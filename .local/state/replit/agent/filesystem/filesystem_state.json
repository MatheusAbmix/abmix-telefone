{"file_contents":{"server/elevenlabs.ts":{"content":"import WebSocket from 'ws';\nimport { EventEmitter } from 'events';\nimport { queries } from './database';\n\nconst ELEVENLABS_API_KEY = process.env.ELEVENLABS_API_KEY;\nconst ELEVENLABS_WS_URL = 'wss://api.elevenlabs.io/v1/text-to-speech';\n\ninterface ElevenLabsSession {\n  ws: WebSocket | null;\n  voiceId: string;\n  model: string;\n  isConnected: boolean;\n  lastActivity: number;\n}\n\nclass ElevenLabsService extends EventEmitter {\n  private sessions = new Map<string, ElevenLabsSession>();\n  private latencyMetrics: number[] = [];\n\n  constructor() {\n    super();\n    this.setupCleanupInterval();\n  }\n\n  // Get voice configuration from database\n  private getVoiceConfig(voiceType: 'masc' | 'fem') {\n    const voiceIdKey = voiceType === 'masc' ? 'VOZ_MASC_ID' : 'VOZ_FEM_ID';\n    const modelKey = 'MODELO';\n    \n    const voiceIdResult = queries.getSetting.get(voiceIdKey) as { value: string } | undefined;\n    const modelResult = queries.getSetting.get(modelKey) as { value: string } | undefined;\n    \n    const voiceId = voiceIdResult?.value || 'pNInz6obpgDQGcFmaJgB';\n    const model = modelResult?.value || 'eleven_multilingual_v2'; // Modelo mais natural\n    \n    return { voiceId, model };\n  }\n\n  // Start TTS session\n  async startTTSSession(sessionId: string, voiceType: 'masc' | 'fem'): Promise<boolean> {\n    try {\n      const { voiceId, model } = this.getVoiceConfig(voiceType);\n      \n      console.log(`[ELEVENLABS] Starting TTS session ${sessionId} with voice ${voiceId}`);\n\n      const ws = new WebSocket(`${ELEVENLABS_WS_URL}/${voiceId}/stream-input?model_id=${model}`, {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY\n        }\n      });\n\n      const session: ElevenLabsSession = {\n        ws,\n        voiceId,\n        model,\n        isConnected: false,\n        lastActivity: Date.now()\n      };\n\n      ws.on('open', () => {\n        console.log(`[ELEVENLABS] TTS session ${sessionId} connected`);\n        session.isConnected = true;\n        session.lastActivity = Date.now();\n        \n        // Configura√ß√£o inicial otimizada para naturalidade\n        ws.send(JSON.stringify({\n          text: \" \",\n          voice_settings: {\n            stability: 0.35,\n            similarity_boost: 0.95,\n            style: 0.15,\n            use_speaker_boost: true\n          },\n          generation_config: {\n            chunk_length_schedule: [120, 160, 250, 290]\n          },\n          optimize_streaming_latency: 0,\n          // Alinha com Twilio Media Stream (8kHz Œº-law/PCM)\n          output_format: \"pcm_8000\"\n        }));\n\n        this.emit('tts-session-ready', sessionId);\n      });\n\n      ws.on('message', (data) => {\n        session.lastActivity = Date.now();\n        const startTime = Date.now();\n        \n        try {\n          const message = JSON.parse(data.toString());\n          \n          if (message.audio) {\n            // Calculate latency\n            const latency = Date.now() - startTime;\n            this.recordLatency(latency);\n            \n            // Emit audio data for Twilio\n            this.emit('tts-audio', sessionId, Buffer.from(message.audio, 'base64'));\n          }\n          \n          if (message.isFinal) {\n            console.log(`[ELEVENLABS] TTS final chunk for session ${sessionId}`);\n          }\n        } catch (error) {\n          console.error(`[ELEVENLABS] Error parsing message:`, error);\n        }\n      });\n\n      ws.on('error', (error) => {\n        console.error(`[ELEVENLABS] TTS session ${sessionId} error:`, error);\n        session.isConnected = false;\n        this.emit('tts-session-error', sessionId, error);\n      });\n\n      ws.on('close', () => {\n        console.log(`[ELEVENLABS] TTS session ${sessionId} closed`);\n        session.isConnected = false;\n        this.sessions.delete(sessionId);\n        this.emit('tts-session-closed', sessionId);\n      });\n\n      this.sessions.set(sessionId, session);\n      return true;\n\n    } catch (error) {\n      console.error(`[ELEVENLABS] Failed to start TTS session:`, error);\n      return false;\n    }\n  }\n\n  // Send text to TTS\n  sendTTSText(sessionId: string, text: string, style?: string): boolean {\n    const session = this.sessions.get(sessionId);\n    \n    if (!session || !session.isConnected || !session.ws) {\n      console.warn(`[ELEVENLABS] TTS session ${sessionId} not available`);\n      return false;\n    }\n\n    try {\n      const voiceSettings: any = {\n        stability: 0.5,\n        similarity_boost: 0.8,\n        use_speaker_boost: true\n      };\n\n      // Apply style if provided\n      if (style) {\n        switch (style) {\n          case 'formal':\n            voiceSettings.stability = 0.7;\n            voiceSettings.style = 0.2;\n            break;\n          case 'simpatico':\n            voiceSettings.stability = 0.3;\n            voiceSettings.style = 0.8;\n            break;\n          default: // neutro\n            voiceSettings.style = 0.0;\n        }\n      }\n\n      session.ws.send(JSON.stringify({\n        text: text,\n        voice_settings: voiceSettings\n      }));\n\n      session.lastActivity = Date.now();\n      return true;\n\n    } catch (error) {\n      console.error(`[ELEVENLABS] Error sending TTS text:`, error);\n      return false;\n    }\n  }\n\n  // Start STT session for captions\n  async startSTTSession(): Promise<WebSocket | null> {\n    try {\n      console.log('[ELEVENLABS] Starting STT session for captions');\n      \n      const sttWs = new WebSocket('wss://api.elevenlabs.io/v1/speech-to-text/stream', {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY\n        }\n      });\n\n      sttWs.on('open', () => {\n        console.log('[ELEVENLABS] STT session connected');\n        \n        // Send configuration\n        sttWs.send(JSON.stringify({\n          language: 'pt',\n          model: 'whisper-large-v3'\n        }));\n      });\n\n      sttWs.on('message', (data) => {\n        try {\n          const result = JSON.parse(data.toString());\n          \n          if (result.text) {\n            this.emit('stt-transcript', {\n              text: result.text,\n              isFinal: result.is_final || false\n            });\n          }\n        } catch (error) {\n          console.error('[ELEVENLABS] STT parse error:', error);\n        }\n      });\n\n      sttWs.on('error', (error) => {\n        console.error('[ELEVENLABS] STT error:', error);\n      });\n\n      return sttWs;\n\n    } catch (error) {\n      console.error('[ELEVENLABS] Failed to start STT session:', error);\n      return null;\n    }\n  }\n\n  // Stop TTS session\n  stopTTSSession(sessionId: string): boolean {\n    const session = this.sessions.get(sessionId);\n    \n    if (session && session.ws) {\n      console.log(`[ELEVENLABS] Stopping TTS session ${sessionId}`);\n      session.ws.close();\n      this.sessions.delete(sessionId);\n      return true;\n    }\n    return false;\n  }\n\n  // Get available voices from ElevenLabs\n  async getVoices(): Promise<any[]> {\n    try {\n      const response = await fetch('https://api.elevenlabs.io/v1/voices', {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY!\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`ElevenLabs API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data.voices || [];\n\n    } catch (error) {\n      console.error('[ELEVENLABS] Failed to fetch voices:', error);\n      return [];\n    }\n  }\n\n  // Record latency metrics\n  private recordLatency(latency: number): void {\n    this.latencyMetrics.push(latency);\n    \n    // Keep only last 10 measurements\n    if (this.latencyMetrics.length > 10) {\n      this.latencyMetrics.shift();\n    }\n  }\n\n  // Get average latency\n  getAverageLatency(): number {\n    if (this.latencyMetrics.length === 0) return 0;\n    \n    const sum = this.latencyMetrics.reduce((a, b) => a + b, 0);\n    return Math.round(sum / this.latencyMetrics.length);\n  }\n\n  // Cleanup inactive sessions\n  private setupCleanupInterval(): void {\n    setInterval(() => {\n      const now = Date.now();\n      const timeout = 300000; // 5 minutes\n      \n      for (const [sessionId, session] of Array.from(this.sessions.entries())) {\n        if (now - session.lastActivity > timeout) {\n          console.log(`[ELEVENLABS] Cleaning up inactive session: ${sessionId}`);\n          this.stopTTSSession(sessionId);\n        }\n      }\n    }, 60000); // Check every minute\n  }\n}\n\nexport const elevenLabsService = new ElevenLabsService();","size_bytes":8372},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/CallRecording.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Dot, \n  Square, \n  Play, \n  Pause, \n  Download, \n  Trash2, \n  Clock, \n  Phone,\n  FileAudio,\n  Volume2\n} from \"lucide-react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface Recording {\n  id: string;\n  filename: string;\n  status: 'recording' | 'paused' | 'completed' | 'failed';\n  startTime: string;\n  endTime?: string;\n  duration?: number;\n  fileSize?: number;\n  transcription?: string;\n  callId?: string;\n  toNumber?: string;\n  fromNumber?: string;\n}\n\ninterface CallRecordingProps {\n  callSid?: string;\n  phoneNumber?: string;\n  isCallActive: boolean;\n}\n\nexport function CallRecording({ callSid, phoneNumber, isCallActive }: CallRecordingProps) {\n  const { toast } = useToast();\n  const [currentRecording, setCurrentRecording] = useState<Recording | null>(null);\n  const [recordingProgress, setRecordingProgress] = useState(0);\n  const [playingAudio, setPlayingAudio] = useState<string | null>(null);\n\n  // Fetch all recordings\n  const { data: recordings = [], refetch: refetchRecordings } = useQuery<Recording[]>({\n    queryKey: ['/api/recordings/list'],\n    refetchInterval: currentRecording?.status === 'recording' ? 2000 : false,\n  });\n\n  // Start recording mutation\n  const startRecordingMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/recordings/start', {\n        callSid,\n        phoneNumber\n      });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setCurrentRecording(data);\n      toast({\n        title: \"üî¥ Grava√ß√£o Iniciada\",\n        description: `Gravando chamada para ${phoneNumber}`,\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro na Grava√ß√£o\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Pause recording mutation\n  const pauseRecordingMutation = useMutation({\n    mutationFn: async (recordingId: string) => {\n      const response = await apiRequest('POST', `/api/recordings/${recordingId}/pause`);\n      return response.json();\n    },\n    onSuccess: () => {\n      setCurrentRecording(prev => prev ? { ...prev, status: 'paused' } : null);\n      toast({\n        title: \"‚è∏Ô∏è Grava√ß√£o Pausada\",\n        description: \"A grava√ß√£o foi pausada\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Resume recording mutation\n  const resumeRecordingMutation = useMutation({\n    mutationFn: async (recordingId: string) => {\n      const response = await apiRequest('POST', `/api/recordings/${recordingId}/resume`);\n      return response.json();\n    },\n    onSuccess: () => {\n      setCurrentRecording(prev => prev ? { ...prev, status: 'recording' } : null);\n      toast({\n        title: \"‚ñ∂Ô∏è Grava√ß√£o Retomada\",\n        description: \"A grava√ß√£o foi retomada\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Stop recording mutation\n  const stopRecordingMutation = useMutation({\n    mutationFn: async (recordingId: string) => {\n      const response = await apiRequest('POST', `/api/recordings/${recordingId}/stop`);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setCurrentRecording(null);\n      setRecordingProgress(0);\n      toast({\n        title: \"‚èπÔ∏è Grava√ß√£o Finalizada\",\n        description: `Arquivo salvo: ${data.filename}`,\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete recording mutation\n  const deleteRecordingMutation = useMutation({\n    mutationFn: async (recordingId: string) => {\n      const response = await apiRequest('DELETE', `/api/recordings/${recordingId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"üóëÔ∏è Grava√ß√£o Removida\",\n        description: \"A grava√ß√£o foi removida com sucesso\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update recording progress\n  useEffect(() => {\n    let interval: NodeJS.Timeout;\n    \n    if (currentRecording?.status === 'recording') {\n      interval = setInterval(() => {\n        setRecordingProgress(prev => Math.min(prev + 1, 100));\n      }, 1000);\n    }\n\n    return () => {\n      if (interval) clearInterval(interval);\n    };\n  }, [currentRecording?.status]);\n\n  // Play audio function\n  const playAudio = async (recordingId: string, filename: string) => {\n    try {\n      if (playingAudio === recordingId) {\n        setPlayingAudio(null);\n        return;\n      }\n\n      setPlayingAudio(recordingId);\n      \n      const response = await fetch(`/api/recordings/${recordingId}/download`);\n      const blob = await response.blob();\n      const audioUrl = URL.createObjectURL(blob);\n      const audio = new Audio(audioUrl);\n      \n      audio.onended = () => {\n        setPlayingAudio(null);\n        URL.revokeObjectURL(audioUrl);\n      };\n      \n      audio.onerror = () => {\n        setPlayingAudio(null);\n        URL.revokeObjectURL(audioUrl);\n        toast({\n          title: \"Erro na Reprodu√ß√£o\",\n          description: \"N√£o foi poss√≠vel reproduzir a grava√ß√£o\",\n          variant: \"destructive\",\n        });\n      };\n\n      await audio.play();\n    } catch (error) {\n      setPlayingAudio(null);\n      toast({\n        title: \"Erro na Reprodu√ß√£o\",\n        description: \"Falha ao reproduzir √°udio\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const downloadRecording = (recordingId: string, filename: string) => {\n    const link = document.createElement('a');\n    link.href = `/api/recordings/${recordingId}/download`;\n    link.download = filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const formatDuration = (seconds?: number) => {\n    if (!seconds) return \"00:00\";\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const formatFileSize = (bytes?: number) => {\n    if (!bytes) return \"0 B\";\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(1024));\n    return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'recording': return 'bg-red-500';\n      case 'paused': return 'bg-yellow-500';\n      case 'completed': return 'bg-green-500';\n      case 'failed': return 'bg-gray-500';\n      default: return 'bg-gray-400';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'recording': return 'Gravando';\n      case 'paused': return 'Pausada';\n      case 'completed': return 'Conclu√≠da';\n      case 'failed': return 'Falhou';\n      default: return 'Desconhecido';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Current Recording Controls */}\n      {isCallActive && (\n        <Card className=\"border-red-200 dark:border-red-800\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-red-700 dark:text-red-300\">\n              <Dot className=\"h-5 w-5\" />\n              Controles de Grava√ß√£o\n            </CardTitle>\n            <CardDescription>\n              Gerencie a grava√ß√£o da chamada atual para {phoneNumber}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {!currentRecording ? (\n              <Button \n                onClick={() => startRecordingMutation.mutate()}\n                disabled={startRecordingMutation.isPending}\n                className=\"w-full bg-red-600 hover:bg-red-700\"\n                data-testid=\"button-start-recording\"\n              >\n                <Dot className=\"h-4 w-4 mr-2\" />\n                Iniciar Grava√ß√£o\n              </Button>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Badge className={getStatusColor(currentRecording.status)} data-testid=\"badge-recording-status\">\n                    {getStatusText(currentRecording.status)}\n                  </Badge>\n                  <span className=\"text-sm font-mono\" data-testid=\"text-recording-duration\">\n                    {Math.floor(recordingProgress / 60).toString().padStart(2, '0')}:\n                    {(recordingProgress % 60).toString().padStart(2, '0')}\n                  </span>\n                </div>\n                \n                {currentRecording.status === 'recording' && (\n                  <Progress value={recordingProgress} className=\"w-full\" />\n                )}\n\n                <div className=\"flex gap-2\">\n                  {currentRecording.status === 'recording' ? (\n                    <Button\n                      onClick={() => pauseRecordingMutation.mutate(currentRecording.id)}\n                      disabled={pauseRecordingMutation.isPending}\n                      variant=\"outline\"\n                      data-testid=\"button-pause-recording\"\n                    >\n                      <Pause className=\"h-4 w-4 mr-2\" />\n                      Pausar\n                    </Button>\n                  ) : currentRecording.status === 'paused' ? (\n                    <Button\n                      onClick={() => resumeRecordingMutation.mutate(currentRecording.id)}\n                      disabled={resumeRecordingMutation.isPending}\n                      variant=\"outline\"\n                      data-testid=\"button-resume-recording\"\n                    >\n                      <Play className=\"h-4 w-4 mr-2\" />\n                      Continuar\n                    </Button>\n                  ) : null}\n                  \n                  <Button\n                    onClick={() => stopRecordingMutation.mutate(currentRecording.id)}\n                    disabled={stopRecordingMutation.isPending}\n                    variant=\"destructive\"\n                    data-testid=\"button-stop-recording\"\n                  >\n                    <Square className=\"h-4 w-4 mr-2\" />\n                    Finalizar\n                  </Button>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Recordings List */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <FileAudio className=\"h-5 w-5\" />\n            Grava√ß√µes Salvas\n          </CardTitle>\n          <CardDescription>\n            Hist√≥rico de grava√ß√µes de chamadas com reprodu√ß√£o e download\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {recordings.length === 0 ? (\n            <div className=\"text-center py-8 text-muted-foreground\" data-testid=\"text-no-recordings\">\n              <FileAudio className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>Nenhuma grava√ß√£o dispon√≠vel</p>\n              <p className=\"text-sm\">As grava√ß√µes aparecer√£o aqui ap√≥s serem finalizadas</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {recordings.map((recording) => (\n                <div \n                  key={recording.id} \n                  className=\"flex items-center justify-between p-4 border rounded-lg\"\n                  data-testid={`recording-item-${recording.id}`}\n                >\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"flex flex-col items-center\">\n                      <Badge className={getStatusColor(recording.status)} data-testid={`badge-status-${recording.id}`}>\n                        {getStatusText(recording.status)}\n                      </Badge>\n                      <div className=\"text-xs text-muted-foreground mt-1\">\n                        <Clock className=\"h-3 w-3 inline mr-1\" />\n                        {formatDuration(recording.duration)}\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-1\">\n                      <div className=\"font-medium\" data-testid={`text-filename-${recording.id}`}>\n                        {recording.filename}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground flex items-center gap-2\">\n                        <Phone className=\"h-3 w-3\" />\n                        {recording.toNumber && (\n                          <span data-testid={`text-number-${recording.id}`}>\n                            Para: {recording.toNumber}\n                          </span>\n                        )}\n                        {recording.fromNumber && (\n                          <span>De: {recording.fromNumber}</span>\n                        )}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {new Date(recording.startTime).toLocaleString('pt-BR')}\n                        {recording.fileSize && ` ‚Ä¢ ${formatFileSize(recording.fileSize)}`}\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    {recording.status === 'completed' && (\n                      <>\n                        <Button\n                          onClick={() => playAudio(recording.id, recording.filename)}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          disabled={!!playingAudio && playingAudio !== recording.id}\n                          data-testid={`button-play-${recording.id}`}\n                        >\n                          {playingAudio === recording.id ? (\n                            <>\n                              <Volume2 className=\"h-4 w-4 mr-2\" />\n                              Tocando...\n                            </>\n                          ) : (\n                            <>\n                              <Play className=\"h-4 w-4 mr-2\" />\n                              Reproduzir\n                            </>\n                          )}\n                        </Button>\n\n                        <Button\n                          onClick={() => downloadRecording(recording.id, recording.filename)}\n                          variant=\"outline\"\n                          size=\"sm\"\n                          data-testid={`button-download-${recording.id}`}\n                        >\n                          <Download className=\"h-4 w-4 mr-2\" />\n                          Download\n                        </Button>\n                      </>\n                    )}\n\n                    <Button\n                      onClick={() => deleteRecordingMutation.mutate(recording.id)}\n                      disabled={deleteRecordingMutation.isPending}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"text-red-600 hover:text-red-700\"\n                      data-testid={`button-delete-${recording.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":16388},"client/src/services/api.ts":{"content":"import { apiRequest } from '@/lib/queryClient';\n\nexport const api = {\n  // === TELEPHONY ENDPOINTS ===\n  \n  startCall: async (provider: string, toNumber: string, voiceType: string = 'masc') => {\n    const response = await apiRequest('POST', '/api/call/dial', {\n      to: toNumber,\n      voiceType,\n    });\n    return response.json();\n  },\n\n  hangupCall: async (callSid: string) => {\n    const response = await apiRequest('POST', '/api/call/hangup', { callSid });\n    return response.json();\n  },\n\n  sendDTMF: async (callSid: string, digits: string) => {\n    const response = await apiRequest('POST', '/api/call/dtmf', { callSid, digits });\n    return response.json();\n  },\n\n  answerCall: async (callSid: string) => {\n    const response = await apiRequest('POST', '/api/call/answer', { callSid });\n    return response.json();\n  },\n\n  // === RECORDING ENDPOINTS ===\n  \n  startRecording: async (callSid: string, phoneNumber?: string) => {\n    const response = await apiRequest('POST', '/api/recordings/start', { \n      callSid,\n      phoneNumber: phoneNumber || 'Unknown'\n    });\n    return response.json();\n  },\n\n  pauseRecording: async (recordingId: number) => {\n    const response = await apiRequest('POST', `/api/recordings/${recordingId}/pause`);\n    return response.json();\n  },\n\n  resumeRecording: async (recordingId: number) => {\n    const response = await apiRequest('POST', `/api/recordings/${recordingId}/resume`);\n    return response.json();\n  },\n\n  stopRecording: async (recordingId: number) => {\n    const response = await apiRequest('POST', `/api/recordings/${recordingId}/stop`);\n    return response.json();\n  },\n\n  getRecordings: async () => {\n    const response = await apiRequest('GET', '/api/recordings/list');\n    return response.json();\n  },\n\n  downloadRecording: async (id: string) => {\n    const response = await fetch(`/api/recordings/${id}/download`);\n    return response.blob();\n  },\n\n  deleteRecording: async (id: string) => {\n    const response = await apiRequest('DELETE', `/api/recordings/${id}`);\n    return response.json();\n  },\n\n  // === AI/AGENT ENDPOINTS ===\n  \n  injectPrompt: async (callSid: string, text: string) => {\n    const response = await apiRequest('POST', '/api/agent/prompt', { text, callSid });\n    return response.json();\n  },\n\n  pauseAI: async (callSid: string) => {\n    const response = await apiRequest('POST', '/api/agent/disable', { callSid });\n    return response.json();\n  },\n\n  resumeAI: async (callSid: string) => {\n    const response = await apiRequest('POST', '/api/agent/enable', { callSid });\n    return response.json();\n  },\n\n  // === VOICE/TTS ENDPOINTS ===\n  \n  getVoices: async () => {\n    const response = await apiRequest('GET', '/api/voices');\n    return response.json();\n  },\n\n  testVoice: async (voiceId: string, text: string) => {\n    const response = await fetch('/api/voices/test', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ voiceId, text })\n    });\n    return response;\n  },\n\n  // === FAVORITES ENDPOINTS ===\n  \n  getFavorites: async () => {\n    const response = await apiRequest('GET', '/api/favorites');\n    return response.json();\n  },\n\n  addFavorite: async (favorite: { name: string; phone_e164: string; voice_type?: 'masc' | 'fem' }) => {\n    const response = await apiRequest('POST', '/api/favorites/add', favorite);\n    return response.json();\n  },\n\n  removeFavorite: async (id: string) => {\n    const response = await apiRequest('DELETE', `/api/favorites/${id}`);\n    return response.json();\n  },\n\n  // === SETTINGS ENDPOINTS ===\n  \n  getSettings: async () => {\n    const response = await apiRequest('GET', '/api/settings');\n    return response.json();\n  },\n\n  updateSettings: async (settings: Record<string, string>) => {\n    const response = await apiRequest('POST', '/api/settings', settings);\n    return response.json();\n  },\n\n  // === TRANSCRIPTS ENDPOINTS ===\n  \n  getTranscripts: async (callId: string) => {\n    const response = await apiRequest('GET', `/api/transcripts/${callId}`);\n    return response.json();\n  },\n\n  // === LEGACY COMPATIBILITY ===\n  \n  sendLivePrompt: async (text: string, style?: string) => {\n    const response = await apiRequest('POST', '/api/agent/prompt', { text, style });\n    return response.json();\n  },\n};","size_bytes":4288},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"server/recordingService.ts":{"content":"import { existsSync, mkdirSync, writeFileSync, readFileSync, statSync, createWriteStream, createReadStream } from 'fs';\nimport { join } from 'path';\nimport { db } from './db';\nimport { recordings, calls } from '@shared/schema';\nimport { eq, desc } from 'drizzle-orm';\n\nexport class RecordingService {\n  private recordingsDir: string;\n  private activeRecordings = new Map<string, NodeJS.Timeout>();\n\n  constructor() {\n    this.recordingsDir = join(process.cwd(), 'recordings');\n    this.ensureRecordingsDirectory();\n  }\n\n  private ensureRecordingsDirectory(): void {\n    if (!existsSync(this.recordingsDir)) {\n      mkdirSync(this.recordingsDir, { recursive: true });\n    }\n  }\n\n  async startRecording(callId: string, callSid?: string, phoneNumber?: string): Promise<any> {\n    try {\n      const timestamp = Date.now();\n      const filename = `call-${phoneNumber || 'unknown'}-${timestamp}.wav`;\n      const filePath = join(this.recordingsDir, filename);\n\n      // Create recording record in database\n      const [recording] = await db\n        .insert(recordings)\n        .values({\n          callId,\n          twilioRecordingSid: callSid,\n          filename,\n          status: 'recording',\n          metadata: { phoneNumber, startedAt: new Date().toISOString() }\n        })\n        .returning();\n\n      // Update call record with recording status\n      await db\n        .update(calls)\n        .set({ recordingStatus: 'recording' })\n        .where(eq(calls.id, callId));\n\n      // Start simulated recording (in production, this would handle Twilio recording)\n      this.startSimulatedRecording(recording.id, filePath);\n\n      console.log(`[RECORDING] Started recording ${recording.id}: ${filename}`);\n      \n      return {\n        id: recording.id,\n        filename,\n        status: 'recording',\n        callId,\n        startTime: recording.startTime\n      };\n    } catch (error) {\n      console.error('[RECORDING] Error starting recording:', error);\n      throw error;\n    }\n  }\n\n  async pauseRecording(recordingId: string): Promise<any> {\n    try {\n      // Clear any active recording timeout\n      const timeout = this.activeRecordings.get(recordingId);\n      if (timeout) {\n        clearTimeout(timeout);\n        this.activeRecordings.delete(recordingId);\n      }\n\n      // Update recording status in database\n      const [recording] = await db\n        .update(recordings)\n        .set({ \n          status: 'paused',\n          metadata: db.select({ metadata: recordings.metadata }).from(recordings).where(eq(recordings.id, recordingId)).then(res => ({\n            ...res[0]?.metadata as any,\n            pausedAt: new Date().toISOString()\n          }))\n        })\n        .where(eq(recordings.id, recordingId))\n        .returning();\n\n      if (!recording) {\n        throw new Error('Recording not found');\n      }\n\n      console.log(`[RECORDING] Paused recording ${recordingId}`);\n      \n      return {\n        id: recordingId,\n        status: 'paused',\n        message: 'Recording paused successfully'\n      };\n    } catch (error) {\n      console.error('[RECORDING] Error pausing recording:', error);\n      throw error;\n    }\n  }\n\n  async resumeRecording(recordingId: string): Promise<any> {\n    try {\n      // Get recording details\n      const [recording] = await db\n        .select()\n        .from(recordings)\n        .where(eq(recordings.id, recordingId));\n\n      if (!recording) {\n        throw new Error('Recording not found');\n      }\n\n      // Update recording status\n      const [updatedRecording] = await db\n        .update(recordings)\n        .set({ \n          status: 'recording',\n          metadata: {\n            ...recording.metadata as any,\n            resumedAt: new Date().toISOString()\n          }\n        })\n        .where(eq(recordings.id, recordingId))\n        .returning();\n\n      // Resume simulated recording\n      const filePath = join(this.recordingsDir, recording.filename);\n      this.startSimulatedRecording(recordingId, filePath, true);\n\n      console.log(`[RECORDING] Resumed recording ${recordingId}`);\n      \n      return {\n        id: recordingId,\n        status: 'recording',\n        message: 'Recording resumed successfully'\n      };\n    } catch (error) {\n      console.error('[RECORDING] Error resuming recording:', error);\n      throw error;\n    }\n  }\n\n  async stopRecording(recordingId: string): Promise<any> {\n    try {\n      // Clear any active recording timeout\n      const timeout = this.activeRecordings.get(recordingId);\n      if (timeout) {\n        clearTimeout(timeout);\n        this.activeRecordings.delete(recordingId);\n      }\n\n      // Get recording details\n      const [recording] = await db\n        .select()\n        .from(recordings)\n        .where(eq(recordings.id, recordingId));\n\n      if (!recording) {\n        throw new Error('Recording not found');\n      }\n\n      const filePath = join(this.recordingsDir, recording.filename);\n      \n      // Generate audio file if it doesn't exist\n      if (!existsSync(filePath)) {\n        this.generateDemoAudioFile(filePath);\n      }\n\n      // Calculate file size and duration\n      const stats = statSync(filePath);\n      const duration = this.calculateAudioDuration(filePath);\n\n      // Update recording with completion details\n      const [updatedRecording] = await db\n        .update(recordings)\n        .set({\n          status: 'completed',\n          endTime: new Date(),\n          duration,\n          fileSize: stats.size,\n          metadata: {\n            ...recording.metadata as any,\n            completedAt: new Date().toISOString(),\n            filePath\n          }\n        })\n        .where(eq(recordings.id, recordingId))\n        .returning();\n\n      // Update call record\n      if (recording.callId) {\n        await db\n          .update(calls)\n          .set({ \n            recordingStatus: 'completed',\n            recordingUrl: `/api/recordings/${recordingId}/download`\n          })\n          .where(eq(calls.id, recording.callId));\n      }\n\n      console.log(`[RECORDING] Completed recording ${recordingId}: ${recording.filename}`);\n      \n      return {\n        id: recordingId,\n        filename: recording.filename,\n        status: 'completed',\n        duration,\n        fileSize: stats.size,\n        downloadUrl: `/api/recordings/${recordingId}/download`\n      };\n    } catch (error) {\n      console.error('[RECORDING] Error stopping recording:', error);\n      throw error;\n    }\n  }\n\n  async getRecording(recordingId: string): Promise<any> {\n    try {\n      const [recording] = await db\n        .select({\n          id: recordings.id,\n          filename: recordings.filename,\n          status: recordings.status,\n          startTime: recordings.startTime,\n          endTime: recordings.endTime,\n          duration: recordings.duration,\n          fileSize: recordings.fileSize,\n          transcription: recordings.transcription,\n          metadata: recordings.metadata,\n          callId: recordings.callId,\n          toNumber: calls.toNumber,\n          fromNumber: calls.fromNumber\n        })\n        .from(recordings)\n        .leftJoin(calls, eq(recordings.callId, calls.id))\n        .where(eq(recordings.id, recordingId));\n\n      if (!recording) {\n        throw new Error('Recording not found');\n      }\n\n      return recording;\n    } catch (error) {\n      console.error('[RECORDING] Error getting recording:', error);\n      throw error;\n    }\n  }\n\n  async getAllRecordings(): Promise<any[]> {\n    try {\n      const recordingsList = await db\n        .select({\n          id: recordings.id,\n          filename: recordings.filename,\n          status: recordings.status,\n          startTime: recordings.startTime,\n          endTime: recordings.endTime,\n          duration: recordings.duration,\n          fileSize: recordings.fileSize,\n          transcription: recordings.transcription,\n          callId: recordings.callId,\n          toNumber: calls.toNumber,\n          fromNumber: calls.fromNumber\n        })\n        .from(recordings)\n        .leftJoin(calls, eq(recordings.callId, calls.id))\n        .orderBy(desc(recordings.startTime));\n\n      return recordingsList;\n    } catch (error) {\n      console.error('[RECORDING] Error getting recordings:', error);\n      throw error;\n    }\n  }\n\n  async getRecordingFile(recordingId: string): Promise<{ filePath: string; filename: string; mimeType: string }> {\n    try {\n      const [recording] = await db\n        .select()\n        .from(recordings)\n        .where(eq(recordings.id, recordingId));\n\n      if (!recording) {\n        throw new Error('Recording not found');\n      }\n\n      const filePath = join(this.recordingsDir, recording.filename);\n      \n      if (!existsSync(filePath)) {\n        // Generate demo file if it doesn't exist\n        this.generateDemoAudioFile(filePath);\n      }\n\n      return {\n        filePath,\n        filename: recording.filename,\n        mimeType: 'audio/wav'\n      };\n    } catch (error) {\n      console.error('[RECORDING] Error getting recording file:', error);\n      throw error;\n    }\n  }\n\n  private startSimulatedRecording(recordingId: string, filePath: string, isResume = false): void {\n    // Simulate recording process with periodic updates\n    const updateInterval = setInterval(() => {\n      // In production, this would handle real audio stream processing\n      console.log(`[RECORDING] Recording ${recordingId} in progress...`);\n    }, 5000);\n\n    // Store the interval for cleanup\n    this.activeRecordings.set(recordingId, updateInterval);\n\n    // Auto-complete after 30 seconds for demo purposes\n    setTimeout(() => {\n      if (this.activeRecordings.has(recordingId)) {\n        this.generateDemoAudioFile(filePath);\n        clearInterval(updateInterval);\n        this.activeRecordings.delete(recordingId);\n      }\n    }, 30000);\n  }\n\n  private generateDemoAudioFile(filePath: string): void {\n    // Generate a simple WAV file with a tone for demo purposes\n    const duration = 10; // 10 seconds\n    const sampleRate = 44100;\n    const channels = 1;\n    const bitsPerSample = 16;\n    const blockAlign = channels * bitsPerSample / 8;\n    const byteRate = sampleRate * blockAlign;\n    const dataSize = duration * byteRate;\n    const fileSize = 36 + dataSize;\n\n    const header = Buffer.alloc(44);\n    \n    // WAV header\n    header.write('RIFF', 0);\n    header.writeUInt32LE(fileSize, 4);\n    header.write('WAVE', 8);\n    header.write('fmt ', 12);\n    header.writeUInt32LE(16, 16);\n    header.writeUInt16LE(1, 20);\n    header.writeUInt16LE(channels, 22);\n    header.writeUInt32LE(sampleRate, 24);\n    header.writeUInt32LE(byteRate, 28);\n    header.writeUInt16LE(blockAlign, 32);\n    header.writeUInt16LE(bitsPerSample, 34);\n    header.write('data', 36);\n    header.writeUInt32LE(dataSize, 40);\n\n    // Generate audio data (simple tone)\n    const audioData = Buffer.alloc(dataSize);\n    const frequency = 440; // A4 note\n    \n    for (let i = 0; i < dataSize / 2; i++) {\n      const sample = Math.sin(2 * Math.PI * frequency * i / sampleRate) * 0.3 * 32767;\n      audioData.writeInt16LE(Math.round(sample), i * 2);\n    }\n\n    writeFileSync(filePath, Buffer.concat([header, audioData]));\n  }\n\n  private calculateAudioDuration(filePath: string): number {\n    try {\n      const stats = statSync(filePath);\n      // Simple duration calculation for WAV files (assuming 44.1kHz, 16-bit, mono)\n      return Math.round((stats.size - 44) / (44100 * 2));\n    } catch {\n      return 0;\n    }\n  }\n}\n\nexport const recordingService = new RecordingService();","size_bytes":11453},"client/src/components/CallManager.tsx":{"content":"import { useState } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\n\nexport function CallManager() {\n  const { toast } = useToast();\n  const { currentCallId, callState } = useCallStore();\n  const [searchCallId, setSearchCallId] = useState('');\n\n  // Mock data for call management - will be replaced with actual API calls\n  const callHistory = [\n    {\n      id: 'CA123456789',\n      to: '+5511999999999',\n      status: 'completed',\n      duration: '2m 35s',\n      startTime: '2025-08-15 10:30:00'\n    },\n    {\n      id: 'CA987654321',\n      to: '+5511888888888',\n      status: 'busy',\n      duration: '0s',\n      startTime: '2025-08-15 10:25:00'\n    }\n  ];\n\n  const handleSearchCall = () => {\n    if (!searchCallId.trim()) {\n      toast({\n        title: \"Campo vazio\",\n        description: \"Digite um Call SID para pesquisar\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    toast({\n      title: \"Pesquisando chamada\",\n      description: `Buscando informa√ß√µes para: ${searchCallId}`,\n    });\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'completed': return 'text-green-400';\n      case 'busy': return 'text-yellow-400';\n      case 'failed': return 'text-red-400';\n      case 'in-progress': return 'text-abmix-green';\n      default: return 'text-gray-400';\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case 'completed': return 'Conclu√≠da';\n      case 'busy': return 'Ocupado';\n      case 'failed': return 'Falhou';\n      case 'in-progress': return 'Em andamento';\n      default: return status;\n    }\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Controle de Chamadas</h3>\n      \n      <div className=\"space-y-6\">\n        {/* Current Call Status */}\n        {currentCallId && (\n          <div className=\"p-4 bg-dark-bg rounded-lg border border-dark-border\">\n            <h4 className=\"text-sm font-medium text-foreground mb-2\">Chamada Ativa</h4>\n            <div className=\"space-y-2\">\n              <p className=\"text-sm text-gray-400\">\n                <span className=\"font-medium\">Call SID:</span> {currentCallId}\n              </p>\n              <p className=\"text-sm text-gray-400\">\n                <span className=\"font-medium\">Status:</span> \n                <span className={`ml-1 ${getStatusColor(callState.toLowerCase())}`}>\n                  {getStatusText(callState.toLowerCase())}\n                </span>\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* Call Search */}\n        <div className=\"space-y-3\">\n          <Label htmlFor=\"call-search\" className=\"text-sm font-medium text-foreground\">\n            Consultar Chamada\n          </Label>\n          <div className=\"flex space-x-2\">\n            <Input\n              id=\"call-search\"\n              type=\"text\"\n              placeholder=\"Digite o Call SID (ex: CA1234567890abcdef)\"\n              value={searchCallId}\n              onChange={(e) => setSearchCallId(e.target.value)}\n              className=\"flex-1\"\n              data-testid=\"call-search-input\"\n            />\n            <Button\n              onClick={handleSearchCall}\n              className=\"bg-abmix-green text-black hover:bg-abmix-green/80\"\n              data-testid=\"search-call-button\"\n            >\n              Buscar\n            </Button>\n          </div>\n        </div>\n\n        {/* Recent Calls */}\n        <div>\n          <h4 className=\"text-sm font-medium text-foreground mb-3\">Chamadas Recentes</h4>\n          <div className=\"space-y-2\">\n            {callHistory.map((call) => (\n              <div key={call.id} className=\"p-3 bg-dark-bg rounded-lg border border-dark-border\">\n                <div className=\"flex justify-between items-start\">\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-foreground\">{call.to}</p>\n                    <p className=\"text-xs text-gray-400\">\n                      {call.id} ‚Ä¢ {call.startTime}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className={`text-sm ${getStatusColor(call.status)}`}>\n                      {getStatusText(call.status)}\n                    </p>\n                    <p className=\"text-xs text-gray-400\">{call.duration}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border\">\n          <p className=\"text-xs text-gray-400\">\n            <strong>Funcionalidade:</strong> Consulte e controle chamadas via API Twilio.\n            Visualize hist√≥rico, status em tempo real e detalhes de cada chamada.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5127},"scripts/quick-fix-port.sh":{"content":"#!/bin/bash\n\n# Script r√°pido para corrigir porta sem conflito\nVPS_HOST=\"root@juliocamara.dev\"\nVPS_PATH=\"/var/www/juliocamara.dev/abmix-ligacao\"\n\necho \"‚ö° Corre√ß√£o R√°pida - Mudan√ßa para Porta 5001\"\necho \"üì° Conectando: $VPS_HOST\"\necho \"\"\n\nssh $VPS_HOST << 'EOF'\ncd /var/www/juliocamara.dev/abmix-ligacao\n\necho \"üìã 1. Verificando situa√ß√£o atual...\"\necho \"   Processos na porta 3000: $(ss -ltn | grep :3000 | wc -l)\"\necho \"   Processos na porta 5001: $(ss -ltn | grep :5001 | wc -l)\"\necho \"   Status PM2:\"\npm2 status abmix-ligacao 2>/dev/null || echo \"   (Processo n√£o encontrado)\"\n\necho \"\"\necho \"üîß 2. Configurando porta 5001 no .env...\"\n# Atualizar ou adicionar PORT=5001\nif grep -q \"^PORT=\" .env 2>/dev/null; then\n    sed -i 's/^PORT=.*/PORT=5001/' .env\nelse\n    echo \"PORT=5001\" >> .env\nfi\n\necho \"   ‚úÖ .env atualizado:\"\ngrep \"PORT=\" .env || echo \"   ‚ùå Erro ao configurar PORT\"\n\necho \"\"\necho \"üöÄ 3. Reiniciando com nova porta...\"\n\n# Parar processo atual\npm2 stop abmix-ligacao 2>/dev/null || echo \"   (Nenhum processo para parar)\"\n\n# Matar qualquer coisa na porta 5001\nfuser -k 5001/tcp 2>/dev/null || echo \"   (Porta 5001 livre)\"\n\n# Iniciar com nova porta\nPORT=5001 pm2 start dist/index.js --name \"abmix-ligacao\" --update-env\n\necho \"\"\necho \"üíæ 4. Salvando configura√ß√£o...\"\npm2 save\n\necho \"\"\necho \"üìä 5. Verifica√ß√£o final:\"\necho \"   Status PM2:\"\npm2 status abmix-ligacao\n\necho \"   Porta em uso:\"\nss -ltnp | grep :5001 || echo \"   ‚ùå Processo n√£o encontrado na porta 5001\"\n\necho \"\"\necho \"üß™ 6. Teste local:\"\nsleep 3\ncurl -s http://localhost:5001/api/health || echo \"   ‚ùå Endpoint n√£o responde\"\n\necho \"\"\necho \"üìã 7. Atualizando Nginx...\"\nif [ -f \"juliocamara.dev\" ]; then\n    sudo cp juliocamara.dev /etc/nginx/sites-available/\n    sudo nginx -t && sudo systemctl reload nginx\n    echo \"   ‚úÖ Nginx atualizado\"\nelse\n    echo \"   ‚ö†Ô∏è  Arquivo juliocamara.dev n√£o encontrado\"\nfi\nEOF\n\necho \"\"\necho \"üåê Testando acesso externo...\"\nsleep 5\n\nHTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"https://juliocamara.dev/abmix-ligacao/api/health\" 2>/dev/null || echo \"000\")\n\nif [ \"$HTTP_STATUS\" = \"200\" ]; then\n    echo \"‚úÖ CORRE√á√ÉO BEM-SUCEDIDA!\"\n    echo \"\"\n    echo \"üéâ SISTEMA FUNCIONANDO SEM CONFLITOS!\"\n    echo \"\"\n    echo \"üì± Acesse: https://juliocamara.dev/abmix-ligacao\"\n    echo \"üé§ Teste convers√£o de voz agora!\"\n    echo \"\"\n    echo \"üìä Configura√ß√£o final:\"\n    echo \"   ‚Ä¢ Sistema existente: porta 3000 ‚úÖ\"\n    echo \"   ‚Ä¢ Abmix Liga√ß√£o: porta 5001 ‚úÖ\"\n    echo \"   ‚Ä¢ Nginx: configurado para ambos ‚úÖ\"\n    \nelif [ \"$HTTP_STATUS\" = \"502\" ]; then\n    echo \"‚ö†Ô∏è  Erro 502: Aplica√ß√£o n√£o est√° rodando na porta 5001\"\n    echo \"   Execute: ssh $VPS_HOST 'pm2 logs abmix-ligacao'\"\n    \nelif [ \"$HTTP_STATUS\" = \"000\" ]; then\n    echo \"‚ö†Ô∏è  N√£o foi poss√≠vel testar\"\n    echo \"   Teste manualmente: https://juliocamara.dev/abmix-ligacao\"\n    \nelse\n    echo \"‚ùå Status: $HTTP_STATUS\"\n    echo \"   Verifique logs: ssh $VPS_HOST 'pm2 logs abmix-ligacao'\"\nfi\n\n\n\n\n\n","size_bytes":3036},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"scripts/quick-fix.sh":{"content":"#!/bin/bash\n\n# Script de corre√ß√£o r√°pida para executar no servidor VPS\n# Execute como: bash quick-fix.sh\n\necho \"üîß CORRE√á√ÉO R√ÅPIDA - AbmixDialer\"\necho \"===============================\"\n\n# Navegar para o diret√≥rio\ncd /var/www/juliocamara.dev/abmix-ligacao || {\n    echo \"‚ùå Diret√≥rio n√£o encontrado. Criando...\"\n    mkdir -p /var/www/juliocamara.dev/abmix-ligacao\n    cd /var/www/juliocamara.dev/abmix-ligacao\n}\n\n# Parar processo existente\necho \"üõë Parando processos existentes...\"\npm2 stop abmix-ligacao 2>/dev/null || true\npm2 delete abmix-ligacao 2>/dev/null || true\n\n# Verificar se os arquivos existem\nif [ ! -f \"dist/index.js\" ]; then\n    echo \"‚ùå Arquivo dist/index.js n√£o encontrado!\"\n    echo \"Execute o deploy primeiro com: npm run deploy:fix\"\n    exit 1\nfi\n\n# Configurar .env se n√£o existir\nif [ ! -f \".env\" ]; then\n    echo \"üìù Criando arquivo .env...\"\n    cat > .env << 'EOF'\nPORT=5001\nNODE_ENV=production\n\n# Configure suas chaves API:\nTWILIO_ACCOUNT_SID=your_twilio_sid\nTWILIO_AUTH_TOKEN=your_twilio_token  \nTWILIO_NUMBER=your_twilio_number\nELEVENLABS_API_KEY=your_elevenlabs_key\n\n# URLs p√∫blicas\nPUBLIC_BASE_URL=https://juliocamara.dev/abmix-ligacao\nEOF\n    echo \"‚ö†Ô∏è  IMPORTANTE: Configure suas chaves API no arquivo .env\"\nfi\n\n# Garantir que PORT=5001 esteja no .env\nif ! grep -q \"PORT=5001\" .env; then\n    echo \"PORT=5001\" >> .env\nfi\n\n# Instalar depend√™ncias se necess√°rio\nif [ ! -d \"node_modules\" ]; then\n    echo \"üì¶ Instalando depend√™ncias...\"\n    npm install --production\nfi\n\n# Ajustar permiss√µes\necho \"üîí Ajustando permiss√µes...\"\nchown -R www-data:www-data /var/www/juliocamara.dev/abmix-ligacao/\nchmod -R 755 /var/www/juliocamara.dev/abmix-ligacao/\n\n# Verificar configura√ß√£o do nginx\necho \"üåê Verificando nginx...\"\nnginx -t\nif [ $? -eq 0 ]; then\n    echo \"‚úÖ Nginx configura√ß√£o OK\"\n    systemctl reload nginx\nelse\n    echo \"‚ùå Erro na configura√ß√£o do nginx\"\nfi\n\n# Iniciar aplica√ß√£o\necho \"üöÄ Iniciando aplica√ß√£o na porta 5001...\"\nPORT=5001 pm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\n# Aguardar um pouco\nsleep 3\n\n# Verificar status\necho \"üìä Status da aplica√ß√£o:\"\npm2 status\n\n# Testar conectividade\necho \"üß™ Testando conectividade local...\"\nLOCAL_TEST=$(curl -s -o /dev/null -w \"%{http_code}\" http://127.0.0.1:5001/api/health 2>/dev/null || echo \"000\")\nif [ \"$LOCAL_TEST\" = \"200\" ]; then\n    echo \"‚úÖ Aplica√ß√£o respondendo localmente\"\nelse\n    echo \"‚ùå Aplica√ß√£o n√£o responde localmente (Status: $LOCAL_TEST)\"\n    echo \"üìã Verifique os logs: pm2 logs abmix-ligacao\"\nfi\n\n# Testar acesso externo\necho \"üåç Testando acesso externo...\"\nEXTERNAL_TEST=$(curl -s -o /dev/null -w \"%{http_code}\" https://juliocamara.dev/abmix-ligacao/ 2>/dev/null || echo \"000\")\nif [ \"$EXTERNAL_TEST\" = \"200\" ]; then\n    echo \"‚úÖ Site acess√≠vel externamente\"\nelif [ \"$EXTERNAL_TEST\" = \"403\" ]; then\n    echo \"‚ùå Erro 403 - problema de permiss√µes ou nginx\"\nelif [ \"$EXTERNAL_TEST\" = \"502\" ]; then\n    echo \"‚ùå Erro 502 - aplica√ß√£o n√£o est√° respondendo\"\nelse\n    echo \"‚ö†Ô∏è  Status externo: $EXTERNAL_TEST\"\nfi\n\necho \"\"\necho \"üéâ CORRE√á√ÉO CONCLU√çDA!\"\necho \"======================\"\necho \"\"\necho \"üìã PR√ìXIMOS PASSOS:\"\necho \"1. Configure suas chaves API no arquivo .env\"\necho \"2. Acesse: https://juliocamara.dev/abmix-ligacao/\"\necho \"3. Se ainda houver problemas, verifique os logs: pm2 logs abmix-ligacao\"\necho \"\"\necho \"üîç COMANDOS √öTEIS:\"\necho \"‚Ä¢ Ver logs: pm2 logs abmix-ligacao\"\necho \"‚Ä¢ Reiniciar: pm2 restart abmix-ligacao\"\necho \"‚Ä¢ Status: pm2 status\"\necho \"‚Ä¢ Teste local: curl http://127.0.0.1:5001/api/health\"\necho \"\"\n\n\n\n\n","size_bytes":3630},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"server/database.ts":{"content":"import Database from 'better-sqlite3';\nimport { mkdirSync, existsSync } from 'fs';\nimport { join } from 'path';\n\n// Ensure data directory exists\nconst dataDir = join(process.cwd(), 'data');\nif (!existsSync(dataDir)) {\n  mkdirSync(dataDir, { recursive: true });\n}\n\n// Initialize SQLite database\nconst dbPath = join(dataDir, 'app.db');\nexport const db = Database(dbPath);\n\n// Enable WAL mode for better concurrency\ndb.pragma('journal_mode = WAL');\n\n// Create tables\nexport function initDatabase() {\n  console.log('[DB] Initializing database at:', dbPath);\n\n  // Recordings table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS recordings (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      call_sid TEXT NOT NULL,\n      phone_number TEXT,\n      filename TEXT NOT NULL,\n      duration_sec INTEGER DEFAULT 0,\n      started_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n      ended_at DATETIME,\n      size_bytes INTEGER DEFAULT 0,\n      UNIQUE(call_sid, started_at)\n    )\n  `);\n\n  // Calls table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS calls (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      to_number TEXT NOT NULL,\n      from_number TEXT,\n      started_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n      ended_at DATETIME,\n      status TEXT DEFAULT 'initiated'\n    )\n  `);\n\n  // Favorites table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS favorites (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT NOT NULL,\n      phone_e164 TEXT NOT NULL,\n      voice_type TEXT DEFAULT 'masc' CHECK(voice_type IN ('masc', 'fem')),\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n      UNIQUE(phone_e164)\n    )\n  `);\n\n  // Settings table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS settings (\n      key TEXT PRIMARY KEY,\n      value TEXT NOT NULL,\n      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // Prompts table for AI agent prompts\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS prompts (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      call_sid TEXT NOT NULL,\n      prompt_text TEXT NOT NULL,\n      applied BOOLEAN DEFAULT false,\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // VoIP Numbers table for managing multiple phone numbers\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS voip_numbers (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT NOT NULL,\n      number TEXT NOT NULL UNIQUE,\n      provider TEXT NOT NULL CHECK(provider IN ('falevono')),\n      sip_username TEXT,\n      sip_password TEXT,\n      sip_server TEXT,\n      sip_port INTEGER DEFAULT 5060,\n      sip_ips TEXT,\n      is_default BOOLEAN DEFAULT false,\n      status TEXT DEFAULT 'active' CHECK(status IN ('active', 'inactive')),\n      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n\n  // Insert default settings if they don't exist\n  const defaultSettings = [\n    { key: 'VOZ_MASC_ID', value: 'pNInz6obpgDQGcFmaJgB' }, // Default ElevenLabs voice\n    { key: 'VOZ_FEM_ID', value: 'EXAVITQu4vr4xnSDxMaL' }, // Default ElevenLabs voice\n    { key: 'MODELO', value: 'eleven_multilingual_v2' }, // Modelo mais natural\n    { key: 'VELOCIDADE', value: '1.0' },\n    { key: 'ESTILO', value: 'neutro' },\n    { key: 'STT_IDIOMA', value: 'pt-BR' },\n    // Configura√ß√µes avan√ßadas para voz mais natural\n    { key: 'VOICE_STABILITY', value: '0.35' },      // Mais emotivo\n    { key: 'VOICE_SIMILARITY', value: '0.95' },     // M√°xima similaridade\n    { key: 'VOICE_STYLE', value: '0.15' },          // Estilo sutil\n    { key: 'VOICE_SPEAKER_BOOST', value: 'true' },  // Clareza m√°xima\n    { key: 'VOICE_PROCESSING', value: 'enhanced' }  // Processamento aprimorado\n  ];\n\n  const insertSetting = db.prepare('INSERT OR IGNORE INTO settings (key, value) VALUES (?, ?)');\n  \n  for (const setting of defaultSettings) {\n    insertSetting.run(setting.key, setting.value);\n  }\n\n  console.log('[DB] Database initialized successfully');\n}\n\n// Initialize on import\ninitDatabase();\n\n// Helper functions for common queries\nexport const queries = {\n  // Settings\n  getSetting: db.prepare('SELECT value FROM settings WHERE key = ?'),\n  setSetting: db.prepare('INSERT OR REPLACE INTO settings (key, value, updated_at) VALUES (?, ?, CURRENT_TIMESTAMP)'),\n  getAllSettings: db.prepare('SELECT key, value FROM settings'),\n\n  // Favorites\n  getAllFavorites: db.prepare('SELECT * FROM favorites ORDER BY name ASC'),\n  addFavorite: db.prepare('INSERT INTO favorites (name, phone_e164, voice_type) VALUES (?, ?, ?)'),\n  removeFavorite: db.prepare('DELETE FROM favorites WHERE id = ?'),\n  \n  // Recordings\n  getAllRecordings: db.prepare('SELECT * FROM recordings ORDER BY started_at DESC'),\n  addRecording: db.prepare('INSERT INTO recordings (call_sid, phone_number, filename) VALUES (?, ?, ?)'),\n  getLastRecording: db.prepare('SELECT * FROM recordings ORDER BY id DESC LIMIT 1'),\n  updateRecording: db.prepare('UPDATE recordings SET ended_at = CURRENT_TIMESTAMP, duration_sec = ?, size_bytes = ? WHERE id = ?'),\n  getRecordingById: db.prepare('SELECT * FROM recordings WHERE id = ?'),\n  getRecordingByCallSid: db.prepare('SELECT * FROM recordings WHERE call_sid = ?'),\n  deleteRecording: db.prepare('DELETE FROM recordings WHERE id = ?'),\n  \n  // Calls\n  addCall: db.prepare('INSERT INTO calls (to_number, from_number, status) VALUES (?, ?, ?)'),\n  updateCallStatus: db.prepare('UPDATE calls SET status = ?, ended_at = CURRENT_TIMESTAMP WHERE id = ?'),\n  \n  // Prompts\n  addPrompt: db.prepare('INSERT INTO prompts (call_sid, prompt_text, applied) VALUES (?, ?, ?)'),\n  getPromptsByCallSid: db.prepare('SELECT * FROM prompts WHERE call_sid = ? ORDER BY created_at DESC'),\n  \n  // VoIP Numbers\n  getAllVoipNumbers: db.prepare('SELECT * FROM voip_numbers ORDER BY is_default DESC, name ASC'),\n  getVoipNumberById: db.prepare('SELECT * FROM voip_numbers WHERE id = ?'),\n  getVoipNumberByNumber: db.prepare('SELECT * FROM voip_numbers WHERE number = ?'),\n  getDefaultVoipNumber: db.prepare('SELECT * FROM voip_numbers WHERE is_default = true LIMIT 1'),\n  addVoipNumber: db.prepare('INSERT INTO voip_numbers (name, number, provider, sip_username, sip_password, sip_server, is_default, status) VALUES (?, ?, ?, ?, ?, ?, ?, ?)'),\n  updateVoipNumber: db.prepare('UPDATE voip_numbers SET name = ?, number = ?, provider = ?, sip_username = ?, sip_password = ?, sip_server = ?, status = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?'),\n  setDefaultVoipNumber: db.prepare('UPDATE voip_numbers SET is_default = CASE WHEN id = ? THEN true ELSE false END'),\n  deleteVoipNumber: db.prepare('DELETE FROM voip_numbers WHERE id = ?')\n};","size_bytes":6549},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0 0% 100%);\n  --foreground: hsl(240 5.88% 10%);\n  --card: hsl(0 0% 100%);\n  --card-foreground: hsl(240 5.88% 10%);\n  --popover: hsl(0 0% 100%);\n  --popover-foreground: hsl(240 5.88% 10%);\n  --primary: hsl(68 100% 50%);\n  --primary-foreground: hsl(0 0% 0%);\n  --secondary: hsl(240 4.76% 95.88%);\n  --secondary-foreground: hsl(240 5.88% 10%);\n  --muted: hsl(240 4.76% 95.88%);\n  --muted-foreground: hsl(240 3.83% 46.47%);\n  --accent: hsl(240 4.76% 95.88%);\n  --accent-foreground: hsl(240 5.88% 10%);\n  --destructive: hsl(0 84.24% 60.2%);\n  --destructive-foreground: hsl(0 0% 98%);\n  --border: hsl(240 5.88% 90%);\n  --input: hsl(240 5.88% 90%);\n  --ring: hsl(68 100% 50%);\n  --chart-1: hsl(12 76% 61%);\n  --chart-2: hsl(173 58% 39%);\n  --chart-3: hsl(197 37% 24%);\n  --chart-4: hsl(43 74% 66%);\n  --chart-5: hsl(27 87% 67%);\n  --radius: 0.75rem;\n  \n  /* Abmix Custom Colors */\n  --abmix-green: hsl(68 100% 50%);\n  --font-inter: 'Inter', sans-serif;\n}\n\n.dark {\n  --background: hsl(0 0% 5.88%);\n  --foreground: hsl(0 0% 98%);\n  --card: hsl(0 0% 10.2%);\n  --card-foreground: hsl(0 0% 98%);\n  --popover: hsl(0 0% 10.2%);\n  --popover-foreground: hsl(0 0% 98%);\n  --primary: hsl(68 100% 50%);\n  --primary-foreground: hsl(0 0% 0%);\n  --secondary: hsl(0 0% 14.9%);\n  --secondary-foreground: hsl(0 0% 98%);\n  --muted: hsl(0 0% 14.9%);\n  --muted-foreground: hsl(240 5% 64.9%);\n  --accent: hsl(0 0% 14.9%);\n  --accent-foreground: hsl(0 0% 98%);\n  --destructive: hsl(0 62.8% 30.6%);\n  --destructive-foreground: hsl(0 0% 98%);\n  --border: hsl(0 0% 20%);\n  --input: hsl(0 0% 20%);\n  --ring: hsl(68 100% 50%);\n  --chart-1: hsl(220 70% 50%);\n  --chart-2: hsl(160 60% 45%);\n  --chart-3: hsl(30 80% 55%);\n  --chart-4: hsl(280 65% 60%);\n  --chart-5: hsl(340 75% 55%);\n  \n  /* Dark mode specific colors */\n  --dark-bg: hsl(0 0% 5.88%);\n  --dark-surface: hsl(0 0% 10.2%);\n  --dark-border: hsl(0 0% 20%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  \n  body {\n    @apply bg-background text-foreground font-inter antialiased;\n    font-family: var(--font-inter);\n    overflow: auto;\n  }\n  \n  html, body, #root {\n    height: 100%;\n    overflow: auto;\n  }\n}\n\n@layer utilities {\n  .bg-dark-bg {\n    background-color: var(--dark-bg);\n  }\n  \n  .bg-dark-surface {\n    background-color: var(--dark-surface);\n  }\n  \n  .border-dark-border {\n    border-color: var(--dark-border);\n  }\n  \n  .text-abmix-green {\n    color: var(--abmix-green);\n  }\n  \n  .bg-abmix-green {\n    background-color: var(--abmix-green);\n  }\n  \n  .font-inter {\n    font-family: var(--font-inter);\n  }\n  \n  .hover\\:bg-abmix-green\\/90:hover {\n    background-color: hsl(68 100% 50% / 0.9);\n  }\n  \n  .bg-abmix-green\\/10 {\n    background-color: hsl(68 100% 50% / 0.1);\n  }\n}\n","size_bytes":2899},"client/src/components/FavoriteDialog.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { api } from '@/services/api';\nimport { validateE164, formatPhoneNumber } from '@/utils/validation';\nimport type { Favorite } from '@shared/schema';\n\ninterface FavoriteDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  favorite: Favorite | null;\n  onClose: () => void;\n}\n\nexport function FavoriteDialog({ open, onOpenChange, favorite, onClose }: FavoriteDialogProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [formData, setFormData] = useState({\n    name: '',\n    number: '',\n    tags: '',\n    notes: '',\n  });\n\n  // Reset form when dialog opens/closes or favorite changes\n  useEffect(() => {\n    if (open) {\n      if (favorite) {\n        setFormData({\n          name: favorite.name,\n          number: favorite.number,\n          tags: favorite.tags || '',\n          notes: favorite.notes || '',\n        });\n      } else {\n        setFormData({\n          name: '',\n          number: '',\n          tags: '',\n          notes: '',\n        });\n      }\n    }\n  }, [open, favorite]);\n\n  const createMutation = useMutation({\n    mutationFn: (data: typeof formData) => api.createFavorite(data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/favorites'] });\n      toast({\n        title: \"Favorito adicionado\",\n        description: `${formData.name} foi adicionado aos favoritos`,\n      });\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao adicionar favorito\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: (data: typeof formData) => api.updateFavorite(favorite!.id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/favorites'] });\n      toast({\n        title: \"Favorito atualizado\",\n        description: `${formData.name} foi atualizado`,\n      });\n      onClose();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao atualizar favorito\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!formData.name.trim()) {\n      toast({\n        title: \"Nome obrigat√≥rio\",\n        description: \"Por favor, preencha o nome do favorito\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const formattedNumber = formatPhoneNumber(formData.number);\n    if (!validateE164(formattedNumber)) {\n      toast({\n        title: \"N√∫mero inv√°lido\",\n        description: \"Por favor, insira um n√∫mero no formato E.164 (+5511999999999)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const submitData = {\n      ...formData,\n      number: formattedNumber,\n    };\n\n    if (favorite) {\n      updateMutation.mutate(submitData);\n    } else {\n      createMutation.mutate(submitData);\n    }\n  };\n\n  const handleInputChange = (field: keyof typeof formData) => (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: e.target.value,\n    }));\n  };\n\n  const isLoading = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"bg-dark-surface border-dark-border text-white\">\n        <DialogHeader>\n          <DialogTitle>\n            {favorite ? 'Editar Favorito' : 'Adicionar Favorito'}\n          </DialogTitle>\n        </DialogHeader>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"favorite-name\">Nome *</Label>\n            <Input\n              id=\"favorite-name\"\n              placeholder=\"Ex: Suporte T√©cnico\"\n              value={formData.name}\n              onChange={handleInputChange('name')}\n              className=\"bg-dark-bg border-dark-border\"\n              data-testid=\"favorite-name-input\"\n              required\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"favorite-number\">N√∫mero *</Label>\n            <Input\n              id=\"favorite-number\"\n              placeholder=\"+5511999999999\"\n              value={formData.number}\n              onChange={handleInputChange('number')}\n              className=\"bg-dark-bg border-dark-border font-mono\"\n              data-testid=\"favorite-number-input\"\n              required\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"favorite-tags\">Tags</Label>\n            <Input\n              id=\"favorite-tags\"\n              placeholder=\"Ex: trabalho, suporte, vendas\"\n              value={formData.tags}\n              onChange={handleInputChange('tags')}\n              className=\"bg-dark-bg border-dark-border\"\n              data-testid=\"favorite-tags-input\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"favorite-notes\">Observa√ß√µes</Label>\n            <Textarea\n              id=\"favorite-notes\"\n              placeholder=\"Notas adicionais sobre este contato...\"\n              value={formData.notes}\n              onChange={handleInputChange('notes')}\n              className=\"bg-dark-bg border-dark-border h-20 resize-none\"\n              data-testid=\"favorite-notes-input\"\n            />\n          </div>\n\n          <div className=\"flex justify-end space-x-2 pt-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={onClose}\n              className=\"border-dark-border text-white hover:bg-dark-border\"\n              data-testid=\"cancel-favorite-button\"\n            >\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={isLoading}\n              className=\"bg-abmix-green text-black hover:bg-abmix-green/90\"\n              data-testid=\"save-favorite-button\"\n            >\n              {isLoading ? 'Salvando...' : (favorite ? 'Atualizar' : 'Adicionar')}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":6619},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n        'abmix-green': 'var(--abmix-green)',\n        'dark-bg': 'var(--dark-bg)',\n        'dark-surface': 'var(--dark-surface)',\n        'dark-border': 'var(--dark-border)',\n      },\n      fontFamily: {\n        sans: [\"var(--font-inter)\", \"Inter\", \"sans-serif\"],\n        inter: [\"var(--font-inter)\", \"Inter\", \"sans-serif\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2951},"server/index.ts":{"content":"// Load environment variables FIRST - before any other imports\nimport { config } from \"dotenv\";\nconfig();\n\nimport express, { type Request, Response, NextFunction } from \"express\";\nimport http from \"http\";\nimport type { ListenOptions } from \"node:net\";\nimport { WebSocketServer } from \"ws\";\nimport { setupTelephony } from \"./telephony\";\nimport { registerRoutes } from \"./routes\";\n\n// Debug: verificar se as vari√°veis foram carregadas\nconsole.log('[ENV] Debug das vari√°veis de ambiente:');\nconsole.log(`[ENV] FALEVONO_PASSWORD: ${process.env.FALEVONO_PASSWORD ? '‚úÖ CONFIGURADA' : '‚ùå N√ÉO DEFINIDA'}`);\nconsole.log(`[ENV] ELEVENLABS_API_KEY: ${process.env.ELEVENLABS_API_KEY ? `${process.env.ELEVENLABS_API_KEY.substring(0, 10)}... ‚úÖ` : '‚ùå N√ÉO DEFINIDA'}`);\nconsole.log(`[ENV] DEEPGRAM_API_KEY: ${process.env.DEEPGRAM_API_KEY ? '‚úÖ CONFIGURADA' : '‚ùå N√ÉO DEFINIDA'}`);\n\nconst app = express();\n\n// Configure trust proxy for subpath deployment\napp.set('trust proxy', true);\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      console.log(`[express] ${logLine}`);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Create HTTP server\n  const server = http.createServer(app);\n  \n  // Configura telefonia (WS /media, TwiML e rotas relacionadas)\n  setupTelephony(app, server);\n  \n  await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    const { setupVite } = await import(\"./vite.js\");\n    await setupVite(app, server);\n  } else {\n    const { serveStatic } = await import(\"./vite.js\");\n    serveStatic(app);\n  }\n\n  // Start server\n  const port = parseInt(process.env.PORT || '5000', 10);\n  const listenOptions: ListenOptions = {\n    port,\n    host: \"0.0.0.0\",\n  };\n\n  if (process.platform !== \"win32\") {\n    // SO_REUSEPORT is unavailable on Windows; enabling it there throws ENOTSUP.\n    listenOptions.reusePort = true;\n  }\n\n  server.listen(listenOptions, () => {\n    console.log(`[express] HTTP/WS on ${port}`);\n  });\n})();\n","size_bytes":3121},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"server/providers/ttsProvider.ts":{"content":"export class TTSProvider {\n  private apiKey: string;\n  private provider: 'elevenlabs' | 'playht';\n\n  constructor() {\n    this.apiKey = process.env.ELEVENLABS_API_KEY || process.env.PLAYHT_API_KEY || \"\";\n    this.provider = process.env.ELEVENLABS_API_KEY ? 'elevenlabs' : 'playht';\n  }\n\n  async speak(text: string, voiceId: string): Promise<string | ReadableStream> {\n    // TODO: Generate speech from text\n    // Return audio stream or URL for integration with voice provider\n    throw new Error('TTS provider not implemented yet');\n  }\n\n  async getVoices(): Promise<Array<{ id: string; name: string; language: string }>> {\n    // TODO: Get available PT-BR voices\n    throw new Error('TTS provider not implemented yet');\n  }\n}\n","size_bytes":727},"client/src/contexts/ThemeContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from 'react';\n\ntype Theme = 'light' | 'dark';\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n  setTheme: (theme: Theme) => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\ninterface ThemeProviderProps {\n  children: ReactNode;\n}\n\nexport function ThemeProvider({ children }: ThemeProviderProps) {\n  const [theme, setThemeState] = useState<Theme>(() => {\n    // Check localStorage first, then system preference, default to dark\n    const savedTheme = localStorage.getItem('abmix-theme') as Theme;\n    if (savedTheme) return savedTheme;\n    \n    if (window.matchMedia('(prefers-color-scheme: light)').matches) {\n      return 'light';\n    }\n    return 'dark';\n  });\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n    \n    // Remove previous theme classes\n    root.classList.remove('light', 'dark');\n    \n    // Add current theme class\n    root.classList.add(theme);\n    \n    // Save to localStorage\n    localStorage.setItem('abmix-theme', theme);\n  }, [theme]);\n\n  const setTheme = (newTheme: Theme) => {\n    setThemeState(newTheme);\n  };\n\n  const toggleTheme = () => {\n    setThemeState(prevTheme => prevTheme === 'light' ? 'dark' : 'light');\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme, setTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}","size_bytes":1632},"client/src/components/AudioEffects.tsx":{"content":"import { useState } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function AudioEffects() {\n  const { toast } = useToast();\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [selectedEffect, setSelectedEffect] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n\n  const effects = [\n    { id: 'denoise', name: 'Redu√ß√£o de Ru√≠do', description: 'Remove ru√≠dos de fundo' },\n    { id: 'equalize', name: 'Equaliza√ß√£o', description: 'Melhora a qualidade do √°udio' },\n    { id: 'amplify', name: 'Amplifica√ß√£o', description: 'Aumenta o volume' },\n    { id: 'normalize', name: 'Normaliza√ß√£o', description: 'Ajusta n√≠veis de √°udio' }\n  ];\n\n  const processEffectMutation = useMutation({\n    mutationFn: async (data: { fileId: string; effect: string }) => {\n      // Implementation will be added when endpoint is ready\n      setIsProcessing(true);\n      await new Promise(resolve => setTimeout(resolve, 3000)); // Simulate processing\n      setIsProcessing(false);\n      return { success: true, processedUrl: '/processed-audio.wav' };\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Efeito aplicado\",\n        description: \"Processamento de √°udio conclu√≠do\",\n      });\n      setSelectedFile(null);\n      setSelectedEffect('');\n    },\n    onError: (error) => {\n      setIsProcessing(false);\n      toast({\n        title: \"Erro no processamento\",\n        description: error instanceof Error ? error.message : \"Falha na aplica√ß√£o do efeito\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.type.startsWith('audio/')) {\n        setSelectedFile(file);\n      } else {\n        toast({\n          title: \"Arquivo inv√°lido\",\n          description: \"Selecione um arquivo de √°udio\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleApplyEffect = () => {\n    if (!selectedFile || !selectedEffect) {\n      toast({\n        title: \"Dados incompletos\",\n        description: \"Selecione um arquivo e um efeito\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    processEffectMutation.mutate({ fileId: selectedFile.name, effect: selectedEffect });\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Efeitos de √Åudio</h3>\n      \n      <div className=\"space-y-4\">\n        <div>\n          <Label htmlFor=\"audio-file\" className=\"text-sm font-medium text-foreground\">\n            Arquivo de √Åudio\n          </Label>\n          <Input\n            id=\"audio-file\"\n            type=\"file\"\n            accept=\"audio/*\"\n            onChange={handleFileChange}\n            className=\"mt-1\"\n            data-testid=\"audio-file-input\"\n          />\n          {selectedFile && (\n            <p className=\"text-xs text-gray-400 mt-1\">\n              Arquivo: {selectedFile.name} ({Math.round(selectedFile.size / 1024)} KB)\n            </p>\n          )}\n        </div>\n\n        <div>\n          <Label className=\"text-sm font-medium text-foreground\">\n            Efeito de √Åudio\n          </Label>\n          <Select value={selectedEffect} onValueChange={setSelectedEffect}>\n            <SelectTrigger className=\"mt-1\" data-testid=\"effect-select\">\n              <SelectValue placeholder=\"Selecione um efeito\" />\n            </SelectTrigger>\n            <SelectContent>\n              {effects.map((effect) => (\n                <SelectItem key={effect.id} value={effect.id}>\n                  <div className=\"flex flex-col\">\n                    <span>{effect.name}</span>\n                    <span className=\"text-xs text-gray-400\">{effect.description}</span>\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <Button\n          onClick={handleApplyEffect}\n          disabled={!selectedFile || !selectedEffect || isProcessing}\n          className=\"w-full bg-abmix-green text-black hover:bg-abmix-green/80\"\n          data-testid=\"apply-effect-button\"\n        >\n          {isProcessing ? 'Processando...' : 'Aplicar Efeito'}\n        </Button>\n\n        {isProcessing && (\n          <div className=\"mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border\">\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-4 h-4 border-2 border-abmix-green border-t-transparent rounded-full animate-spin\"></div>\n              <span className=\"text-sm text-gray-400\">Processando efeito de √°udio...</span>\n            </div>\n          </div>\n        )}\n\n        <div className=\"mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border\">\n          <p className=\"text-xs text-gray-400\">\n            <strong>Efeitos dispon√≠veis:</strong> Redu√ß√£o de ru√≠do, equaliza√ß√£o autom√°tica,\n            amplifica√ß√£o e normaliza√ß√£o de √°udio para melhorar a qualidade das grava√ß√µes.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5397},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"server/providers/vapiProvider.ts":{"content":"import { VoiceProvider, CallEvent } from './voiceProvider';\n\nexport class VapiProvider implements VoiceProvider {\n  private apiKey: string;\n  private baseUrl = 'https://api.vapi.ai';\n\n  constructor() {\n    this.apiKey = process.env.VAPI_API_KEY || process.env.VAPI_KEY || \"\";\n  }\n\n  async startCall(toNumber: string, voiceId?: string): Promise<{ callId: string; status: string }> {\n    // TODO: Implement Vapi call start\n    // const response = await fetch(`${this.baseUrl}/calls`, {\n    //   method: 'POST',\n    //   headers: {\n    //     'Authorization': `Bearer ${this.apiKey}`,\n    //     'Content-Type': 'application/json'\n    //   },\n    //   body: JSON.stringify({\n    //     to: toNumber,\n    //     voiceId: voiceId\n    //   })\n    // });\n    \n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async hangup(callId: string): Promise<boolean> {\n    // TODO: Implement Vapi hangup\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async pauseAI(callId: string): Promise<boolean> {\n    // TODO: Implement Vapi AI pause\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async resumeAI(callId: string): Promise<boolean> {\n    // TODO: Implement Vapi AI resume\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async injectPrompt(callId: string, prompt: string): Promise<boolean> {\n    // TODO: Implement Vapi prompt injection\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async transfer(callId: string, target: string): Promise<boolean> {\n    // TODO: Implement Vapi transfer\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async hold(callId: string): Promise<boolean> {\n    // TODO: Implement Vapi hold\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async resume(callId: string): Promise<boolean> {\n    // TODO: Implement Vapi resume\n    throw new Error('Vapi provider not implemented yet');\n  }\n\n  async sendDTMF(callId: string, tone: string): Promise<boolean> {\n    // TODO: Implement Vapi DTMF\n    throw new Error('Vapi provider not implemented yet');\n  }\n}\n","size_bytes":2079},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"server/storage.ts":{"content":"import { type Favorite, type InsertFavorite, type Call, type InsertCall, type Transcript, type InsertTranscript, type Prompt, type InsertPrompt } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\n\nexport interface IStorage {\n  // Favorites\n  getFavorites(): Promise<Favorite[]>;\n  getFavorite(id: string): Promise<Favorite | undefined>;\n  createFavorite(favorite: InsertFavorite): Promise<Favorite>;\n  updateFavorite(id: string, favorite: Partial<InsertFavorite>): Promise<Favorite | undefined>;\n  deleteFavorite(id: string): Promise<boolean>;\n\n  // Calls\n  getCalls(): Promise<Call[]>;\n  getCall(id: string): Promise<Call | undefined>;\n  createCall(call: InsertCall): Promise<Call>;\n  updateCall(id: string, call: Partial<Call>): Promise<Call | undefined>;\n\n  // Transcripts\n  getTranscripts(callId: string): Promise<Transcript[]>;\n  createTranscript(transcript: InsertTranscript): Promise<Transcript>;\n\n  // Prompts\n  getPrompts(callId: string): Promise<Prompt[]>;\n  createPrompt(prompt: InsertPrompt): Promise<Prompt>;\n  updatePrompt(id: string, prompt: Partial<Prompt>): Promise<Prompt | undefined>;\n}\n\nexport class MemStorage implements IStorage {\n  private favorites: Map<string, Favorite>;\n  private calls: Map<string, Call>;\n  private transcripts: Map<string, Transcript>;\n  private prompts: Map<string, Prompt>;\n\n  constructor() {\n    this.favorites = new Map();\n    this.calls = new Map();\n    this.transcripts = new Map();\n    this.prompts = new Map();\n  }\n\n  // Favorites\n  async getFavorites(): Promise<Favorite[]> {\n    return Array.from(this.favorites.values());\n  }\n\n  async getFavorite(id: string): Promise<Favorite | undefined> {\n    return this.favorites.get(id);\n  }\n\n  async createFavorite(insertFavorite: InsertFavorite): Promise<Favorite> {\n    const id = randomUUID();\n    const favorite: Favorite = {\n      ...insertFavorite,\n      id,\n      createdAt: new Date(),\n      tags: insertFavorite.tags || null,\n      notes: insertFavorite.notes || null,\n    };\n    this.favorites.set(id, favorite);\n    return favorite;\n  }\n\n  async updateFavorite(id: string, updateData: Partial<InsertFavorite>): Promise<Favorite | undefined> {\n    const existing = this.favorites.get(id);\n    if (!existing) return undefined;\n\n    const updated: Favorite = { ...existing, ...updateData };\n    this.favorites.set(id, updated);\n    return updated;\n  }\n\n  async deleteFavorite(id: string): Promise<boolean> {\n    return this.favorites.delete(id);\n  }\n\n  // Calls\n  async getCalls(): Promise<Call[]> {\n    return Array.from(this.calls.values());\n  }\n\n  async getCall(id: string): Promise<Call | undefined> {\n    return this.calls.get(id);\n  }\n\n  async createCall(insertCall: InsertCall): Promise<Call> {\n    const id = randomUUID();\n    const call: Call = {\n      ...insertCall,\n      id,\n      startTime: new Date(),\n      endTime: null,\n      duration: null,\n      recordingUrl: null,\n      metadata: null,\n      fromNumber: insertCall.fromNumber || null,\n    };\n    this.calls.set(id, call);\n    return call;\n  }\n\n  async updateCall(id: string, updateData: Partial<Call>): Promise<Call | undefined> {\n    const existing = this.calls.get(id);\n    if (!existing) return undefined;\n\n    const updated: Call = { ...existing, ...updateData };\n    this.calls.set(id, updated);\n    return updated;\n  }\n\n  // Transcripts\n  async getTranscripts(callId: string): Promise<Transcript[]> {\n    return Array.from(this.transcripts.values()).filter(t => t.callId === callId);\n  }\n\n  async createTranscript(insertTranscript: InsertTranscript): Promise<Transcript> {\n    const id = randomUUID();\n    const transcript: Transcript = {\n      ...insertTranscript,\n      id,\n      timestamp: new Date(),\n      callId: insertTranscript.callId || null,\n      isFinal: insertTranscript.isFinal || null,\n      confidence: insertTranscript.confidence || null,\n    };\n    this.transcripts.set(id, transcript);\n    return transcript;\n  }\n\n  // Prompts\n  async getPrompts(callId: string): Promise<Prompt[]> {\n    return Array.from(this.prompts.values()).filter(p => p.callId === callId);\n  }\n\n  async createPrompt(insertPrompt: InsertPrompt): Promise<Prompt> {\n    const id = randomUUID();\n    const prompt: Prompt = {\n      ...insertPrompt,\n      id,\n      timestamp: new Date(),\n      applied: false,\n      callId: insertPrompt.callId || null,\n    };\n    this.prompts.set(id, prompt);\n    return prompt;\n  }\n\n  async updatePrompt(id: string, updateData: Partial<Prompt>): Promise<Prompt | undefined> {\n    const existing = this.prompts.get(id);\n    if (!existing) return undefined;\n\n    const updated: Prompt = { ...existing, ...updateData };\n    this.prompts.set(id, updated);\n    return updated;\n  }\n}\n\nexport const storage = new MemStorage();\n","size_bytes":4732},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"scripts/check-env.js":{"content":"#!/usr/bin/env node\n\n// Script para verificar se as vari√°veis de ambiente est√£o configuradas corretamente\nconst { existsSync } = require('fs');\nconst path = require('path');\n\n// Carrega as vari√°veis do .env se o arquivo existir\nconst envPath = path.join(__dirname, '..', '.env');\nif (existsSync(envPath)) {\n  require('dotenv').config({ path: envPath });\n} else {\n  console.log('‚ö†Ô∏è  Arquivo .env n√£o encontrado na raiz do projeto');\n  console.log('   Crie o arquivo .env com suas chaves de API\\n');\n}\n\nconsole.log('üîç Verificando configura√ß√µes do .env para teste de convers√£o de voz...\\n');\n\nconst requiredVars = [\n  { name: 'ELEVENLABS_API_KEY', required: true, description: 'Chave da API ElevenLabs (convers√£o de voz)' },\n  { name: 'TWILIO_ACCOUNT_SID', required: true, description: 'SID da conta Twilio (chamadas)' },\n  { name: 'TWILIO_AUTH_TOKEN', required: true, description: 'Token de autentica√ß√£o Twilio' },\n  { name: 'TWILIO_NUMBER', required: true, description: 'N√∫mero Twilio para chamadas' },\n  { name: 'DEEPGRAM_API_KEY', required: false, description: 'Chave Deepgram (transcri√ß√£o - opcional)' },\n  { name: 'NODE_ENV', required: false, description: 'Ambiente de execu√ß√£o' },\n  { name: 'PORT', required: false, description: 'Porta do servidor' }\n];\n\nlet allGood = true;\nlet missingRequired = [];\n\nconsole.log('üìã Status das vari√°veis de ambiente:\\n');\n\nfor (const envVar of requiredVars) {\n  const value = process.env[envVar.name];\n  const isPresent = !!value;\n  const isRequired = envVar.required;\n  \n  let status = '‚ùå';\n  let info = 'N√£o configurada';\n  \n  if (isPresent) {\n    status = '‚úÖ';\n    \n    // Valida√ß√µes espec√≠ficas\n    if (envVar.name === 'ELEVENLABS_API_KEY') {\n      if (value.startsWith('sk_') && value.length > 30) {\n        info = `Formato correto (${value.length} caracteres)`;\n      } else {\n        info = `‚ö†Ô∏è  Formato suspeito (deve come√ßar com 'sk_')`;\n        status = '‚ö†Ô∏è ';\n      }\n    } else if (envVar.name === 'TWILIO_ACCOUNT_SID') {\n      if (value.startsWith('AC') && value.length === 34) {\n        info = 'Formato correto (34 caracteres)';\n      } else {\n        info = `‚ö†Ô∏è  Formato suspeito (deve come√ßar com 'AC' e ter 34 caracteres)`;\n        status = '‚ö†Ô∏è ';\n      }\n    } else if (envVar.name === 'TWILIO_AUTH_TOKEN') {\n      if (value.length === 32) {\n        info = 'Formato correto (32 caracteres)';\n      } else {\n        info = `‚ö†Ô∏è  Formato suspeito (deve ter 32 caracteres, tem ${value.length})`;\n        status = '‚ö†Ô∏è ';\n      }\n    } else if (envVar.name === 'TWILIO_NUMBER') {\n      if (value.startsWith('+') && value.length >= 10) {\n        info = `Formato correto (${value})`;\n      } else {\n        info = `‚ö†Ô∏è  Formato suspeito (deve come√ßar com '+')`;\n        status = '‚ö†Ô∏è ';\n      }\n    } else {\n      info = `Configurada (${value})`;\n    }\n  } else {\n    if (isRequired) {\n      allGood = false;\n      missingRequired.push(envVar.name);\n    }\n  }\n  \n  const requiredText = isRequired ? '(OBRIGAT√ìRIA)' : '(opcional)';\n  console.log(`${status} ${envVar.name} ${requiredText}`);\n  console.log(`   ${info}`);\n  console.log(`   Descri√ß√£o: ${envVar.description}\\n`);\n}\n\n// Resumo\nconsole.log('=' .repeat(60));\nif (allGood) {\n  console.log('üéâ TODAS as vari√°veis obrigat√≥rias est√£o configuradas!');\n  console.log('‚úÖ Seu sistema est√° pronto para teste de convers√£o de voz');\n  \n  console.log('\\nüöÄ Para testar:');\n  console.log('1. Execute: npm run dev');\n  console.log('2. Acesse: http://localhost:5000');\n  console.log('3. Digite seu n√∫mero e clique \"Discar\"');\n  console.log('4. Atenda a liga√ß√£o');\n  console.log('5. Ative o switch \"Convers√£o de Voz\"');\n  console.log('6. Fale e ou√ßa sua voz modificada! üé§‚ú®');\n} else {\n  console.log('‚ùå FALTAM vari√°veis obrigat√≥rias:');\n  console.log(`   ${missingRequired.join(', ')}`);\n  console.log('\\nüìù Crie/edite o arquivo .env na raiz do projeto com:');\n  console.log('   ELEVENLABS_API_KEY=sk_sua_chave_aqui');\n  console.log('   TWILIO_ACCOUNT_SID=AC_seu_sid_aqui');\n  console.log('   TWILIO_AUTH_TOKEN=seu_token_aqui');\n  console.log('   TWILIO_NUMBER=+5511999999999');\n}\n\nconsole.log('\\nüí° Dica: Execute este script sempre que alterar o .env');\nconsole.log('   node scripts/check-env.js');\n\n// Teste de conectividade (se as chaves est√£o presentes)\nasync function testConnectivity() {\n  if (process.env.ELEVENLABS_API_KEY && process.env.ELEVENLABS_API_KEY.startsWith('sk_')) {\n    console.log('\\nüîó Testando conectividade com ElevenLabs...');\n    \n    try {\n      const https = require('https');\n      const options = {\n        hostname: 'api.elevenlabs.io',\n        path: '/v1/voices',\n        method: 'GET',\n        headers: {\n          'xi-api-key': process.env.ELEVENLABS_API_KEY\n        }\n      };\n      \n      const req = https.request(options, (res) => {\n        if (res.statusCode === 200) {\n          console.log('‚úÖ ElevenLabs: Conectado! Chave API v√°lida');\n        } else {\n          console.log(`‚ùå ElevenLabs: Erro ${res.statusCode} - Verifique sua chave API`);\n        }\n      });\n      \n      req.on('error', (error) => {\n        console.log(`‚ùå ElevenLabs: Erro de conex√£o - ${error.message}`);\n      });\n      \n      req.end();\n    } catch (error) {\n      console.log(`‚ùå ElevenLabs: Erro - ${error.message}`);\n    }\n  }\n\n  if (process.env.TWILIO_ACCOUNT_SID && process.env.TWILIO_AUTH_TOKEN) {\n    console.log('\\nüîó Testando conectividade com Twilio...');\n    \n    try {\n      const https = require('https');\n      const auth = Buffer.from(`${process.env.TWILIO_ACCOUNT_SID}:${process.env.TWILIO_AUTH_TOKEN}`).toString('base64');\n      \n      const options = {\n        hostname: 'api.twilio.com',\n        path: `/2010-04-01/Accounts/${process.env.TWILIO_ACCOUNT_SID}.json`,\n        method: 'GET',\n        headers: {\n          'Authorization': `Basic ${auth}`\n        }\n      };\n      \n      const req = https.request(options, (res) => {\n        if (res.statusCode === 200) {\n          console.log('‚úÖ Twilio: Conectado! Credenciais v√°lidas');\n        } else {\n          console.log(`‚ùå Twilio: Erro ${res.statusCode} - Verifique suas credenciais`);\n        }\n      });\n      \n      req.on('error', (error) => {\n        console.log(`‚ùå Twilio: Erro de conex√£o - ${error.message}`);\n      });\n      \n      req.end();\n    } catch (error) {\n      console.log(`‚ùå Twilio: Erro - ${error.message}`);\n    }\n  }\n}\n\n// Executar teste de conectividade\nif (allGood) {\n  testConnectivity();\n}\n\nconsole.log('\\n' + '='.repeat(60));\n","size_bytes":6552},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/VoiceCloning.tsx":{"content":"import { useState } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { api } from '@/services/api';\n\nexport function VoiceCloning() {\n  const { toast } = useToast();\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [targetVoiceId, setTargetVoiceId] = useState('');\n\n  const cloneVoiceMutation = useMutation({\n    mutationFn: async (data: { file: File; targetVoiceId: string }) => {\n      // Implementation will be added when endpoint is ready\n      return { success: true };\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Clonagem iniciada\",\n        description: \"Processando convers√£o de voz...\",\n      });\n      setSelectedFile(null);\n      setTargetVoiceId('');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro na clonagem\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.type.startsWith('audio/')) {\n        setSelectedFile(file);\n      } else {\n        toast({\n          title: \"Arquivo inv√°lido\",\n          description: \"Selecione um arquivo de √°udio\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleClone = () => {\n    if (!selectedFile || !targetVoiceId) {\n      toast({\n        title: \"Dados incompletos\",\n        description: \"Selecione um arquivo e uma voz de destino\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    cloneVoiceMutation.mutate({ file: selectedFile, targetVoiceId });\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Clonagem & Convers√£o de Voz</h3>\n      \n      <div className=\"space-y-4\">\n        <div>\n          <Label htmlFor=\"voice-file\" className=\"text-sm font-medium text-foreground\">\n            Arquivo de √Åudio\n          </Label>\n          <Input\n            id=\"voice-file\"\n            type=\"file\"\n            accept=\"audio/*\"\n            onChange={handleFileChange}\n            className=\"mt-1\"\n            data-testid=\"voice-file-input\"\n          />\n          {selectedFile && (\n            <p className=\"text-xs text-gray-400 mt-1\">\n              Arquivo: {selectedFile.name} ({Math.round(selectedFile.size / 1024)} KB)\n            </p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"target-voice\" className=\"text-sm font-medium text-foreground\">\n            ID da Voz de Destino\n          </Label>\n          <Input\n            id=\"target-voice\"\n            type=\"text\"\n            placeholder=\"Ex: 21m00Tcm4TlvDq8ikWAM\"\n            value={targetVoiceId}\n            onChange={(e) => setTargetVoiceId(e.target.value)}\n            className=\"mt-1\"\n            data-testid=\"target-voice-input\"\n          />\n        </div>\n\n        <Button\n          onClick={handleClone}\n          disabled={!selectedFile || !targetVoiceId || cloneVoiceMutation.isPending}\n          className=\"w-full bg-abmix-green text-black hover:bg-abmix-green/80\"\n          data-testid=\"clone-voice-button\"\n        >\n          {cloneVoiceMutation.isPending ? 'Processando...' : 'Iniciar Clonagem'}\n        </Button>\n\n        <div className=\"mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border\">\n          <p className=\"text-xs text-gray-400\">\n            <strong>Funcionalidade:</strong> Clone e converta vozes usando IA avan√ßada.\n            Fa√ßa upload de um arquivo de √°udio e selecione uma voz de destino para convers√£o.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":3890},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config.mjs\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  // Estrutura simplificada: arquivos est√°ticos na raiz junto com index.js\n  // Procurar por index.html na raiz do diret√≥rio atual (onde est√° o index.js)\n  const rootPath = import.meta.dirname; // Diret√≥rio onde est√° o index.js\n  \n  // Verificar se existe index.html na raiz\n  const indexHtmlPath = path.resolve(rootPath, \"index.html\");\n  \n  let staticPath = rootPath;\n  \n  if (!fs.existsSync(indexHtmlPath)) {\n    // Fallback: tentar dist/public (estrutura antiga)\n    const distPublicPath = path.resolve(rootPath, \"public\");\n    const distPath = path.resolve(rootPath, \"..\", \"dist\", \"public\");\n    \n    if (fs.existsSync(path.resolve(distPublicPath, \"index.html\"))) {\n      staticPath = distPublicPath;\n      console.log(`[STATIC] Usando estrutura com pasta public: ${staticPath}`);\n    } else if (fs.existsSync(path.resolve(distPath, \"index.html\"))) {\n      staticPath = distPath;\n      console.log(`[STATIC] Usando estrutura dist/public: ${staticPath}`);\n    } else {\n      throw new Error(\n        `Could not find index.html. Tried: ${indexHtmlPath}, ${distPublicPath}, ${distPath}. Make sure to build and deploy correctly`,\n      );\n    }\n  } else {\n    console.log(`[STATIC] Usando estrutura na raiz: ${staticPath}`);\n  }\n\n  console.log(`[STATIC] Servindo arquivos est√°ticos de: ${staticPath}`);\n  \n  // Listar arquivos para debug\n  if (fs.existsSync(staticPath)) {\n    const files = fs.readdirSync(staticPath);\n    console.log(`[STATIC] Arquivos encontrados:`, files.slice(0, 10)); // Mostrar apenas os primeiros 10\n  }\n\n  // Servir arquivos est√°ticos com configura√ß√£o adequada\n  app.use(express.static(staticPath, {\n    // Configurar MIME types corretos\n    setHeaders: (res, filePath) => {\n      if (filePath.endsWith('.js')) {\n        res.setHeader('Content-Type', 'application/javascript');\n      } else if (filePath.endsWith('.css')) {\n        res.setHeader('Content-Type', 'text/css');\n      } else if (filePath.endsWith('.html')) {\n        res.setHeader('Content-Type', 'text/html');\n      }\n    },\n    // N√£o redirecionar para index.html automaticamente\n    fallthrough: true,\n    // Cache para assets\n    maxAge: '1y' // Cache de 1 ano para todos os assets est√°ticos\n  }));\n\n  // Middleware espec√≠fico para assets - garantir que n√£o sejam redirecionados\n  app.use('/assets/*', (req, res, next) => {\n    const assetPath = path.resolve(staticPath, req.path.substring(1));\n    console.log(`[STATIC] Tentando servir asset: ${assetPath}`);\n    \n    if (fs.existsSync(assetPath)) {\n      // Definir MIME type correto baseado na extens√£o\n      if (assetPath.endsWith('.js')) {\n        res.setHeader('Content-Type', 'application/javascript');\n      } else if (assetPath.endsWith('.css')) {\n        res.setHeader('Content-Type', 'text/css');\n      }\n      res.sendFile(assetPath);\n    } else {\n      console.error(`[STATIC] Asset n√£o encontrado: ${assetPath}`);\n      res.status(404).send('Asset not found');\n    }\n  });\n\n  // fall through to index.html APENAS para rotas que n√£o s√£o assets\n  app.use(\"*\", (req, res) => {\n    // N√£o servir index.html para requisi√ß√µes de assets\n    if (req.originalUrl.includes('/assets/')) {\n      console.error(`[STATIC] Asset n√£o encontrado: ${req.originalUrl}`);\n      return res.status(404).send('Asset not found');\n    }\n\n    const indexPath = path.resolve(staticPath, \"index.html\");\n    console.log(`[STATIC] Servindo index.html de: ${indexPath} para rota: ${req.originalUrl}`);\n    \n    if (fs.existsSync(indexPath)) {\n      res.sendFile(indexPath);\n    } else {\n      console.error(`[STATIC] index.html n√£o encontrado em: ${indexPath}`);\n      res.status(404).send('Application not properly built. Please run: npm run build');\n    }\n  });\n}\n","size_bytes":5562},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"scripts/test-deploy.sh":{"content":"#!/bin/bash\n\necho \"üß™ TESTE COMPLETO DO DEPLOY\"\necho \"==========================\"\n\n# Cores\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\nDOMAIN=\"https://juliocamara.dev/abmix-ligacao\"\n\necho -e \"${BLUE}1. Testando conectividade b√°sica...${NC}\"\nHTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"$DOMAIN/\")\nif [ \"$HTTP_STATUS\" -eq 200 ]; then\n    echo -e \"${GREEN}‚úÖ Site principal acess√≠vel (200)${NC}\"\nelif [ \"$HTTP_STATUS\" -eq 403 ]; then\n    echo -e \"${RED}‚ùå Erro 403 Forbidden - problema de permiss√µes ou nginx${NC}\"\nelif [ \"$HTTP_STATUS\" -eq 502 ]; then\n    echo -e \"${RED}‚ùå Erro 502 Bad Gateway - aplica√ß√£o n√£o est√° rodando${NC}\"\nelse\n    echo -e \"${YELLOW}‚ö†Ô∏è Status HTTP: $HTTP_STATUS${NC}\"\nfi\n\necho -e \"${BLUE}2. Testando API de sa√∫de...${NC}\"\nAPI_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"$DOMAIN/api/health\")\nif [ \"$API_STATUS\" -eq 200 ]; then\n    echo -e \"${GREEN}‚úÖ API funcionando (200)${NC}\"\nelse\n    echo -e \"${RED}‚ùå API com problema. Status: $API_STATUS${NC}\"\nfi\n\necho -e \"${BLUE}3. Testando WebSocket...${NC}\"\n# Teste b√°sico de WebSocket usando wscat se dispon√≠vel\nif command -v wscat &> /dev/null; then\n    echo \"Testando wss://juliocamara.dev/abmix-ligacao/media...\"\n    timeout 5s wscat -c \"wss://juliocamara.dev/abmix-ligacao/media\" &\n    WS_PID=$!\n    sleep 2\n    if kill -0 $WS_PID 2>/dev/null; then\n        echo -e \"${GREEN}‚úÖ WebSocket conectou com sucesso${NC}\"\n        kill $WS_PID 2>/dev/null\n    else\n        echo -e \"${RED}‚ùå WebSocket falhou ao conectar${NC}\"\n    fi\nelse\n    echo -e \"${YELLOW}‚ö†Ô∏è wscat n√£o dispon√≠vel para teste de WebSocket${NC}\"\nfi\n\necho -e \"${BLUE}4. Verificando headers de resposta...${NC}\"\ncurl -s -I \"$DOMAIN/\" | head -10\n\necho \"\"\necho -e \"${BLUE}5. Diagn√≥stico de problemas comuns:${NC}\"\n\nif [ \"$HTTP_STATUS\" -eq 403 ]; then\n    echo -e \"${YELLOW}üí° Solu√ß√µes para erro 403:${NC}\"\n    echo \"   1. Verificar permiss√µes: chmod -R 755 /var/www/juliocamara.dev/abmix-ligacao/\"\n    echo \"   2. Verificar owner: chown -R www-data:www-data /var/www/juliocamara.dev/abmix-ligacao/\"\n    echo \"   3. Verificar se aplica√ß√£o est√° rodando: pm2 status\"\n    echo \"   4. Verificar logs: pm2 logs abmix-ligacao\"\nfi\n\nif [ \"$HTTP_STATUS\" -eq 502 ]; then\n    echo -e \"${YELLOW}üí° Solu√ß√µes para erro 502:${NC}\"\n    echo \"   1. Verificar se aplica√ß√£o est√° rodando na porta 5001: ss -ltnp | grep :5001\"\n    echo \"   2. Iniciar aplica√ß√£o: PORT=5001 pm2 start dist/index.js --name abmix-ligacao\"\n    echo \"   3. Verificar logs: pm2 logs abmix-ligacao\"\nfi\n\necho \"\"\necho -e \"${GREEN}üéØ COMANDOS √öTEIS PARA DEBUG:${NC}\"\necho \"   ‚Ä¢ Ver logs: pm2 logs abmix-ligacao\"\necho \"   ‚Ä¢ Status: pm2 status\"\necho \"   ‚Ä¢ Reiniciar: pm2 restart abmix-ligacao\"\necho \"   ‚Ä¢ Ver portas: ss -ltnp | grep node\"\necho \"   ‚Ä¢ Testar local: curl http://127.0.0.1:5001/api/health\"\necho \"\"\n\n\n\n\n","size_bytes":2906},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/stores/useCallStore.ts":{"content":"import { create } from 'zustand';\nimport { Transcript, Favorite } from '@shared/schema';\n\ninterface CallState {\n  // Call management\n  callState: 'IDLE' | 'RINGING' | 'CONNECTED' | 'ENDED';\n  currentCallId: string | null;\n  recordingSid: string | null;\n  voiceType: string;\n  aiActive: boolean;\n  latency: number;\n  audioLevel: number;\n  phoneNumber: string;\n  \n  // Transcripts\n  transcripts: Transcript[];\n  \n  // Favorites\n  favorites: Favorite[];\n  \n  // UI states\n  isRecording: boolean;\n  livePrompt: string;\n  selectedProvider: string;\n  activeView: 'discagem' | 'vozes' | 'enhancer' | 'audio' | 'chamadas' | 'favoritos' | 'gravacoes' | 'configuracoes';\n  \n  // Actions\n  setCallState: (state: 'IDLE' | 'RINGING' | 'CONNECTED' | 'ENDED') => void;\n  setCurrentCallId: (callId: string | null) => void;\n  setRecordingSid: (sid: string | null) => void;\n  setVoiceType: (type: string) => void;\n  setAiActive: (active: boolean) => void;\n  setLatency: (latency: number) => void;\n  setAudioLevel: (level: number) => void;\n  setPhoneNumber: (number: string) => void;\n  appendToPhoneNumber: (digit: string) => void;\n  clearPhoneNumber: () => void;\n  addTranscript: (transcript: Transcript) => void;\n  updateTranscript: (id: string, updates: Partial<Transcript>) => void;\n  clearTranscripts: () => void;\n  setFavorites: (favorites: Favorite[]) => void;\n  setIsRecording: (recording: boolean) => void;\n  setLivePrompt: (prompt: string) => void;\n  setSelectedProvider: (provider: string) => void;\n  setActiveView: (view: 'discagem' | 'vozes' | 'enhancer' | 'audio' | 'chamadas' | 'favoritos' | 'gravacoes' | 'configuracoes') => void;\n}\n\nexport const useCallStore = create<CallState>((set, get) => ({\n  // Initial state\n  callState: 'IDLE',\n  currentCallId: null,\n  recordingSid: null,\n  voiceType: 'masc',\n  aiActive: false,\n  latency: 0,\n  audioLevel: 0,\n  phoneNumber: '',\n  transcripts: [],\n  favorites: [],\n  isRecording: false,\n  livePrompt: '',\n  selectedProvider: 'twilio',\n  activeView: 'discagem',\n  \n  // Actions\n  setCallState: (state) => set({ callState: state }),\n  setCurrentCallId: (callId) => set({ currentCallId: callId }),\n  setRecordingSid: (sid) => set({ recordingSid: sid }),\n  setVoiceType: (type) => set({ voiceType: type }),\n  setAiActive: (active) => set({ aiActive: active }),\n  setLatency: (latency) => set({ latency }),\n  setAudioLevel: (level) => set({ audioLevel: level }),\n  setPhoneNumber: (number) => set({ phoneNumber: number }),\n  appendToPhoneNumber: (digit) => set(state => ({ \n    phoneNumber: state.phoneNumber + digit \n  })),\n  clearPhoneNumber: () => set({ phoneNumber: '' }),\n  \n  addTranscript: (transcript) => set(state => ({\n    transcripts: [...state.transcripts, transcript]\n  })),\n  \n  updateTranscript: (id, updates) => set(state => ({\n    transcripts: state.transcripts.map(t => \n      t.id === id ? { ...t, ...updates } : t\n    )\n  })),\n  \n  clearTranscripts: () => set({ transcripts: [] }),\n  setFavorites: (favorites) => set({ favorites }),\n  setIsRecording: (recording) => set({ isRecording: recording }),\n  setLivePrompt: (prompt) => set({ livePrompt: prompt }),\n  setSelectedProvider: (provider) => set({ selectedProvider: provider }),\n  setActiveView: (view) => set({ activeView: view }),\n}));\n","size_bytes":3245},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/DialerCard.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { api } from '@/services/api';\nimport { connectCaptions, disconnectCaptions } from '@/services/captions';\nimport { validateE164, formatPhoneNumber, isDTMFTone } from '@/utils/validation';\nimport { VoiceConversionControl } from './VoiceConversionControl';\n\nexport function DialerCard() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { \n    phoneNumber, \n    setPhoneNumber, \n    appendToPhoneNumber,\n    clearPhoneNumber,\n    callState, \n    setCallState, \n    setCurrentCallId,\n    currentCallId,\n    voiceType,\n    setVoiceType,\n    selectedProvider \n  } = useCallStore();\n\n  const [selectedVoice, setSelectedVoice] = useState<'masc' | 'fem'>(voiceType as 'masc' | 'fem');\n\n  // Listen for favorite number selection\n  useEffect(() => {\n    const handleSetDialerNumber = (event: any) => {\n      const { number } = event.detail;\n      setPhoneNumber(number);\n    };\n\n    window.addEventListener('setDialerNumber', handleSetDialerNumber);\n    return () => window.removeEventListener('setDialerNumber', handleSetDialerNumber);\n  }, [setPhoneNumber]);\n\n  // Setup caption service only when needed (during call)\n  useEffect(() => {\n    if (callState === 'CONNECTED') {\n      (window as any).__CALL_ACTIVE__ = true;\n      connectCaptions();\n    } else {\n      (window as any).__CALL_ACTIVE__ = false;\n      disconnectCaptions();\n    }\n\n    return () => {\n      if (callState !== 'CONNECTED') {\n        (window as any).__CALL_ACTIVE__ = false;\n        disconnectCaptions();\n      }\n    };\n  }, [callState]);\n\n  const startCallMutation = useMutation({\n    mutationFn: () => api.startCall(selectedProvider, phoneNumber, selectedVoice),\n    onSuccess: (data) => {\n      setCurrentCallId(data.callSid);\n      setCallState('RINGING');\n      setVoiceType(selectedVoice);\n      \n      // Connect captions when call starts\n      (window as any).__CALL_ACTIVE__ = true;\n      connectCaptions();\n      \n      toast({\n        title: \"Chamada iniciada\",\n        description: `Discando para ${phoneNumber} (voz ${selectedVoice === 'masc' ? 'masculina' : 'feminina'})`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao iniciar chamada\",\n        description: error instanceof Error ? error.message : \"Falha na discagem\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const hangupMutation = useMutation({\n    mutationFn: () => api.hangupCall(currentCallId!),\n    onSuccess: () => {\n      setCallState('ENDED');\n      \n      // Disconnect captions when call ends\n      (window as any).__CALL_ACTIVE__ = false;\n      disconnectCaptions();\n      \n      setTimeout(() => {\n        setCallState('IDLE');\n        setCurrentCallId(null);\n      }, 1000);\n      toast({\n        title: \"Chamada encerrada\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao encerrar chamada\",\n        description: error instanceof Error ? error.message : \"Falha ao encerrar\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const dtmfMutation = useMutation({\n    mutationFn: (tone: string) => api.sendDTMF(currentCallId!, tone),\n    onSuccess: (_, tone) => {\n      toast({\n        title: `DTMF enviado: ${tone}`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao enviar DTMF\",\n        description: error instanceof Error ? error.message : \"Falha no envio\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleDial = () => {\n    const formatted = formatPhoneNumber(phoneNumber);\n    \n    if (!validateE164(formatted)) {\n      toast({\n        title: \"N√∫mero inv√°lido\",\n        description: \"Por favor, insira um n√∫mero no formato E.164 (+5511999999999)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setPhoneNumber(formatted);\n    startCallMutation.mutate();\n  };\n\n  const handleAnswer = () => {\n    // For incoming calls - this would be implemented when handling inbound calls\n    setCallState('CONNECTED');\n    toast({\n      title: \"Chamada atendida\",\n    });\n  };\n\n  const handleHangup = () => {\n    if (currentCallId) {\n      hangupMutation.mutate();\n    } else {\n      setCallState('IDLE');\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && callState === 'IDLE') {\n      handleDial();\n    }\n  };\n\n  const sendDTMF = (tone: string) => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!isDTMFTone(tone)) {\n      toast({\n        title: \"Tom DTMF inv√°lido\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    dtmfMutation.mutate(tone);\n  };\n\n  const dtmfTones = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '0', '#'];\n  \n  // Unified keypad handler - works for both dialing and DTMF\n  const handleKeypadPress = (digit: string) => {\n    if (callState === 'IDLE') {\n      // During dialing - add digit to phone number\n      if (digit === '*') {\n        appendToPhoneNumber('+');\n      } else if (digit === '#') {\n        // # doesn't add anything during dialing\n        return;\n      } else {\n        appendToPhoneNumber(digit);\n      }\n    } else if (callState === 'CONNECTED') {\n      // During call - send DTMF tone\n      sendDTMF(digit);\n    } else {\n      toast({\n        title: \"Teclado indispon√≠vel\",\n        description: \"Use o teclado apenas durante discagem ou chamada conectada\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"bg-card rounded-xl p-6 border border-border\">\n      <h3 className=\"text-lg font-semibold mb-4 text-foreground\">Discagem</h3>\n      \n      {/* Number Input */}\n      <div className=\"mb-4\">\n        <Label htmlFor=\"phone-input\" className=\"block text-sm text-muted-foreground mb-2\">\n          N√∫mero (E.164)\n        </Label>\n        <Input\n          id=\"phone-input\"\n          type=\"text\"\n          placeholder=\"+5511999999999\"\n          value={phoneNumber}\n          onChange={(e) => setPhoneNumber(e.target.value)}\n          onKeyDown={handleKeyDown}\n          className=\"w-full bg-background border border-border rounded-lg px-4 py-3 focus:border-abmix-green focus:outline-none transition-colors font-mono\"\n          data-testid=\"phone-input\"\n        />\n      </div>\n\n      {/* Voice Selection */}\n      <div className=\"mb-4\">\n        <Label className=\"block text-sm text-muted-foreground mb-2\">Tipo de Voz</Label>\n        <div className=\"grid grid-cols-2 gap-2\">\n          <Button\n            onClick={() => {\n              setSelectedVoice('masc');\n              toast({ title: \"Voz selecionada\", description: \"Voz masculina ativada\" });\n            }}\n            className={`py-2 px-3 rounded-lg transition-colors flex flex-col items-center justify-center text-xs gap-1 ${\n              selectedVoice === 'masc' \n                ? 'bg-abmix-green text-black' \n                : 'bg-background border border-border text-foreground hover:bg-muted'\n            }`}\n            data-testid=\"male-voice-button\"\n          >\n            <i className=\"fas fa-male text-sm\"></i>\n            Masculina\n          </Button>\n          \n          <Button\n            onClick={() => {\n              setSelectedVoice('fem');\n              toast({ title: \"Voz selecionada\", description: \"Voz feminina ativada\" });\n            }}\n            className={`py-2 px-3 rounded-lg transition-colors flex flex-col items-center justify-center text-xs gap-1 ${\n              selectedVoice === 'fem' \n                ? 'bg-abmix-green text-black' \n                : 'bg-background border border-border text-foreground hover:bg-muted'\n            }`}\n            data-testid=\"female-voice-button\"\n          >\n            <i className=\"fas fa-female text-sm\"></i>\n            Feminina\n          </Button>\n        </div>\n      </div>\n\n      {/* Action Buttons */}\n      <div className=\"grid grid-cols-3 gap-2\">\n        <Button\n          onClick={handleDial}\n          disabled={callState !== 'IDLE' || startCallMutation.isPending}\n          className=\"bg-abmix-green text-black font-medium py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors flex flex-col items-center justify-center text-xs gap-1\"\n          data-testid=\"dial-button\"\n        >\n          <i className=\"fas fa-phone text-sm\"></i>\n          {startCallMutation.isPending ? 'Discando' : 'Discar'}\n        </Button>\n        \n        <Button\n          onClick={handleAnswer}\n          disabled={callState !== 'RINGING'}\n          className=\"bg-abmix-green text-black font-medium py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors flex flex-col items-center justify-center disabled:opacity-50 text-xs gap-1\"\n          data-testid=\"answer-button\"\n        >\n          <i className=\"fas fa-phone text-sm\"></i>\n          Atender\n        </Button>\n        \n        <Button\n          onClick={handleHangup}\n          disabled={callState === 'IDLE' || hangupMutation.isPending}\n          className=\"bg-abmix-green text-black font-medium py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors flex flex-col items-center justify-center disabled:opacity-50 text-xs gap-1\"\n          data-testid=\"hangup-button\"\n        >\n          <i className=\"fas fa-phone-slash text-sm\"></i>\n          {hangupMutation.isPending ? 'Encerrando' : 'Encerrar'}\n        </Button>\n      </div>\n\n      {/* Unified Keypad - Works for both dialing and DTMF */}\n      <div className=\"mt-6 pt-4 border-t border-border\">\n        <Label className=\"block text-sm text-muted-foreground mb-3\">\n          {callState === 'IDLE' ? 'Teclado Num√©rico - Discagem' : 'Teclado DTMF - Durante Chamada'}\n        </Label>\n        <div className=\"grid grid-cols-3 gap-2\">\n          {dtmfTones.map((tone) => (\n            <Button\n              key={tone}\n              onClick={() => handleKeypadPress(tone)}\n              disabled={dtmfMutation.isPending}\n              className={`py-3 rounded text-lg font-mono transition-colors ${\n                callState === 'IDLE' \n                  ? 'bg-abmix-green text-black border border-abmix-green hover:bg-abmix-green/90' \n                  : callState === 'CONNECTED' \n                    ? 'bg-abmix-green text-black border border-abmix-green hover:bg-abmix-green/90' \n                    : 'bg-muted text-muted-foreground cursor-not-allowed opacity-50'\n              }`}\n              data-testid={`keypad-${tone}`}\n            >\n              {tone}\n            </Button>\n          ))}\n        </div>\n        \n        {/* Clear and Backspace buttons for dialing */}\n        {callState === 'IDLE' && (\n          <div className=\"grid grid-cols-2 gap-2 mt-2\">\n            <Button\n              onClick={() => setPhoneNumber(phoneNumber.slice(0, -1))}\n              disabled={phoneNumber.length === 0}\n              className=\"bg-muted text-foreground hover:bg-muted/80 py-2 text-sm\"\n              data-testid=\"backspace-button\"\n            >\n              ‚å´ Apagar\n            </Button>\n            <Button\n              onClick={() => setPhoneNumber('')}\n              disabled={phoneNumber.length === 0}\n              className=\"bg-muted text-foreground hover:bg-muted/80 py-2 text-sm\"\n              data-testid=\"clear-button\"\n            >\n              üóëÔ∏è Limpar\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {/* Voice Conversion Control */}\n      <div className=\"mt-6 pt-4 border-t border-border\">\n        <VoiceConversionControl \n          callSid={currentCallId || undefined}\n          isInCall={callState === 'CONNECTED'}\n          onVoiceConversionToggle={(enabled) => {\n            toast({\n              title: enabled ? \"Convers√£o Ativada\" : \"Convers√£o Desativada\",\n              description: enabled \n                ? \"Sua voz ser√° modificada em tempo real\" \n                : \"Voltando √† voz original\",\n            });\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":12235},"client/src/components/VoiceEnhancer.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Volume2, Zap, Sparkles, Settings } from \"lucide-react\";\n\ninterface VoiceSettings {\n  stability: number;\n  similarity: number;\n  style: number;\n  speakerBoost: boolean;\n  model: string;\n  quality: string;\n}\n\nexport function VoiceEnhancer() {\n  const { toast } = useToast();\n  const [settings, setSettings] = useState<VoiceSettings>({\n    stability: 35,\n    similarity: 95,\n    style: 15,\n    speakerBoost: true,\n    model: 'eleven_multilingual_v2',\n    quality: 'natural'\n  });\n  \n  const [recommendedVoices, setRecommendedVoices] = useState<{\n    masc: string[];\n    fem: string[];\n  }>({ masc: [], fem: [] });\n  \n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    fetchRecommendedVoices();\n  }, []);\n\n  const fetchRecommendedVoices = async () => {\n    try {\n      const response = await fetch('/api/voices/recommended');\n      if (response.ok) {\n        const data = await response.json();\n        setRecommendedVoices(data.voices || { masc: [], fem: [] });\n      } else {\n        console.error('Failed to fetch recommended voices:', response.status);\n        setRecommendedVoices({ masc: [], fem: [] });\n      }\n    } catch (error) {\n      console.error('Failed to fetch recommended voices:', error);\n      setRecommendedVoices({ masc: [], fem: [] });\n    }\n  };\n\n  const testEnhancedVoice = async (voiceId: string, voiceType: 'masc' | 'fem') => {\n    setIsLoading(true);\n    try {\n      const testText = voiceType === 'masc' \n        ? 'Ol√°, sou seu assistente virtual. Esta voz foi otimizada para soar mais natural e humana.'\n        : 'Ol√°, sou sua assistente virtual. Esta configura√ß√£o remove o tom rob√≥tico da voz artificial.';\n\n      const response = await fetch('/api/voices/test', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          voiceId,\n          text: testText,\n          voiceType,\n          quality: settings.quality\n        })\n      });\n\n      if (response.ok) {\n        const audioBlob = await response.blob();\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n        await audio.play();\n\n        toast({\n          title: \"üéØ Voz Aprimorada\",\n          description: `Reproduzindo voz ${voiceType} com configura√ß√µes anti-rob√≥ticas`,\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro no teste\",\n        description: \"N√£o foi poss√≠vel reproduzir a voz aprimorada\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const applySettings = async () => {\n    try {\n      const response = await fetch('/api/settings', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          VOICE_STABILITY: (settings.stability / 100).toString(),\n          VOICE_SIMILARITY: (settings.similarity / 100).toString(),\n          VOICE_STYLE: (settings.style / 100).toString(),\n          VOICE_SPEAKER_BOOST: settings.speakerBoost.toString(),\n          MODELO: settings.model,\n          VOICE_PROCESSING: settings.quality\n        })\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"‚úÖ Configura√ß√µes Salvas\",\n          description: \"Voz otimizada para soar mais natural\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro\",\n        description: \"Falha ao salvar configura√ß√µes\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"border-green-200 dark:border-green-800\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-green-700 dark:text-green-300\">\n            <Sparkles className=\"h-5 w-5\" />\n            Otimizador de Voz Anti-Rob√≥tica\n          </CardTitle>\n          <CardDescription>\n            Configure par√¢metros avan√ßados para vozes mais naturais e humanas\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {/* Modelo de IA */}\n          <div className=\"space-y-2\">\n            <Label>Modelo de IA</Label>\n            <Select value={settings.model} onValueChange={(value) => \n              setSettings(prev => ({ ...prev, model: value }))\n            }>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"eleven_multilingual_v2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"secondary\">Recomendado</Badge>\n                    Multilingual V2 (Natural)\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"eleven_turbo_v2_5\">\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"outline\">Novo</Badge>\n                    Turbo V2.5 (Ultra Natural)\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"eleven_flash_v2_5\">\n                  Flash V2.5 (R√°pido)\n                </SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Qualidade */}\n          <div className=\"space-y-2\">\n            <Label>Prioridade</Label>\n            <Select value={settings.quality} onValueChange={(value) => \n              setSettings(prev => ({ ...prev, quality: value }))\n            }>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"natural\">\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"secondary\">Melhor</Badge>\n                    Naturalidade M√°xima\n                  </div>\n                </SelectItem>\n                <SelectItem value=\"quality\">Qualidade Alta</SelectItem>\n                <SelectItem value=\"speed\">Velocidade</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Configura√ß√µes Avan√ßadas */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label>Estabilidade: {settings.stability}%</Label>\n              <Slider\n                value={[settings.stability]}\n                onValueChange={([value]) => \n                  setSettings(prev => ({ ...prev, stability: value }))\n                }\n                max={100}\n                step={5}\n                className=\"w-full\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Menos = mais emotivo, Mais = mais consistente\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Similaridade: {settings.similarity}%</Label>\n              <Slider\n                value={[settings.similarity]}\n                onValueChange={([value]) => \n                  setSettings(prev => ({ ...prev, similarity: value }))\n                }\n                max={100}\n                step={5}\n                className=\"w-full\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Maior = mais fiel √† voz original\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Estilo: {settings.style}%</Label>\n              <Slider\n                value={[settings.style]}\n                onValueChange={([value]) => \n                  setSettings(prev => ({ ...prev, style: value }))\n                }\n                max={100}\n                step={5}\n                className=\"w-full\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                Personalidade da voz original\n              </p>\n            </div>\n\n            <div className=\"flex items-center justify-between\">\n              <Label htmlFor=\"speaker-boost\">Amplifica√ß√£o de Clareza</Label>\n              <Switch\n                id=\"speaker-boost\"\n                checked={settings.speakerBoost}\n                onCheckedChange={(checked) => \n                  setSettings(prev => ({ ...prev, speakerBoost: checked }))\n                }\n              />\n            </div>\n          </div>\n\n          {/* Bot√µes de A√ß√£o */}\n          <div className=\"flex gap-2\">\n            <Button \n              onClick={applySettings}\n              className=\"flex-1 bg-green-600 hover:bg-green-700\"\n            >\n              <Settings className=\"h-4 w-4 mr-2\" />\n              Aplicar Configura√ß√µes\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Vozes Recomendadas */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Volume2 className=\"h-5 w-5\" />\n            Vozes Menos Rob√≥ticas\n          </CardTitle>\n          <CardDescription>\n            Sele√ß√£o de vozes otimizadas para soar mais humanas\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {/* Vozes Masculinas */}\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-blue-700 dark:text-blue-300\">Masculinas</h3>\n              <div className=\"space-y-2\">\n                {recommendedVoices?.masc?.slice(0, 3).map((voiceId, index) => (\n                  <Button\n                    key={voiceId}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => testEnhancedVoice(voiceId, 'masc')}\n                    disabled={isLoading}\n                    className=\"w-full justify-start\"\n                  >\n                    <Zap className=\"h-4 w-4 mr-2\" />\n                    Testar Voz {index + 1}\n                  </Button>\n                )) || (\n                  <div className=\"text-sm text-muted-foreground\">\n                    Carregando vozes recomendadas...\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Vozes Femininas */}\n            <div className=\"space-y-2\">\n              <h3 className=\"font-semibold text-pink-700 dark:text-pink-300\">Femininas</h3>\n              <div className=\"space-y-2\">\n                {recommendedVoices?.fem?.slice(0, 3).map((voiceId, index) => (\n                  <Button\n                    key={voiceId}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => testEnhancedVoice(voiceId, 'fem')}\n                    disabled={isLoading}\n                    className=\"w-full justify-start\"\n                  >\n                    <Sparkles className=\"h-4 w-4 mr-2\" />\n                    Testar Voz {index + 1}\n                  </Button>\n                )) || (\n                  <div className=\"text-sm text-muted-foreground\">\n                    Carregando vozes recomendadas...\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Dicas */}\n      <Card className=\"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800\">\n        <CardContent className=\"pt-6\">\n          <h3 className=\"font-semibold mb-2 text-blue-700 dark:text-blue-300\">\n            üí° Dicas para Voz Mais Natural\n          </h3>\n          <ul className=\"text-sm space-y-1 text-blue-600 dark:text-blue-400\">\n            <li>‚Ä¢ Estabilidade baixa (30-40%) = mais expressiva</li>\n            <li>‚Ä¢ Similaridade alta (90-95%) = menos rob√≥tica</li>\n            <li>‚Ä¢ Modelo Multilingual V2 = melhor qualidade</li>\n            <li>‚Ä¢ Textos longos = maior varia√ß√£o natural</li>\n            <li>‚Ä¢ Evite frases muito t√©cnicas ou repetitivas</li>\n          </ul>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":12319},"client/src/services/websocket.ts":{"content":"import { useCallStore } from '@/stores/useCallStore';\n\nclass WebSocketService {\n  private ws: WebSocket | null = null;\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private reconnectInterval = 3000;\n  private isConnected = false;\n\n  connect() {\n    // DISABLED - This WebSocket service is disabled to prevent infinite loops\n    // Use captions.ts service for call-specific connections instead\n    console.log('[WEBSOCKET] Service disabled - use captions service for calls');\n    return;\n\n    this.ws.onopen = () => {\n      console.log('WebSocket connected');\n      this.isConnected = true;\n      this.reconnectAttempts = 0;\n    };\n\n    this.ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        this.handleMessage(data);\n      } catch (error) {\n        console.error('Failed to parse WebSocket message:', error);\n      }\n    };\n\n    this.ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      this.isConnected = false;\n      this.attemptReconnect();\n    };\n\n    this.ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n  }\n\n  private attemptReconnect() {\n    // DISABLED - No more automatic reconnection to prevent loops\n    console.log('[WEBSOCKET] Reconnection disabled - use captions service instead');\n  }\n\n  private handleMessage(data: any) {\n    const store = useCallStore.getState();\n\n    switch (data.type) {\n      case 'connected':\n        store.setSelectedProvider(data.payload.provider);\n        break;\n\n      case 'call:state':\n        store.setCallState(data.payload.state);\n        if (data.payload.state === 'ENDED') {\n          store.setCurrentCallId(null);\n          store.clearTranscripts();\n        }\n        break;\n\n      case 'agent:state':\n        store.setAiActive(data.payload.aiActive);\n        break;\n\n      case 'transcript:partial':\n        // For partial transcripts, find existing and update or add new\n        const existingPartial = store.transcripts.find(\n          t => t.speaker === data.payload.speaker && !t.isFinal\n        );\n        \n        if (existingPartial) {\n          store.updateTranscript(existingPartial.id, {\n            text: data.payload.text,\n            timestamp: new Date(data.payload.timestamp),\n          });\n        } else {\n          store.addTranscript({\n            id: `partial-${Date.now()}`,\n            callId: data.callId,\n            speaker: data.payload.speaker,\n            text: data.payload.text,\n            timestamp: new Date(data.payload.timestamp),\n            isFinal: false,\n            confidence: data.payload.confidence || null,\n          });\n        }\n        break;\n\n      case 'transcript:final':\n        // Remove any partial transcript and add final one\n        const finalTranscript = {\n          id: `final-${Date.now()}`,\n          callId: data.callId,\n          speaker: data.payload.speaker,\n          text: data.payload.text,\n          timestamp: new Date(data.payload.timestamp),\n          isFinal: true,\n          confidence: data.payload.confidence || null,\n        };\n        \n        // Remove partial transcript for same speaker\n        store.clearTranscripts();\n        store.transcripts\n          .filter(t => !(t.speaker === data.payload.speaker && !t.isFinal))\n          .forEach(t => store.addTranscript(t));\n        \n        store.addTranscript(finalTranscript);\n        break;\n\n      case 'latency:update':\n        store.setLatency(data.payload.latency);\n        break;\n\n      case 'audio:level':\n        store.setAudioLevel(data.payload.level);\n        break;\n\n      case 'error':\n        console.error('Call error:', data.payload);\n        break;\n\n      default:\n        console.log('Unknown WebSocket message type:', data.type);\n    }\n  }\n\n  disconnect() {\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n      this.isConnected = false;\n    }\n  }\n\n  getConnectionStatus() {\n    return this.isConnected;\n  }\n}\n\nexport const websocketService = new WebSocketService();\n","size_bytes":4002},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"server/providers/retellProvider.ts":{"content":"import { VoiceProvider, CallEvent } from './voiceProvider';\n\nexport class RetellProvider implements VoiceProvider {\n  private apiKey: string;\n  private baseUrl = 'https://api.retellai.com';\n\n  constructor() {\n    this.apiKey = process.env.RETELL_API_KEY || process.env.RETELL_KEY || \"\";\n  }\n\n  async startCall(toNumber: string, voiceId?: string): Promise<{ callId: string; status: string }> {\n    // TODO: Implement Retell call start\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async hangup(callId: string): Promise<boolean> {\n    // TODO: Implement Retell hangup\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async pauseAI(callId: string): Promise<boolean> {\n    // TODO: Implement Retell AI pause\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async resumeAI(callId: string): Promise<boolean> {\n    // TODO: Implement Retell AI resume\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async injectPrompt(callId: string, prompt: string): Promise<boolean> {\n    // TODO: Implement Retell prompt injection\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async transfer(callId: string, target: string): Promise<boolean> {\n    // TODO: Implement Retell transfer\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async hold(callId: string): Promise<boolean> {\n    // TODO: Implement Retell hold\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async resume(callId: string): Promise<boolean> {\n    // TODO: Implement Retell resume\n    throw new Error('Retell provider not implemented yet');\n  }\n\n  async sendDTMF(callId: string, tone: string): Promise<boolean> {\n    // TODO: Implement Retell DTMF\n    throw new Error('Retell provider not implemented yet');\n  }\n}\n","size_bytes":1794},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"server/routes_backup.ts":{"content":"import type { Express } from \"express\";\nimport { createServer } from \"http\";\nimport { setupTelephony } from \"./telephony\";\nimport { queries } from \"./database\";\nimport { initDatabase } from \"./database\";\nimport twilio from \"twilio\";\nimport express from \"express\";\nimport fetch from \"node-fetch\";\nimport multer from \"multer\";\nimport { promises as fs } from \"fs\";\nimport path from \"path\";\nimport { recordingService } from \"./recordingService\";\nimport { db } from \"./db\";\nimport { calls, recordings } from \"@shared/schema\";\nimport { eq, desc } from \"drizzle-orm\";\n\n// Environment variables\nconst {\n  TWILIO_ACCOUNT_SID,\n  TWILIO_AUTH_TOKEN,\n  TWILIO_NUMBER,\n  ELEVENLABS_API_KEY\n} = process.env;\n\nexport async function registerRoutes(app: Express) {\n  // Initialize database\n  initDatabase();\n  \n  // Create HTTP server\n  const server = createServer(app);\n  \n  // Setup telephony with WebSocket\n  setupTelephony(app, server);\n  \n  // === SETUP/VALIDATION ROUTES ===\n\n  // Setup API keys validation endpoint\n  app.post(\"/api/setup/keys\", async (req, res) => {\n    try {\n      const { ELEVENLABS_API_KEY, TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_NUMBER } = req.body;\n      \n      console.log('[SETUP] Validating API keys...');\n      \n      // Basic format validation first\n      if (!ELEVENLABS_API_KEY || !ELEVENLABS_API_KEY.startsWith('sk-')) {\n        return res.status(400).json({ \n          success: false, \n          message: 'Chave ElevenLabs inv√°lida. Deve come√ßar com \"sk-\"'\n        });\n      }\n      \n      if (!TWILIO_ACCOUNT_SID || !TWILIO_ACCOUNT_SID.startsWith('AC')) {\n        return res.status(400).json({ \n          success: false, \n          message: 'Twilio Account SID inv√°lido. Deve come√ßar com \"AC\"'\n        });\n      }\n      \n      if (!TWILIO_AUTH_TOKEN || TWILIO_AUTH_TOKEN.length < 32) {\n        return res.status(400).json({ \n          success: false, \n          message: 'Twilio Auth Token inv√°lido. Deve ter pelo menos 32 caracteres'\n        });\n      }\n      \n      if (!TWILIO_NUMBER || !TWILIO_NUMBER.startsWith('+')) {\n        return res.status(400).json({ \n          success: false, \n          message: 'N√∫mero Twilio inv√°lido. Deve estar no formato E.164 (+5511...)'\n        });\n      }\n      \n      // Validate ElevenLabs API\n      let elevenLabsValid = false;\n      let twilioValid = false;\n      let elevenLabsError = '';\n      let twilioError = '';\n      \n      try {\n        console.log('[SETUP] Testing ElevenLabs API...');\n        const elevenLabsResponse = await fetch('https://api.elevenlabs.io/v1/voices', {\n          headers: { 'xi-api-key': ELEVENLABS_API_KEY }\n        });\n        \n        if (elevenLabsResponse.ok) {\n          elevenLabsValid = true;\n          console.log('[SETUP] ElevenLabs API validated');\n        } else {\n          elevenLabsError = `HTTP ${elevenLabsResponse.status}: ${elevenLabsResponse.statusText}`;\n          console.log('[SETUP] ElevenLabs validation failed:', elevenLabsError);\n        }\n      } catch (error) {\n        elevenLabsError = error instanceof Error ? error.message : 'Erro de conex√£o';\n        console.log('[SETUP] ElevenLabs error:', elevenLabsError);\n      }\n      \n      // Validate Twilio API\n      try {\n        console.log('[SETUP] Testing Twilio API...');\n        const credentials = Buffer.from(`${TWILIO_ACCOUNT_SID}:${TWILIO_AUTH_TOKEN}`).toString('base64');\n        const twilioResponse = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${TWILIO_ACCOUNT_SID}.json`, {\n          headers: { 'Authorization': `Basic ${credentials}` }\n        });\n        \n        if (twilioResponse.ok) {\n          twilioValid = true;\n          console.log('[SETUP] Twilio API validated');\n        } else {\n          twilioError = `HTTP ${twilioResponse.status}: ${twilioResponse.statusText}`;\n          console.log('[SETUP] Twilio validation failed:', twilioError);\n        }\n      } catch (error) {\n        twilioError = error instanceof Error ? error.message : 'Erro de conex√£o';\n        console.log('[SETUP] Twilio error:', twilioError);\n      }\n      \n      if (elevenLabsValid && twilioValid) {\n        console.log('[SETUP] All API keys validated successfully');\n        \n        // Store validated keys in environment (for this session)\n        process.env.ELEVENLABS_API_KEY = ELEVENLABS_API_KEY;\n        process.env.TWILIO_ACCOUNT_SID = TWILIO_ACCOUNT_SID;\n        process.env.TWILIO_AUTH_TOKEN = TWILIO_AUTH_TOKEN;\n        process.env.TWILIO_NUMBER = TWILIO_NUMBER;\n        \n        res.json({ success: true, message: 'Chaves validadas com sucesso!' });\n      } else {\n        console.log('[SETUP] Validation failed:', { elevenLabsValid, twilioValid, elevenLabsError, twilioError });\n        \n        let errorMessage = 'Falha na valida√ß√£o das chaves API:';\n        if (!elevenLabsValid) errorMessage += `\\n‚Ä¢ ElevenLabs: ${elevenLabsError}`;\n        if (!twilioValid) errorMessage += `\\n‚Ä¢ Twilio: ${twilioError}`;\n        \n        res.status(400).json({ \n          success: false, \n          message: errorMessage,\n          details: {\n            elevenlabs: { valid: elevenLabsValid, error: elevenLabsError },\n            twilio: { valid: twilioValid, error: twilioError }\n          }\n        });\n      }\n    } catch (error) {\n      console.error('[SETUP] Key validation error:', error);\n      res.status(500).json({ \n        success: false, \n        message: 'Erro interno do servidor durante valida√ß√£o' \n      });\n    }\n  });\n\n  // Get ElevenLabs voices (proxy)\n  app.get(\"/api/voices\", async (req, res) => {\n    try {\n      if (!ELEVENLABS_API_KEY) {\n        return res.status(500).json({ message: \"ElevenLabs API key not configured\" });\n      }\n\n      const response = await fetch('https://api.elevenlabs.io/v1/voices', {\n        headers: { 'xi-api-key': ELEVENLABS_API_KEY }\n      });\n\n      if (!response.ok) {\n        throw new Error(`ElevenLabs API error: ${response.status}`);\n      }\n\n      const voices = await response.json();\n      res.json(voices);\n    } catch (error) {\n      console.error('[VOICES] Error fetching voices:', error);\n      res.status(500).json({ message: \"Failed to fetch voices\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Test voice with specific text - VERSION APRIMORADA\n  app.post('/api/voices/test', async (req, res) => {\n    try {\n      const { voiceId, text, voiceType = 'masc', quality = 'natural' } = req.body;\n      \n      if (!voiceId || !text) {\n        return res.status(400).json({ error: 'VoiceId and text are required' });\n      }\n\n      if (!ELEVENLABS_API_KEY) {\n        return res.status(500).json({ error: 'ElevenLabs API key not configured' });\n      }\n\n      console.log(`[VOICE_TEST] Testing voice ${voiceId} (${voiceType}) with enhanced settings`);\n      \n      // Importa o processador de voz\n      const { voiceProcessor } = await import('./voiceProcessor');\n      \n      // Configura√ß√µes otimizadas para naturalidade\n      const voiceSettings = voiceProcessor.getOptimizedVoiceSettings(voiceType as 'masc' | 'fem');\n      const bestModel = voiceProcessor.getBestModel(quality as 'speed' | 'quality' | 'natural');\n      const advancedParams = voiceProcessor.getAdvancedParameters(text);\n      \n      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {\n        method: 'POST',\n        headers: {\n          'Accept': 'audio/mpeg',\n          'Content-Type': 'application/json',\n          'xi-api-key': ELEVENLABS_API_KEY\n        },\n        body: JSON.stringify({\n          text,\n          model_id: bestModel,\n          voice_settings: voiceSettings,\n          ...advancedParams\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`ElevenLabs TTS error: ${response.statusText}`);\n      }\n\n      let audioBuffer = Buffer.from(await response.arrayBuffer());\n      \n      // Processa o √°udio para torn√°-lo mais natural\n      audioBuffer = await voiceProcessor.processAudioBuffer(audioBuffer);\n      \n      res.set({\n        'Content-Type': 'audio/mpeg',\n        'Content-Length': audioBuffer.byteLength.toString(),\n        'X-Voice-Quality': 'enhanced'\n      });\n      \n      res.send(audioBuffer);\n    } catch (error) {\n      console.error('[VOICE_TEST] Error testing voice:', error);\n      res.status(500).json({ error: 'Failed to test voice' });\n    }\n  });\n\n  // Novo endpoint: Lista vozes recomendadas (menos rob√≥ticas)\n  app.get('/api/voices/recommended', async (req, res) => {\n    try {\n      // Vozes recomendadas codificadas para evitar depend√™ncias\n      const recommended = {\n        masc: [\n          'pNInz6obpgDQGcFmaJgB', // Adam - voz masculina natural\n          'VR6AewLTigWG4xSOukaG', // Arnold - profundo e natural  \n          'ErXwobaYiN019PkySvjV', // Antoni - caloroso\n          'yoZ06aMxZJJ28mfd3POQ', // Sam - jovem e energ√©tico\n          'jsCqWAovK2LkecY7zXl4'  // Matheus - portugu√™s brasileiro\n        ],\n        fem: [\n          'EXAVITQu4vr4xnSDxMaL', // Bella - feminina suave\n          'AZnzlk1XvdvUeBnXmlld', // Domi - expressiva\n          'TxGEqnHWrfWFTfGW9XjX', // Josh - vers√°til\n          'pFZP5JQG7iQjIQuC4Bku', // Lily - jovem e clara\n          'CwhRBWXzGAHq8TQ4Fs17'  // Serena - brasileira natural\n        ]\n      };\n      \n      res.json({\n        message: 'Vozes otimizadas para soar mais naturais',\n        voices: recommended,\n        tips: [\n          'Estas vozes foram selecionadas por soarem menos rob√≥ticas',\n          'Use o modelo eleven_multilingual_v2 para melhor qualidade',\n          'Configura√ß√µes de estabilidade baixa (0.3-0.4) s√£o mais naturais',\n          'Similarity boost alto (0.9+) melhora a qualidade'\n        ]\n      });\n    } catch (error) {\n      console.error('[VOICES] Error getting recommended voices:', error);\n      res.status(500).json({ error: 'Failed to get recommended voices' });\n    }\n  });\n\n  // === FAVORITES ROUTES ===\n\n  // Add favorite\n  app.post(\"/api/favorites/add\", (req, res) => {\n    try {\n      const { name, phone_e164, voice_type } = req.body;\n      \n      if (!name || !phone_e164 || !voice_type) {\n        return res.status(400).json({ message: \"name, phone_e164, and voice_type are required\" });\n      }\n\n      const favorite = queries.addFavorite.run({\n        name,\n        phone_e164,\n        voice_type\n      });\n\n      console.log(`[FAVORITE] Added: ${name} (${phone_e164}) with voice ${voice_type}`);\n      res.json({ success: true, favorite });\n    } catch (error) {\n      console.error('[FAVORITE] Error adding favorite:', error);\n      res.status(500).json({ message: \"Failed to add favorite\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Remove favorite\n  app.delete(\"/api/favorites/:id\", (req, res) => {\n    try {\n      const { id } = req.params;\n      const result = queries.removeFavorite.run({ id: parseInt(id) });\n      \n      if (result.changes === 0) {\n        return res.status(404).json({ message: \"Favorite not found\" });\n      }\n\n      console.log(`[FAVORITE] Removed favorite with ID: ${id}`);\n      res.json({ success: true, message: \"Favorite removed\" });\n    } catch (error) {\n      console.error('[FAVORITE] Error removing favorite:', error);\n      res.status(500).json({ message: \"Failed to remove favorite\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Get all favorites\n  app.get(\"/api/favorites\", (req, res) => {\n    try {\n      const favorites = queries.getAllFavorites.all();\n      res.json(favorites);\n    } catch (error) {\n      console.error('[FAVORITE] Error getting favorites:', error);\n      res.status(500).json({ message: \"Failed to get favorites\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === SETTINGS ROUTES ===\n\n  // Get settings\n  app.get(\"/api/settings\", (req, res) => {\n    try {\n      const settings = queries.getAllSettings.all();\n      const settingsObj = settings.reduce((acc: any, setting: any) => {\n        acc[setting.key] = setting.value;\n        return acc;\n      }, {});\n      res.json(settingsObj);\n    } catch (error) {\n      console.error('[SETTINGS] Error getting settings:', error);\n      res.status(500).json({ message: \"Failed to get settings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Update settings\n  app.post(\"/api/settings\", (req, res) => {\n    try {\n      const settings = req.body;\n      \n      for (const [key, value] of Object.entries(settings)) {\n        queries.setSetting.run({ key, value: String(value) });\n      }\n\n      console.log('[SETTINGS] Updated settings:', Object.keys(settings));\n      res.json({ success: true, message: \"Settings updated\" });\n    } catch (error) {\n      console.error('[SETTINGS] Error updating settings:', error);\n      res.status(500).json({ message: \"Failed to update settings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === RECORDINGS ROUTES ===\n\n  // List recordings\n  app.get(\"/api/recordings/list\", async (req, res) => {\n    try {\n      const recordings = queries.getAllRecordings.all();\n      res.json(recordings);\n    } catch (error) {\n      console.error('[RECORDING] Error listing recordings:', error);\n      res.status(500).json({ message: \"Failed to list recordings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Start recording  \n  app.post(\"/api/recordings/start\", async (req, res) => {\n    try {\n      const { callSid, phoneNumber } = req.body;\n      \n      console.log(`[RECORDING] Starting recording for call: ${callSid || 'demo'}`);\n\n      const timestamp = Date.now();\n      const filename = `call-${phoneNumber || 'unknown'}-${timestamp}.wav`;\n      \n      queries.addRecording.run(callSid || `demo-${timestamp}`, phoneNumber || 'unknown', filename);\n      const recordingDb = queries.getLastRecording.get() as any;\n      \n      console.log(`[RECORDING] Recording started: ${filename}`);\n      res.json({ \n        success: true, \n        id: recordingDb.id, \n        filename, \n        callSid: callSid || `demo-${timestamp}`,\n        status: 'recording'\n      });\n    } catch (error) {\n      console.error('[RECORDING] Error starting recording:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Pause recording\n  app.post(\"/api/recordings/:id/pause\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      console.log(`[RECORDING] Pausing recording ${recordingId}`);\n      \n      res.json({ \n        success: true, \n        id: recordingId,\n        status: 'paused',\n        message: \"Recording paused successfully\" \n      });\n    } catch (error) {\n      console.error('[RECORDING] Error pausing recording:', error);\n      res.status(500).json({ message: \"Failed to pause recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Resume recording\n  app.post(\"/api/recordings/:id/resume\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      console.log(`[RECORDING] Resuming recording ${recordingId}`);\n      \n      res.json({ \n        success: true, \n        id: recordingId,\n        status: 'recording',\n        message: \"Recording resumed successfully\" \n      });\n    } catch (error) {\n      console.error('[RECORDING] Error resuming recording:', error);\n      res.status(500).json({ message: \"Failed to resume recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Stop recording\n  app.post(\"/api/recordings/:id/stop\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      const recording = queries.getRecordingById.get(recordingId);\n      if (!recording) {\n        return res.status(404).json({ message: \"Recording not found\" });\n      }\n\n      // Create demo audio file\n      const { existsSync, mkdirSync, writeFileSync, statSync } = await import('fs');\n      const { join } = await import('path');\n      \n      const recordingsDir = join(process.cwd(), 'recordings');\n      if (!existsSync(recordingsDir)) {\n        mkdirSync(recordingsDir, { recursive: true });\n      }\n\n      const filePath = join(recordingsDir, (recording as any).filename);\n      \n      // Generate a simple WAV file\n      const duration = 10; // 10 seconds\n      const sampleRate = 44100;\n      const channels = 1;\n      const bitsPerSample = 16;\n      const blockAlign = channels * bitsPerSample / 8;\n      const byteRate = sampleRate * blockAlign;\n      const dataSize = duration * byteRate;\n      const fileSize = 36 + dataSize;\n\n      const buffer = Buffer.alloc(44 + dataSize);\n      \n      // WAV header\n      buffer.write('RIFF', 0);\n      buffer.writeUInt32LE(fileSize, 4);\n      buffer.write('WAVE', 8);\n      buffer.write('fmt ', 12);\n      buffer.writeUInt32LE(16, 16);\n      buffer.writeUInt16LE(1, 20);\n      buffer.writeUInt16LE(channels, 22);\n      buffer.writeUInt32LE(sampleRate, 24);\n      buffer.writeUInt32LE(byteRate, 28);\n      buffer.writeUInt16LE(blockAlign, 32);\n      buffer.writeUInt16LE(bitsPerSample, 34);\n      buffer.write('data', 36);\n      buffer.writeUInt32LE(dataSize, 40);\n      \n      // Generate 440Hz tone\n      for (let i = 0; i < dataSize / 2; i++) {\n        const sample = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 16000;\n        buffer.writeInt16LE(Math.floor(sample), 44 + i * 2);\n      }\n      \n      writeFileSync(filePath, buffer);\n      const stats = statSync(filePath);\n      \n      queries.updateRecording.run(duration, stats.size, recordingId);\n      \n      console.log(`[RECORDING] Stopped recording ${recordingId}: ${(recording as any).filename}`);\n      res.json({ success: true, id: recordingId, duration, size: stats.size });\n    } catch (error) {\n      console.error('[RECORDING] Error stopping recording:', error);\n      res.status(500).json({ message: \"Failed to stop recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n      \n      // WAV header + tone audio data\n      const buffer = Buffer.alloc(44 + dataSize);\n      buffer.write('RIFF', 0);\n      buffer.writeUInt32LE(fileSize, 4);\n      buffer.write('WAVE', 8);\n      buffer.write('fmt ', 12);\n      buffer.writeUInt32LE(16, 16);\n      buffer.writeUInt16LE(1, 20);\n      buffer.writeUInt16LE(channels, 22);\n      buffer.writeUInt32LE(sampleRate, 24);\n      buffer.writeUInt32LE(byteRate, 28);\n      buffer.writeUInt16LE(blockAlign, 32);\n      buffer.writeUInt16LE(bitsPerSample, 34);\n      buffer.write('data', 36);\n      buffer.writeUInt32LE(dataSize, 40);\n      \n      // Generate a 440Hz tone  \n      for (let i = 0; i < dataSize / 2; i++) {\n        const sample = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 16000;\n        buffer.writeInt16LE(Math.floor(sample), 44 + i * 2);\n      }\n      \n      writeFileSync(filePath, buffer);\n      \n      const stats = statSync(filePath);\n      \n      queries.updateRecording.run(duration, stats.size, recordingId);\n      \n      console.log(`[RECORDING] Stopped recording ${recordingId}: ${(recording as any).filename}`);\n      res.json({ success: true, id: recordingId, duration, size: stats.size });\n    } catch (error) {\n      console.error('[RECORDING] Error stopping recording:', error);\n      res.status(500).json({ message: \"Failed to stop recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Download recording\n  app.get(\"/api/recordings/:id/download\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      const recording = queries.getRecordingById.get(recordingId);\n      if (!recording || !(recording as any).filename) {\n        return res.status(404).json({ message: \"Recording not found\" });\n      }\n\n      const { join } = await import('path');\n      const { existsSync, statSync } = await import('fs');\n      \n      const filePath = join(process.cwd(), 'recordings', (recording as any).filename);\n      \n      if (!existsSync(filePath)) {\n        return res.status(404).json({ message: \"Recording file not found\" });\n      }\n\n      const stats = statSync(filePath);\n      \n      res.set({\n        'Content-Type': 'audio/wav',\n        'Content-Disposition': `attachment; filename=\"${(recording as any).filename}\"`,\n        'Content-Length': stats.size\n      });\n      \n      const { createReadStream } = await import('fs');\n      const fileStream = createReadStream(filePath);\n      fileStream.pipe(res);\n      \n      console.log(`[RECORDING] Downloaded recording ${recordingId}: ${(recording as any).filename}`);\n    } catch (error) {\n      console.error('[RECORDING] Error downloading recording:', error);\n      res.status(500).json({ message: \"Failed to download recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Delete recording\n  app.delete(\"/api/recordings/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      const recording = queries.getRecordingById.get(recordingId);\n      if (!recording) {\n        return res.status(404).json({ message: \"Recording not found\" });\n      }\n\n      // Delete file from disk\n      const { join } = await import('path');\n      const { existsSync, unlinkSync } = await import('fs');\n      \n      const filePath = join(process.cwd(), 'recordings', (recording as any).filename);\n      \n      if (existsSync(filePath)) {\n        unlinkSync(filePath);\n      }\n\n      // Delete from database\n      queries.deleteRecording.run(recordingId);\n      \n      console.log(`[RECORDING] Deleted recording ${recordingId}: ${(recording as any).filename}`);\n      res.json({ success: true, message: \"Recording deleted successfully\" });\n    } catch (error) {\n      console.error('[RECORDING] Error deleting recording:', error);\n      res.status(500).json({ message: \"Failed to delete recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Recording status callback from Twilio\n  app.post(\"/twilio/recording-status\", express.urlencoded({ extended: true }), async (req, res) => {\n    try {\n      const {\n        CallSid,\n        RecordingSid,\n        RecordingUrl,\n        RecordingDuration,\n        RecordingStatus\n      } = req.body;\n\n      console.log(`[TWILIO] Recording status: ${RecordingStatus} for ${CallSid}`);\n\n      if (RecordingStatus === 'completed') {\n        const urlMp3 = `${RecordingUrl}.mp3`;\n        const auth = Buffer.from(`${TWILIO_ACCOUNT_SID}:${TWILIO_AUTH_TOKEN}`).toString('base64');\n        \n        const response = await fetch(urlMp3, { \n          headers: { Authorization: `Basic ${auth}` }\n        });\n        \n        if (!response.ok) throw new Error(`Download failed: ${response.status}`);\n        \n        const { join } = await import('path');\n        const { writeFile, mkdir } = await import('fs').then(fs => fs.promises);\n        \n        const recordingsDir = join(process.cwd(), 'recordings');\n        await mkdir(recordingsDir, { recursive: true });\n        \n        const file = join(recordingsDir, `${CallSid}-${RecordingSid}.mp3`);\n        await writeFile(file, Buffer.from(await response.arrayBuffer()));\n        \n        console.log(`[TWILIO] Downloaded recording: ${CallSid}-${RecordingSid}.mp3`);\n      }\n      \n      res.status(200).end();\n    } catch (error) {\n      console.error('[TWILIO] Recording status error:', error instanceof Error ? error.message : String(error));\n      res.status(200).end(); // Always respond 200 to Twilio\n    }\n  });\n\n  // Serve test page for public access verification\n  app.get('/test-public', (req, res) => {\n    const html = `\n<!DOCTYPE html>\n<html>\n<head>\n    <title>‚úÖ Teste P√∫blico Abmix - APIs Funcionando!</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 20px; background: #0f172a; color: white; }\n        .success { background: #16a34a; color: white; padding: 15px; border-radius: 8px; margin: 10px 0; }\n        .info { background: #0ea5e9; color: white; padding: 10px; border-radius: 8px; margin: 10px 0; }\n        button { background: #22c55e; color: white; padding: 12px 20px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; }\n        button:hover { background: #16a34a; }\n        pre { background: #1e293b; padding: 10px; border-radius: 6px; overflow: auto; }\n    </style>\n</head>\n<body>\n    <div class=\"success\">\n        <h1>‚úÖ SUCESSO - Deployment Funcionando Perfeitamente!</h1>\n        <p>Todas as APIs e credenciais est√£o operacionais no deployment.</p>\n    </div>\n    \n    <div class=\"info\">\n        <h3>üìä Status dos Testes:</h3>\n        <ul>\n            <li>‚úÖ Health Check: PASSOU</li>\n            <li>‚úÖ Validate Keys: PASSOU</li>\n            <li>‚úÖ ElevenLabs: V√ÅLIDA</li>\n            <li>‚úÖ Twilio: V√ÅLIDO</li>\n            <li>‚úÖ Deepgram: V√ÅLIDA</li>\n        </ul>\n    </div>\n\n    <div>\n        <h3>üîß Links de Teste:</h3>\n        <button onclick=\"window.open('/api/health', '_blank')\">Ver Health Check</button>\n        <button onclick=\"testAPIs()\">Testar Todas as APIs</button>\n        <button onclick=\"window.open('/', '_blank')\">Abrir Painel Principal</button>\n    </div>\n    \n    <div id=\"results\"></div>\n    \n    <script>\n        function testAPIs() {\n            fetch('/api/validate-keys', {method: 'POST'})\n                .then(r => r.json())\n                .then(data => {\n                    const div = document.getElementById('results');\n                    div.innerHTML = '<h3>Resultado dos Testes:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';\n                })\n                .catch(err => {\n                    const div = document.getElementById('results');\n                    div.innerHTML = '<h3 style=\"color: #ef4444\">Erro:</h3><pre>' + err.message + '</pre>';\n                });\n        }\n        \n        // Teste autom√°tico na carga\n        document.addEventListener('DOMContentLoaded', () => {\n            console.log('‚úÖ P√°gina de teste carregada no deployment');\n            console.log('URL:', window.location.href);\n        });\n    </script>\n</body>\n</html>\n    `;\n    res.set('Content-Type', 'text/html').send(html);\n  });\n\n  // === HEALTH CHECK ENDPOINTS ===\n  \n  // Endpoint para verificar se as chaves est√£o configuradas\n  app.get('/api/health', (req, res) => {\n    const requiredEnvVars = [\n      'ELEVENLABS_API_KEY',\n      'TWILIO_ACCOUNT_SID', \n      'TWILIO_AUTH_TOKEN',\n      'TWILIO_NUMBER',\n      'DEEPGRAM_API_KEY'\n    ];\n\n    const envStatus: { [key: string]: { present: boolean; format: string } } = {};\n    const missingVars: string[] = [];\n\n    requiredEnvVars.forEach(envVar => {\n      const value = process.env[envVar];\n      const isPresent = !!value;\n      let formatInfo = 'not found';\n      \n      if (value) {\n        if (envVar === 'ELEVENLABS_API_KEY') {\n          formatInfo = value.startsWith('sk_') ? `valid format (${value.length} chars)` : `invalid format (starts with ${value.substring(0, 3)}...)`;\n        } else if (envVar.includes('TWILIO')) {\n          formatInfo = `${value.length} chars`;\n        } else {\n          formatInfo = `${value.length} chars`;\n        }\n      }\n      \n      envStatus[envVar] = { present: isPresent, format: formatInfo };\n      \n      if (!isPresent) {\n        missingVars.push(envVar);\n      }\n    });\n\n    const allPresent = missingVars.length === 0;\n\n    res.json({\n      status: allPresent ? 'healthy' : 'unhealthy',\n      timestamp: new Date().toISOString(),\n      environment: process.env.NODE_ENV || 'development',\n      is_replit: !!process.env.REPLIT_DEV_DOMAIN,\n      replit_domain: process.env.REPLIT_DEV_DOMAIN,\n      missing_variables: missingVars,\n      variables_status: envStatus,\n      message: allPresent \n        ? 'Todas as vari√°veis est√£o configuradas' \n        : `${missingVars.length} vari√°veis faltando: ${missingVars.join(', ')}`\n    });\n  });\n\n  // Endpoint espec√≠fico para validar chaves da API\n  app.post('/api/validate-keys', async (req, res) => {\n    const results: { [key: string]: { valid: boolean; error?: string; keyInfo?: string } } = {};\n\n    // Teste ElevenLabs\n    try {\n      const elevenlabsKey = process.env.ELEVENLABS_API_KEY;\n      if (!elevenlabsKey) {\n        results.elevenlabs = { \n          valid: false, \n          error: 'API key not found in environment',\n          keyInfo: 'No ELEVENLABS_API_KEY environment variable'\n        };\n      } else if (!elevenlabsKey.startsWith('sk_')) {\n        results.elevenlabs = { \n          valid: false, \n          error: 'Chave ElevenLabs inv√°lida. Deve come√ßar com \"sk-\"',\n          keyInfo: `Key starts with: ${elevenlabsKey.substring(0, 3)}..., length: ${elevenlabsKey.length}`\n        };\n      } else {\n        const response = await fetch('https://api.elevenlabs.io/v1/user', {\n          headers: { 'xi-api-key': elevenlabsKey }\n        });\n        \n        if (response.ok) {\n          const userData = await response.json() as any;\n          results.elevenlabs = { \n            valid: true,\n            keyInfo: `Valid key, user: ${userData?.subscription?.tier || 'unknown'}`\n          };\n        } else {\n          const errorText = await response.text();\n          results.elevenlabs = { \n            valid: false,\n            error: `HTTP ${response.status}: ${response.statusText}`,\n            keyInfo: `Response: ${errorText.substring(0, 100)}...`\n          };\n        }\n      }\n    } catch (error) {\n      results.elevenlabs = { \n        valid: false, \n        error: error instanceof Error ? error.message : 'Unknown error',\n        keyInfo: 'Network or connection error'\n      };\n    }\n\n    // Teste Twilio\n    try {\n      const twilioSid = process.env.TWILIO_ACCOUNT_SID;\n      const twilioToken = process.env.TWILIO_AUTH_TOKEN;\n      \n      if (!twilioSid || !twilioToken) {\n        results.twilio = { valid: false, error: 'Credentials not found' };\n      } else {\n        const auth = Buffer.from(`${twilioSid}:${twilioToken}`).toString('base64');\n        const response = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${twilioSid}.json`, {\n          headers: { 'Authorization': `Basic ${auth}` }\n        });\n        results.twilio = { \n          valid: response.ok,\n          error: response.ok ? undefined : `HTTP ${response.status}: ${response.statusText}`\n        };\n      }\n    } catch (error) {\n      results.twilio = { \n        valid: false, \n        error: error instanceof Error ? error.message : 'Unknown error' \n      };\n    }\n\n    // Teste Deepgram\n    try {\n      const deepgramKey = process.env.DEEPGRAM_API_KEY;\n      if (!deepgramKey) {\n        results.deepgram = { valid: false, error: 'API key not found' };\n      } else {\n        const response = await fetch('https://api.deepgram.com/v1/projects', {\n          headers: { 'Authorization': `Token ${deepgramKey}` }\n        });\n        results.deepgram = { \n          valid: response.ok,\n          error: response.ok ? undefined : `HTTP ${response.status}: ${response.statusText}`\n        };\n      }\n    } catch (error) {\n      results.deepgram = { \n        valid: false, \n        error: error instanceof Error ? error.message : 'Unknown error' \n      };\n    }\n\n    const allValid = Object.values(results).every(result => result.valid);\n\n    res.json({\n      status: allValid ? 'all_valid' : 'some_invalid',\n      timestamp: new Date().toISOString(),\n      results,\n      summary: {\n        total: Object.keys(results).length,\n        valid: Object.values(results).filter(r => r.valid).length,\n        invalid: Object.values(results).filter(r => !r.valid).length\n      }\n    });\n  });\n\n  // === TELEPHONY CALL CONTROL ENDPOINTS ===\n\n  // Dial/Start call\n  app.post(\"/api/call/dial\", async (req, res) => {\n    try {\n      const { to, voiceType = 'masc' } = req.body;\n      \n      if (!to) {\n        return res.status(400).json({ error: \"Phone number 'to' is required\" });\n      }\n\n      if (!TWILIO_ACCOUNT_SID || !TWILIO_AUTH_TOKEN || !TWILIO_NUMBER) {\n        return res.status(500).json({ error: \"Twilio credentials not configured\" });\n      }\n\n      console.log(`[CALL] Dialing ${to} with voice type: ${voiceType}`);\n      \n      // Use TwilioProvider for consistency\n      const { TwilioProvider } = await import('./providers/twilioProvider');\n      const twilioProvider = new TwilioProvider();\n      const result = await twilioProvider.startCall(to, voiceType);\n\n      console.log(`[CALL] Call initiated: ${result.callId}`);\n\n      res.json({ callSid: result.callId, status: result.status });\n    } catch (error) {\n      console.error('[CALL] Error initiating call:', error);\n      res.status(500).json({ error: 'Failed to initiate call' });\n    }\n  });\n\n  // Hangup call\n  app.post(\"/api/call/hangup\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ error: \"callSid is required\" });\n      }\n\n      // Use TwilioProvider for consistency\n      const { TwilioProvider } = await import('./providers/twilioProvider');\n      const twilioProvider = new TwilioProvider();\n      const success = await twilioProvider.hangup(callSid);\n      \n      if (success) {\n        console.log(`[CALL] Call ended: ${callSid}`);\n        res.json({ success: true, callSid });\n      } else {\n        res.status(500).json({ error: 'Failed to hangup call' });\n      }\n    } catch (error) {\n      console.error('[CALL] Error ending call:', error);\n      res.status(500).json({ error: 'Failed to end call' });\n    }\n  });\n\n  // Send DTMF tones - Create a call that plays digits\n  app.post(\"/api/call/dtmf\", async (req, res) => {\n    try {\n      const { callSid, digits } = req.body;\n      \n      if (!callSid || !digits) {\n        return res.status(400).json({ error: \"callSid and digits are required\" });\n      }\n\n      console.log(`[CALL] Sending DTMF '${digits}' to call ${callSid}`);\n      \n      // Use TwilioProvider for consistency\n      const { TwilioProvider } = await import('./providers/twilioProvider');\n      const twilioProvider = new TwilioProvider();\n      const success = await twilioProvider.sendDTMF(callSid, digits);\n      \n      if (success) {\n        res.json({ success: true, callSid, digits });\n      } else {\n        res.status(500).json({ error: 'Failed to send DTMF via Twilio' });\n      }\n    } catch (error) {\n      console.error('[CALL] Error sending DTMF:', error);\n      res.status(500).json({ error: 'Failed to send DTMF' });\n    }\n  });\n\n  // Answer call (for inbound)\n  app.post(\"/api/call/answer\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      console.log(`[CALL] Answered: ${callSid}`);\n      res.json({ success: true, callSid });\n    } catch (error) {\n      console.error('[CALL] Error answering call:', error);\n      res.status(500).json({ error: 'Failed to answer call' });\n    }\n  });\n\n  // === AGENT/AI CONTROL ENDPOINTS ===\n\n  let AGENT_PROMPT = 'Voc√™ √© um assistente de chamadas em pt-BR. Seja prestativo e cordial.';\n  const agentStates = new Map<string, { enabled: boolean }>();\n\n  // Update agent prompt\n  app.post(\"/api/agent/prompt\", async (req, res) => {\n    try {\n      const { text, callSid } = req.body;\n      \n      if (!text || !callSid) {\n        return res.status(400).json({ message: \"text and callSid are required\" });\n      }\n\n      console.log(`[AGENT] Injecting prompt for call ${callSid}: ${text}`);\n\n      // Use TwilioProvider to inject prompt\n      const { TwilioProvider } = await import('./providers/twilioProvider');\n      const twilioProvider = new TwilioProvider();\n      const success = await twilioProvider.injectPrompt(callSid, text);\n\n      if (success) {\n        // Store prompt in database\n        queries.addPrompt.run({\n          call_sid: callSid,\n          prompt_text: text,\n          applied: true\n        });\n\n        console.log(`[AGENT] Prompt injected and stored for call ${callSid}`);\n        res.json({ message: \"Prompt injected successfully\", callSid, text });\n      } else {\n        res.status(500).json({ message: \"Failed to inject prompt via Twilio\" });\n      }\n    } catch (error) {\n      console.error('[AGENT] Error injecting prompt:', error);\n      res.status(500).json({ message: \"Failed to inject prompt\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Enable AI agent\n  app.post(\"/api/agent/enable\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ message: \"callSid is required\" });\n      }\n\n      // Check if call is active before trying to control it\n      const twilioClient = twilio(TWILIO_ACCOUNT_SID!, TWILIO_AUTH_TOKEN!);\n      \n      try {\n        const call = await twilioClient.calls(callSid).fetch();\n        if (call.status !== 'in-progress') {\n          console.log(`[AGENT] Call ${callSid} is not active (status: ${call.status})`);\n          return res.status(400).json({ \n            message: \"Call is not active\", \n            callSid, \n            status: call.status \n          });\n        }\n      } catch (fetchError) {\n        console.log(`[AGENT] Call ${callSid} not found or inaccessible`);\n        return res.status(404).json({ message: \"Call not found\", callSid });\n      }\n\n      console.log(`[AGENT] Enabling AI for call ${callSid}`);\n      \n      const { TwilioProvider } = await import('./providers/twilioProvider');\n      const twilioProvider = new TwilioProvider();\n      const success = await twilioProvider.resumeAI(callSid);\n\n      if (success) {\n        agentStates.set(callSid, { enabled: true });\n        res.json({ message: \"AI agent enabled\", callSid });\n      } else {\n        res.status(500).json({ message: \"Failed to enable AI via Twilio\" });\n      }\n    } catch (error) {\n      console.error('[AGENT] Error enabling AI:', error);\n      res.status(500).json({ message: \"Failed to enable AI\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Disable AI agent\n  app.post(\"/api/agent/disable\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ message: \"callSid is required\" });\n      }\n\n      // Check if call is active before trying to control it\n      const twilioClient = twilio(TWILIO_ACCOUNT_SID!, TWILIO_AUTH_TOKEN!);\n      \n      try {\n        const call = await twilioClient.calls(callSid).fetch();\n        if (call.status !== 'in-progress') {\n          console.log(`[AGENT] Call ${callSid} is not active (status: ${call.status})`);\n          return res.status(400).json({ \n            message: \"Call is not active\", \n            callSid, \n            status: call.status \n          });\n        }\n      } catch (fetchError) {\n        console.log(`[AGENT] Call ${callSid} not found or inaccessible`);\n        return res.status(404).json({ message: \"Call not found\", callSid });\n      }\n\n      console.log(`[AGENT] Disabling AI for call ${callSid}`);\n      \n      const { TwilioProvider } = await import('./providers/twilioProvider');\n      const twilioProvider = new TwilioProvider();\n      const success = await twilioProvider.pauseAI(callSid);\n\n      if (success) {\n        agentStates.set(callSid, { enabled: false });\n        res.json({ message: \"AI agent disabled\", callSid });\n      } else {\n        res.status(500).json({ message: \"Failed to disable AI via Twilio\" });\n      }\n    } catch (error) {\n      console.error('[AGENT] Error disabling AI:', error);\n      res.status(500).json({ message: \"Failed to disable AI\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Pause speech (TTS only)\n  app.post(\"/api/agent/pause-speech\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ message: \"callSid is required\" });\n      }\n\n      console.log(`[AGENT] Pausing speech for call ${callSid}`);\n      \n      // Stop TTS session via ElevenLabs service\n      const { elevenLabsService } = await import('./elevenlabs');\n      const success = elevenLabsService.stopTTSSession(callSid);\n\n      if (success) {\n        res.json({ message: \"Speech paused\", callSid });\n      } else {\n        res.status(500).json({ message: \"Failed to pause speech\" });\n      }\n    } catch (error) {\n      console.error('[AGENT] Error pausing speech:', error);\n      res.status(500).json({ message: \"Failed to pause speech\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Resume speech (TTS only)\n  app.post(\"/api/agent/resume-speech\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ message: \"callSid is required\" });\n      }\n\n      console.log(`[AGENT] Resuming speech for call ${callSid}`);\n      \n      // Restart TTS session via ElevenLabs service\n      const { elevenLabsService } = await import('./elevenlabs');\n      const success = await elevenLabsService.startTTSSession(callSid, 'masc');\n\n      if (success) {\n        res.json({ message: \"Speech resumed\", callSid });\n      } else {\n        res.status(500).json({ message: \"Failed to resume speech\" });\n      }\n    } catch (error) {\n      console.error('[AGENT] Error resuming speech:', error);\n      res.status(500).json({ message: \"Failed to resume speech\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === METRICS/MONITORING ENDPOINTS ===\n\n  // Server-Sent Events for real-time metrics\n  app.get('/api/metrics', (req, res) => {\n    res.setHeader('Content-Type', 'text/event-stream');\n    res.setHeader('Cache-Control', 'no-cache');\n    res.setHeader('Connection', 'keep-alive');\n    res.setHeader('Access-Control-Allow-Origin', '*');\n\n    const sendMetrics = () => {\n      const latencyMs = Math.floor(Math.random() * 50) + 20; // Simulated latency 20-70ms\n      const metrics = {\n        latencyMs,\n        timestamp: Date.now(),\n        activeConnections: 1\n      };\n      \n      res.write(`data: ${JSON.stringify(metrics)}\\n\\n`);\n    };\n\n    // Send initial metrics\n    sendMetrics();\n    \n    // Send metrics every 2 seconds\n    const interval = setInterval(sendMetrics, 2000);\n\n    // Cleanup on client disconnect\n    req.on('close', () => {\n      clearInterval(interval);\n      console.log('[METRICS] Client disconnected from metrics stream');\n    });\n\n    console.log('[METRICS] Client connected to metrics stream');\n  });\n\n  console.log('[ROUTES] API routes configured');\n  \n  // Configure multer for microphone recordings upload\n  const upload = multer({\n    storage: multer.diskStorage({\n      destination: async (req, file, cb) => {\n        const recordingsDir = path.join(process.cwd(), 'recordings');\n        await fs.mkdir(recordingsDir, { recursive: true });\n        cb(null, recordingsDir);\n      },\n      filename: (req, file, cb) => {\n        cb(null, file.originalname);\n      }\n    }),\n    limits: {\n      fileSize: 100 * 1024 * 1024 // 100MB limit\n    }\n  });\n\n  // Upload microphone recording\n  app.post(\"/api/recordings/upload\", upload.single('audio'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"No audio file provided\" });\n      }\n\n      const { phoneNumber, callSid } = req.body;\n      const filename = req.file.filename;\n      const fileSize = req.file.size;\n\n      // Calculate duration (approximate based on file size - will be updated when we add real duration detection)\n      const estimatedDuration = Math.floor(fileSize / (44100 * 2)); // rough estimate\n\n      // Add to database\n      queries.addRecording.run(callSid, phoneNumber, filename);\n      const recording = queries.getLastRecording.get() as any;\n      \n      // Update with file size and duration\n      queries.updateRecording.run(estimatedDuration, fileSize, recording.id);\n\n      console.log(`[RECORDING] Microphone recording uploaded: ${filename} (${fileSize} bytes)`);\n      res.json({ \n        success: true, \n        id: recording.id, \n        filename,\n        size: fileSize,\n        duration: estimatedDuration\n      });\n    } catch (error) {\n      console.error('[RECORDING] Error uploading microphone recording:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Real Twilio call recording setup\n  app.post(\"/api/recordings/twilio/start\", async (req, res) => {\n    try {\n      const { callSid, phoneNumber } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ error: \"callSid obrigat√≥rio\" });\n      }\n\n      console.log(`[TWILIO] Starting real recording for call: ${callSid}`);\n\n      // Start recording via Twilio API\n      const twilioClient = twilio(TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN);\n      const recording = await twilioClient.calls(callSid).recordings.create({\n        recordingTrack: 'both',\n        trim: 'do-not-trim',\n        recordingStatusCallback: `${process.env.REPL_SLUG ? `https://${process.env.REPL_SLUG}.${process.env.REPLIT_DEV_DOMAIN}` : 'http://localhost:5000'}/api/recordings/twilio/callback`\n      });\n\n      const timestamp = Date.now();\n      const filename = `${phoneNumber || 'unknown'}-${timestamp}.mp3`;\n      \n      queries.addRecording.run(callSid, phoneNumber || 'unknown', filename);\n      const recordingDb = queries.getLastRecording.get() as any;\n      \n      console.log(`[TWILIO] Real recording started: ${recording.sid}`);\n      res.json({ \n        success: true, \n        id: recordingDb.id, \n        recordingSid: recording.sid,\n        filename, \n        callSid \n      });\n    } catch (error) {\n      console.error('[TWILIO] Error starting real recording:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Twilio recording callback - downloads the MP3 file\n  app.post(\"/api/recordings/twilio/callback\", async (req, res) => {\n    try {\n      const { RecordingSid, RecordingUrl, RecordingDuration, CallSid } = req.body;\n      \n      console.log(`[TWILIO] Recording completed: ${RecordingSid}, Duration: ${RecordingDuration}s`);\n      \n      // Download the recording file from Twilio\n      const response = await fetch(RecordingUrl);\n      if (!response.ok) throw new Error('Failed to download recording');\n      \n      const buffer = await response.arrayBuffer();\n      const recordingsDir = path.join(process.cwd(), 'recordings');\n      await fs.mkdir(recordingsDir, { recursive: true });\n      \n      // Find the recording in database by CallSid\n      const recording = queries.getRecordingByCallSid.get(CallSid) as any;\n      if (recording) {\n        const filePath = path.join(recordingsDir, recording.filename);\n        await fs.writeFile(filePath, Buffer.from(buffer));\n        \n        // Update database with final duration and size\n        queries.updateRecording.run(parseInt(RecordingDuration), buffer.byteLength, recording.id);\n        \n        console.log(`[TWILIO] Recording saved: ${recording.filename} (${buffer.byteLength} bytes)`);\n      }\n      \n      res.send('<Response></Response>'); // TwiML response\n    } catch (error) {\n      console.error('[TWILIO] Error processing recording callback:', error);\n      res.status(500).send('<Response></Response>');\n    }\n  });\n\n  // TwiML endpoint for Twilio calls - CR√çTICO para funcionar\n  app.get(\"/twiml\", (req, res) => {\n    const { voiceType } = req.query;\n    console.log(`[TWIML] Serving TwiML for voice type: ${voiceType}`);\n    \n    res.type('text/xml');\n    res.send(`<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Response>\n  <Say voice=\"alice\" language=\"pt-BR\">Ol√°! Voc√™ est√° conectado ao sistema Abmix. Esta chamada est√° sendo controlada pelo painel de discagem inteligente.</Say>\n  <Gather input=\"dtmf\" timeout=\"10\" numDigits=\"1\">\n    <Say voice=\"alice\" language=\"pt-BR\">Pressione qualquer tecla para continuar ou aguarde para falar com o assistente virtual.</Say>\n  </Gather>\n  <Say voice=\"alice\" language=\"pt-BR\">Obrigado por usar o sistema Abmix. A chamada ser√° mantida ativa para testes. Pressione desligar no painel para encerrar.</Say>\n  <Pause length=\"300\"/>\n</Response>`);\n  });\n\n  return server;\n}","size_bytes":48319},"client/src/utils/validation.ts":{"content":"export const validateE164 = (phoneNumber: string): boolean => {\n  const e164Regex = /^\\+[1-9]\\d{1,14}$/;\n  return e164Regex.test(phoneNumber);\n};\n\nexport const formatPhoneNumber = (phoneNumber: string): string => {\n  // Remove all non-digit characters except +\n  let cleaned = phoneNumber.replace(/[^\\d+]/g, '');\n  \n  // Ensure it starts with +\n  if (!cleaned.startsWith('+')) {\n    cleaned = '+' + cleaned;\n  }\n  \n  return cleaned;\n};\n\nexport const isDTMFTone = (tone: string): boolean => {\n  return /^[0-9*#]$/.test(tone);\n};\n","size_bytes":528},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"scripts/fix-deploy.sh":{"content":"#!/bin/bash\n\n# Script para corrigir deploy do AbmixDialer\n# Execute este script LOCALMENTE primeiro\n\necho \"üöÄ CORRE√á√ÉO DE DEPLOY - AbmixDialer\"\necho \"===================================\"\n\n# Cores\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\necho -e \"${BLUE}1. Fazendo build da aplica√ß√£o...${NC}\"\nnpm run build\n\nif [ $? -ne 0 ]; then\n    echo -e \"${RED}‚ùå Erro no build. Verifique os erros acima.${NC}\"\n    exit 1\nfi\n\necho -e \"${GREEN}‚úÖ Build conclu√≠do${NC}\"\n\necho -e \"${BLUE}2. Preparando arquivo .env para produ√ß√£o...${NC}\"\nif [ -f \"production.env\" ]; then\n    cp production.env .env.production\n    echo \"PORT=5001\" >> .env.production\n    echo \"NODE_ENV=production\" >> .env.production\n    echo -e \"${GREEN}‚úÖ Arquivo .env.production criado${NC}\"\nelse\n    echo -e \"${YELLOW}‚ö†Ô∏è Arquivo production.env n√£o encontrado. Criando b√°sico...${NC}\"\n    cat > .env.production << EOF\nPORT=5001\nNODE_ENV=production\n# Adicione suas chaves API aqui:\n# TWILIO_ACCOUNT_SID=\n# TWILIO_AUTH_TOKEN=\n# TWILIO_NUMBER=\n# ELEVENLABS_API_KEY=\nEOF\nfi\n\necho -e \"${BLUE}3. Enviando arquivos para o servidor...${NC}\"\necho \"Executando: scp -r dist/ package.json .env.production root@95.216.201.197:/var/www/juliocamara.dev/abmix-ligacao/\"\n\n# Criar diret√≥rio se n√£o existir\nssh root@95.216.201.197 \"mkdir -p /var/www/juliocamara.dev/abmix-ligacao\"\n\n# Enviar arquivos\nscp -r dist/ package.json .env.production root@95.216.201.197:/var/www/juliocamara.dev/abmix-ligacao/\n\nif [ $? -eq 0 ]; then\n    echo -e \"${GREEN}‚úÖ Arquivos enviados com sucesso${NC}\"\nelse\n    echo -e \"${RED}‚ùå Erro ao enviar arquivos${NC}\"\n    exit 1\nfi\n\necho -e \"${BLUE}4. Configurando servidor remoto...${NC}\"\nssh root@95.216.201.197 << 'ENDSSH'\ncd /var/www/juliocamara.dev/abmix-ligacao\n\n# Renomear .env\nmv .env.production .env\n\n# Instalar depend√™ncias\nnpm install --production\n\n# Parar processo existente\npm2 stop abmix-ligacao 2>/dev/null || true\npm2 delete abmix-ligacao 2>/dev/null || true\n\n# Ajustar permiss√µes\nchown -R www-data:www-data /var/www/juliocamara.dev/abmix-ligacao/\nchmod -R 755 /var/www/juliocamara.dev/abmix-ligacao/\n\n# Iniciar aplica√ß√£o na porta correta\nPORT=5001 pm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\n# Recarregar nginx\nsystemctl reload nginx\n\necho \"üéâ Configura√ß√£o do servidor conclu√≠da!\"\nENDSSH\n\necho -e \"${GREEN}‚úÖ Deploy corrigido com sucesso!${NC}\"\necho \"\"\necho -e \"${BLUE}Verifica√ß√µes finais:${NC}\"\necho \"1. Acesse: https://juliocamara.dev/abmix-ligacao/\"\necho \"2. WebSocket: wss://juliocamara.dev/abmix-ligacao/media\"\necho \"\"\necho -e \"${YELLOW}Se ainda houver problemas, execute no servidor:${NC}\"\necho \"bash /var/www/juliocamara.dev/abmix-ligacao/diagnose-and-fix.sh\"\n\n\n\n\n","size_bytes":2747},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/App.tsx":{"content":"import { Switch, Route, Router as WouterRouter } from \"wouter\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"./contexts/ThemeContext\";\nimport { useState, useEffect } from \"react\";\nimport Home from \"@/pages/Home\";\nimport NotFound from \"@/pages/not-found\";\nimport { SetupModal } from \"@/components/SetupModal\";\n\n// Fun√ß√£o para detectar a base URL do roteamento\nfunction getRouterBase(): string {\n  const currentPath = window.location.pathname;\n  \n  // Se estamos em um subpath (ex: /abmix-ligacao/), usar esse subpath\n  if (currentPath.startsWith('/abmix-ligacao/')) {\n    return '/abmix-ligacao';\n  }\n  \n  // Caso contr√°rio, usar raiz\n  return '';\n}\n\nfunction Router() {\n  const baseUrl = getRouterBase();\n  \n  console.log(`[ROUTER] Base URL: ${baseUrl}`); // Debug\n  \n  return (\n    <WouterRouter base={baseUrl}>\n      <Switch>\n        <Route path=\"/\" component={Home} />\n        <Route path=\"~/*\" component={NotFound} />\n      </Switch>\n    </WouterRouter>\n  );\n}\n\nfunction App() {\n  // Temporariamente desabilitado - modal de configura√ß√£o removido\n  const [isSetupComplete, setIsSetupComplete] = useState(true);\n  const [showSetupModal, setShowSetupModal] = useState(false);\n\n  // useEffect(() => {\n  //   // Check if setup is complete\n  //   const setupComplete = localStorage.getItem('abmix_setup_complete');\n  //   if (setupComplete === 'true') {\n  //     setIsSetupComplete(true);\n  //   } else {\n  //     setShowSetupModal(true);\n  //   }\n  // }, []);\n\n  const handleSetupComplete = () => {\n    setIsSetupComplete(true);\n    setShowSetupModal(false);\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <div>\n            {/* Modal de configura√ß√£o temporariamente desabilitado */}\n            {/* <SetupModal \n              isOpen={showSetupModal} \n              onComplete={handleSetupComplete}\n            /> */}\n            \n            <Router />\n            \n            <Toaster />\n          </div>\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2299},"client/src/components/Favorites.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { api } from '@/services/api';\nimport { FavoriteDialog } from '.';\nimport type { Favorite } from '@shared/schema';\n\nexport function Favorites() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { setPhoneNumber } = useCallStore();\n  const [editingFavorite, setEditingFavorite] = useState<Favorite | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  const { data: favorites = [], isLoading } = useQuery({\n    queryKey: ['/api/favorites'],\n    queryFn: () => api.getFavorites(),\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: string) => api.deleteFavorite(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/favorites'] });\n      toast({\n        title: \"Favorito removido\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao remover favorito\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleDialFavorite = (favorite: Favorite) => {\n    // Set the number in the dialer component\n    setPhoneNumber(favorite.number);\n    \n    // Also trigger the dialer to update its local state\n    const event = new CustomEvent('setDialerNumber', { \n      detail: { number: favorite.number } \n    });\n    window.dispatchEvent(event);\n    \n    toast({\n      title: \"N√∫mero preenchido\",\n      description: `${favorite.name}: ${favorite.number}`,\n    });\n  };\n\n  const handleEditFavorite = (favorite: Favorite) => {\n    setEditingFavorite(favorite);\n    setIsDialogOpen(true);\n  };\n\n  const handleDeleteFavorite = (favorite: Favorite) => {\n    if (window.confirm(`Deseja realmente remover ${favorite.name}?`)) {\n      deleteMutation.mutate(favorite.id);\n    }\n  };\n\n  const handleAddFavorite = () => {\n    setEditingFavorite(null);\n    setIsDialogOpen(true);\n  };\n\n  const handleDialogClose = () => {\n    setIsDialogOpen(false);\n    setEditingFavorite(null);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border h-fit\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold\">Favoritos</h3>\n        </div>\n        <div className=\"text-center text-gray-400\">Carregando...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border h-fit\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold\">Favoritos</h3>\n        <Button\n          onClick={handleAddFavorite}\n          className=\"bg-abmix-green text-black p-2 rounded-lg hover:bg-abmix-green/90 transition-colors\"\n          data-testid=\"add-favorite-button\"\n        >\n          <i className=\"fas fa-plus\"></i>\n        </Button>\n      </div>\n\n      <div className=\"space-y-3\">\n        {favorites.length === 0 ? (\n          <div className=\"text-center text-gray-400 py-4\">\n            <i className=\"fas fa-star text-2xl mb-2 block\"></i>\n            Nenhum favorito adicionado\n          </div>\n        ) : (\n          favorites.map((favorite: Favorite) => (\n            <div\n              key={favorite.id}\n              className=\"bg-dark-bg rounded-lg p-4 border border-dark-border\"\n              data-testid={`favorite-${favorite.id}`}\n            >\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h4 className=\"font-semibold\">{favorite.name}</h4>\n                  <p className=\"text-sm text-gray-400 font-mono\">{favorite.number}</p>\n                  {favorite.notes && (\n                    <p className=\"text-xs text-gray-500 mt-1\">{favorite.notes}</p>\n                  )}\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Button\n                    onClick={() => handleDialFavorite(favorite)}\n                    className=\"text-abmix-green hover:bg-abmix-green/10 p-2 rounded transition-colors\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    data-testid={`dial-favorite-${favorite.id}`}\n                  >\n                    <i className=\"fas fa-phone\"></i>\n                  </Button>\n                  <Button\n                    onClick={() => handleEditFavorite(favorite)}\n                    className=\"text-blue-400 hover:bg-blue-400/10 p-2 rounded transition-colors\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    data-testid={`edit-favorite-${favorite.id}`}\n                  >\n                    <i className=\"fas fa-edit\"></i>\n                  </Button>\n                  <Button\n                    onClick={() => handleDeleteFavorite(favorite)}\n                    disabled={deleteMutation.isPending}\n                    className=\"text-red-400 hover:bg-red-400/10 p-2 rounded transition-colors\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    data-testid={`delete-favorite-${favorite.id}`}\n                  >\n                    <i className=\"fas fa-trash\"></i>\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      <FavoriteDialog\n        open={isDialogOpen}\n        onOpenChange={setIsDialogOpen}\n        favorite={editingFavorite}\n        onClose={handleDialogClose}\n      />\n    </div>\n  );\n}\n","size_bytes":5714},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"server/services/dataStore.ts":{"content":"import fs from 'fs/promises';\nimport path from 'path';\n\nconst DATA_DIR = path.join(process.cwd(), 'data');\n\nexport class DataStore {\n  private static async ensureDir() {\n    try {\n      await fs.access(DATA_DIR);\n    } catch {\n      await fs.mkdir(DATA_DIR, { recursive: true });\n    }\n  }\n\n  static async read<T>(filename: string, defaultValue: T): Promise<T> {\n    await this.ensureDir();\n    const filePath = path.join(DATA_DIR, filename);\n    \n    try {\n      const data = await fs.readFile(filePath, 'utf-8');\n      return JSON.parse(data);\n    } catch {\n      return defaultValue;\n    }\n  }\n\n  static async write<T>(filename: string, data: T): Promise<void> {\n    await this.ensureDir();\n    const filePath = path.join(DATA_DIR, filename);\n    await fs.writeFile(filePath, JSON.stringify(data, null, 2));\n  }\n}\n","size_bytes":817},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/services/metrics.ts":{"content":"// Real-time metrics service using Server-Sent Events\nlet eventSource: EventSource | null = null;\n\ninterface MetricsData {\n  latencyMs: number;\n  timestamp: number;\n  activeConnections: number;\n}\n\ntype MetricsCallback = (data: MetricsData) => void;\n\nexport const metricsService = {\n  connect(callback: MetricsCallback) {\n    if (eventSource) {\n      this.disconnect();\n    }\n\n    eventSource = new EventSource('/api/metrics');\n    \n    eventSource.onmessage = (event) => {\n      try {\n        const data: MetricsData = JSON.parse(event.data);\n        callback(data);\n      } catch (error) {\n        console.error('[METRICS] Error parsing metrics data:', error);\n      }\n    };\n\n    eventSource.onerror = (error) => {\n      console.error('[METRICS] EventSource error:', error);\n      // Reconnect after 5 seconds\n      setTimeout(() => {\n        if (eventSource?.readyState === EventSource.CLOSED) {\n          this.connect(callback);\n        }\n      }, 5000);\n    };\n\n    console.log('[METRICS] Connected to metrics stream');\n  },\n\n  disconnect() {\n    if (eventSource) {\n      eventSource.close();\n      eventSource = null;\n      console.log('[METRICS] Disconnected from metrics stream');\n    }\n  }\n};","size_bytes":1201},"client/src/components/Recordings.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useState, useEffect, useRef } from 'react';\n\ninterface Recording {\n  id: number;\n  call_sid: string;\n  phone_number: string;\n  filename: string;\n  duration_sec: number;\n  started_at: string;\n  ended_at: string;\n  size_bytes: number;\n}\n\nexport function Recordings() {\n  const { toast } = useToast();\n  const { isRecording, setIsRecording, currentCallId } = useCallStore();\n  const [recordingStartTime, setRecordingStartTime] = useState<number | null>(null);\n  const [currentRecordingId, setCurrentRecordingId] = useState<number | null>(null);\n  const [mediaRecorder, setMediaRecorder] = useState<MediaRecorder | null>(null);\n  const [audioStream, setAudioStream] = useState<MediaStream | null>(null);\n  const audioChunks = useRef<Blob[]>([]);\n  const queryClient = useQueryClient();\n\n  // Fetch recordings list\n  const { data: recordings = [], isLoading } = useQuery({\n    queryKey: ['/api/recordings/list'],\n    queryFn: async () => {\n      const response = await fetch('/api/recordings/list');\n      if (!response.ok) throw new Error('Failed to fetch recordings');\n      return response.json();\n    },\n    refetchInterval: isRecording ? 5000 : false, // Refresh while recording\n  });\n\n  // Start recording mutation\n  const startRecordingMutation = useMutation({\n    mutationFn: async (phoneNumber: string) => {\n      const response = await fetch('/api/recordings/start', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          callSid: currentCallId || `call-${Date.now()}`,\n          phoneNumber: phoneNumber\n        })\n      });\n      if (!response.ok) throw new Error('Failed to start recording');\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setCurrentRecordingId(data.id);\n      setRecordingStartTime(Date.now());\n      setIsRecording(true);\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    }\n  });\n\n  // Stop recording mutation\n  const stopRecordingMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentRecordingId) throw new Error('No active recording');\n      const response = await fetch(`/api/recordings/${currentRecordingId}/stop`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to stop recording');\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsRecording(false);\n      setRecordingStartTime(null);\n      setCurrentRecordingId(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n    }\n  });\n\n  // Format duration helper\n  const formatDuration = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Format file size helper\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n  };\n\n  const handleStartRecording = async () => {\n    try {\n      if (currentCallId) {\n        // Recording during a call - use Twilio recording\n        const phoneNumber = \"11999887766\";\n        startRecordingMutation.mutate(phoneNumber);\n        toast({\n          title: \"Grava√ß√£o de liga√ß√£o iniciada\",\n          description: `Gravando chamada para ${phoneNumber}`,\n        });\n      } else {\n        // Recording from microphone when not in call\n        const stream = await navigator.mediaDevices.getUserMedia({ \n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true,\n            sampleRate: 44100\n          } \n        });\n        \n        setAudioStream(stream);\n        audioChunks.current = [];\n        \n        const recorder = new MediaRecorder(stream, {\n          mimeType: 'audio/webm;codecs=opus'\n        });\n        \n        recorder.ondataavailable = (event) => {\n          if (event.data.size > 0) {\n            audioChunks.current.push(event.data);\n          }\n        };\n        \n        recorder.onstop = async () => {\n          const audioBlob = new Blob(audioChunks.current, { type: 'audio/webm' });\n          await uploadMicrophoneRecording(audioBlob);\n        };\n        \n        recorder.start(1000); // Collect data every second\n        setMediaRecorder(recorder);\n        setIsRecording(true);\n        setRecordingStartTime(Date.now());\n        \n        toast({\n          title: \"Grava√ß√£o do microfone iniciada\",\n          description: \"Gravando √°udio do microfone\",\n        });\n      }\n    } catch (error) {\n      console.error('Error starting recording:', error);\n      toast({\n        title: \"Erro ao iniciar grava√ß√£o\",\n        description: \"N√£o foi poss√≠vel acessar o microfone\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const pauseRecordingMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentRecordingId) throw new Error('No active recording');\n      const response = await fetch(`/api/recordings/${currentRecordingId}/pause`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to pause recording');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Grava√ß√£o pausada\",\n        description: \"Grava√ß√£o pausada temporariamente\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao pausar\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const resumeRecordingMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentRecordingId) throw new Error('No active recording');\n      const response = await fetch(`/api/recordings/${currentRecordingId}/resume`, {\n        method: 'POST',\n      });\n      if (!response.ok) throw new Error('Failed to resume recording');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Grava√ß√£o retomada\",\n        description: \"Grava√ß√£o retomada com sucesso\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao retomar\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handlePauseRecording = () => {\n    if (mediaRecorder && mediaRecorder.state === 'recording') {\n      // Pause microphone recording\n      mediaRecorder.pause();\n      toast({\n        title: \"Grava√ß√£o pausada\",\n        description: \"Microfone pausado temporariamente\",\n      });\n    } else if (currentRecordingId) {\n      // Pause Twilio call recording\n      pauseRecordingMutation.mutate();\n    } else {\n      toast({\n        title: \"Nenhuma grava√ß√£o ativa\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleResumeRecording = () => {\n    if (mediaRecorder && mediaRecorder.state === 'paused') {\n      // Resume microphone recording\n      mediaRecorder.resume();\n      toast({\n        title: \"Grava√ß√£o retomada\",\n        description: \"Microfone retomado\",\n      });\n    } else if (currentRecordingId) {\n      // Resume Twilio call recording\n      resumeRecordingMutation.mutate();\n    } else {\n      toast({\n        title: \"Nenhuma grava√ß√£o pausada\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleStopRecording = () => {\n    if (currentRecordingId && currentCallId) {\n      // Stop Twilio call recording\n      stopRecordingMutation.mutate();\n    } else if (mediaRecorder && mediaRecorder.state === 'recording') {\n      // Stop microphone recording\n      mediaRecorder.stop();\n      if (audioStream) {\n        audioStream.getTracks().forEach(track => track.stop());\n        setAudioStream(null);\n      }\n      setMediaRecorder(null);\n      setIsRecording(false);\n      setRecordingStartTime(null);\n      \n      toast({\n        title: \"Grava√ß√£o finalizada\",\n        description: \"Processando √°udio do microfone...\",\n      });\n    }\n  };\n  \n  const uploadMicrophoneRecording = async (audioBlob: Blob) => {\n    try {\n      const formData = new FormData();\n      const timestamp = Date.now();\n      const filename = `microfone-${timestamp}.webm`;\n      \n      formData.append('audio', audioBlob, filename);\n      formData.append('phoneNumber', 'Microfone');\n      formData.append('callSid', `mic-${timestamp}`);\n      \n      const response = await fetch('/api/recordings/upload', {\n        method: 'POST',\n        body: formData\n      });\n      \n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n        toast({\n          title: \"Grava√ß√£o salva\",\n          description: \"√Åudio do microfone salvo com sucesso\",\n        });\n      } else {\n        throw new Error('Upload failed');\n      }\n    } catch (error) {\n      console.error('Error uploading recording:', error);\n      toast({\n        title: \"Erro ao salvar\",\n        description: \"N√£o foi poss√≠vel salvar a grava√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleDownload = async (recording: Recording) => {\n    try {\n      const response = await fetch(`/api/recordings/${recording.id}/download`);\n      if (!response.ok) throw new Error('Failed to download');\n      \n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = recording.filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      \n      toast({\n        title: \"Download iniciado\",\n        description: `Baixando ${recording.filename}`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Erro no download\",\n        description: \"N√£o foi poss√≠vel baixar a grava√ß√£o\",\n      });\n    }\n  };\n\n  // Delete recording mutation\n  const deleteRecordingMutation = useMutation({\n    mutationFn: async (recordingId: number) => {\n      const response = await fetch(`/api/recordings/${recordingId}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) throw new Error('Failed to delete recording');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n      toast({\n        title: \"Grava√ß√£o exclu√≠da\",\n        description: \"Arquivo removido com sucesso\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro ao excluir\",\n        description: \"N√£o foi poss√≠vel excluir a grava√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleDelete = async (recording: Recording) => {\n    deleteRecordingMutation.mutate(recording.id);\n  };\n\n  return (\n    <div className=\"bg-card rounded-xl p-6 border border-border h-fit\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-foreground\">Grava√ß√µes</h3>\n        <div className=\"flex items-center space-x-2\">\n          <div \n            className={`w-3 h-3 rounded-full transition-all duration-300 ${\n              isRecording ? 'bg-red-500 animate-pulse' : 'bg-gray-400 opacity-30'\n            }`}\n            data-testid=\"recording-indicator\"\n          ></div>\n          <span className=\"text-sm text-muted-foreground\">\n            {isRecording ? 'Gravando' : 'Inativo'}\n          </span>\n        </div>\n      </div>\n      \n      <div className=\"space-y-4\">\n        {/* Control Buttons */}\n        <div className=\"grid grid-cols-2 gap-2\">\n          {!isRecording ? (\n            <Button\n              onClick={handleStartRecording}\n              disabled={startRecordingMutation.isPending}\n              className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n              data-testid=\"start-recording-button\"\n            >\n              <i className=\"fas fa-record-vinyl text-sm\"></i>\n              {startRecordingMutation.isPending ? 'Iniciando...' : 'Iniciar'}\n            </Button>\n          ) : (\n            <Button\n              onClick={handlePauseRecording}\n              disabled={stopRecordingMutation.isPending}\n              className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n              data-testid=\"pause-recording-button\"\n            >\n              <i className=\"fas fa-pause text-sm\"></i>\n              Pausar\n            </Button>\n          )}\n          \n          <Button\n            onClick={handleStopRecording}\n            disabled={!isRecording || stopRecordingMutation.isPending}\n            className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n            data-testid=\"stop-recording-button\"\n          >\n            <i className=\"fas fa-stop text-sm\"></i>\n            {stopRecordingMutation.isPending ? 'Parando...' : 'Parar'}\n          </Button>\n        </div>\n\n        {/* Recordings List */}\n        <div className=\"max-h-80 overflow-y-auto space-y-2\">\n          {isLoading ? (\n            <div className=\"text-center py-4 text-muted-foreground\">\n              <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n              Carregando grava√ß√µes...\n            </div>\n          ) : recordings.length === 0 ? (\n            <div className=\"text-center py-4 text-muted-foreground\">\n              <i className=\"fas fa-microphone-slash mr-2\"></i>\n              Nenhuma grava√ß√£o encontrada\n            </div>\n          ) : (\n            recordings.map((recording: Recording) => (\n              <div key={recording.id} className=\"bg-background rounded-lg p-3 border border-border\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <div className=\"text-sm font-medium text-foreground\">\n                      {recording.phone_number || 'N√∫mero n√£o informado'}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground mt-1\">\n                      {formatDuration(recording.duration_sec)} ‚Ä¢ {formatFileSize(recording.size_bytes)}\n                    </div>\n                    <div className=\"text-xs text-muted-foreground\">\n                      {new Date(recording.started_at).toLocaleString('pt-BR')}\n                    </div>\n                  </div>\n                  <div className=\"flex gap-1 ml-2\">\n                    <Button\n                      onClick={() => handleDownload(recording)}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"p-1 h-8 w-8 border-border text-foreground hover:bg-muted\"\n                      data-testid={`download-button-${recording.id}`}\n                    >\n                      <i className=\"fas fa-download text-xs\"></i>\n                    </Button>\n                    <Button\n                      onClick={() => handleDelete(recording)}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      disabled={deleteRecordingMutation.isPending}\n                      className=\"p-1 h-8 w-8 border-abmix-green text-abmix-green hover:bg-abmix-green hover:text-black\"\n                      data-testid={`delete-button-${recording.id}`}\n                    >\n                      <i className=\"fas fa-trash text-xs\"></i>\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":16066},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/index.ts":{"content":"export { Layout } from './Layout';\nexport { Sidebar } from './Sidebar';\nexport { Header } from './Header';\nexport { DialerCard } from './DialerCard';\nexport { AgentControls } from './AgentControls';\nexport { CallControls } from './CallControls';\nexport { LivePrompt } from './LivePrompt';\nexport { Favorites } from './Favorites';\nexport { FavoriteDialog } from './FavoriteDialog';\nexport { Recordings } from './Recordings';\nexport { RecordingsTab } from './RecordingsTab';\nexport { Transcripts } from './Transcripts';\nexport { Settings } from './Settings';\nexport { VoiceSelector } from './VoiceSelector';\nexport { VoiceTester } from './VoiceTester';\nexport { DTMFKeypad } from './DTMFKeypad';\nexport { VoiceCloning } from './VoiceCloning';\nexport { AudioEffects } from './AudioEffects';\nexport { DubbingTranslation } from './DubbingTranslation';\nexport { CallManager } from './CallManager';\nexport { VoiceEnhancer } from './VoiceEnhancer';","size_bytes":940},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer } from \"http\";\nimport { queries } from \"./database\";\nimport { initDatabase } from \"./database\";\nimport express from \"express\";\nimport fetch from \"node-fetch\";\nimport multer from \"multer\";\nimport { promises as fs } from \"fs\";\nimport path from \"path\";\nimport { ProviderFactory } from \"./providers/providerFactory\";\n\n// Environment variables\nconst {\n  ELEVENLABS_API_KEY\n} = process.env;\n\nexport async function registerRoutes(app: Express) {\n  // Initialize database\n  initDatabase();\n\n  // Health check endpoint\n  app.get('/api/health', (req, res) => {\n    res.json({\n      status: 'ok',\n      timestamp: new Date().toISOString(),\n      environment: process.env.NODE_ENV || 'development',\n      port: process.env.PORT || 8080,\n      services: {\n        database: 'ok',\n        elevenlabs: process.env.ELEVENLABS_API_KEY ? 'configured' : 'not_configured',\n        falevono: process.env.FALEVONO_PASSWORD ? 'configured' : 'not_configured'\n      }\n    });\n  });\n\n  // Discagem √© tratada por server/telephony.ts\n\n  // === CALL CONTROL ROUTES ===\n\n  // Store active calls with their providers\n  const activeCallProviders = new Map<string, any>();\n\n  // Dial endpoint\n  app.post(\"/api/call/dial\", async (req, res) => {\n    try {\n      const { to, voipNumberId, voiceType } = req.body;\n      \n      if (!to) {\n        return res.status(400).json({ error: \"Phone number 'to' is required\" });\n      }\n\n      console.log(`[CALL] Initiating call to ${to}`);\n      \n      // Get the appropriate provider based on VoIP number\n      const { provider, voipNumber } = ProviderFactory.getProviderForCall(voipNumberId);\n      \n      console.log(`[CALL] Using ${voipNumber.provider} provider (${voipNumber.name})`);\n      console.log(`[CALL] From: ${voipNumber.number} ‚Üí To: ${to}`);\n      \n      // Start the call\n      const result = await provider.startCall(to, voiceType || 'masc');\n      \n      // Store the provider for this call\n      activeCallProviders.set(result.callId, provider);\n      \n      res.json({\n        success: true,\n        message: `Calling ${to} via ${voipNumber.provider}...`,\n        callId: result.callId,\n        callSid: result.callId,\n        status: result.status,\n        provider: voipNumber.provider,\n        fromNumber: voipNumber.number\n      });\n    } catch (error) {\n      console.error('[CALL] Error dialing:', error);\n      res.status(500).json({ \n        error: error instanceof Error ? error.message : String(error),\n        success: false\n      });\n    }\n  });\n\n  // Hangup endpoint\n  app.post(\"/api/call/hangup\", async (req, res) => {\n    try {\n      const { callSid } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ error: \"Call SID is required\" });\n      }\n\n      console.log(`[CALL] Hanging up call ${callSid}`);\n      \n      // Get the provider for this call\n      const provider = activeCallProviders.get(callSid);\n      \n      if (!provider) {\n        console.warn(`[CALL] No provider found for call ${callSid}, using default`);\n        // Try to get default provider as fallback\n        const { provider: defaultProvider } = ProviderFactory.getProviderForCall();\n        await defaultProvider.hangup(callSid);\n      } else {\n        await provider.hangup(callSid);\n        activeCallProviders.delete(callSid);\n      }\n      \n      res.json({\n        success: true,\n        message: 'Call ended',\n        status: 'ended'\n      });\n    } catch (error) {\n      console.error('[CALL] Error hanging up:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // DTMF endpoint\n  app.post(\"/api/call/dtmf\", async (req, res) => {\n    try {\n      const { callSid, digits } = req.body;\n      \n      if (!callSid || !digits) {\n        return res.status(400).json({ error: \"Call SID and digits are required\" });\n      }\n\n      console.log(`[CALL] Sending DTMF ${digits} to call ${callSid}`);\n      \n      const provider = activeCallProviders.get(callSid);\n      \n      if (!provider) {\n        throw new Error('No active provider for this call');\n      }\n      \n      await provider.sendDTMF(callSid, digits);\n      \n      res.json({\n        success: true,\n        message: `DTMF ${digits} sent`\n      });\n    } catch (error) {\n      console.error('[CALL] Error sending DTMF:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === FAVORITES ROUTES ===\n\n  // Get favorites\n  app.get(\"/api/favorites\", (req, res) => {\n    try {\n      const favorites = queries.getAllFavorites.all();\n      res.json(favorites);\n    } catch (error) {\n      console.error('[FAVORITES] Error getting favorites:', error);\n      res.status(500).json({ message: \"Failed to get favorites\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Add favorite\n  app.post(\"/api/favorites\", (req, res) => {\n    try {\n      const { name, phoneNumber, voiceType } = req.body;\n      \n      if (!name || !phoneNumber) {\n        return res.status(400).json({ error: \"Name and phone number are required\" });\n      }\n\n      queries.addFavorite.run(name, phoneNumber, voiceType || 'masculine');\n      const favorites = queries.getAllFavorites.all();\n      const favorite = favorites[favorites.length - 1];\n      \n      console.log(`[FAVORITES] Added favorite: ${name} - ${phoneNumber}`);\n      res.json(favorite);\n    } catch (error) {\n      console.error('[FAVORITES] Error adding favorite:', error);\n      res.status(500).json({ message: \"Failed to add favorite\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === VOIP NUMBERS ROUTES ===\n\n  // Get all VoIP numbers (WITHOUT sensitive credentials)\n  app.get(\"/api/voip-numbers\", (req, res) => {\n    try {\n      const numbers = queries.getAllVoipNumbers.all() as any[];\n      \n      // Remove sensitive fields before sending to client\n      const safeNumbers = numbers.map(num => ({\n        id: num.id,\n        name: num.name,\n        number: num.number,\n        provider: num.provider,\n        sip_username: num.sip_username,\n        sip_server: num.sip_server,\n        is_default: num.is_default,\n        status: num.status,\n        created_at: num.created_at,\n        updated_at: num.updated_at\n        // sip_password is intentionally omitted for security\n      }));\n      \n      res.json(safeNumbers);\n    } catch (error) {\n      console.error('[VOIP_NUMBERS] Error getting numbers:', error);\n      res.status(500).json({ message: \"Failed to get VoIP numbers\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Get default VoIP number\n  app.get(\"/api/voip-numbers/default\", (req, res) => {\n    try {\n      const defaultNumber = queries.getDefaultVoipNumber.get();\n      res.json(defaultNumber || null);\n    } catch (error) {\n      console.error('[VOIP_NUMBERS] Error getting default number:', error);\n      res.status(500).json({ message: \"Failed to get default VoIP number\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Add VoIP number (passwords NOT stored - must be in environment)\n  app.post(\"/api/voip-numbers\", (req, res) => {\n    try {\n      const { name, number, provider, sipUsername, sipServer, isDefault } = req.body;\n      \n      if (!name || !number || !provider) {\n        return res.status(400).json({ error: \"Name, number and provider are required\" });\n      }\n\n      // SECURITY: Never store passwords in database\n      // Passwords must be configured as environment variables\n      // For FaleVono: use FALEVONO_PASSWORD environment variable\n      \n      if (provider.toLowerCase() === 'falevono') {\n        if (!process.env.FALEVONO_PASSWORD) {\n          return res.status(400).json({ \n            error: \"FaleVono password must be configured in FALEVONO_PASSWORD environment variable\" \n          });\n        }\n      }\n\n      // If this is marked as default, unset any other default\n      if (isDefault) {\n        queries.setDefaultVoipNumber.run(-1); // Unset all defaults first\n      }\n\n      const info = queries.addVoipNumber.run(\n        name, \n        number, \n        provider, \n        sipUsername || null, \n        null, // Never store password in DB\n        sipServer || null, \n        isDefault ? 1 : 0,\n        'active'\n      );\n      \n      const newNumber = queries.getVoipNumberById.get(info.lastInsertRowid) as any;\n      \n      // Remove sensitive fields before sending to client\n      const safeNumber = {\n        id: newNumber.id,\n        name: newNumber.name,\n        number: newNumber.number,\n        provider: newNumber.provider,\n        sip_username: newNumber.sip_username,\n        sip_server: newNumber.sip_server,\n        is_default: newNumber.is_default,\n        status: newNumber.status,\n        created_at: newNumber.created_at,\n        updated_at: newNumber.updated_at\n      };\n      \n      console.log(`[VOIP_NUMBERS] Added number: ${name} - ${number} (${provider})`);\n      res.json(safeNumber);\n    } catch (error) {\n      console.error('[VOIP_NUMBERS] Error adding number:', error);\n      res.status(500).json({ message: \"Failed to add VoIP number\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Set default VoIP number\n  app.put(\"/api/voip-numbers/:id/default\", (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      queries.setDefaultVoipNumber.run(parseInt(id));\n      const updatedNumber = queries.getVoipNumberById.get(parseInt(id));\n      \n      console.log(`[VOIP_NUMBERS] Set default number: ${id}`);\n      res.json(updatedNumber);\n    } catch (error) {\n      console.error('[VOIP_NUMBERS] Error setting default:', error);\n      res.status(500).json({ message: \"Failed to set default VoIP number\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Delete VoIP number\n  app.delete(\"/api/voip-numbers/:id\", (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      queries.deleteVoipNumber.run(parseInt(id));\n      \n      console.log(`[VOIP_NUMBERS] Deleted number: ${id}`);\n      res.json({ success: true });\n    } catch (error) {\n      console.error('[VOIP_NUMBERS] Error deleting number:', error);\n      res.status(500).json({ message: \"Failed to delete VoIP number\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === SETTINGS ROUTES ===\n\n  // Get settings\n  app.get(\"/api/settings\", (req, res) => {\n    try {\n      const allSettings = queries.getAllSettings.all() as any[];\n      const settings = allSettings.length > 0 ? allSettings[0] : {\n        id: 1,\n        voice_type: 'masculine',\n        auto_record: false,\n        noise_reduction: true,\n        echo_cancellation: true\n      };\n      res.json(settings);\n    } catch (error) {\n      console.error('[SETTINGS] Error getting settings:', error);\n      res.status(500).json({ message: \"Failed to get settings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Update settings\n  app.put(\"/api/settings\", (req, res) => {\n    try {\n      const { voice_type, auto_record, noise_reduction, echo_cancellation } = req.body;\n      \n      queries.setSetting.run('voice_type', voice_type || 'masculine');\n      queries.setSetting.run('auto_record', auto_record || false);\n      queries.setSetting.run('noise_reduction', noise_reduction || true);\n      queries.setSetting.run('echo_cancellation', echo_cancellation || true);\n      \n      const allSettings = queries.getAllSettings.all() as any[];\n      const settings = allSettings.length > 0 ? allSettings[0] : {\n        voice_type: voice_type || 'masculine',\n        auto_record: auto_record || false,\n        noise_reduction: noise_reduction || true,\n        echo_cancellation: echo_cancellation || true\n      };\n      console.log('[SETTINGS] Settings updated:', settings);\n      res.json(settings);\n    } catch (error) {\n      console.error('[SETTINGS] Error updating settings:', error);\n      res.status(500).json({ message: \"Failed to update settings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === RECORDINGS ROUTES ===\n\n  // List recordings\n  app.get(\"/api/recordings/list\", async (req, res) => {\n    try {\n      const recordings = queries.getAllRecordings.all();\n      res.json(recordings);\n    } catch (error) {\n      console.error('[RECORDING] Error listing recordings:', error);\n      res.status(500).json({ message: \"Failed to list recordings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Start recording  \n  app.post(\"/api/recordings/start\", async (req, res) => {\n    try {\n      const { callSid, phoneNumber } = req.body;\n      \n      console.log(`[RECORDING] Starting recording for call: ${callSid || 'demo'}`);\n\n      const timestamp = Date.now();\n      const filename = `call-${phoneNumber || 'unknown'}-${timestamp}.wav`;\n      \n      queries.addRecording.run(callSid || `demo-${timestamp}`, phoneNumber || 'unknown', filename);\n      const recordings = queries.getAllRecordings.all();\n      const recordingDb = recordings[recordings.length - 1] as any;\n      \n      console.log(`[RECORDING] Recording started: ${filename}`);\n      res.json({ \n        success: true, \n        id: recordingDb.id, \n        filename, \n        callSid: callSid || `demo-${timestamp}`,\n        status: 'recording'\n      });\n    } catch (error) {\n      console.error('[RECORDING] Error starting recording:', error);\n      res.status(500).json({ error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Pause recording\n  app.post(\"/api/recordings/:id/pause\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      console.log(`[RECORDING] Pausing recording ${recordingId}`);\n      \n      res.json({ \n        success: true, \n        id: recordingId,\n        status: 'paused',\n        message: \"Recording paused successfully\" \n      });\n    } catch (error) {\n      console.error('[RECORDING] Error pausing recording:', error);\n      res.status(500).json({ message: \"Failed to pause recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Resume recording\n  app.post(\"/api/recordings/:id/resume\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      console.log(`[RECORDING] Resuming recording ${recordingId}`);\n      \n      res.json({ \n        success: true, \n        id: recordingId,\n        status: 'recording',\n        message: \"Recording resumed successfully\" \n      });\n    } catch (error) {\n      console.error('[RECORDING] Error resuming recording:', error);\n      res.status(500).json({ message: \"Failed to resume recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Stop recording\n  app.post(\"/api/recordings/:id/stop\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      const recording = queries.getRecordingById.get(recordingId);\n      if (!recording) {\n        return res.status(404).json({ message: \"Recording not found\" });\n      }\n\n      // Create demo audio file\n      const { existsSync, mkdirSync, writeFileSync, statSync } = await import('fs');\n      const { join } = await import('path');\n      \n      const recordingsDir = join(process.cwd(), 'recordings');\n      if (!existsSync(recordingsDir)) {\n        mkdirSync(recordingsDir, { recursive: true });\n      }\n\n      const filePath = join(recordingsDir, (recording as any).filename);\n      \n      // Generate a simple WAV file\n      const duration = 10; // 10 seconds\n      const sampleRate = 44100;\n      const channels = 1;\n      const bitsPerSample = 16;\n      const blockAlign = channels * bitsPerSample / 8;\n      const byteRate = sampleRate * blockAlign;\n      const dataSize = duration * byteRate;\n      const fileSize = 36 + dataSize;\n\n      const buffer = Buffer.alloc(44 + dataSize);\n      \n      // WAV header\n      buffer.write('RIFF', 0);\n      buffer.writeUInt32LE(fileSize, 4);\n      buffer.write('WAVE', 8);\n      buffer.write('fmt ', 12);\n      buffer.writeUInt32LE(16, 16);\n      buffer.writeUInt16LE(1, 20);\n      buffer.writeUInt16LE(channels, 22);\n      buffer.writeUInt32LE(sampleRate, 24);\n      buffer.writeUInt32LE(byteRate, 28);\n      buffer.writeUInt16LE(blockAlign, 32);\n      buffer.writeUInt16LE(bitsPerSample, 34);\n      buffer.write('data', 36);\n      buffer.writeUInt32LE(dataSize, 40);\n      \n      // Generate 440Hz tone  \n      for (let i = 0; i < dataSize / 2; i++) {\n        const sample = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 16000;\n        buffer.writeInt16LE(Math.floor(sample), 44 + i * 2);\n      }\n      \n      writeFileSync(filePath, buffer);\n      const stats = statSync(filePath);\n      \n      queries.updateRecording.run(duration, stats.size, recordingId);\n      \n      console.log(`[RECORDING] Stopped recording ${recordingId}: ${(recording as any).filename}`);\n      res.json({ success: true, id: recordingId, duration, size: stats.size });\n    } catch (error) {\n      console.error('[RECORDING] Error stopping recording:', error);\n      res.status(500).json({ message: \"Failed to stop recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Download recording\n  app.get(\"/api/recordings/:id/download\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      const recording = queries.getRecordingById.get(recordingId);\n      if (!recording || !(recording as any).filename) {\n        return res.status(404).json({ message: \"Recording not found\" });\n      }\n\n      const { join } = await import('path');\n      const { existsSync, statSync } = await import('fs');\n      \n      const filePath = join(process.cwd(), 'recordings', (recording as any).filename);\n      \n      if (!existsSync(filePath)) {\n        return res.status(404).json({ message: \"Recording file not found\" });\n      }\n\n      const stats = statSync(filePath);\n      \n      res.set({\n        'Content-Type': 'audio/wav',\n        'Content-Disposition': `attachment; filename=\"${(recording as any).filename}\"`,\n        'Content-Length': stats.size\n      });\n      \n      const { createReadStream } = await import('fs');\n      const fileStream = createReadStream(filePath);\n      fileStream.pipe(res);\n      \n      console.log(`[RECORDING] Downloaded recording ${recordingId}: ${(recording as any).filename}`);\n    } catch (error) {\n      console.error('[RECORDING] Error downloading recording:', error);\n      res.status(500).json({ message: \"Failed to download recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Delete recording\n  app.delete(\"/api/recordings/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const recordingId = parseInt(id);\n      \n      const recording = queries.getRecordingById.get(recordingId);\n      if (!recording) {\n        return res.status(404).json({ message: \"Recording not found\" });\n      }\n\n      // Delete file from disk\n      const { join } = await import('path');\n      const { existsSync, unlinkSync } = await import('fs');\n      \n      const filePath = join(process.cwd(), 'recordings', (recording as any).filename);\n      \n      if (existsSync(filePath)) {\n        unlinkSync(filePath);\n      }\n\n      // Delete from database\n      queries.deleteRecording.run(recordingId);\n      \n      console.log(`[RECORDING] Deleted recording ${recordingId}: ${(recording as any).filename}`);\n      res.json({ success: true, message: \"Recording deleted successfully\" });\n    } catch (error) {\n      console.error('[RECORDING] Error deleting recording:', error);\n      res.status(500).json({ message: \"Failed to delete recording\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Voice recommendations endpoint\n  app.get('/api/voices/recommended', async (req, res) => {\n    try {\n      const recommended = {\n        masc: [\n          'pNInz6obpgDQGcFmaJgB', // Adam - voz masculina natural\n          'VR6AewLTigWG4xSOukaG', // Arnold - profundo e natural  \n          'ErXwobaYiN019PkySvjV', // Antoni - caloroso\n          'yoZ06aMxZJJ28mfd3POQ', // Sam - jovem e energ√©tico\n          'jsCqWAovK2LkecY7zXl4'  // Matheus - portugu√™s brasileiro\n        ],\n        fem: [\n          'EXAVITQu4vr4xnSDxMaL', // Bella - feminina suave\n          'AZnzlk1XvdvUeBnXmlld', // Domi - expressiva\n          'TxGEqnHWrfWFTfGW9XjX', // Josh - vers√°til\n          'pFZP5JQG7iQjIQuC4Bku', // Lily - jovem e clara\n          'CwhRBWXzGAHq8TQ4Fs17'  // Serena - brasileira natural\n        ]\n      };\n      \n      res.json({\n        message: 'Vozes otimizadas para soar mais naturais',\n        voices: recommended\n      });\n    } catch (error) {\n      console.error('[VOICES] Error getting recommended voices:', error);\n      res.status(500).json({ message: \"Failed to get recommended voices\" });\n    }\n  });\n\n  // Voice test endpoint - generate audio sample\n  app.post('/api/voices/test', async (req, res) => {\n    try {\n      const { voiceId, text } = req.body;\n      \n      if (!voiceId || !text) {\n        return res.status(400).json({ error: 'voiceId and text are required' });\n      }\n\n      const ELEVENLABS_API_KEY = process.env.ELEVENLABS_API_KEY;\n      if (!ELEVENLABS_API_KEY) {\n        return res.status(500).json({ error: 'ElevenLabs API key not configured' });\n      }\n\n      console.log(`[VOICE_TEST] Generating audio for voice ${voiceId}`);\n\n      // Call ElevenLabs TTS API\n      const fetch = (await import('node-fetch')).default;\n      const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {\n        method: 'POST',\n        headers: {\n          'Accept': 'audio/mpeg',\n          'Content-Type': 'application/json',\n          'xi-api-key': ELEVENLABS_API_KEY\n        },\n        body: JSON.stringify({\n          text: text,\n          model_id: 'eleven_multilingual_v2',\n          voice_settings: {\n            stability: 0.5,\n            similarity_boost: 0.8,\n            style: 0.0,\n            use_speaker_boost: true\n          }\n        })\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('[VOICE_TEST] ElevenLabs API error:', response.status, errorText);\n        return res.status(response.status).json({ error: 'Failed to generate audio' });\n      }\n\n      // Stream the audio response\n      const audioBuffer = await response.buffer();\n      \n      res.set({\n        'Content-Type': 'audio/mpeg',\n        'Content-Length': audioBuffer.length.toString()\n      });\n      \n      res.send(audioBuffer);\n      console.log(`[VOICE_TEST] Audio generated successfully (${audioBuffer.length} bytes)`);\n\n    } catch (error) {\n      console.error('[VOICE_TEST] Error generating voice test:', error);\n      res.status(500).json({ error: 'Failed to generate voice test' });\n    }\n  });\n\n  console.log('[ROUTES] API routes configured');\n}","size_bytes":23169},"client/src/components/LivePrompt.tsx":{"content":"import { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { api } from '@/services/api';\n\nexport function LivePrompt() {\n  const { toast } = useToast();\n  const { livePrompt, setLivePrompt, currentCallId } = useCallStore();\n\n  const applyPromptMutation = useMutation({\n    mutationFn: () => api.injectPrompt(currentCallId!, livePrompt),\n    onSuccess: () => {\n      toast({\n        title: \"Prompt aplicado\",\n        description: \"Instru√ß√µes enviadas para a IA\",\n      });\n      setLivePrompt('');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao aplicar prompt\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleApplyPrompt = () => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        description: \"Inicie uma chamada para aplicar prompts\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!livePrompt.trim()) {\n      toast({\n        title: \"Prompt vazio\",\n        description: \"Digite instru√ß√µes para aplicar\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    applyPromptMutation.mutate();\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.ctrlKey && e.key === 'Enter') {\n      e.preventDefault();\n      handleApplyPrompt();\n    }\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border flex flex-col h-full\">\n      <h3 className=\"text-lg font-semibold mb-4\">Prompt Ao Vivo</h3>\n      \n      <div className=\"flex flex-col flex-1 space-y-4\">\n        <div className=\"flex-1\">\n          <Label htmlFor=\"live-prompt\" className=\"sr-only\">Prompt ao vivo</Label>\n          <Textarea\n            id=\"live-prompt\"\n            placeholder=\"Digite instru√ß√µes para a IA (ex: Mude o tom para mais formal, mencione a promo√ß√£o especial...)\"\n            value={livePrompt}\n            onChange={(e) => setLivePrompt(e.target.value)}\n            onKeyDown={handleKeyDown}\n            className=\"w-full h-full bg-dark-bg border border-dark-border rounded-lg px-4 py-3 resize-none focus:border-abmix-green focus:outline-none transition-colors min-h-[120px]\"\n            data-testid=\"live-prompt-textarea\"\n          />\n        </div>\n        \n        <div className=\"space-y-3\">\n          <Button\n            onClick={handleApplyPrompt}\n            disabled={!currentCallId || !livePrompt.trim() || applyPromptMutation.isPending}\n            className=\"w-full bg-abmix-green text-black font-semibold py-3 rounded-lg hover:bg-abmix-green/90 transition-colors\"\n            data-testid=\"apply-prompt-button\"\n          >\n            <i className=\"fas fa-magic mr-2\"></i>\n            {applyPromptMutation.isPending ? 'Aplicando...' : 'Aplicar Prompt'}\n          </Button>\n          \n          <p className=\"text-xs text-gray-500 text-center\">\n            Dica: Use Ctrl+Enter para aplicar rapidamente\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3280},"client/src/pages/Home.tsx":{"content":"import { useEffect } from 'react';\nimport { Layout } from '@/components/Layout';\nimport { websocketService } from '@/services/websocket';\n\nexport default function Home() {\n  useEffect(() => {\n    // Connect to WebSocket on component mount\n    // websocketService.connect(); // DISABLED - Use captions service for call-specific connections\n\n    // Cleanup on unmount\n    return () => {\n      websocketService.disconnect();\n    };\n  }, []);\n\n  return <Layout />;\n}\n","size_bytes":463},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/VoiceTester.tsx":{"content":"import { useState } from 'react';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { api } from '@/services/api';\n\nexport function VoiceTester() {\n  const { toast } = useToast();\n  const [selectedMascVoice, setSelectedMascVoice] = useState<string>('');\n  const [selectedFemVoice, setSelectedFemVoice] = useState<string>('');\n  const [currentAudio, setCurrentAudio] = useState<HTMLAudioElement | null>(null);\n\n  const testPhrase = \"Ol√°, bem-vindo √† Disck Mix. Seu painel inteligente de liga√ß√µes.\";\n\n  // Get available voices\n  const { data: voices = [] } = useQuery({\n    queryKey: ['/api/voices'],\n    queryFn: () => api.getVoices(),\n  });\n\n  const testVoiceMutation = useMutation({\n    mutationFn: ({ voiceId }: { voiceId: string }) => api.testVoice(voiceId, testPhrase),\n    onSuccess: async (response, variables) => {\n      try {\n        // Stop any currently playing audio\n        if (currentAudio) {\n          currentAudio.pause();\n          setCurrentAudio(null);\n        }\n\n        const audioBlob = await response.blob();\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n        \n        setCurrentAudio(audio);\n        \n        audio.onended = () => {\n          URL.revokeObjectURL(audioUrl);\n          setCurrentAudio(null);\n        };\n\n        await audio.play();\n\n        toast({\n          title: \"Voz testada\",\n          description: \"Reproduzindo amostra da voz selecionada\",\n        });\n      } catch (error) {\n        console.error('Error playing voice test:', error);\n        toast({\n          title: \"Erro no teste\",\n          description: \"N√£o foi poss√≠vel reproduzir a voz\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro no teste de voz\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleTestVoice = (voiceId: string, type: 'masc' | 'fem') => {\n    if (!voiceId) {\n      toast({\n        title: \"Nenhuma voz selecionada\",\n        description: `Selecione uma voz ${type === 'masc' ? 'masculina' : 'feminina'} para testar`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    testVoiceMutation.mutate({ voiceId });\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Configurar Vozes</h3>\n      \n      <div className=\"space-y-4\">\n        {/* Masculine Voice */}\n        <div className=\"space-y-2\">\n          <label className=\"text-sm font-medium text-foreground\">\n            Voz Masculina\n          </label>\n          <div className=\"flex space-x-2\">\n            <Select value={selectedMascVoice} onValueChange={setSelectedMascVoice}>\n              <SelectTrigger className=\"flex-1\" data-testid=\"select-masculine-voice\">\n                <SelectValue placeholder=\"Selecione voz masculina\" />\n              </SelectTrigger>\n              <SelectContent>\n                {voices.map((voice: any) => (\n                  <SelectItem key={voice.voice_id} value={voice.voice_id}>\n                    {voice.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleTestVoice(selectedMascVoice, 'masc')}\n              disabled={testVoiceMutation.isPending || !selectedMascVoice}\n              className=\"bg-abmix-green text-black hover:bg-abmix-green/80 border-abmix-green\"\n              data-testid=\"test-masculine-voice\"\n            >\n              {testVoiceMutation.isPending ? 'Testando...' : 'Testar'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Feminine Voice */}\n        <div className=\"space-y-2\">\n          <label className=\"text-sm font-medium text-foreground\">\n            Voz Feminina\n          </label>\n          <div className=\"flex space-x-2\">\n            <Select value={selectedFemVoice} onValueChange={setSelectedFemVoice}>\n              <SelectTrigger className=\"flex-1\" data-testid=\"select-feminine-voice\">\n                <SelectValue placeholder=\"Selecione voz feminina\" />\n              </SelectTrigger>\n              <SelectContent>\n                {voices.map((voice: any) => (\n                  <SelectItem key={voice.voice_id} value={voice.voice_id}>\n                    {voice.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Button\n              variant=\"outline\"\n              onClick={() => handleTestVoice(selectedFemVoice, 'fem')}\n              disabled={testVoiceMutation.isPending || !selectedFemVoice}\n              className=\"bg-abmix-green text-black hover:bg-abmix-green/80 border-abmix-green\"\n              data-testid=\"test-feminine-voice\"\n            >\n              {testVoiceMutation.isPending ? 'Testando...' : 'Testar'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Test phrase display */}\n        <div className=\"mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border\">\n          <p className=\"text-sm text-gray-400 mb-1\">Frase de teste:</p>\n          <p className=\"text-sm italic\">\"{testPhrase}\"</p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5530},"scripts/quick-deploy.md":{"content":"# ‚ö° Deploy R√°pido para VPS\n\n## üéØ **Resposta Direta:**\n\n**SIM!** √â exatamente isso, mas com alguns detalhes importantes:\n\n### **üì¶ Comandos Exatos:**\n\n```bash\n# 1. Local - Build\nnpm run build\n\n# 2. Enviar para VPS (via SCP/RSYNC)\nscp -r dist/ package.json package-lock.json .env usuario@seu-dominio.com:/var/www/abmix/\n\n# 3. Na VPS - Instalar e iniciar\nssh usuario@seu-dominio.com\ncd /var/www/abmix\nnpm install --production\nnpm start\n```\n\n### **‚ö†Ô∏è Pontos CR√çTICOS:**\n\n#### **1. Arquivo .env OBRIGAT√ìRIO:**\n```env\n# Mude esta linha para sua URL p√∫blica:\nPUBLIC_BASE_URL=https://seu-dominio.com\n\n# Mantenha as outras chaves iguais:\nELEVENLABS_API_KEY=sk_sua_chave_aqui\nTWILIO_ACCOUNT_SID=AC_seu_sid_aqui\nTWILIO_AUTH_TOKEN=seu_token_aqui\nTWILIO_NUMBER=+14474442595\nNODE_ENV=production\n```\n\n#### **2. HTTPS Obrigat√≥rio:**\n- WebSocket precisa de `wss://` (n√£o `ws://`)\n- Configure SSL no seu dom√≠nio\n- Use Let's Encrypt ou certificado pr√≥prio\n\n#### **3. Nginx (Recomendado):**\nConfigure proxy para porta 5000 e WebSocket\n\n### **üöÄ Processo Completo:**\n\n```bash\n# === LOCAL ===\nnpm run build\nscp -r dist/ package.json .env usuario@seu-dominio.com:/var/www/abmix/\n\n# === VPS ===\nssh usuario@seu-dominio.com\ncd /var/www/abmix\nnpm install --production\n\n# Editar .env para URL p√∫blica\nnano .env\n# Mudar: PUBLIC_BASE_URL=https://seu-dominio.com\n\n# Iniciar (escolha uma op√ß√£o)\nnpm start                    # Simples\n# OU\npm2 start dist/index.js --name abmix  # Recomendado\n```\n\n### **‚úÖ Resultado:**\n\nAp√≥s deploy, voc√™ ter√°:\n- üåê **Painel**: `https://seu-dominio.com`\n- üé§ **Convers√£o real**: WebSocket `wss://seu-dominio.com/media`\n- üìû **Liga√ß√µes**: Funcionando com convers√£o de voz\n- üîÑ **Controles**: Switch ativa/desativa convers√£o\n\n### **üß™ Como Testar:**\n\n1. **Acesse**: `https://seu-dominio.com`\n2. **Fa√ßa liga√ß√£o** pelo painel\n3. **Ative convers√£o** no switch\n4. **Converse** - sua voz ser√° modificada!\n\n**√â isso! Simples e direto.** üéØ\n\n---\n\n**üí° Dica:** Use o script `./scripts/deploy.sh usuario@seu-dominio.com` para automatizar todo o processo!\n\n\n\n\n\n\n","size_bytes":2105},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/Layout.tsx":{"content":"import { \n  Sidebar,\n  Header,\n  DialerCard,\n  AgentControls,\n  LivePrompt,\n  Favorites,\n  Recordings,\n  RecordingsTab,\n  Transcripts,\n  Settings\n} from '.';\nimport { VoiceTester } from './VoiceTester';\nimport { VoiceCloning } from './VoiceCloning';\nimport { AudioEffects } from './AudioEffects';\nimport { DubbingTranslation } from './DubbingTranslation';\nimport { CallManager } from './CallManager';\nimport { VoiceEnhancer } from './VoiceEnhancer';\nimport { useCallStore } from '@/stores/useCallStore';\n\nexport function Layout() {\n  const { activeView } = useCallStore();\n\n  const renderContent = () => {\n    switch(activeView) {\n      case 'discagem':\n        return (\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-8rem)]\">\n            <div className=\"space-y-6\" data-testid=\"left-column\">\n              <DialerCard />\n              <AgentControls />\n            </div>\n            <div className=\"flex flex-col space-y-6 h-full\" data-testid=\"middle-column\">\n              <div className=\"flex-1\">\n                <LivePrompt />\n              </div>\n              <Favorites />\n              <Recordings />\n            </div>\n            <div className=\"space-y-6\" data-testid=\"right-column\">\n              <Transcripts />\n            </div>\n          </div>\n        );\n        \n      case 'favoritos':\n        return (\n          <div className=\"max-w-4xl mx-auto\">\n            <Favorites />\n          </div>\n        );\n        \n      case 'gravacoes':\n        return (\n          <div className=\"max-w-6xl mx-auto\">\n            <RecordingsTab />\n          </div>\n        );\n        \n      case 'vozes':\n        return (\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <VoiceTester />\n              <VoiceCloning />\n            </div>\n          </div>\n        );\n\n      case 'enhancer':\n        return (\n          <div className=\"max-w-4xl mx-auto\">\n            <VoiceEnhancer />\n          </div>\n        );\n\n      case 'audio':\n        return (\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n              <AudioEffects />\n              <DubbingTranslation />\n            </div>\n          </div>\n        );\n\n      case 'chamadas':\n        return (\n          <div className=\"max-w-4xl mx-auto\">\n            <CallManager />\n          </div>\n        );\n\n      case 'configuracoes':\n        return (\n          <div className=\"max-w-4xl mx-auto\">\n            <Settings />\n          </div>\n        );\n        \n      default:\n        return (\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-8rem)]\">\n            <div className=\"space-y-6\" data-testid=\"left-column\">\n              <DialerCard />\n              <AgentControls />\n            </div>\n            <div className=\"flex flex-col space-y-6 h-full\" data-testid=\"middle-column\">\n              <div className=\"flex-1\">\n                <LivePrompt />\n              </div>\n              <Favorites />\n              <Recordings />\n            </div>\n            <div className=\"space-y-6\" data-testid=\"right-column\">\n              <Transcripts />\n            </div>\n          </div>\n        );\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground font-inter\">\n      <div className=\"flex min-h-screen\">\n        <Sidebar />\n        \n        <div className=\"flex-1 flex flex-col\">\n          <Header />\n          \n          <main className=\"flex-1 overflow-auto\">\n            <div className=\"container mx-auto p-6 max-w-7xl\">\n              {renderContent()}\n            </div>\n          </main>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3726},"client/src/components/RecordingsTab.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useState } from 'react';\n\ninterface Recording {\n  id: number;\n  call_sid: string;\n  phone_number: string;\n  filename: string;\n  duration_sec: number;\n  started_at: string;\n  ended_at: string;\n  size_bytes: number;\n}\n\nexport function RecordingsTab() {\n  const { toast } = useToast();\n  const [playingId, setPlayingId] = useState<number | null>(null);\n  const queryClient = useQueryClient();\n\n  // Fetch recordings list\n  const { data: recordings = [], isLoading } = useQuery({\n    queryKey: ['/api/recordings/list'],\n    queryFn: async () => {\n      const response = await fetch('/api/recordings/list');\n      if (!response.ok) throw new Error('Failed to fetch recordings');\n      return response.json();\n    }\n  });\n\n  // Format duration helper\n  const formatDuration = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Format file size helper\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];\n  };\n\n  const handlePlay = async (recordingId: number) => {\n    if (playingId === recordingId) {\n      // Stop current playback\n      const audioElements = document.querySelectorAll('audio');\n      audioElements.forEach(audio => {\n        audio.pause();\n        audio.currentTime = 0;\n      });\n      setPlayingId(null);\n      toast({\n        title: \"Reprodu√ß√£o pausada\",\n        description: \"√Åudio pausado\",\n      });\n    } else {\n      try {\n        // Stop any other playing audio first\n        const audioElements = document.querySelectorAll('audio');\n        audioElements.forEach(audio => {\n          audio.pause();\n          audio.currentTime = 0;\n        });\n\n        // Create and configure new audio\n        const audio = new Audio(`/api/recordings/${recordingId}/play`);\n        audio.crossOrigin = \"anonymous\";\n        audio.preload = \"auto\";\n        \n        setPlayingId(recordingId);\n        \n        audio.onended = () => {\n          setPlayingId(null);\n          toast({\n            title: \"Reprodu√ß√£o finalizada\",\n            description: \"√Åudio reproduzido completamente\",\n          });\n        };\n        \n        audio.onerror = (e) => {\n          console.error('Audio playback error:', e);\n          setPlayingId(null);\n          toast({\n            title: \"Erro na reprodu√ß√£o\",\n            description: \"N√£o foi poss√≠vel carregar o √°udio\",\n            variant: \"destructive\",\n          });\n        };\n\n        audio.onloadstart = () => {\n          console.log('Audio loading started for recording:', recordingId);\n        };\n\n        audio.oncanplay = () => {\n          console.log('Audio can start playing for recording:', recordingId);\n        };\n        \n        // Start loading and playing\n        await audio.play();\n        toast({\n          title: \"Reproduzindo √°udio\",\n          description: \"Tocando grava√ß√£o da liga√ß√£o\",\n        });\n      } catch (error) {\n        console.error('Play error:', error);\n        setPlayingId(null);\n        toast({\n          title: \"Erro na reprodu√ß√£o\", \n          description: \"N√£o foi poss√≠vel reproduzir o √°udio\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleStop = (recordingId: number) => {\n    // Stop all audio elements\n    const audioElements = document.querySelectorAll('audio');\n    audioElements.forEach(audio => {\n      audio.pause();\n      audio.currentTime = 0;\n    });\n    setPlayingId(null);\n    toast({\n      title: \"Reprodu√ß√£o parada\",\n      description: \"√Åudio parado\",\n    });\n  };\n\n  const handleDownload = async (recording: Recording) => {\n    try {\n      const response = await fetch(`/api/recordings/${recording.id}/download`);\n      if (!response.ok) throw new Error('Failed to download');\n      \n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = recording.filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      \n      toast({\n        title: \"Download iniciado\",\n        description: `Baixando ${recording.filename}`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Erro no download\",\n        description: \"N√£o foi poss√≠vel baixar a grava√ß√£o\",\n      });\n    }\n  };\n\n  // Delete recording mutation\n  const deleteRecordingMutation = useMutation({\n    mutationFn: async (recordingId: number) => {\n      const response = await fetch(`/api/recordings/${recordingId}`, {\n        method: 'DELETE',\n      });\n      if (!response.ok) throw new Error('Failed to delete recording');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/recordings/list'] });\n      toast({\n        title: \"Grava√ß√£o exclu√≠da\",\n        description: \"Arquivo removido com sucesso\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Erro ao excluir\",\n        description: \"N√£o foi poss√≠vel excluir a grava√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleDelete = async (recording: Recording) => {\n    deleteRecordingMutation.mutate(recording.id);\n  };\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h2 className=\"text-2xl font-bold text-foreground\">Grava√ß√µes</h2>\n        <div className=\"text-sm text-muted-foreground\">\n          {recordings.length} arquivo{recordings.length !== 1 ? 's' : ''}\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        {isLoading ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <i className=\"fas fa-spinner fa-spin mr-2\"></i>\n            Carregando grava√ß√µes...\n          </div>\n        ) : recordings.length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <i className=\"fas fa-microphone-slash text-3xl mb-3\"></i>\n            <p>Nenhuma grava√ß√£o encontrada</p>\n            <p className=\"text-sm\">Inicie uma grava√ß√£o no painel principal</p>\n          </div>\n        ) : (\n          recordings.map((recording: Recording) => (\n            <div key={recording.id} className=\"bg-card rounded-lg p-4 border border-border\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center space-x-3\">\n                    <div className=\"w-10 h-10 bg-abmix-green/20 rounded-full flex items-center justify-center\">\n                      <i className=\"fas fa-phone text-abmix-green\"></i>\n                    </div>\n                    <div>\n                      <div className=\"text-lg font-medium text-foreground\">\n                        {recording.phone_number || 'N√∫mero n√£o informado'}\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {formatDuration(recording.duration_sec)} ‚Ä¢ {formatFileSize(recording.size_bytes)}\n                      </div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {new Date(recording.started_at).toLocaleString('pt-BR')}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"flex gap-2 ml-4\">\n                  <Button\n                    onClick={() => handlePlay(recording.id)}\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"p-2 h-9 w-9 border-border text-foreground hover:bg-muted\"\n                    data-testid={`play-button-${recording.id}`}\n                  >\n                    <i className={`fas ${playingId === recording.id ? 'fa-pause' : 'fa-play'} text-sm`}></i>\n                  </Button>\n                  \n                  <Button\n                    onClick={() => handleStop(recording.id)}\n                    size=\"sm\"\n                    variant=\"outline\"\n                    disabled={playingId !== recording.id}\n                    className=\"p-2 h-9 w-9 border-border text-foreground hover:bg-muted disabled:opacity-50\"\n                    data-testid={`stop-button-${recording.id}`}\n                  >\n                    <i className=\"fas fa-stop text-sm\"></i>\n                  </Button>\n                  \n                  <Button\n                    onClick={() => handleDownload(recording)}\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"p-2 h-9 w-9 border-border text-foreground hover:bg-muted\"\n                    data-testid={`download-button-${recording.id}`}\n                  >\n                    <i className=\"fas fa-download text-sm\"></i>\n                  </Button>\n                  \n                  <Button\n                    onClick={() => handleDelete(recording)}\n                    size=\"sm\"\n                    variant=\"outline\"\n                    disabled={deleteRecordingMutation.isPending}\n                    className=\"p-2 h-9 w-9 border-abmix-green text-abmix-green hover:bg-abmix-green hover:text-black\"\n                    data-testid={`delete-button-${recording.id}`}\n                  >\n                    <i className=\"fas fa-trash text-sm\"></i>\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":9886},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, boolean, integer, jsonb } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const favorites = pgTable(\"favorites\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  phoneE164: text(\"phone_e164\").notNull().unique(),\n  voiceType: text(\"voice_type\").notNull().default('masc'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const calls = pgTable(\"calls\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  twilioSid: text(\"twilio_sid\"),\n  toNumber: text(\"to_number\").notNull(),\n  fromNumber: text(\"from_number\"),\n  provider: text(\"provider\").notNull(),\n  status: text(\"status\").notNull(),\n  startTime: timestamp(\"start_time\").defaultNow(),\n  endTime: timestamp(\"end_time\"),\n  duration: integer(\"duration\"),\n  recordingUrl: text(\"recording_url\"),\n  recordingStatus: text(\"recording_status\"), // 'not_started', 'recording', 'paused', 'completed'\n  metadata: jsonb(\"metadata\"),\n});\n\nexport const recordings = pgTable(\"recordings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  callId: varchar(\"call_id\").references(() => calls.id),\n  twilioRecordingSid: text(\"twilio_recording_sid\"),\n  filename: text(\"filename\").notNull(),\n  status: text(\"status\").notNull(), // 'recording', 'paused', 'completed', 'failed'\n  startTime: timestamp(\"start_time\").defaultNow(),\n  endTime: timestamp(\"end_time\"),\n  duration: integer(\"duration\"), // in seconds\n  fileSize: integer(\"file_size\"), // in bytes\n  transcription: text(\"transcription\"),\n  metadata: jsonb(\"metadata\"),\n});\n\nexport const transcripts = pgTable(\"transcripts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  callId: varchar(\"call_id\").references(() => calls.id),\n  speaker: text(\"speaker\").notNull(), // 'AI' | 'Human' | 'Remote'\n  text: text(\"text\").notNull(),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n  isFinal: boolean(\"is_final\").default(false),\n  confidence: integer(\"confidence\"),\n});\n\nexport const prompts = pgTable(\"prompts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  callId: varchar(\"call_id\").references(() => calls.id),\n  prompt: text(\"prompt\").notNull(),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n  applied: boolean(\"applied\").default(false),\n});\n\nexport const settings = pgTable(\"settings\", {\n  key: text(\"key\").primaryKey(),\n  value: text(\"value\").notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertFavoriteSchema = createInsertSchema(favorites).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCallSchema = createInsertSchema(calls).omit({\n  id: true,\n  startTime: true,\n  endTime: true,\n  duration: true,\n});\n\nexport const insertRecordingSchema = createInsertSchema(recordings).omit({\n  id: true,\n  startTime: true,\n  endTime: true,\n  duration: true,\n  fileSize: true,\n});\n\nexport const insertTranscriptSchema = createInsertSchema(transcripts).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertPromptSchema = createInsertSchema(prompts).omit({\n  id: true,\n  timestamp: true,\n  applied: true,\n});\n\nexport const insertSettingSchema = createInsertSchema(settings).omit({\n  updatedAt: true,\n});\n\nexport type InsertFavorite = z.infer<typeof insertFavoriteSchema>;\nexport type InsertCall = z.infer<typeof insertCallSchema>;\nexport type InsertRecording = z.infer<typeof insertRecordingSchema>;\nexport type InsertTranscript = z.infer<typeof insertTranscriptSchema>;\nexport type InsertPrompt = z.infer<typeof insertPromptSchema>;\nexport type InsertSetting = z.infer<typeof insertSettingSchema>;\n\nexport type Favorite = typeof favorites.$inferSelect;\nexport type Call = typeof calls.$inferSelect;\nexport type Recording = typeof recordings.$inferSelect;\nexport type Transcript = typeof transcripts.$inferSelect;\nexport type Prompt = typeof prompts.$inferSelect;\nexport type Setting = typeof settings.$inferSelect;\n\n// Validation schemas\nexport const phoneNumberSchema = z.string().regex(/^\\+[1-9]\\d{1,14}$/, \"Invalid E.164 format\");\nexport const dtmfToneSchema = z.enum([\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"*\", \"#\"]);\nexport const callStateSchema = z.enum([\"IDLE\", \"RINGING\", \"CONNECTED\", \"ENDED\"]);\nexport const speakerSchema = z.enum([\"AI\", \"Human\", \"Remote\"]);\nexport const providerSchema = z.enum([\"vapi\", \"retell\", \"twilio\", \"mock\"]);\n","size_bytes":4484},"client/src/components/Sidebar.tsx":{"content":"import { useCallStore } from '@/stores/useCallStore';\n\nexport function Sidebar() {\n  const { selectedProvider, activeView, setActiveView } = useCallStore();\n\n  const handleNavClick = (view: string) => {\n    setActiveView(view);\n  };\n\n  return (\n    <div className=\"w-64 bg-card border-r border-border flex-shrink-0\">\n      {/* Logo */}\n      <div className=\"p-6 border-b border-border\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-abmix-green to-green-400 flex items-center justify-center\">\n            <i className=\"fas fa-phone text-black text-sm\"></i>\n          </div>\n          <h1 className=\"text-xl font-bold text-abmix-green\">Abmix</h1>\n        </div>\n        <p className=\"text-sm text-muted-foreground mt-1\">Sistema de Discagem</p>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"p-4 space-y-2\">\n        <button \n          onClick={() => handleNavClick('discagem')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'discagem' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-dial\"\n        >\n          <i className=\"fas fa-phone-alt w-4\"></i>\n          <span className={activeView === 'discagem' ? 'font-medium' : ''}>Discagem</span>\n        </button>\n        \n        <button \n          onClick={() => handleNavClick('vozes')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'vozes' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-voices\"\n        >\n          <i className=\"fas fa-volume-up w-4\"></i>\n          <span className={activeView === 'vozes' ? 'font-medium' : ''}>Vozes & TTS</span>\n        </button>\n\n        <button \n          onClick={() => handleNavClick('enhancer')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'enhancer' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-enhancer\"\n        >\n          <i className=\"fas fa-magic w-4\"></i>\n          <span className={activeView === 'enhancer' ? 'font-medium' : ''}>Voz Natural</span>\n        </button>\n        \n        <button \n          onClick={() => handleNavClick('audio')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'audio' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-audio\"\n        >\n          <i className=\"fas fa-music w-4\"></i>\n          <span className={activeView === 'audio' ? 'font-medium' : ''}>√Åudio & Efeitos</span>\n        </button>\n        \n        <button \n          onClick={() => handleNavClick('chamadas')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'chamadas' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-calls\"\n        >\n          <i className=\"fas fa-phone-volume w-4\"></i>\n          <span className={activeView === 'chamadas' ? 'font-medium' : ''}>Chamadas</span>\n        </button>\n        \n        <button \n          onClick={() => handleNavClick('favoritos')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'favoritos' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-favorites\"\n        >\n          <i className=\"fas fa-star w-4\"></i>\n          <span className={activeView === 'favoritos' ? 'font-medium' : ''}>Favoritos</span>\n        </button>\n        \n        <button \n          onClick={() => handleNavClick('gravacoes')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'gravacoes' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-recordings\"\n        >\n          <i className=\"fas fa-microphone w-4\"></i>\n          <span className={activeView === 'gravacoes' ? 'font-medium' : ''}>Grava√ß√µes</span>\n        </button>\n        \n        <button \n          onClick={() => handleNavClick('configuracoes')}\n          className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors ${\n            activeView === 'configuracoes' \n              ? 'bg-abmix-green/10 text-abmix-green' \n              : 'hover:bg-muted text-muted-foreground'\n          }`}\n          data-testid=\"nav-settings\"\n        >\n          <i className=\"fas fa-cog w-4\"></i>\n          <span className={activeView === 'configuracoes' ? 'font-medium' : ''}>Configura√ß√µes</span>\n        </button>\n      </nav>\n\n      {/* Provider Status */}\n      <div className=\"absolute bottom-4 left-4 right-4\">\n        <div className=\"bg-dark-border/50 rounded-lg p-3\">\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm text-gray-400\">Provider</span>\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-2 h-2 bg-abmix-green rounded-full\"></div>\n              <span className=\"text-sm text-white capitalize\" data-testid=\"provider-status\">{selectedProvider}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5881},"server/healthCheck.ts":{"content":"// Health check endpoint para verificar se as vari√°veis est√£o dispon√≠veis no ambiente p√∫blico\nimport { Request, Response } from 'express';\n\nexport function setupHealthCheck(app: any) {\n  // Endpoint para verificar sa√∫de do sistema (Docker health check)\n  app.get('/api/health', (req: Request, res: Response) => {\n    // Health check simples para Docker/Kubernetes\n    res.status(200).json({\n      status: 'ok',\n      timestamp: new Date().toISOString(),\n      environment: process.env.NODE_ENV || 'development',\n      uptime: process.uptime()\n    });\n  });\n\n  // Endpoint detalhado para verificar configura√ß√£o (uso interno)\n  app.get('/api/health/detailed', (req: Request, res: Response) => {\n    const requiredEnvVars = [\n      'ELEVENLABS_API_KEY',\n      'DEEPGRAM_API_KEY',\n      'FALEVONO_PASSWORD'\n    ];\n\n    const optionalEnvVars: string[] = [];\n\n    const envStatus: { [key: string]: boolean } = {};\n    const missingRequired: string[] = [];\n\n    requiredEnvVars.forEach(envVar => {\n      const isPresent = !!process.env[envVar];\n      envStatus[envVar] = isPresent;\n      \n      if (!isPresent) {\n        missingRequired.push(envVar);\n      }\n    });\n\n    optionalEnvVars.forEach(envVar => {\n      envStatus[envVar] = !!process.env[envVar];\n    });\n\n    const isHealthy = missingRequired.length === 0;\n\n    res.json({\n      status: isHealthy ? 'healthy' : 'unhealthy',\n      timestamp: new Date().toISOString(),\n      environment: process.env.NODE_ENV || 'development',\n      uptime: process.uptime(),\n      missing_required: missingRequired,\n      variables_status: envStatus,\n      message: isHealthy \n        ? 'Todas as vari√°veis obrigat√≥rias est√£o configuradas' \n        : `${missingRequired.length} vari√°veis obrigat√≥rias faltando: ${missingRequired.join(', ')}`\n    });\n  });\n\n  // Endpoint espec√≠fico para validar chaves da API\n  app.post('/api/validate-keys', async (req: Request, res: Response) => {\n    const results: { [key: string]: { valid: boolean; error?: string } } = {};\n\n    // Teste ElevenLabs\n    try {\n      const elevenlabsKey = process.env.ELEVENLABS_API_KEY;\n      if (!elevenlabsKey) {\n        results.elevenlabs = { valid: false, error: 'API key not found' };\n      } else {\n        const response = await fetch('https://api.elevenlabs.io/v1/user', {\n          headers: { 'xi-api-key': elevenlabsKey }\n        });\n        results.elevenlabs = { \n          valid: response.ok,\n          error: response.ok ? undefined : `HTTP ${response.status}: ${response.statusText}`\n        };\n      }\n    } catch (error) {\n      results.elevenlabs = { \n        valid: false, \n        error: error instanceof Error ? error.message : 'Unknown error' \n      };\n    }\n\n\n    // Teste Deepgram\n    try {\n      const deepgramKey = process.env.DEEPGRAM_API_KEY;\n      if (!deepgramKey) {\n        results.deepgram = { valid: false, error: 'API key not found' };\n      } else {\n        const response = await fetch('https://api.deepgram.com/v1/projects', {\n          headers: { 'Authorization': `Token ${deepgramKey}` }\n        });\n        results.deepgram = { \n          valid: response.ok,\n          error: response.ok ? undefined : `HTTP ${response.status}: ${response.statusText}`\n        };\n      }\n    } catch (error) {\n      results.deepgram = { \n        valid: false, \n        error: error instanceof Error ? error.message : 'Unknown error' \n      };\n    }\n\n    const allValid = Object.values(results).every(result => result.valid);\n\n    res.json({\n      status: allValid ? 'all_valid' : 'some_invalid',\n      timestamp: new Date().toISOString(),\n      results,\n      summary: {\n        total: Object.keys(results).length,\n        valid: Object.values(results).filter(r => r.valid).length,\n        invalid: Object.values(results).filter(r => !r.valid).length\n      }\n    });\n  });\n}","size_bytes":3816},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"replit.md":{"content":"# Abmix - Sistema de Discagem Inteligente\n\n## Overview\n\nAbmix is an AI-powered telephony system for intelligent voice calls, offering real-time transcription, AI agent control, and advanced call management. It provides a unified interface for outbound calls, AI conversation flow management, live prompt injection, and real-time Portuguese transcription. The system integrates **FaleVono** as the sole telephony provider via SIP protocol, ElevenLabs for voice synthesis, and Deepgram for speech-to-text, forming a complete conversational AI telephony solution with a modern web application.\n\n**Deployment Port:** 8080 (configured for EasyPanel VPS deployment)  \n**Telephony Provider:** FaleVono (vono2.me:5060) - SIP only\n\n## Recent Changes (November 04, 2025 - 20:15) üöÄ CORRE√á√ïES FINAIS - PRONTO PARA DEPLOY\n\n### SISTEMA 100% PRONTO PARA PRODU√á√ÉO NO EASYPANEL ‚úÖ\n- ‚úÖ **Erro de Produ√ß√£o Corrigido**: Dynamic imports (`await import('./vite.js')`) em `server/index.ts`\n  - Vite n√£o ser√° inclu√≠do no bundle de produ√ß√£o (90.8kb ESM)\n  - Resolve erro `Cannot find package 'vite'` no ambiente EasyPanel\n  - Log helper removido, console.log padr√£o usado\n- ‚úÖ **Erros LSP Zerados**: Tipos `(info: any)` adicionados em `server/telephony.ts` linhas 111 e 120\n- ‚úÖ **UI Dark Mode Consistente**: `VoiceConversionControl.tsx` completamente atualizado\n  - Todas as cores hard-coded removidas (blue-50, green-50, etc)\n  - Palette dark: `bg-dark-surface`, `text-muted-foreground`, `bg-abmix-green/10`\n  - Badge ativo: `bg-abmix-green text-black`\n  - Banners: `bg-dark-bg border-dark-border`\n- ‚úÖ **UI Limpa**: `Settings.tsx` substituiu bot√£o \"Twilio\" por \"FaleVono\"\n- ‚úÖ **Aprovado pelo Architect**: PASS - \"Ready for EasyPanel deployment\"\n\n### Arquivos Modificados:\n- `server/index.ts` - Dynamic imports para vite.js\n- `server/telephony.ts` - Tipos adicionados aos callbacks WebSocket\n- `client/src/components/VoiceConversionControl.tsx` - Dark mode completo\n- `client/src/components/Settings.tsx` - FaleVono ao inv√©s de Twilio\n\n---\n\n## Recent Changes (November 04, 2025 - 19:35) üßπ LIMPEZA COMPLETA TWILIO/SOBREIP\n\n### SISTEMA 100% FALEVONO - C√ìDIGO LIMPO ‚úÖ\n- ‚úÖ **Pacote Twilio Removido**: `npm uninstall twilio` - depend√™ncia completamente removida\n- ‚úÖ **Providers Eliminados**: Deletados `sobreipProvider.ts` e toda l√≥gica Twilio\n- ‚úÖ **Backend Limpo**: `providerFactory.ts` aceita apenas 'falevono'\n- ‚úÖ **Frontend Simplificado**: VoIPNumbers.tsx mostra apenas op√ß√£o FaleVono\n- ‚úÖ **Banco de Dados**: CHECK constraint atualizado para `provider IN ('falevono')`\n- ‚úÖ **Health Check**: Removidas checagens Twilio/SobreIP\n- ‚úÖ **Routes Limpo**: Valida√ß√£o FALEVONO_PASSWORD, rotas SobreIP removidas\n- ‚úÖ **Telephony.ts Limpo**: Imports, rotas e callbacks Twilio removidos\n- ‚úÖ **Vari√°veis de Ambiente**: `.env.example`, `docker-compose.yml`, `DEPLOY.md` limpos\n- ‚úÖ **Porta 8080 Confirmada**: DEPLOY.md atualizado com porta correta\n- ‚úÖ **Build Validado**: ESM (90.5kb) sem erros, servidor rodando perfeitamente\n\n### Arquivos Modificados:\n- `package.json` - Twilio removido das depend√™ncias\n- `server/providers/providerFactory.ts` - Apenas FaleVono\n- `server/routes.ts` - Valida√ß√£o FALEVONO_PASSWORD\n- `server/healthCheck.ts` - Sem checagens alternativas\n- `server/database.ts` - CHECK (`provider` IN ('falevono'))\n- `server/telephony.ts` - Imports e rotas Twilio removidos\n- `server/index.ts` - Logs de debug Twilio removidos\n- `client/src/components/VoIPNumbers.tsx` - Apenas FaleVono no dropdown\n- `.env.example` - Apenas FALEVONO_PASSWORD\n- `docker-compose.yml` - Apenas FALEVONO_PASSWORD\n- `DEPLOY.md` - Porta 8080, sem refer√™ncias SobreIP\n- **Deletado**: `server/providers/sobreipProvider.ts`\n\n### Sistema Pronto Para Deploy:\n```bash\nnpm run build   # ‚úÖ 90.5kb ESM - OK\nnpm run dev     # ‚úÖ Running na porta 5000 (dev) - OK\n# Production: porta 8080 autom√°tica via ENV\n```\n\n---\n\n## Recent Changes (November 04, 2025 - 19:00) üéØ CONFIGURA√á√ÉO FINAL ESM + PORTA 8080\n\n### DECIS√ÉO T√âCNICA FINAL: ESM (ECMAScript Modules) ‚úÖ\n- ‚úÖ **package.json**: `\"type\": \"module\"` confirmado como correto\n- ‚úÖ **Build**: `format=esm` ‚Üí `dist/index.js` (105.6kb)\n- ‚úÖ **Porta**: Alterada de 5000 ‚Üí **8080** (porta livre no VPS)\n- ‚úÖ **Dockerfile**: EXPOSE 8080, ENV PORT=8080, healthcheck atualizado\n- ‚úÖ **docker-compose.yml**: PORT=8080, network_mode: host (obrigat√≥rio para SIP)\n- ‚úÖ **Import SIP**: Corrigido `sip/digest` ‚Üí `sip/digest.js` (ESM requer extens√µes)\n- ‚úÖ **Servidor Production**: Testado e funcionando perfeitamente na porta 8080\n\n### Por Que ESM √© a Escolha Correta:\n1. **Vite Nativo**: Plugins Replit e vite.config.mjs requerem ESM\n2. **Node.js 20**: Recomenda ESM como padr√£o moderno\n3. **Top-level await**: Funciona apenas com ESM\n4. **Build Validado**: 4 testes confirmaram funcionamento perfeito\n5. **CommonJS Falhou**: Problemas t√©cnicos insol√∫veis (await, import.meta, plugins)\n\n### Configura√ß√£o para EasyPanel:\n```\nExpose Port: 8080\nNetwork Mode: host (CR√çTICO para SIP/UDP)\nEnvironment Variables:\n  - PORT=8080\n  - NODE_ENV=production\n  - FALEVONO_PASSWORD=...\n  - ELEVENLABS_API_KEY=...\n  - DEEPGRAM_API_KEY=...\n```\n\n---\n\n## Recent Changes (November 04, 2025 - 16:50) üìö TUTORIAL DE DEPLOY COMPLETO\n\n### DEPLOY.md COMPLETAMENTE REESCRITO - PRONTO PARA USO üéâ\n- ‚úÖ **Tutorial Completo**: 580+ linhas de documenta√ß√£o detalhada passo-a-passo\n- ‚úÖ **12 Se√ß√µes Estruturadas**: Sum√°rio naveg√°vel desde setup at√© troubleshooting\n- ‚úÖ **Linguagem Simples**: Instru√ß√µes claras para usu√°rios n√£o-t√©cnicos\n- ‚úÖ **Destaque para Configura√ß√µes Cr√≠ticas**: Network Mode = host (OBRIGAT√ìRIO para SIP)\n- ‚úÖ **Tabelas de Configura√ß√£o**: Copy-paste f√°cil para todas as configura√ß√µes\n- ‚úÖ **Links Diretos**: Como obter API keys (ElevenLabs, Deepgram)\n- ‚úÖ **Deploy vs Redeploy**: Diferen√ßa clara entre primeiro deploy e atualiza√ß√µes\n- ‚úÖ **7 Testes de Funcionamento**: Health check, logs SIP, chamada teste, SSL\n- ‚úÖ **9 Problemas Comuns**: Troubleshooting expandido com solu√ß√µes detalhadas\n- ‚úÖ **Checklist de 20 Itens**: Valida√ß√£o completa antes de considerar deploy finalizado\n- ‚úÖ **Monitoramento**: Logs, m√©tricas, backup, comandos √∫teis SSH\n\n### Se√ß√µes Principais do DEPLOY.md:\n1. Vis√£o Geral - Entendimento do fluxo completo\n2. Pr√©-requisitos - Tabela com tudo que √© necess√°rio\n3. Preparar GitHub - Como garantir c√≥digo atualizado\n4. Conectar EasyPanel - Autoriza√ß√£o e configura√ß√£o passo-a-passo\n5. Criar Aplica√ß√£o - Onde clicar e o que preencher\n6. Vari√°veis de Ambiente - 5 vari√°veis obrigat√≥rias + links para obter API keys\n7. Configura√ß√µes Avan√ßadas - Network Mode = host (CR√çTICO!)\n8. Deploy Inicial - Processo de build e verifica√ß√£o\n9. Verificar Funcionamento - Testes web, health check, logs SIP, chamada teste\n10. Redeploy - Como atualizar o sistema ap√≥s mudan√ßas\n11. Troubleshooting - 9 problemas comuns + solu√ß√µes\n12. Checklist Final - 20 itens para validar deploy completo\n\n### Melhorias de Usabilidade:\n- üéØ **Avisos Visuais**: Caixas de aten√ß√£o para configura√ß√µes cr√≠ticas\n- üìä **Tabelas Organizadas**: Configura√ß√µes, portas, vari√°veis de ambiente\n- üîó **Links √öteis**: FaleVono, ElevenLabs, Deepgram, Let's Encrypt\n- üíª **Comandos SSH**: Debug e manuten√ß√£o do container\n- ‚úÖ **Mensagens Esperadas**: Exemplos de logs corretos vs erros\n\n---\n\n## Recent Changes (November 03, 2025 - 23:09) üöÄ PREPARADO PARA DEPLOY VPS\n\n### DEPLOY EM VPS COM EASYPANEL - PRONTO PARA PRODU√á√ÉO üéâ\n- ‚úÖ **Dockerfile Criado**: Multi-stage build otimizado para Node.js 20 Alpine (ESM)\n- ‚úÖ **docker-compose.yml**: Configura√ß√£o completa com network mode host para SIP/UDP\n- ‚úÖ **.dockerignore**: Otimiza√ß√£o de build removendo arquivos desnecess√°rios\n- ‚úÖ **.env.example**: Template com todas as vari√°veis necess√°rias (FaleVono + AI services)\n- ‚úÖ **Health Check Atualizado**: Endpoints /api/health (simples) e /api/health/detailed\n- ‚ö†Ô∏è **Limita√ß√£o Replit**: SIP/UDP n√£o funciona no Replit (firewall bloqueia) - **deploy em VPS √© obrigat√≥rio**\n\n### Arquivos de Deploy Criados:\n- `Dockerfile` - Container production-ready (ESM format)\n- `docker-compose.yml` - Orquestra√ß√£o com portas UDP (5060/6060)\n- `.dockerignore` - Otimiza√ß√£o de build\n- `.env.example` - Template de vari√°veis\n- `DEPLOY.md` - Guia completo de deploy (580+ linhas)\n\n### Como Fazer Deploy:\n1. Fazer push do c√≥digo para GitHub\n2. Criar app no EasyPanel conectando reposit√≥rio\n3. Adicionar vari√°veis de ambiente (FALEVONO_PASSWORD, ELEVENLABS_API_KEY, DEEPGRAM_API_KEY)\n4. **IMPORTANTE**: Configurar Network Mode = `host` (permite SIP/UDP)\n5. Deploy (1 clique)\n\nVeja detalhes completos em: **DEPLOY.md**\n\n---\n\n## Recent Changes (November 03, 2025 - 22:34) ‚úÖ APROVADO PELO ARCHITECT\n\n### CORRE√á√ÉO CR√çTICA: CONFLITO DE ROTAS RESOLVIDO üîß\n- ‚úÖ **Problema Identificado**: Rotas duplicadas em `telephony.ts` e `routes.ts` causavam uso do Twilio (n√£o configurado) ao inv√©s do FaleVono SIP\n- ‚úÖ **Solu√ß√£o Implementada**: \n  - Rotas `/api/call/dial` e `/api/call/hangup` comentadas em `telephony.ts` (linhas 153-178)\n  - Backend `routes.ts` corrigido para aceitar campo `to` (ao inv√©s de `phoneNumber`)\n  - Frontend alinhado para enviar `{ to, voipNumberId, voiceType }`\n- ‚úÖ **Formato de N√∫mero Padronizado**: DDD+n√∫mero sem prefixo +55 (ex: `11999999999`)\n- ‚úÖ **Fluxo Completo Validado**: Frontend ‚Üí routes.ts ‚Üí ProviderFactory ‚Üí SIPService (FaleVono)\n- ‚úÖ **APROVADO PELO ARCHITECT**: \"PASS ‚Äî dialing now uses the `to` field consistently end-to-end and the SIP flow is aligned\"\n\n### INTEGRA√á√ÉO SIP REAL COMPLETA - PRONTA PARA PRODU√á√ÉO üéâ\n- ‚úÖ **Biblioteca SIP Instalada**: Pacote `sip` do npm com m√≥dulo `digest` integrado\n- ‚úÖ **SIPService Production-Ready**: Classe TypeScript completa (550+ linhas)\n- ‚úÖ **Autentica√ß√£o Digest Completa**: \n  - REGISTER: Handler 401/407 com digest.challenge + digest.signRequest\n  - INVITE: M√©todo reInviteWithAuth para re-autentica√ß√£o autom√°tica\n  - Sessions separadas para registro vs. chamadas individuais\n- ‚úÖ **Endere√ßamento de Rede Correto**:\n  - IP real detectado via hostname (172.31.70.162)\n  - Contact URIs e SDP usam IP rote√°vel\n  - Porta client consistente (6060)\n- ‚úÖ **Di√°logos SIP RFC-Compliant**:\n  - ACK usa Contact URI do 200 OK (n√£o Request-URI)\n  - BYE usa dialog.remote correto (headers.to com tag)\n  - CANCEL preserva Via/branch/tag do INVITE original\n  - Dialog tracking: local, remote, inviteRequest, lastResponse, cseq\n- ‚úÖ **Gest√£o de Estado Robusta**: Tracking completo, erros detalhados, flag registered\n- ‚úÖ **APROVADO PELO ARCHITECT**: \"PASS ‚Äì dialog state correctly tracks remote leg, BYE/INFO will address callee\"\n\n### Sistema Pronto Para:\n- üìû **Fazer Chamadas Reais**: REGISTER + INVITE autenticado para vono2.me:5060\n- üì¥ **Desligar Chamadas**: BYE/CANCEL RFC-compliant\n- üî¢ **Enviar DTMF**: INFO com headers corretos\n- üîê **Autentica√ß√£o Autom√°tica**: Responde a desafios 401/407\n\n### Limita√ß√£o Conhecida:\n- ‚ö†Ô∏è **RTP/√Åudio**: Biblioteca `sip` faz apenas sinaliza√ß√£o - √°udio requer biblioteca RTP separada\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\nThe client-side is a React with TypeScript application utilizing modern UI patterns. It employs a component-based design with shadcn/ui and Tailwind CSS for styling and responsiveness. Key decisions include React + TypeScript for type safety, Zustand for state management, TanStack Query for server state, Wouter for routing, and WebSocket for real-time communication.\n\n### Backend Architecture\nThe server uses Express.js with TypeScript, providing a REST API and WebSocket support. It features a provider pattern for telephony services (e.g., FaleVono, SobreIP, Twilio) and modular service organization. SQLite is used for local persistence of VoIP numbers, calls, recordings, and favorites. Sensitive credentials are stored exclusively in environment variables.\n\n### Data Storage Solutions\nThe system currently uses in-memory storage with interfaces designed for future database migration. Drizzle ORM is configured for PostgreSQL with schema definitions for calls, transcripts, and prompts.\n\n### Real-time Communication\nWebSocket integration enables bi-directional communication for call state updates, live transcription streaming, AI agent status changes, latency monitoring, and error notifications.\n\n## External Dependencies\n\n### Telephony Providers\n- **FaleVono**: Primary Brazilian VoIP provider via SIP protocol.\n- **SobreIP**: Alternative Brazilian VoIP provider.\n- **Twilio**: Optional alternative for granular telephony control with Media Streams.\n- **Vapi**: (Future integration) AI voice platform.\n- **Retell AI**: (Future integration) Alternative AI voice provider.\n\n### AI and Speech Services\n- **ElevenLabs**: Primary TTS/STT service for Portuguese voice synthesis and transcription via WebSocket.\n- **Deepgram**: For real-time Portuguese speech-to-text transcription.\n- **OpenAI**: Integrated for AI conversation logic and live prompt injection.\n\n### Frontend Dependencies\n- **shadcn/ui**: React component library built on Radix UI.\n- **Radix UI**: Unstyled, accessible component primitives.\n- **Tailwind CSS**: Utility-first CSS framework.\n- **Lucide React**: Icon library.\n- **React Hook Form**: Form handling with validation.\n\n### Development and Build Tools\n- **Vite**: Fast build tool and development server.\n- **TypeScript**: Static typing for frontend and backend.\n- **Drizzle Kit**: Database migration and schema management.","size_bytes":13678},"scripts/diagnose-and-fix.sh":{"content":"#!/bin/bash\n\necho \"üîç DIAGN√ìSTICO COMPLETO - AbmixDialer\"\necho \"==================================\"\n\n# Cores para output\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\necho -e \"${BLUE}1. Verificando processos Node.js...${NC}\"\nps aux | grep node | grep -v grep\necho \"\"\n\necho -e \"${BLUE}2. Verificando porta 5001...${NC}\"\nss -ltnp | grep :5001\nif [ $? -eq 0 ]; then\n    echo -e \"${GREEN}‚úÖ Porta 5001 est√° em uso${NC}\"\nelse\n    echo -e \"${RED}‚ùå Porta 5001 n√£o est√° em uso${NC}\"\nfi\necho \"\"\n\necho -e \"${BLUE}3. Verificando PM2...${NC}\"\npm2 status\necho \"\"\n\necho -e \"${BLUE}4. Verificando diret√≥rio da aplica√ß√£o...${NC}\"\nls -la /var/www/juliocamara.dev/abmix-ligacao/\necho \"\"\n\necho -e \"${BLUE}5. Verificando arquivo .env...${NC}\"\nif [ -f \"/var/www/juliocamara.dev/abmix-ligacao/.env\" ]; then\n    echo -e \"${GREEN}‚úÖ Arquivo .env existe${NC}\"\n    echo \"Conte√∫do (sem valores sens√≠veis):\"\n    grep -E \"^[A-Z_]+\" /var/www/juliocamara.dev/abmix-ligacao/.env | sed 's/=.*/=***/'\nelse\n    echo -e \"${RED}‚ùå Arquivo .env n√£o encontrado${NC}\"\nfi\necho \"\"\n\necho -e \"${BLUE}6. Verificando configura√ß√£o nginx...${NC}\"\nnginx -t\nif [ $? -eq 0 ]; then\n    echo -e \"${GREEN}‚úÖ Configura√ß√£o nginx v√°lida${NC}\"\nelse\n    echo -e \"${RED}‚ùå Erro na configura√ß√£o nginx${NC}\"\nfi\necho \"\"\n\necho -e \"${BLUE}7. Testando conectividade local...${NC}\"\ncurl -s -o /dev/null -w \"%{http_code}\" http://127.0.0.1:5001/api/health\necho \"\"\n\necho -e \"${YELLOW}üîß INICIANDO CORRE√á√ïES...${NC}\"\necho \"==================================\"\n\n# Navegar para o diret√≥rio\ncd /var/www/juliocamara.dev/abmix-ligacao/\n\necho -e \"${BLUE}1. Parando processo existente...${NC}\"\npm2 stop abmix-ligacao 2>/dev/null || echo \"Processo n√£o estava rodando\"\npm2 delete abmix-ligacao 2>/dev/null || echo \"Processo n√£o existia\"\n\necho -e \"${BLUE}2. Verificando depend√™ncias...${NC}\"\nif [ ! -d \"node_modules\" ]; then\n    echo \"Instalando depend√™ncias...\"\n    npm install --production\nfi\n\necho -e \"${BLUE}3. Configurando vari√°veis de ambiente...${NC}\"\nif [ ! -f \".env\" ]; then\n    echo \"PORT=5001\" > .env\n    echo \"NODE_ENV=production\" >> .env\n    echo -e \"${YELLOW}‚ö†Ô∏è Configure suas chaves API no arquivo .env${NC}\"\nelse\n    # Garantir que a porta esteja correta\n    if ! grep -q \"PORT=5001\" .env; then\n        echo \"PORT=5001\" >> .env\n    fi\nfi\n\necho -e \"${BLUE}4. Ajustando permiss√µes...${NC}\"\nchown -R www-data:www-data /var/www/juliocamara.dev/abmix-ligacao/\nchmod -R 755 /var/www/juliocamara.dev/abmix-ligacao/\n\necho -e \"${BLUE}5. Iniciando aplica√ß√£o...${NC}\"\nPORT=5001 pm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\necho -e \"${BLUE}6. Recarregando nginx...${NC}\"\nsystemctl reload nginx\n\necho \"\"\necho -e \"${GREEN}üéâ CORRE√á√ïES APLICADAS!${NC}\"\necho \"==================================\"\n\necho -e \"${BLUE}Verifica√ß√£o final:${NC}\"\nsleep 3\npm2 status\necho \"\"\n\necho -e \"${BLUE}Teste de conectividade:${NC}\"\ncurl -s -o /dev/null -w \"Status: %{http_code}\\n\" http://127.0.0.1:5001/api/health\n\necho \"\"\necho -e \"${GREEN}‚úÖ Acesse: https://juliocamara.dev/abmix-ligacao/${NC}\"\necho -e \"${YELLOW}üìã Para WebSocket use: wss://juliocamara.dev/abmix-ligacao/media${NC}\"\necho \"\"\n\n\n\n\n","size_bytes":3220},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/VoiceSelector.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\n\ninterface VoiceSelectorProps {\n  value: 'masc' | 'fem';\n  onChange: (value: 'masc' | 'fem') => void;\n}\n\nexport function VoiceSelector({ value, onChange }: VoiceSelectorProps) {\n  return (\n    <div className=\"space-y-2\">\n      <label className=\"text-sm font-medium text-foreground\">\n        Tipo de Voz\n      </label>\n      <Select value={value} onValueChange={onChange}>\n        <SelectTrigger className=\"w-full\" data-testid=\"select-voice-type\">\n          <SelectValue placeholder=\"Selecione o tipo de voz\" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"masc\" data-testid=\"voice-masc\">\n            Masculina\n          </SelectItem>\n          <SelectItem value=\"fem\" data-testid=\"voice-fem\">\n            Feminina\n          </SelectItem>\n        </SelectContent>\n      </Select>\n    </div>\n  );\n}","size_bytes":1016},"scripts/deploy-juliocamara.sh":{"content":"#!/bin/bash\n\n# Deploy espec√≠fico para juliocamara.dev/abmix-ligacao\nVPS_HOST=\"usuario@juliocamara.dev\"  # Substitua 'usuario' pelo seu usu√°rio SSH\nVPS_PATH=\"/var/www/abmix-ligacao\"\nDOMAIN=\"juliocamara.dev\"\nSUBPATH=\"/abmix-ligacao\"\n\necho \"üöÄ Deploy do Abmix Dialer para $DOMAIN$SUBPATH\"\necho \"üì° Servidor: $VPS_HOST\"\necho \"üìÅ Destino: $VPS_PATH\"\necho \"\"\n\n# 1. Build local\necho \"üì¶ 1. Fazendo build do projeto...\"\nnpm run build\n\nif [ ! -f \"dist/index.js\" ]; then\n    echo \"‚ùå Erro: Build falhou. Arquivo dist/index.js n√£o encontrado.\"\n    exit 1\nfi\n\necho \"‚úÖ Build conclu√≠do\"\n\n# 2. Verificar conex√£o SSH\necho \"\"\necho \"üîó 2. Testando conex√£o SSH...\"\nssh -o BatchMode=yes -o ConnectTimeout=5 $VPS_HOST exit\nif [ $? -ne 0 ]; then\n    echo \"‚ùå Erro: N√£o foi poss√≠vel conectar via SSH\"\n    echo \"   Comando para testar: ssh $VPS_HOST\"\n    exit 1\nfi\necho \"‚úÖ Conex√£o SSH funcionando\"\n\n# 3. Preparar arquivos\necho \"\"\necho \"üìÅ 3. Preparando arquivos para deploy...\"\n\n# Copiar .env de produ√ß√£o\ncp production.env .env.production\n\necho \"‚úÖ Arquivos preparados\"\n\n# 4. Sync arquivos para VPS\necho \"\"\necho \"üì§ 4. Enviando arquivos para VPS...\"\n\n# Criar diret√≥rio se n√£o existir\nssh $VPS_HOST \"sudo mkdir -p $VPS_PATH && sudo chown \\$USER:www-data $VPS_PATH\"\n\n# Enviar arquivos essenciais\nrsync -avz --progress \\\n    --include='dist/' \\\n    --include='dist/**' \\\n    --include='package.json' \\\n    --include='package-lock.json' \\\n    --include='.env.production' \\\n    --include='data/' \\\n    --include='data/**' \\\n    --include='recordings/' \\\n    --include='recordings/**' \\\n    --include='shared/' \\\n    --include='shared/**' \\\n    --include='juliocamara.dev' \\\n    --exclude='*' \\\n    ./ $VPS_HOST:$VPS_PATH/\n\nif [ $? -ne 0 ]; then\n    echo \"‚ùå Erro no envio de arquivos\"\n    exit 1\nfi\n\necho \"‚úÖ Arquivos enviados com sucesso\"\n\n# 5. Configurar na VPS\necho \"\"\necho \"üîß 5. Configurando na VPS...\"\n\nssh $VPS_HOST << EOF\ncd $VPS_PATH\n\necho \"üìù Configurando .env para produ√ß√£o...\"\nmv .env.production .env\n\necho \"üì¶ Instalando depend√™ncias...\"\nnpm install --production --silent\n\necho \"üõë Parando processo anterior (se existir)...\"\npm2 stop abmix-ligacao 2>/dev/null || echo \"   (Nenhum processo anterior encontrado)\"\n\necho \"üöÄ Iniciando processo...\"\npm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\necho \"üíæ Salvando configura√ß√£o PM2...\"\npm2 save\n\necho \"\"\necho \"üìä Status do processo:\"\npm2 status abmix-ligacao\n\necho \"\"\necho \"üîç √öltimas linhas do log:\"\npm2 logs abmix-ligacao --lines 5 --nostream\n\necho \"\"\necho \"üìã Configurando Nginx...\"\nsudo cp juliocamara.dev /etc/nginx/sites-available/\nsudo nginx -t\nif [ \\$? -eq 0 ]; then\n    sudo systemctl reload nginx\n    echo \"‚úÖ Nginx recarregado com sucesso\"\nelse\n    echo \"‚ùå Erro na configura√ß√£o do Nginx\"\nfi\nEOF\n\n# 6. Teste final\necho \"\"\necho \"üß™ 6. Testando deploy...\"\n\necho \"   Aguardando servidor inicializar...\"\nsleep 10\n\necho \"   Testando: https://$DOMAIN$SUBPATH/api/health\"\n\nHTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"https://$DOMAIN$SUBPATH/api/health\" || echo \"000\")\n\nif [ \"$HTTP_STATUS\" = \"200\" ]; then\n    echo \"‚úÖ DEPLOY BEM-SUCEDIDO!\"\n    echo \"\"\n    echo \"üéâ SEU SISTEMA DE CONVERS√ÉO DE VOZ EST√Å FUNCIONANDO!\"\n    echo \"\"\n    echo \"üì± Acesse: https://$DOMAIN$SUBPATH\"\n    echo \"üé§ Teste convers√£o: Fa√ßa uma liga√ß√£o e ative o switch\"\n    echo \"\"\n    echo \"üîó URLs importantes:\"\n    echo \"   ‚Ä¢ Painel: https://$DOMAIN$SUBPATH\"\n    echo \"   ‚Ä¢ API Health: https://$DOMAIN$SUBPATH/api/health\"\n    echo \"   ‚Ä¢ WebSocket Media: wss://$DOMAIN$SUBPATH/media\"\n    echo \"   ‚Ä¢ WebSocket Captions: wss://$DOMAIN$SUBPATH/captions\"\n    echo \"\"\n    echo \"üìä Monitoramento:\"\n    echo \"   ssh $VPS_HOST\"\n    echo \"   pm2 logs abmix-ligacao    # Ver logs\"\n    echo \"   pm2 status               # Status dos processos\"\n    echo \"   pm2 restart abmix-ligacao # Reiniciar se necess√°rio\"\n    \nelif [ \"$HTTP_STATUS\" = \"000\" ]; then\n    echo \"‚ö†Ô∏è  N√£o foi poss√≠vel testar (poss√≠vel problema de rede)\"\n    echo \"   Teste manualmente: https://$DOMAIN$SUBPATH\"\n    echo \"   Verifique logs: ssh $VPS_HOST 'pm2 logs abmix-ligacao'\"\n    \nelse\n    echo \"‚ùå Erro: Servidor respondeu com status $HTTP_STATUS\"\n    echo \"   Verifique os logs: ssh $VPS_HOST 'pm2 logs abmix-ligacao'\"\n    echo \"   Verifique Nginx: ssh $VPS_HOST 'sudo nginx -t'\"\nfi\n\necho \"\"\necho \"üìã CONFIGURA√á√ïES FINAIS:\"\necho \"   ‚úÖ Nginx configurado para subpath /abmix-ligacao\"\necho \"   ‚úÖ WebSockets configurados para media streaming\"\necho \"   ‚úÖ SSL funcionando (HTTPS obrigat√≥rio)\"\necho \"   ‚úÖ PM2 gerenciando processo\"\necho \"\"\necho \"üéØ PR√ìXIMO PASSO:\"\necho \"   Teste uma liga√ß√£o real com convers√£o de voz!\"\necho \"   O destinat√°rio ouvir√° sua voz modificada em tempo real!\"\n\n\n\n\n\n","size_bytes":4796},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/Header.tsx":{"content":"import { useEffect } from 'react';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { metricsService } from '@/services/metrics';\n\nexport function Header() {\n  const { callState, latency, audioLevel } = useCallStore();\n  const setLatency = useCallStore(state => state.setLatency);\n\n  // Connect to real-time metrics\n  useEffect(() => {\n    metricsService.connect((data) => {\n      setLatency(data.latencyMs);\n    });\n\n    return () => {\n      metricsService.disconnect();\n    };\n  }, [setLatency]);\n\n  const getStatusConfig = (state: string) => {\n    const configs = {\n      'IDLE': { color: 'bg-gray-500', text: 'Idle', textClass: '' },\n      'RINGING': { color: 'bg-yellow-500', text: 'Chamando...', textClass: 'text-yellow-400' },\n      'CONNECTED': { color: 'bg-abmix-green', text: 'Conectado', textClass: 'text-abmix-green' },\n      'ENDED': { color: 'bg-red-500', text: 'Encerrada', textClass: 'text-red-400' }\n    };\n    return configs[state as keyof typeof configs] || configs.IDLE;\n  };\n\n  const statusConfig = getStatusConfig(callState);\n\n  return (\n    <header className=\"bg-dark-surface border-b border-dark-border px-6 py-4\">\n      <div className=\"flex items-center justify-between\">\n        {/* Call Status */}\n        <div className=\"flex items-center space-x-6\">\n          <div className=\"flex items-center space-x-3\">\n            <div className={`w-3 h-3 ${statusConfig.color} rounded-full`} data-testid=\"status-indicator\"></div>\n            <span className={`text-lg font-semibold ${statusConfig.textClass}`} data-testid=\"call-state\">\n              {statusConfig.text}\n            </span>\n          </div>\n          <div className=\"text-sm text-gray-400\">\n            Lat√™ncia: <span className=\"text-abmix-green\" data-testid=\"latency-display\">\n              {latency > 0 ? `${Math.round(latency)} ms` : '-- ms'}\n            </span>\n          </div>\n        </div>\n\n        {/* Audio Indicator */}\n        <div className=\"flex items-center space-x-4\">\n          <div className=\"flex items-center space-x-2\">\n            <i className=\"fas fa-microphone text-gray-400\"></i>\n            <div className=\"w-16 h-2 bg-dark-border rounded-full overflow-hidden\">\n              <div \n                className=\"h-full bg-abmix-green transition-all duration-150\" \n                style={{ width: `${audioLevel}%` }}\n                data-testid=\"audio-level\"\n              ></div>\n            </div>\n          </div>\n          <button className=\"p-2 hover:bg-dark-border rounded-lg transition-colors\" data-testid=\"volume-button\">\n            <i className=\"fas fa-volume-up text-gray-400\"></i>\n          </button>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":2681},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/DTMFKeypad.tsx":{"content":"import { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { api } from '@/services/api';\n\nexport function DTMFKeypad() {\n  const { toast } = useToast();\n  const { currentCallId, callState } = useCallStore();\n\n  const sendDTMFMutation = useMutation({\n    mutationFn: (digits: string) => api.sendDTMF(currentCallId!, digits),\n    onSuccess: (data, digits) => {\n      toast({\n        title: \"DTMF enviado\",\n        description: `Tom \"${digits}\" transmitido`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao enviar DTMF\",\n        description: error instanceof Error ? error.message : \"Falha na transmiss√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleKeyPress = (digit: string) => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        description: \"Inicie uma chamada para usar o teclado\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (callState !== 'CONNECTED') {\n      toast({\n        title: \"Chamada n√£o conectada\",\n        description: \"Aguarde a conex√£o para usar o teclado\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    sendDTMFMutation.mutate(digit);\n  };\n\n  const keypadLayout = [\n    ['1', '2', '3'],\n    ['4', '5', '6'],\n    ['7', '8', '9'],\n    ['*', '0', '#']\n  ];\n\n  const isDisabled = !currentCallId || callState !== 'CONNECTED' || sendDTMFMutation.isPending;\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Teclado DTMF</h3>\n      \n      <div className=\"grid grid-cols-3 gap-3\">\n        {keypadLayout.flat().map((digit) => (\n          <Button\n            key={digit}\n            variant=\"outline\"\n            onClick={() => handleKeyPress(digit)}\n            disabled={isDisabled}\n            className=\"h-12 text-lg font-semibold bg-dark-bg hover:bg-abmix-green hover:text-black border-dark-border disabled:opacity-50\"\n            data-testid={`dtmf-${digit}`}\n          >\n            {digit}\n          </Button>\n        ))}\n      </div>\n      \n      {isDisabled && (\n        <p className=\"text-sm text-gray-400 mt-3 text-center\">\n          {!currentCallId ? 'Inicie uma chamada para usar o teclado' : \n           callState !== 'CONNECTED' ? 'Aguarde a conex√£o' : \n           'Enviando...'}\n        </p>\n      )}\n    </div>\n  );\n}","size_bytes":2531},"client/src/components/VoiceConversionControl.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Button } from './ui/button';\nimport { Switch } from './ui/switch';\nimport { Badge } from './ui/badge';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';\nimport { Mic, MicOff, Volume2, VolumeX, Settings } from 'lucide-react';\nimport { useToast } from '../hooks/use-toast';\n\ninterface VoiceConversionControlProps {\n  callSid?: string;\n  isInCall: boolean;\n  onVoiceConversionToggle?: (enabled: boolean) => void;\n}\n\nexport function VoiceConversionControl({ \n  callSid, \n  isInCall, \n  onVoiceConversionToggle \n}: VoiceConversionControlProps) {\n  const [isEnabled, setIsEnabled] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [conversionStats, setConversionStats] = useState<any>(null);\n  const [availableVoices, setAvailableVoices] = useState<any[]>([]);\n  const { toast } = useToast();\n\n  // Fetch available voices for conversion\n  useEffect(() => {\n    const fetchVoices = async () => {\n      try {\n        const response = await fetch('/api/voice/conversion-voices');\n        if (response.ok) {\n          const voices = await response.json();\n          setAvailableVoices(voices);\n        }\n      } catch (error) {\n        console.error('Error fetching conversion voices:', error);\n      }\n    };\n\n    fetchVoices();\n  }, []);\n\n  // Fetch conversion status when call is active\n  useEffect(() => {\n    if (callSid && isInCall) {\n      const fetchStatus = async () => {\n        try {\n          const response = await fetch(`/api/voice/status/${callSid}`);\n          if (response.ok) {\n            const status = await response.json();\n            setIsEnabled(status.enabled);\n            setConversionStats(status.stats);\n          }\n        } catch (error) {\n          console.error('Error fetching voice conversion status:', error);\n        }\n      };\n\n      fetchStatus();\n      \n      // Poll status every 5 seconds during call\n      const interval = setInterval(fetchStatus, 5000);\n      return () => clearInterval(interval);\n    }\n  }, [callSid, isInCall]);\n\n  const handleToggleConversion = async () => {\n    if (!callSid) {\n      toast({\n        title: \"Erro\",\n        description: \"Nenhuma chamada ativa encontrada\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const response = await fetch('/api/voice/toggle', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          callSid,\n          enabled: !isEnabled\n        })\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        setIsEnabled(result.enabled);\n        \n        toast({\n          title: result.enabled ? \"Convers√£o de Voz Ativada\" : \"Convers√£o de Voz Desativada\",\n          description: result.enabled \n            ? \"Sua voz ser√° modificada durante a chamada\" \n            : \"Sua voz original ser√° transmitida\",\n        });\n\n        onVoiceConversionToggle?.(result.enabled);\n      } else {\n        throw new Error('Failed to toggle voice conversion');\n      }\n    } catch (error) {\n      console.error('Error toggling voice conversion:', error);\n      toast({\n        title: \"Erro\",\n        description: \"Falha ao alterar convers√£o de voz\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <Card className=\"w-full bg-dark-surface border-dark-border\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            <Settings className=\"h-4 w-4 text-abmix-green\" />\n            <CardTitle className=\"text-sm text-foreground\">Convers√£o de Voz</CardTitle>\n          </div>\n          <Badge variant={isEnabled ? \"default\" : \"secondary\"} className={isEnabled ? \"bg-abmix-green text-black\" : \"\"}>\n            {isEnabled ? \"Ativo\" : \"Inativo\"}\n          </Badge>\n        </div>\n        <CardDescription className=\"text-xs text-muted-foreground\">\n          Modifique sua voz em tempo real durante a chamada\n        </CardDescription>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        {/* Status da chamada */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            {isInCall ? (\n              <>\n                <Mic className=\"h-4 w-4 text-abmix-green\" />\n                <span className=\"text-sm text-abmix-green\">Em chamada</span>\n              </>\n            ) : (\n              <>\n                <MicOff className=\"h-4 w-4 text-muted-foreground\" />\n                <span className=\"text-sm text-muted-foreground\">Sem chamada ativa</span>\n              </>\n            )}\n          </div>\n          \n          {isInCall && callSid && (\n            <div className=\"text-xs text-muted-foreground\">\n              ID: {callSid.substring(0, 8)}...\n            </div>\n          )}\n        </div>\n\n        {/* Controle de convers√£o */}\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-2\">\n            {isEnabled ? (\n              <Volume2 className=\"h-4 w-4 text-abmix-green\" />\n            ) : (\n              <VolumeX className=\"h-4 w-4 text-muted-foreground\" />\n            )}\n            <span className=\"text-sm text-foreground\">\n              {isEnabled ? \"Voz Modificada\" : \"Voz Original\"}\n            </span>\n          </div>\n          \n          <Switch\n            checked={isEnabled}\n            onCheckedChange={handleToggleConversion}\n            disabled={!isInCall || isLoading}\n          />\n        </div>\n\n        {/* Estat√≠sticas de convers√£o */}\n        {conversionStats && isEnabled && (\n          <div className=\"bg-dark-bg p-3 rounded-lg space-y-2 border border-dark-border\">\n            <div className=\"text-xs font-medium text-foreground\">\n              Estat√≠sticas de Convers√£o\n            </div>\n            <div className=\"grid grid-cols-2 gap-2 text-xs\">\n              <div>\n                <span className=\"text-muted-foreground\">Sess√µes Ativas:</span>\n                <span className=\"ml-1 font-medium text-foreground\">{conversionStats.activeSessions}</span>\n              </div>\n              <div>\n                <span className=\"text-muted-foreground\">Lat√™ncia M√©dia:</span>\n                <span className=\"ml-1 font-medium text-foreground\">{conversionStats.averageLatency}ms</span>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Instru√ß√µes */}\n        {!isInCall && (\n          <div className=\"text-xs text-muted-foreground bg-dark-bg p-2 rounded border border-dark-border\">\n            üí° <strong className=\"text-foreground\">Como usar:</strong> Inicie uma chamada para ativar a convers√£o de voz em tempo real\n          </div>\n        )}\n\n        {isInCall && !isEnabled && (\n          <div className=\"text-xs text-muted-foreground bg-dark-bg p-2 rounded border border-dark-border\">\n            üé§ <strong className=\"text-foreground\">Dica:</strong> Ative a convers√£o para que o destinat√°rio ou√ßa sua voz modificada\n          </div>\n        )}\n\n        {isInCall && isEnabled && (\n          <div className=\"text-xs text-foreground bg-abmix-green/10 p-2 rounded border border-abmix-green/30\">\n            ‚úÖ <strong className=\"text-abmix-green\">Ativo:</strong> Sua voz est√° sendo modificada em tempo real\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\n\n","size_bytes":7657},"scripts/fix-404-deploy.sh":{"content":"#!/bin/bash\n\n# Script para corrigir erro 404 - Arquivos est√°ticos n√£o encontrados\n# Execute LOCALMENTE primeiro, depois no servidor\n\necho \"üîß CORRE√á√ÉO DE ERRO 404 - Arquivos Est√°ticos\"\necho \"============================================\"\n\n# Cores\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\nlog_info() { echo -e \"${BLUE}[INFO]${NC} $1\"; }\nlog_success() { echo -e \"${GREEN}[OK]${NC} $1\"; }\nlog_warning() { echo -e \"${YELLOW}[AVISO]${NC} $1\"; }\nlog_error() { echo -e \"${RED}[ERRO]${NC} $1\"; }\n\n# Verificar se estamos no diret√≥rio correto\nif [ ! -f \"package.json\" ]; then\n    log_error \"Execute este script no diret√≥rio raiz do projeto (onde est√° o package.json)\"\n    exit 1\nfi\n\nlog_info \"=== PARTE 1: BUILD LOCAL ===\"\n\n# 1. Limpar build anterior\nlog_info \"1. Limpando build anterior...\"\nrm -rf dist/\nrm -rf client/dist/\n\n# 2. Fazer build completo\nlog_info \"2. Fazendo build da aplica√ß√£o...\"\nnpm run build\n\nif [ $? -ne 0 ]; then\n    log_error \"Falha no build. Verifique os erros acima.\"\n    exit 1\nfi\n\nlog_success \"Build conclu√≠do com sucesso\"\n\n# 3. Verificar estrutura do build\nlog_info \"3. Verificando estrutura do build...\"\necho \"Conte√∫do de dist/:\"\nls -la dist/\necho \"\"\necho \"Conte√∫do de dist/public/ (se existir):\"\nls -la dist/public/ 2>/dev/null || echo \"Diret√≥rio dist/public/ n√£o existe\"\necho \"\"\n\n# 4. Preparar .env para produ√ß√£o\nlog_info \"4. Preparando arquivo .env para produ√ß√£o...\"\nif [ -f \"production.env\" ]; then\n    cp production.env .env.production\n    log_success \"Arquivo production.env copiado para .env.production\"\nelse\n    log_warning \"Arquivo production.env n√£o encontrado. Criando b√°sico...\"\n    cat > .env.production << 'EOF'\nPORT=5001\nNODE_ENV=production\nPUBLIC_BASE_URL=https://juliocamara.dev/abmix-ligacao\n\n# Configure suas chaves API:\nTWILIO_ACCOUNT_SID=\nTWILIO_AUTH_TOKEN=\nTWILIO_NUMBER=\nELEVENLABS_API_KEY=\nEOF\nfi\n\n# Garantir configura√ß√µes essenciais\necho \"PORT=5001\" >> .env.production\necho \"NODE_ENV=production\" >> .env.production\necho \"PUBLIC_BASE_URL=https://juliocamara.dev/abmix-ligacao\" >> .env.production\n\nlog_info \"=== PARTE 2: DEPLOY PARA SERVIDOR ===\"\n\n# 5. Enviar arquivos para o servidor\nlog_info \"5. Enviando arquivos para o servidor...\"\n\n# Criar estrutura no servidor\nssh root@95.216.201.197 \"mkdir -p /var/www/juliocamara.dev/abmix-ligacao\"\n\n# Enviar arquivos essenciais\nscp -r dist/ package.json .env.production root@95.216.201.197:/var/www/juliocamara.dev/abmix-ligacao/\n\nif [ $? -eq 0 ]; then\n    log_success \"Arquivos enviados com sucesso\"\nelse\n    log_error \"Erro ao enviar arquivos para o servidor\"\n    exit 1\nfi\n\nlog_info \"=== PARTE 3: CONFIGURA√á√ÉO NO SERVIDOR ===\"\n\n# 6. Configurar no servidor\nlog_info \"6. Configurando no servidor...\"\nssh root@95.216.201.197 << 'ENDSSH'\n\necho \"üîß CONFIGURA√á√ÉO NO SERVIDOR\"\ncd /var/www/juliocamara.dev/abmix-ligacao\n\n# Renomear .env\nmv .env.production .env\n\n# Verificar estrutura de arquivos\necho \"üìÅ Estrutura de arquivos:\"\nls -la\necho \"\"\necho \"üìÅ Conte√∫do de dist/:\"\nls -la dist/\necho \"\"\necho \"üìÅ Conte√∫do de dist/public/ (se existir):\"\nls -la dist/public/ 2>/dev/null || echo \"dist/public/ n√£o existe\"\necho \"\"\n\n# Se dist/public n√£o existir, criar link simb√≥lico\nif [ ! -d \"dist/public\" ] && [ -f \"dist/index.html\" ]; then\n    echo \"üîó Criando estrutura de arquivos est√°ticos...\"\n    # Mover arquivos para a estrutura correta\n    mkdir -p dist/public\n    # Mover todos os arquivos est√°ticos para public, exceto index.js\n    find dist/ -maxdepth 1 -type f ! -name \"index.js\" -exec mv {} dist/public/ \\;\n    # Mover diret√≥rios assets se existir\n    [ -d \"dist/assets\" ] && mv dist/assets dist/public/\nfi\n\n# Verificar novamente\necho \"üìÅ Nova estrutura de dist/:\"\nls -la dist/\necho \"\"\necho \"üìÅ Nova estrutura de dist/public/:\"\nls -la dist/public/ 2>/dev/null || echo \"dist/public/ ainda n√£o existe\"\necho \"\"\n\n# Instalar depend√™ncias\necho \"üì¶ Instalando depend√™ncias...\"\nnpm install --production\n\n# Parar processo existente\necho \"üõë Parando processo existente...\"\npm2 stop abmix-ligacao 2>/dev/null || true\npm2 delete abmix-ligacao 2>/dev/null || true\n\n# Ajustar permiss√µes\necho \"üîí Ajustando permiss√µes...\"\nchown -R www-data:www-data /var/www/juliocamara.dev/abmix-ligacao/\nchmod -R 755 /var/www/juliocamara.dev/abmix-ligacao/\n\n# Recarregar nginx\necho \"üåê Recarregando nginx...\"\nnginx -t && systemctl reload nginx\n\n# Iniciar aplica√ß√£o\necho \"üöÄ Iniciando aplica√ß√£o...\"\nPORT=5001 pm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\n# Aguardar inicializa√ß√£o\nsleep 5\n\n# Verificar status\necho \"üìä Status da aplica√ß√£o:\"\npm2 status\n\n# Testar conectividade\necho \"üß™ Testando conectividade...\"\necho \"Teste local:\"\ncurl -s -o /dev/null -w \"Status: %{http_code}\\n\" http://127.0.0.1:5001/ || echo \"Erro na conex√£o local\"\n\necho \"Teste API:\"\ncurl -s -o /dev/null -w \"Status: %{http_code}\\n\" http://127.0.0.1:5001/api/health || echo \"API n√£o responde\"\n\n# Mostrar logs recentes\necho \"üìã Logs recentes:\"\npm2 logs abmix-ligacao --lines 10\n\necho \"‚úÖ CONFIGURA√á√ÉO DO SERVIDOR CONCLU√çDA\"\n\nENDSSH\n\nlog_info \"=== PARTE 4: TESTE FINAL ===\"\n\n# 7. Teste final\nlog_info \"7. Testando acesso externo...\"\nsleep 3\n\nEXTERNAL_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" https://juliocamara.dev/abmix-ligacao/ 2>/dev/null || echo \"000\")\n\nif [ \"$EXTERNAL_STATUS\" = \"200\" ]; then\n    log_success \"‚úÖ Site acess√≠vel! Status: $EXTERNAL_STATUS\"\n    echo \"\"\n    echo \"üéâ CORRE√á√ÉO CONCLU√çDA COM SUCESSO!\"\n    echo \"==================================\"\n    echo \"\"\n    echo \"‚úÖ Acesse: https://juliocamara.dev/abmix-ligacao/\"\n    echo \"‚úÖ WebSocket: wss://juliocamara.dev/abmix-ligacao/media\"\n    echo \"\"\nelif [ \"$EXTERNAL_STATUS\" = \"404\" ]; then\n    log_error \"‚ùå Ainda retornando 404. Verifique os logs no servidor:\"\n    echo \"   ssh root@95.216.201.197\"\n    echo \"   pm2 logs abmix-ligacao\"\nelse\n    log_warning \"‚ö†Ô∏è Status: $EXTERNAL_STATUS\"\n    echo \"Verifique os logs para mais detalhes\"\nfi\n\necho \"\"\nlog_info \"üìã COMANDOS √öTEIS PARA DEBUG:\"\necho \"   ‚Ä¢ ssh root@95.216.201.197\"\necho \"   ‚Ä¢ pm2 logs abmix-ligacao\"\necho \"   ‚Ä¢ pm2 restart abmix-ligacao\"\necho \"   ‚Ä¢ curl http://127.0.0.1:5001/\"\necho \"\"\n\n\n\n","size_bytes":6216},"client/src/components/Settings.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\n\nexport function Settings() {\n  const { toast } = useToast();\n  const { selectedProvider, setSelectedProvider } = useCallStore();\n  const { theme, setTheme } = useTheme();\n  \n  const [settings, setSettings] = useState({\n    autoRecord: false,\n    defaultCountryCode: '+55',\n    voiceProvider: 'vapi',\n    aiModel: 'gpt-4',\n    language: 'pt-BR',\n    notifications: true,\n    volume: 80,\n    mascVoiceId: 'pNInz6obpgDQGcFmaJgB', // Default male voice\n    femVoiceId: '21m00Tcm4TlvDq8ikWAM', // Default female voice\n  });\n\n  // Fetch available voices from ElevenLabs\n  const { data: voices, isLoading: voicesLoading } = useQuery({\n    queryKey: ['/api/voices'],\n    queryFn: async () => {\n      const response = await fetch('/api/voices');\n      if (!response.ok) throw new Error('Failed to fetch voices');\n      return response.json();\n    }\n  });\n\n  // Voice categorization\n  const maleVoices = ['Roger', 'Clyde', 'Thomas', 'Charlie'];\n  const femaleVoices = ['Sarah', 'Rachel', 'Laura', 'Aria'];\n\n  // Filter voices by category\n  const masculineVoices = voices?.filter((voice: any) => \n    maleVoices.some(name => voice.name.includes(name))\n  ) || [];\n  \n  const feminineVoices = voices?.filter((voice: any) => \n    femaleVoices.some(name => voice.name.includes(name))\n  ) || [];\n\n  // Fetch current settings\n  const { data: serverSettings } = useQuery({\n    queryKey: ['/api/settings'],\n    queryFn: async () => {\n      const response = await fetch('/api/settings');\n      if (!response.ok) throw new Error('Failed to fetch settings');\n      return response.json();\n    }\n  });\n\n  // Update settings mutation\n  const queryClient = useQueryClient();\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (newSettings: any) => {\n      const response = await fetch('/api/settings', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(newSettings)\n      });\n      if (!response.ok) throw new Error('Failed to update settings');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/settings'] });\n      toast({\n        title: \"Configura√ß√µes salvas\",\n        description: \"Configura√ß√µes de voz atualizadas com sucesso\",\n      });\n    }\n  });\n\n  // Update local settings when server settings load\n  useEffect(() => {\n    if (serverSettings) {\n      setSettings(prev => ({\n        ...prev,\n        mascVoiceId: serverSettings.VOZ_MASC_ID || prev.mascVoiceId,\n        femVoiceId: serverSettings.VOZ_FEM_ID || prev.femVoiceId,\n      }));\n    }\n  }, [serverSettings]);\n\n  const handleSettingChange = (key: string, value: any) => {\n    setSettings(prev => ({\n      ...prev,\n      [key]: value\n    }));\n    \n    toast({\n      title: \"Configura√ß√£o salva\",\n      description: `${key} atualizada`,\n    });\n  };\n\n  const handleProviderChange = (provider: string) => {\n    setSelectedProvider(provider as any);\n    handleSettingChange('voiceProvider', provider);\n  };\n\n  const handleThemeChange = (newTheme: 'light' | 'dark') => {\n    setTheme(newTheme);\n    toast({\n      title: \"Tema alterado\",\n      description: `Modo ${newTheme === 'dark' ? 'escuro' : 'claro'} ativado`,\n    });\n  };\n\n  const resetSettings = () => {\n    setSettings({\n      autoRecord: false,\n      defaultCountryCode: '+55',\n      voiceProvider: 'vapi',\n      aiModel: 'gpt-4',\n      language: 'pt-BR',\n      notifications: true,\n      volume: 80,\n      mascVoiceId: 'pNInz6obpgDQGcFmaJgB',\n      femVoiceId: '21m00Tcm4TlvDq8ikWAM',\n    });\n    setTheme('dark');\n    \n    toast({\n      title: \"Configura√ß√µes resetadas\",\n      description: \"Todas as configura√ß√µes foram restauradas para o padr√£o\",\n    });\n  };\n\n  return (\n    <div className=\"bg-card rounded-xl p-6 border border-border\">\n      <h3 className=\"text-lg font-semibold mb-6 text-foreground\">Configura√ß√µes</h3>\n      \n      <div className=\"space-y-6\">\n        {/* Provedor de Voz */}\n        <div>\n          <Label className=\"text-sm font-medium mb-2 block\">Provedor de Voz</Label>\n          <div className=\"bg-background border border-border rounded-lg px-3 py-2\">\n            <span className=\"text-foreground capitalize\">{selectedProvider}</span>\n          </div>\n          <div className=\"flex gap-2 mt-2\">\n            <Button\n              onClick={() => handleProviderChange('vapi')}\n              variant={selectedProvider === 'vapi' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={selectedProvider === 'vapi' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              Vapi\n            </Button>\n            <Button\n              onClick={() => handleProviderChange('retell')}\n              variant={selectedProvider === 'retell' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={selectedProvider === 'retell' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              Retell AI\n            </Button>\n            <Button\n              onClick={() => handleProviderChange('falevono')}\n              variant={selectedProvider === 'falevono' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={selectedProvider === 'falevono' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              FaleVono\n            </Button>\n          </div>\n        </div>\n\n        {/* Modelo de IA */}\n        <div>\n          <Label className=\"text-sm font-medium mb-2 block\">Modelo de IA</Label>\n          <div className=\"bg-background border border-border rounded-lg px-3 py-2\">\n            <span className=\"text-foreground\">{settings.aiModel}</span>\n          </div>\n          <div className=\"flex gap-2 mt-2\">\n            <Button\n              onClick={() => handleSettingChange('aiModel', 'gpt-4')}\n              variant={settings.aiModel === 'gpt-4' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={settings.aiModel === 'gpt-4' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              GPT-4\n            </Button>\n            <Button\n              onClick={() => handleSettingChange('aiModel', 'gpt-3.5-turbo')}\n              variant={settings.aiModel === 'gpt-3.5-turbo' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={settings.aiModel === 'gpt-3.5-turbo' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              GPT-3.5\n            </Button>\n          </div>\n        </div>\n\n        {/* Configura√ß√£o de Vozes ElevenLabs */}\n        <div className=\"space-y-4 p-4 bg-muted/30 rounded-lg border border-border\">\n          <div className=\"flex items-center gap-2 mb-3\">\n            <i className=\"fas fa-microphone text-abmix-green\"></i>\n            <Label className=\"text-sm font-medium\">Configura√ß√£o de Vozes ElevenLabs</Label>\n          </div>\n          \n          {/* Voz Masculina */}\n          <div>\n            <Label className=\"text-sm font-medium mb-2 block flex items-center gap-2\">\n              <i className=\"fas fa-male text-blue-500\"></i>\n              Voz Masculina\n            </Label>\n            <div className=\"bg-background border border-border rounded-lg px-3 py-2\">\n              <span className=\"text-foreground text-sm\">\n                {voicesLoading ? 'Carregando vozes...' : \n                 voices?.find((v: any) => v.voice_id === settings.mascVoiceId)?.name || 'N√£o selecionada'}\n              </span>\n            </div>\n            <div className=\"flex gap-2 mt-2 flex-wrap\">\n              {masculineVoices.map((voice: any) => (\n                <Button\n                  key={voice.voice_id}\n                  onClick={() => {\n                    handleSettingChange('mascVoiceId', voice.voice_id);\n                    updateSettingsMutation.mutate({ VOZ_MASC_ID: voice.voice_id });\n                  }}\n                  variant={settings.mascVoiceId === voice.voice_id ? 'default' : 'outline'}\n                  size=\"sm\"\n                  className={settings.mascVoiceId === voice.voice_id ? 'bg-abmix-green text-black' : 'border-border text-foreground text-xs'}\n                >\n                  {voice.name}\n                </Button>\n              ))}\n            </div>\n          </div>\n\n          {/* Voz Feminina */}\n          <div>\n            <Label className=\"text-sm font-medium mb-2 block flex items-center gap-2\">\n              <i className=\"fas fa-female text-pink-500\"></i>\n              Voz Feminina\n            </Label>\n            <div className=\"bg-background border border-border rounded-lg px-3 py-2\">\n              <span className=\"text-foreground text-sm\">\n                {voicesLoading ? 'Carregando vozes...' : \n                 voices?.find((v: any) => v.voice_id === settings.femVoiceId)?.name || 'N√£o selecionada'}\n              </span>\n            </div>\n            <div className=\"flex gap-2 mt-2 flex-wrap\">\n              {feminineVoices.map((voice: any) => (\n                <Button\n                  key={voice.voice_id}\n                  onClick={() => {\n                    handleSettingChange('femVoiceId', voice.voice_id);\n                    updateSettingsMutation.mutate({ VOZ_FEM_ID: voice.voice_id });\n                  }}\n                  variant={settings.femVoiceId === voice.voice_id ? 'default' : 'outline'}\n                  size=\"sm\"\n                  className={settings.femVoiceId === voice.voice_id ? 'bg-abmix-green text-black' : 'border-border text-foreground text-xs'}\n                >\n                  {voice.name}\n                </Button>\n              ))}\n            </div>\n          </div>\n\n          {/* Informa√ß√µes das Vozes Selecionadas */}\n          <div className=\"bg-background/50 rounded-lg p-3 text-xs text-muted-foreground\">\n            <div className=\"flex justify-between items-center\">\n              <span>Vozes configuradas para o discador:</span>\n              <div className=\"flex gap-2\">\n                <span className=\"text-blue-500\">‚ôÇ {voices?.find((v: any) => v.voice_id === settings.mascVoiceId)?.name || 'Padr√£o'}</span>\n                <span className=\"text-pink-500\">‚ôÄ {voices?.find((v: any) => v.voice_id === settings.femVoiceId)?.name || 'Padr√£o'}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Teste de Vozes */}\n          <div className=\"flex gap-2 pt-2\">\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"flex-1 border-border text-foreground hover:bg-muted\"\n              onClick={async () => {\n                const selectedVoice = voices?.find((v: any) => v.voice_id === settings.mascVoiceId);\n                if (!selectedVoice) {\n                  toast({\n                    title: \"Erro\",\n                    description: \"Nenhuma voz masculina selecionada\",\n                  });\n                  return;\n                }\n                \n                try {\n                  const response = await fetch('/api/voices/test', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      voiceId: settings.mascVoiceId,\n                      text: 'Ol√°, bem-vindo √† Disck Mix. Seu painel inteligente de liga√ß√µes.'\n                    })\n                  });\n                  \n                  if (response.ok) {\n                    const audioBlob = await response.blob();\n                    const audioUrl = URL.createObjectURL(audioBlob);\n                    const audio = new Audio(audioUrl);\n                    await audio.play();\n                    \n                    toast({\n                      title: \"Teste de voz masculina\",\n                      description: `Reproduzindo: ${selectedVoice.name}`,\n                    });\n                  } else {\n                    throw new Error('Erro no teste de voz');\n                  }\n                } catch (error) {\n                  toast({\n                    title: \"Erro no teste\",\n                    description: \"N√£o foi poss√≠vel reproduzir a voz masculina\",\n                  });\n                }\n              }}\n            >\n              <i className=\"fas fa-play mr-2\"></i>\n              Testar Masc\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"flex-1 border-border text-foreground hover:bg-muted\"\n              onClick={async () => {\n                const selectedVoice = voices?.find((v: any) => v.voice_id === settings.femVoiceId);\n                if (!selectedVoice) {\n                  toast({\n                    title: \"Erro\",\n                    description: \"Nenhuma voz feminina selecionada\",\n                  });\n                  return;\n                }\n                \n                try {\n                  const response = await fetch('/api/voices/test', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      voiceId: settings.femVoiceId,\n                      text: 'Ol√°, bem-vindo √† Disck Mix. Seu painel inteligente de liga√ß√µes.'\n                    })\n                  });\n                  \n                  if (response.ok) {\n                    const audioBlob = await response.blob();\n                    const audioUrl = URL.createObjectURL(audioBlob);\n                    const audio = new Audio(audioUrl);\n                    await audio.play();\n                    \n                    toast({\n                      title: \"Teste de voz feminina\",\n                      description: `Reproduzindo: ${selectedVoice.name}`,\n                    });\n                  } else {\n                    throw new Error('Erro no teste de voz');\n                  }\n                } catch (error) {\n                  toast({\n                    title: \"Erro no teste\",\n                    description: \"N√£o foi poss√≠vel reproduzir a voz feminina\",\n                  });\n                }\n              }}\n            >\n              <i className=\"fas fa-play mr-2\"></i>\n              Testar Fem\n            </Button>\n          </div>\n        </div>\n\n        {/* Idioma */}\n        <div>\n          <Label className=\"text-sm font-medium mb-2 block\">Idioma</Label>\n          <div className=\"bg-background border border-border rounded-lg px-3 py-2\">\n            <span className=\"text-foreground\">\n              {settings.language === 'pt-BR' ? 'Portugu√™s (Brasil)' : \n               settings.language === 'en-US' ? 'English (US)' : 'Espa√±ol'}\n            </span>\n          </div>\n          <div className=\"flex gap-2 mt-2\">\n            <Button\n              onClick={() => handleSettingChange('language', 'pt-BR')}\n              variant={settings.language === 'pt-BR' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={settings.language === 'pt-BR' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              PT-BR\n            </Button>\n            <Button\n              onClick={() => handleSettingChange('language', 'en-US')}\n              variant={settings.language === 'en-US' ? 'default' : 'outline'}\n              size=\"sm\"\n              className={settings.language === 'en-US' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n            >\n              EN-US\n            </Button>\n          </div>\n        </div>\n\n        {/* C√≥digo do Pa√≠s Padr√£o */}\n        <div>\n          <Label htmlFor=\"country-code\" className=\"text-sm font-medium mb-2 block\">\n            C√≥digo do Pa√≠s Padr√£o\n          </Label>\n          <Input\n            id=\"country-code\"\n            value={settings.defaultCountryCode}\n            onChange={(e) => handleSettingChange('defaultCountryCode', e.target.value)}\n            placeholder=\"+55\"\n            className=\"bg-background border-border\"\n          />\n        </div>\n\n        {/* Volume */}\n        <div>\n          <Label htmlFor=\"volume\" className=\"text-sm font-medium mb-2 block\">\n            Volume ({settings.volume}%)\n          </Label>\n          <Input\n            id=\"volume\"\n            type=\"range\"\n            min=\"0\"\n            max=\"100\"\n            value={settings.volume}\n            onChange={(e) => handleSettingChange('volume', parseInt(e.target.value))}\n            className=\"bg-background border-border\"\n          />\n        </div>\n\n        {/* Switches */}\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <Label htmlFor=\"auto-record\" className=\"text-sm font-medium\">\n              Grava√ß√£o Autom√°tica\n            </Label>\n            <Switch\n              id=\"auto-record\"\n              checked={settings.autoRecord}\n              onCheckedChange={(checked) => handleSettingChange('autoRecord', checked)}\n            />\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <Label htmlFor=\"notifications\" className=\"text-sm font-medium\">\n              Notifica√ß√µes\n            </Label>\n            <Switch\n              id=\"notifications\"\n              checked={settings.notifications}\n              onCheckedChange={(checked) => handleSettingChange('notifications', checked)}\n            />\n          </div>\n\n          <div>\n            <Label className=\"text-sm font-medium mb-2 block\">Tema</Label>\n            <div className=\"bg-card border border-border rounded-lg px-3 py-2\">\n              <span className=\"text-foreground capitalize\">\n                {theme === 'dark' ? 'Modo Escuro' : 'Modo Claro'}\n              </span>\n            </div>\n            <div className=\"flex gap-2 mt-2\">\n              <Button\n                onClick={() => handleThemeChange('light')}\n                variant={theme === 'light' ? 'default' : 'outline'}\n                size=\"sm\"\n                className={theme === 'light' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n                data-testid=\"light-mode-button\"\n              >\n                <i className=\"fas fa-sun text-sm mr-1\"></i>\n                Claro\n              </Button>\n              <Button\n                onClick={() => handleThemeChange('dark')}\n                variant={theme === 'dark' ? 'default' : 'outline'}\n                size=\"sm\"\n                className={theme === 'dark' ? 'bg-abmix-green text-black' : 'border-border text-foreground'}\n                data-testid=\"dark-mode-button\"\n              >\n                <i className=\"fas fa-moon text-sm mr-1\"></i>\n                Escuro\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Bot√µes de A√ß√£o */}\n        <div className=\"flex gap-3 pt-4 border-t border-border\">\n          <Button\n            onClick={resetSettings}\n            variant=\"outline\"\n            className=\"flex-1 border-border text-foreground hover:bg-muted\"\n          >\n            <i className=\"fas fa-undo mr-2\"></i>\n            Resetar\n          </Button>\n          \n          <Button\n            onClick={() => {\n              const settingsToSave = {\n                VOZ_MASC_ID: settings.mascVoiceId,\n                VOZ_FEM_ID: settings.femVoiceId,\n                IDIOMA: settings.language,\n                VOLUME: settings.volume.toString(),\n                AUTO_RECORD: settings.autoRecord.toString(),\n                NOTIFICATIONS: settings.notifications.toString()\n              };\n              updateSettingsMutation.mutate(settingsToSave);\n            }}\n            className=\"flex-1 bg-abmix-green text-black hover:bg-abmix-green/90\"\n            disabled={updateSettingsMutation.isPending}\n          >\n            <i className=\"fas fa-save mr-2\"></i>\n            {updateSettingsMutation.isPending ? 'Salvando...' : 'Salvar'}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":20373},"server/realtimeVoiceService.ts":{"content":"// Load environment variables\nimport { config } from \"dotenv\";\nconfig();\n\nimport { EventEmitter } from 'events';\nimport WebSocket from 'ws';\nimport { queries } from './database';\n\nconst ELEVENLABS_API_KEY = process.env.ELEVENLABS_API_KEY;\n\ninterface RealtimeVoiceSession {\n  callSid: string;\n  voiceType: 'masc' | 'fem';\n  sttWs: WebSocket | null;  // Speech-to-Text WebSocket\n  ttsWs: WebSocket | null;  // Text-to-Speech WebSocket\n  isConnected: boolean;\n  enabled: boolean;\n  lastActivity: number;\n}\n\nclass RealtimeVoiceService extends EventEmitter {\n  private sessions = new Map<string, RealtimeVoiceSession>();\n  private latencyMetrics: number[] = [];\n\n  constructor() {\n    super();\n    this.setupCleanupInterval();\n  }\n\n  // Get voice configuration\n  private getVoiceConfig(voiceType: 'masc' | 'fem') {\n    const voiceIdKey = voiceType === 'masc' ? 'VOZ_MASC_ID' : 'VOZ_FEM_ID';\n    const voiceIdResult = queries.getSetting.get(voiceIdKey) as { value: string } | undefined;\n    \n    const defaultVoices = {\n      masc: 'pNInz6obpgDQGcFmaJgB', // Adam - voz masculina natural\n      fem: 'EXAVITQu4vr4xnSDxMaL'   // Bella - voz feminina natural\n    };\n    \n    return voiceIdResult?.value || defaultVoices[voiceType];\n  }\n\n  // Start real-time voice conversion session\n  async startRealtimeVoice(callSid: string, voiceType: 'masc' | 'fem'): Promise<boolean> {\n    try {\n      const targetVoiceId = this.getVoiceConfig(voiceType);\n      \n      console.log(`[REALTIME_VOICE] Starting session ${callSid} with voice ${targetVoiceId}`);\n\n      // Start STT session for incoming audio\n      const sttWs = new WebSocket('wss://api.elevenlabs.io/v1/speech-to-text/stream', {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY\n        }\n      });\n\n      // Start TTS session for outgoing audio\n      const ttsWs = new WebSocket(`wss://api.elevenlabs.io/v1/text-to-speech/${targetVoiceId}/stream-input?model_id=eleven_multilingual_v2`, {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY\n        }\n      });\n\n      const session: RealtimeVoiceSession = {\n        callSid,\n        voiceType,\n        sttWs,\n        ttsWs,\n        isConnected: false,\n        enabled: true,\n        lastActivity: Date.now()\n      };\n\n      // Setup STT WebSocket (Speech-to-Text)\n      sttWs.on('open', () => {\n        console.log(`[REALTIME_VOICE] STT connected for ${callSid}`);\n        \n        // Configure STT for Portuguese\n        sttWs.send(JSON.stringify({\n          language: 'pt',\n          model: 'whisper-large-v3',\n          optimize_streaming_latency: 1\n        }));\n      });\n\n      sttWs.on('message', (data) => {\n        try {\n          const result = JSON.parse(data.toString());\n          \n          if (result.text && result.is_final && session.enabled) {\n            console.log(`[REALTIME_VOICE] STT Result: \"${result.text}\"`);\n            \n            // Send transcribed text to TTS for voice conversion\n            this.convertTextToTargetVoice(callSid, result.text);\n          }\n        } catch (error) {\n          console.error('[REALTIME_VOICE] STT parse error:', error);\n        }\n      });\n\n      // Setup TTS WebSocket (Text-to-Speech)\n      ttsWs.on('open', () => {\n        console.log(`[REALTIME_VOICE] TTS connected for ${callSid}`);\n        \n        // Configure TTS for optimal real-time performance\n        ttsWs.send(JSON.stringify({\n          text: \" \",\n          voice_settings: {\n            stability: 0.35,\n            similarity_boost: 0.85,\n            style: 0.15,\n            use_speaker_boost: true\n          },\n          generation_config: {\n            chunk_length_schedule: [120, 160, 250, 290]\n          },\n          optimize_streaming_latency: 1,\n          output_format: \"pcm_8000\" // Compatible with Twilio\n        }));\n\n        session.isConnected = true;\n        this.emit('realtime-voice-ready', callSid);\n      });\n\n      ttsWs.on('message', (data) => {\n        session.lastActivity = Date.now();\n        \n        try {\n          const message = JSON.parse(data.toString());\n          \n          if (message.audio) {\n            // Emit converted audio for Twilio\n            this.emit('converted-voice-audio', callSid, Buffer.from(message.audio, 'base64'));\n          }\n        } catch (error) {\n          console.error('[REALTIME_VOICE] TTS parse error:', error);\n        }\n      });\n\n      // Error handling\n      sttWs.on('error', (error) => {\n        console.error(`[REALTIME_VOICE] STT error for ${callSid}:`, error);\n      });\n\n      ttsWs.on('error', (error) => {\n        console.error(`[REALTIME_VOICE] TTS error for ${callSid}:`, error);\n      });\n\n      // Cleanup on close\n      const cleanup = () => {\n        console.log(`[REALTIME_VOICE] Session ${callSid} closed`);\n        session.isConnected = false;\n        this.sessions.delete(callSid);\n        this.emit('realtime-voice-closed', callSid);\n      };\n\n      sttWs.on('close', cleanup);\n      ttsWs.on('close', cleanup);\n\n      this.sessions.set(callSid, session);\n      return true;\n\n    } catch (error) {\n      console.error(`[REALTIME_VOICE] Failed to start session:`, error);\n      return false;\n    }\n  }\n\n  // Process incoming audio for STT\n  processIncomingAudio(callSid: string, audioBase64: string): boolean {\n    const session = this.sessions.get(callSid);\n    \n    if (!session || !session.sttWs || !session.enabled) {\n      return false;\n    }\n\n    try {\n      // Send audio to STT\n      session.sttWs.send(JSON.stringify({\n        audio: audioBase64\n      }));\n\n      session.lastActivity = Date.now();\n      return true;\n\n    } catch (error) {\n      console.error(`[REALTIME_VOICE] Error processing audio:`, error);\n      return false;\n    }\n  }\n\n  // Convert text to target voice\n  private convertTextToTargetVoice(callSid: string, text: string): boolean {\n    const session = this.sessions.get(callSid);\n    \n    if (!session || !session.ttsWs || !session.enabled) {\n      return false;\n    }\n\n    try {\n      // Send text to TTS for voice conversion\n      session.ttsWs.send(JSON.stringify({\n        text: text,\n        voice_settings: {\n          stability: 0.35,\n          similarity_boost: 0.85,\n          style: 0.15,\n          use_speaker_boost: true\n        }\n      }));\n\n      return true;\n\n    } catch (error) {\n      console.error(`[REALTIME_VOICE] Error converting text:`, error);\n      return false;\n    }\n  }\n\n  // Enable/disable voice conversion\n  setConversionEnabled(callSid: string, enabled: boolean): boolean {\n    const session = this.sessions.get(callSid);\n    \n    if (!session) {\n      console.warn(`[REALTIME_VOICE] Session ${callSid} not found`);\n      return false;\n    }\n\n    session.enabled = enabled;\n    console.log(`[REALTIME_VOICE] Session ${callSid} conversion ${enabled ? 'enabled' : 'disabled'}`);\n    return true;\n  }\n\n  // Check if conversion is enabled\n  isConversionEnabled(callSid: string): boolean {\n    const session = this.sessions.get(callSid);\n    return session ? session.enabled : false;\n  }\n\n  // Stop session\n  stopRealtimeVoice(callSid: string): boolean {\n    const session = this.sessions.get(callSid);\n    \n    if (session) {\n      console.log(`[REALTIME_VOICE] Stopping session ${callSid}`);\n      \n      if (session.sttWs) session.sttWs.close();\n      if (session.ttsWs) session.ttsWs.close();\n      \n      this.sessions.delete(callSid);\n      return true;\n    }\n    return false;\n  }\n\n  // Get session statistics\n  getSessionStats() {\n    return {\n      activeSessions: this.sessions.size,\n      averageLatency: this.getAverageLatency(),\n      sessions: Array.from(this.sessions.entries()).map(([id, session]) => ({\n        id,\n        voiceType: session.voiceType,\n        isConnected: session.isConnected,\n        enabled: session.enabled,\n        lastActivity: session.lastActivity\n      }))\n    };\n  }\n\n  // Record latency metrics\n  private recordLatency(latency: number): void {\n    this.latencyMetrics.push(latency);\n    \n    if (this.latencyMetrics.length > 10) {\n      this.latencyMetrics.shift();\n    }\n  }\n\n  // Get average latency\n  private getAverageLatency(): number {\n    if (this.latencyMetrics.length === 0) return 0;\n    \n    const sum = this.latencyMetrics.reduce((a, b) => a + b, 0);\n    return Math.round(sum / this.latencyMetrics.length);\n  }\n\n  // Cleanup inactive sessions\n  private setupCleanupInterval(): void {\n    setInterval(() => {\n      const now = Date.now();\n      const timeout = 300000; // 5 minutes\n      \n      for (const [callSid, session] of Array.from(this.sessions.entries())) {\n        if (now - session.lastActivity > timeout) {\n          console.log(`[REALTIME_VOICE] Cleaning up inactive session: ${callSid}`);\n          this.stopRealtimeVoice(callSid);\n        }\n      }\n    }, 60000); // Check every minute\n  }\n}\n\nexport const realtimeVoiceService = new RealtimeVoiceService();\n\n\n\n\n\n\n\n","size_bytes":8829},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"server/voiceConversionService.ts":{"content":"import { EventEmitter } from 'events';\nimport WebSocket from 'ws';\nimport { queries } from './database';\n\n// Load environment variables\nimport { config } from \"dotenv\";\nconfig();\n\nconst ELEVENLABS_API_KEY = process.env.ELEVENLABS_API_KEY;\nconst ELEVENLABS_VOICE_CONVERSION_URL = 'wss://api.elevenlabs.io/v1/text-to-speech';\n\ninterface VoiceConversionSession {\n  ws: WebSocket | null;\n  targetVoiceId: string;\n  isConnected: boolean;\n  lastActivity: number;\n  enabled: boolean; // Se a convers√£o est√° ativa ou n√£o\n}\n\nclass VoiceConversionService extends EventEmitter {\n  private sessions = new Map<string, VoiceConversionSession>();\n  private latencyMetrics: number[] = [];\n\n  constructor() {\n    super();\n    this.setupCleanupInterval();\n  }\n\n  // Get voice configuration from database\n  private getTargetVoiceConfig(voiceType: 'masc' | 'fem') {\n    const voiceIdKey = voiceType === 'masc' ? 'VOZ_MASC_ID' : 'VOZ_FEM_ID';\n    \n    const voiceIdResult = queries.getSetting.get(voiceIdKey) as { value: string } | undefined;\n    \n    // Default voice IDs for voice conversion (natural sounding voices)\n    const defaultVoices = {\n      masc: 'pNInz6obpgDQGcFmaJgB', // Adam - voz masculina natural\n      fem: 'EXAVITQu4vr4xnSDxMaL'   // Bella - voz feminina natural\n    };\n    \n    return voiceIdResult?.value || defaultVoices[voiceType];\n  }\n\n  // Start voice conversion session\n  async startVoiceConversion(sessionId: string, targetVoiceType: 'masc' | 'fem'): Promise<boolean> {\n    try {\n      const targetVoiceId = this.getTargetVoiceConfig(targetVoiceType);\n      \n      console.log(`[VOICE_CONVERSION] Starting voice conversion session ${sessionId} to voice ${targetVoiceId}`);\n\n      const ws = new WebSocket(`${ELEVENLABS_VOICE_CONVERSION_URL}?voice_id=${targetVoiceId}`, {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY\n        }\n      });\n\n      const session: VoiceConversionSession = {\n        ws,\n        targetVoiceId,\n        isConnected: false,\n        lastActivity: Date.now(),\n        enabled: true // Por padr√£o, convers√£o ativa\n      };\n\n      ws.on('open', () => {\n        console.log(`[VOICE_CONVERSION] Session ${sessionId} connected`);\n        session.isConnected = true;\n        session.lastActivity = Date.now();\n        \n        // Configura√ß√£o inicial para convers√£o de voz em portugu√™s\n        ws.send(JSON.stringify({\n          voice_settings: {\n            stability: 0.35,\n            similarity_boost: 0.85,\n            style: 0.15,\n            use_speaker_boost: true\n          },\n          generation_config: {\n            chunk_length_schedule: [120, 160, 250, 290]\n          },\n          // Configura√ß√µes espec√≠ficas para convers√£o de voz\n          optimize_streaming_latency: 1, // Prioriza lat√™ncia baixa\n          output_format: \"pcm_8000\", // Formato compat√≠vel com Twilio\n          model_id: \"eleven_multilingual_sts_v2\" // Modelo espec√≠fico para speech-to-speech\n        }));\n\n        this.emit('voice-conversion-ready', sessionId);\n      });\n\n      ws.on('message', (data) => {\n        session.lastActivity = Date.now();\n        const startTime = Date.now();\n        \n        try {\n          const message = JSON.parse(data.toString());\n          \n          if (message.audio) {\n            // Calculate latency\n            const latency = Date.now() - startTime;\n            this.recordLatency(latency);\n            \n            // Emit converted audio data\n            this.emit('converted-audio', sessionId, Buffer.from(message.audio, 'base64'));\n          }\n          \n          if (message.isFinal) {\n            console.log(`[VOICE_CONVERSION] Final chunk for session ${sessionId}`);\n          }\n        } catch (error) {\n          console.error(`[VOICE_CONVERSION] Error parsing message:`, error);\n        }\n      });\n\n      ws.on('error', (error) => {\n        console.error(`[VOICE_CONVERSION] Session ${sessionId} error:`, error);\n        session.isConnected = false;\n        this.emit('voice-conversion-error', sessionId, error);\n      });\n\n      ws.on('close', () => {\n        console.log(`[VOICE_CONVERSION] Session ${sessionId} closed`);\n        session.isConnected = false;\n        this.sessions.delete(sessionId);\n        this.emit('voice-conversion-closed', sessionId);\n      });\n\n      this.sessions.set(sessionId, session);\n      return true;\n\n    } catch (error) {\n      console.error(`[VOICE_CONVERSION] Failed to start session:`, error);\n      return false;\n    }\n  }\n\n  // Process incoming audio for voice conversion\n  processAudio(sessionId: string, audioBase64: string): boolean {\n    const session = this.sessions.get(sessionId);\n    \n    if (!session || !session.isConnected || !session.ws || !session.enabled) {\n      return false;\n    }\n\n    try {\n      // Send audio data for conversion\n      session.ws.send(JSON.stringify({\n        audio: audioBase64\n      }));\n\n      session.lastActivity = Date.now();\n      return true;\n\n    } catch (error) {\n      console.error(`[VOICE_CONVERSION] Error processing audio:`, error);\n      return false;\n    }\n  }\n\n  // Enable/disable voice conversion for a session\n  setConversionEnabled(sessionId: string, enabled: boolean): boolean {\n    const session = this.sessions.get(sessionId);\n    \n    if (!session) {\n      console.warn(`[VOICE_CONVERSION] Session ${sessionId} not found`);\n      return false;\n    }\n\n    session.enabled = enabled;\n    console.log(`[VOICE_CONVERSION] Session ${sessionId} conversion ${enabled ? 'enabled' : 'disabled'}`);\n    return true;\n  }\n\n  // Check if conversion is enabled for a session\n  isConversionEnabled(sessionId: string): boolean {\n    const session = this.sessions.get(sessionId);\n    return session ? session.enabled : false;\n  }\n\n  // Stop voice conversion session\n  stopVoiceConversion(sessionId: string): boolean {\n    const session = this.sessions.get(sessionId);\n    \n    if (session && session.ws) {\n      console.log(`[VOICE_CONVERSION] Stopping session ${sessionId}`);\n      session.ws.close();\n      this.sessions.delete(sessionId);\n      return true;\n    }\n    return false;\n  }\n\n  // Get available voices for conversion\n  async getAvailableVoices(): Promise<any[]> {\n    try {\n      const response = await fetch('https://api.elevenlabs.io/v1/voices', {\n        headers: {\n          'xi-api-key': ELEVENLABS_API_KEY!\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`ElevenLabs API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      // Filter voices suitable for real-time conversion\n      return (data.voices || []).filter((voice: any) => \n        voice.category === 'premade' || voice.category === 'cloned'\n      );\n\n    } catch (error) {\n      console.error('[VOICE_CONVERSION] Failed to fetch voices:', error);\n      return [];\n    }\n  }\n\n  // Record latency metrics\n  private recordLatency(latency: number): void {\n    this.latencyMetrics.push(latency);\n    \n    // Keep only last 10 measurements\n    if (this.latencyMetrics.length > 10) {\n      this.latencyMetrics.shift();\n    }\n  }\n\n  // Get average latency\n  getAverageLatency(): number {\n    if (this.latencyMetrics.length === 0) return 0;\n    \n    const sum = this.latencyMetrics.reduce((a, b) => a + b, 0);\n    return Math.round(sum / this.latencyMetrics.length);\n  }\n\n  // Cleanup inactive sessions\n  private setupCleanupInterval(): void {\n    setInterval(() => {\n      const now = Date.now();\n      const timeout = 300000; // 5 minutes\n      \n      for (const [sessionId, session] of Array.from(this.sessions.entries())) {\n        if (now - session.lastActivity > timeout) {\n          console.log(`[VOICE_CONVERSION] Cleaning up inactive session: ${sessionId}`);\n          this.stopVoiceConversion(sessionId);\n        }\n      }\n    }, 60000); // Check every minute\n  }\n\n  // Get session statistics\n  getSessionStats() {\n    return {\n      activeSessions: this.sessions.size,\n      averageLatency: this.getAverageLatency(),\n      sessions: Array.from(this.sessions.entries()).map(([id, session]) => ({\n        id,\n        targetVoiceId: session.targetVoiceId,\n        isConnected: session.isConnected,\n        enabled: session.enabled,\n        lastActivity: session.lastActivity\n      }))\n    };\n  }\n}\n\nexport const voiceConversionService = new VoiceConversionService();\n","size_bytes":8284},"client/src/components/Transcripts.tsx":{"content":"import { useEffect, useRef } from 'react';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { format } from 'date-fns';\n\nexport function Transcripts() {\n  const { transcripts, callState } = useCallStore();\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom when new transcripts arrive\n  useEffect(() => {\n    if (containerRef.current) {\n      containerRef.current.scrollTop = containerRef.current.scrollHeight;\n    }\n  }, [transcripts]);\n\n  const getSpeakerConfig = (speaker: string) => {\n    const configs = {\n      'AI': {\n        bgColor: 'bg-abmix-green',\n        textColor: 'text-abmix-green',\n        icon: 'fas fa-robot',\n        iconColor: 'text-black',\n      },\n      'Human': {\n        bgColor: 'bg-orange-600',\n        textColor: 'text-orange-400',\n        icon: 'fas fa-user',\n        iconColor: 'text-white',\n      },\n      'Remote': {\n        bgColor: 'bg-blue-600',\n        textColor: 'text-blue-400',\n        icon: 'fas fa-user',\n        iconColor: 'text-white',\n      },\n    };\n    return configs[speaker as keyof typeof configs] || configs.Remote;\n  };\n\n  const formatTimestamp = (timestamp: Date) => {\n    return format(timestamp, 'HH:mm:ss');\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border h-fit flex flex-col\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold\">Legendas (PT-BR)</h3>\n        <div className=\"flex items-center space-x-2\">\n          <div className={`w-2 h-2 rounded-full ${callState === 'CONNECTED' ? 'bg-green-500' : 'bg-gray-500'}`}></div>\n          <span className=\"text-sm text-gray-400\">\n            {callState === 'CONNECTED' ? 'Ativo' : 'Inativo'}\n          </span>\n        </div>\n      </div>\n\n      <div \n        ref={containerRef}\n        className=\"flex-1 space-y-4 overflow-y-auto max-h-96\"\n        data-testid=\"transcripts-container\"\n      >\n        {transcripts.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\n            <i className=\"fas fa-comments text-4xl mb-3 opacity-50\"></i>\n            <p className=\"text-center\">\n              {callState === 'CONNECTED' \n                ? 'Aguardando transcri√ß√µes...' \n                : 'Inicie uma chamada para ver as transcri√ß√µes'\n              }\n            </p>\n          </div>\n        ) : (\n          transcripts.map((transcript, index) => {\n            const speakerConfig = getSpeakerConfig(transcript.speaker);\n            \n            return (\n              <div \n                key={`${transcript.id}-${index}`}\n                className=\"flex items-start space-x-3\"\n                data-testid={`transcript-${transcript.id}`}\n              >\n                <div className=\"flex-shrink-0\">\n                  <div className={`w-8 h-8 rounded-full ${speakerConfig.bgColor} flex items-center justify-center`}>\n                    <i className={`${speakerConfig.icon} text-xs ${speakerConfig.iconColor}`}></i>\n                  </div>\n                </div>\n                \n                <div className=\"flex-1\">\n                  <div className=\"flex items-center space-x-2 mb-1\">\n                    <span className={`text-sm font-medium ${speakerConfig.textColor}`}>\n                      {transcript.speaker === 'Remote' ? 'Cliente' : transcript.speaker}\n                    </span>\n                    <span className=\"text-xs text-gray-500\">\n                      {formatTimestamp(transcript.timestamp ? new Date(transcript.timestamp) : new Date())}\n                    </span>\n                    {!transcript.isFinal && (\n                      <span className=\"text-xs text-gray-400 italic\">\n                        (parcial)\n                      </span>\n                    )}\n                  </div>\n                  \n                  <p className={`text-sm ${!transcript.isFinal ? 'italic opacity-75' : ''}`}>\n                    {transcript.text}\n                  </p>\n                  \n                  {transcript.confidence && (\n                    <div className=\"mt-1\">\n                      <span className=\"text-xs text-gray-500\">\n                        Confian√ßa: {Math.round(transcript.confidence)}%\n                      </span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            );\n          })\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":4439},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"server/voiceProcessor.ts":{"content":"// Processador de voz em tempo real para reduzir som rob√≥tico\nimport { EventEmitter } from 'events';\nimport { queries } from './database';\n\ninterface VoiceProcessingOptions {\n  removeRoboticTone: boolean;\n  enhanceNaturalness: boolean;\n  adjustTempo: boolean;\n  addEmotionalVariation: boolean;\n  humanizeBreathing: boolean;\n}\n\nexport class VoiceProcessor extends EventEmitter {\n  private processingOptions: VoiceProcessingOptions;\n\n  constructor() {\n    super();\n    this.processingOptions = {\n      removeRoboticTone: true,\n      enhanceNaturalness: true,\n      adjustTempo: true,\n      addEmotionalVariation: true,\n      humanizeBreathing: true\n    };\n  }\n\n  // Configura√ß√µes aprimoradas para ElevenLabs\n  getOptimizedVoiceSettings(voiceType: 'masc' | 'fem'): any {\n    const baseSettings = {\n      stability: 0.35,        // Menos est√°vel = mais natural\n      similarity_boost: 0.95, // M√°xima similaridade\n      style: 0.15,           // Estilo sutil para naturalidade\n      use_speaker_boost: true // Clareza m√°xima\n    };\n\n    // Ajustes espec√≠ficos por tipo de voz\n    if (voiceType === 'fem') {\n      return {\n        ...baseSettings,\n        stability: 0.32,    // Mulheres tendem a ser mais expressivas\n        style: 0.18        // Pouco mais de estilo para feminilidade\n      };\n    }\n\n    return {\n      ...baseSettings,\n      stability: 0.38,      // Homens mais est√°veis\n      style: 0.12          // Menos estilo para masculinidade\n    };\n  }\n\n  // Seleciona o melhor modelo baseado na qualidade desejada\n  getBestModel(priority: 'speed' | 'quality' | 'natural'): string {\n    switch (priority) {\n      case 'speed':\n        return 'eleven_flash_v2_5';\n      case 'quality':\n        return 'eleven_multilingual_v2';\n      case 'natural':\n        return 'eleven_turbo_v2_5'; // Novo modelo otimizado\n      default:\n        return 'eleven_multilingual_v2';\n    }\n  }\n\n  // Vozes recomendadas menos rob√≥ticas do ElevenLabs\n  getRecommendedVoices(): { masc: string[], fem: string[] } {\n    return {\n      masc: [\n        'pNInz6obpgDQGcFmaJgB', // Adam - voz masculina natural\n        'VR6AewLTigWG4xSOukaG', // Arnold - profundo e natural  \n        'ErXwobaYiN019PkySvjV', // Antoni - caloroso\n        'yoZ06aMxZJJ28mfd3POQ', // Sam - jovem e energ√©tico\n        'jsCqWAovK2LkecY7zXl4'  // Matheus - portugu√™s brasileiro\n      ],\n      fem: [\n        'EXAVITQu4vr4xnSDxMaL', // Bella - feminina suave\n        'AZnzlk1XvdvUeBnXmlld', // Domi - expressiva\n        'TxGEqnHWrfWFTfGW9XjX', // Josh - vers√°til\n        'pFZP5JQG7iQjIQuC4Bku', // Lily - jovem e clara\n        'CwhRBWXzGAHq8TQ4Fs17'  // Serena - brasileira natural\n      ]\n    };\n  }\n\n  // Par√¢metros avan√ßados para reduzir robotiza√ß√£o\n  getAdvancedParameters(text: string): any {\n    return {\n      pronunciation_dictionary_locators: [],\n      seed: Math.floor(Math.random() * 1000), // Varia√ß√£o aleat√≥ria\n      previous_text: \"\",\n      next_text: \"\",\n      previous_request_ids: [],\n      next_request_ids: [],\n      \n      // Configura√ß√µes espec√≠ficas para portugu√™s brasileiro\n      optimize_streaming_latency: 0, // Prioriza qualidade\n      output_format: \"mp3_44100_128\", // Alta qualidade de √°udio\n      \n      // Adiciona varia√ß√£o natural baseada no texto\n      apply_text_normalization: \"auto\"\n    };\n  }\n\n  // Processamento de √°udio p√≥s-gera√ß√£o\n  async processAudioBuffer(audioBuffer: Buffer, options?: Partial<VoiceProcessingOptions>): Promise<Buffer> {\n    const settings = { ...this.processingOptions, ...options };\n    \n    // Aqui adicionar√≠amos filtros de √°udio para:\n    // 1. Remover frequ√™ncias rob√≥ticas\n    // 2. Adicionar varia√ß√µes naturais de pitch\n    // 3. Suavizar transi√ß√µes\n    // 4. Adicionar micro-pausas humanas\n    \n    console.log('[VOICE_PROCESSOR] Processing audio with natural enhancement');\n    \n    // Por enquanto retorna o buffer original\n    // Em implementa√ß√£o futura, aplicaria filtros DSP\n    return audioBuffer;\n  }\n\n  // Configura√ß√µes otimizadas por tipo de conte√∫do\n  getSettingsForContent(contentType: 'casual' | 'professional' | 'emotional'): any {\n    const base = this.getOptimizedVoiceSettings('masc');\n    \n    switch (contentType) {\n      case 'casual':\n        return {\n          ...base,\n          stability: 0.25,  // Mais varia√ß√£o\n          style: 0.20      // Mais personalidade\n        };\n      case 'professional':\n        return {\n          ...base,\n          stability: 0.45,  // Mais consistente\n          style: 0.10      // Mais neutro\n        };\n      case 'emotional':\n        return {\n          ...base,\n          stability: 0.20,  // Muito expressivo\n          style: 0.25      // M√°xima personalidade\n        };\n      default:\n        return base;\n    }\n  }\n}\n\nexport const voiceProcessor = new VoiceProcessor();","size_bytes":4800},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n// Fun√ß√£o para obter a base URL da API baseada no local atual\nfunction getApiBaseUrl(): string {\n  const currentPath = window.location.pathname;\n  \n  // Se estamos em um subpath (ex: /abmix-ligacao/), usar esse subpath\n  if (currentPath.startsWith('/abmix-ligacao/')) {\n    return '/abmix-ligacao';\n  }\n  \n  // Caso contr√°rio, usar raiz\n  return '';\n}\n\n// Fun√ß√£o para construir URL completa da API\nfunction buildApiUrl(endpoint: string): string {\n  const baseUrl = getApiBaseUrl();\n  \n  // Garantir que o endpoint comece com /\n  const normalizedEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\n  \n  return `${baseUrl}${normalizedEndpoint}`;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  // Construir URL completa com base URL\n  const fullUrl = buildApiUrl(url);\n  \n  console.log(`[API] ${method} ${url} -> ${fullUrl}`); // Debug\n  \n  const res = await fetch(fullUrl, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    // Construir URL com base URL\n    const endpoint = queryKey.join(\"/\") as string;\n    const fullUrl = buildApiUrl(endpoint);\n    \n    console.log(`[QUERY] ${endpoint} -> ${fullUrl}`); // Debug\n    \n    const res = await fetch(fullUrl, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2379},"server/providers/voiceProvider.ts":{"content":"export interface VoiceProvider {\n  startCall(toNumber: string, voiceId?: string): Promise<{ callId: string; status: string }>;\n  hangup(callId: string): Promise<boolean>;\n  pauseAI(callId: string): Promise<boolean>;\n  resumeAI(callId: string): Promise<boolean>;\n  injectPrompt(callId: string, prompt: string): Promise<boolean>;\n  transfer(callId: string, target: string): Promise<boolean>;\n  hold(callId: string): Promise<boolean>;\n  resume(callId: string): Promise<boolean>;\n  sendDTMF(callId: string, tone: string): Promise<boolean>;\n}\n\nexport interface CallEvent {\n  type: 'call:state' | 'transcript:partial' | 'transcript:final' | 'agent:reply' | 'latency:update' | 'error';\n  callId: string;\n  payload: any;\n}\n","size_bytes":715},"client/src/components/CallControls.tsx":{"content":"import { useState } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { api } from '@/services/api';\nimport { validateE164, isDTMFTone } from '@/utils/validation';\n\nexport function CallControls() {\n  const { toast } = useToast();\n  const { currentCallId } = useCallStore();\n  const [transferTarget, setTransferTarget] = useState('');\n  const [isTransferDialogOpen, setIsTransferDialogOpen] = useState(false);\n\n  const transferMutation = useMutation({\n    mutationFn: (target: string) => api.transferCall(currentCallId!, target),\n    onSuccess: () => {\n      toast({\n        title: \"Transfer√™ncia iniciada\",\n        description: `Transferindo para ${transferTarget}`,\n      });\n      setIsTransferDialogOpen(false);\n      setTransferTarget('');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro na transfer√™ncia\",\n        description: error instanceof Error ? error.message : \"Falha na transfer√™ncia\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const holdMutation = useMutation({\n    mutationFn: () => api.holdCall(currentCallId!),\n    onSuccess: () => {\n      toast({\n        title: \"Chamada em espera\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao colocar em espera\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const dtmfMutation = useMutation({\n    mutationFn: (tone: string) => api.sendDTMF(currentCallId!, tone),\n    onSuccess: (_, tone) => {\n      toast({\n        title: `DTMF enviado: ${tone}`,\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao enviar DTMF\",\n        description: error instanceof Error ? error.message : \"Falha no envio\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleTransfer = () => {\n    if (!validateE164(transferTarget)) {\n      toast({\n        title: \"N√∫mero inv√°lido\",\n        description: \"Por favor, insira um n√∫mero no formato E.164\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    transferMutation.mutate(transferTarget);\n  };\n\n  const handleHold = () => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    holdMutation.mutate();\n  };\n\n  const sendDTMF = (tone: string) => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!isDTMFTone(tone)) {\n      toast({\n        title: \"Tom DTMF inv√°lido\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    dtmfMutation.mutate(tone);\n  };\n\n  const dtmfTones = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '*', '0', '#'];\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Controles Avan√ßados</h3>\n      \n      <div className=\"space-y-4\">\n        {/* Transfer & Hold */}\n        <div className=\"grid grid-cols-2 gap-2\">\n          <Dialog open={isTransferDialogOpen} onOpenChange={setIsTransferDialogOpen}>\n            <DialogTrigger asChild>\n              <Button\n                disabled={!currentCallId}\n                className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n                data-testid=\"transfer-button\"\n              >\n                <i className=\"fas fa-exchange-alt text-sm\"></i>\n                Transferir\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"bg-dark-surface border-dark-border text-white\">\n              <DialogHeader>\n                <DialogTitle>Transferir Chamada</DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"transfer-target\">N√∫mero de destino</Label>\n                  <Input\n                    id=\"transfer-target\"\n                    placeholder=\"+5511999999999\"\n                    value={transferTarget}\n                    onChange={(e) => setTransferTarget(e.target.value)}\n                    className=\"bg-dark-bg border-dark-border\"\n                    data-testid=\"transfer-input\"\n                  />\n                </div>\n                <div className=\"flex justify-end space-x-2\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => setIsTransferDialogOpen(false)}\n                    className=\"border-dark-border text-white\"\n                  >\n                    Cancelar\n                  </Button>\n                  <Button\n                    onClick={handleTransfer}\n                    disabled={transferMutation.isPending}\n                    className=\"bg-abmix-green text-black hover:bg-abmix-green/90\"\n                    data-testid=\"confirm-transfer-button\"\n                  >\n                    {transferMutation.isPending ? 'Transferindo...' : 'Transferir'}\n                  </Button>\n                </div>\n              </div>\n            </DialogContent>\n          </Dialog>\n\n          <Button\n            onClick={handleHold}\n            disabled={!currentCallId || holdMutation.isPending}\n            className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n            data-testid=\"hold-button\"\n          >\n            <i className=\"fas fa-pause-circle text-sm\"></i>\n            Hold\n          </Button>\n        </div>\n\n        {/* DTMF Pad */}\n        <div>\n          <Label className=\"block text-sm text-gray-400 mb-2\">DTMF</Label>\n          <div className=\"grid grid-cols-3 gap-2\">\n            {dtmfTones.map((tone) => (\n              <Button\n                key={tone}\n                onClick={() => sendDTMF(tone)}\n                disabled={!currentCallId || dtmfMutation.isPending}\n                className=\"bg-abmix-green text-black border border-abmix-green hover:bg-abmix-green/90 transition-colors py-2 rounded text-sm font-mono disabled:opacity-50\"\n                data-testid={`dtmf-${tone}`}\n              >\n                {tone}\n              </Button>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6781},"client/src/components/DubbingTranslation.tsx":{"content":"import { useState } from 'react';\nimport { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\n\nexport function DubbingTranslation() {\n  const { toast } = useToast();\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [targetLanguage, setTargetLanguage] = useState('');\n  const [preserveVoice, setPreserveVoice] = useState(true);\n\n  const languages = [\n    { code: 'pt-BR', name: 'Portugu√™s (Brasil)' },\n    { code: 'en-US', name: 'Ingl√™s (EUA)' },\n    { code: 'es-ES', name: 'Espanhol (Espanha)' },\n    { code: 'fr-FR', name: 'Franc√™s (Fran√ßa)' },\n    { code: 'de-DE', name: 'Alem√£o (Alemanha)' },\n    { code: 'it-IT', name: 'Italiano (It√°lia)' },\n    { code: 'zh-CN', name: 'Chin√™s (Mandarim)' },\n    { code: 'ja-JP', name: 'Japon√™s' }\n  ];\n\n  const dubbingMutation = useMutation({\n    mutationFn: async (data: { fileId: string; targetLang: string; preserveVoice: boolean }) => {\n      // Implementation will be added when endpoint is ready\n      return { success: true, dubbedUrl: '/dubbed-audio.wav' };\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Dublagem conclu√≠da\",\n        description: \"√Åudio traduzido e dublado com sucesso\",\n      });\n      setSelectedFile(null);\n      setTargetLanguage('');\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro na dublagem\",\n        description: error instanceof Error ? error.message : \"Falha no processamento\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.type.startsWith('audio/')) {\n        setSelectedFile(file);\n      } else {\n        toast({\n          title: \"Arquivo inv√°lido\",\n          description: \"Selecione um arquivo de √°udio\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleStartDubbing = () => {\n    if (!selectedFile || !targetLanguage) {\n      toast({\n        title: \"Dados incompletos\",\n        description: \"Selecione um arquivo e idioma de destino\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    dubbingMutation.mutate({\n      fileId: selectedFile.name,\n      targetLang: targetLanguage,\n      preserveVoice\n    });\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <h3 className=\"text-lg font-semibold mb-4\">Dublagem & Tradu√ß√£o</h3>\n      \n      <div className=\"space-y-4\">\n        <div>\n          <Label htmlFor=\"dubbing-file\" className=\"text-sm font-medium text-foreground\">\n            Arquivo de √Åudio\n          </Label>\n          <Input\n            id=\"dubbing-file\"\n            type=\"file\"\n            accept=\"audio/*\"\n            onChange={handleFileChange}\n            className=\"mt-1\"\n            data-testid=\"dubbing-file-input\"\n          />\n          {selectedFile && (\n            <p className=\"text-xs text-gray-400 mt-1\">\n              Arquivo: {selectedFile.name} ({Math.round(selectedFile.size / 1024)} KB)\n            </p>\n          )}\n        </div>\n\n        <div>\n          <Label className=\"text-sm font-medium text-foreground\">\n            Idioma de Destino\n          </Label>\n          <Select value={targetLanguage} onValueChange={setTargetLanguage}>\n            <SelectTrigger className=\"mt-1\" data-testid=\"language-select\">\n              <SelectValue placeholder=\"Selecione o idioma\" />\n            </SelectTrigger>\n            <SelectContent>\n              {languages.map((lang) => (\n                <SelectItem key={lang.code} value={lang.code}>\n                  {lang.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"flex items-center space-x-2\">\n          <input\n            type=\"checkbox\"\n            id=\"preserve-voice\"\n            checked={preserveVoice}\n            onChange={(e) => setPreserveVoice(e.target.checked)}\n            className=\"w-4 h-4 text-abmix-green bg-gray-100 border-gray-300 rounded\"\n            data-testid=\"preserve-voice-checkbox\"\n          />\n          <Label htmlFor=\"preserve-voice\" className=\"text-sm text-foreground\">\n            Preservar caracter√≠sticas da voz original\n          </Label>\n        </div>\n\n        <Button\n          onClick={handleStartDubbing}\n          disabled={!selectedFile || !targetLanguage || dubbingMutation.isPending}\n          className=\"w-full bg-abmix-green text-black hover:bg-abmix-green/80\"\n          data-testid=\"start-dubbing-button\"\n        >\n          {dubbingMutation.isPending ? 'Processando...' : 'Iniciar Dublagem'}\n        </Button>\n\n        <div className=\"mt-4 p-3 bg-dark-bg rounded-lg border border-dark-border\">\n          <p className=\"text-xs text-gray-400\">\n            <strong>Funcionalidade:</strong> Traduz automaticamente o conte√∫do de √°udio\n            para o idioma selecionado, mantendo as caracter√≠sticas vocais originais.\n            Suporta 8+ idiomas principais.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5327},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"server/telephony.ts":{"content":"// Load environment variables first\nimport { config } from \"dotenv\";\nconfig();\n\nimport type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer } from \"ws\";\nimport { elevenLabsService } from \"./elevenlabs\";\nimport { voiceConversionService } from \"./voiceConversionService\";\nimport { realtimeVoiceService } from \"./realtimeVoiceService\";\nimport { queries } from \"./database\";\nimport { writeFileSync, statSync } from \"fs\";\nimport { join } from \"path\";\n\nfunction resolvePublicBaseUrl(req?: any): string {\n  const configured = process.env.PUBLIC_BASE_URL || process.env.PUBLIC_URL || process.env.NGROK_URL;\n  if (configured) return configured.replace(/\\/$/, \"\");\n  \n  // Para desenvolvimento local, verificar se temos ngrok ou t√∫nel\n  if (process.env.NODE_ENV === 'development') {\n    // Se n√£o tiver ngrok configurado, usar simula√ß√£o local\n    console.log('[TELEPHONY] Desenvolvimento local - simulando media stream');\n    return 'local-simulation';\n  }\n  \n  if (!req) return \"\";\n  const host = (req.headers?.['x-forwarded-host'] as string) || req.headers?.host;\n  const proto = (req.headers?.['x-forwarded-proto'] as string) || (req.protocol || 'http');\n  if (host) return `${proto}://${host}`;\n  return '';\n}\n\nfunction resolveWebSocketBasePath(): string {\n  const configured = process.env.PUBLIC_BASE_PATH || process.env.PUBLIC_BASE_URL || process.env.PUBLIC_URL || process.env.NGROK_URL;\n  if (!configured) return '';\n\n  let candidate = configured.trim();\n  if (!candidate) return '';\n\n  if (candidate.includes('://')) {\n    try {\n      candidate = new URL(candidate).pathname || '';\n    } catch {\n      candidate = '';\n    }\n  }\n\n  if (!candidate) return '';\n\n  if (!candidate.startsWith('/')) {\n    candidate = `/${candidate}`;\n  }\n\n  if (candidate.length > 1 && candidate.endsWith('/')) {\n    candidate = candidate.slice(0, -1);\n  }\n\n  return candidate === '/' ? '' : candidate;\n}\n\nconst WS_BASE_PATH = resolveWebSocketBasePath();\nconst buildWsPath = (suffix: string) => {\n  const normalizedSuffix = suffix.startsWith('/') ? suffix : `/${suffix}`;\n  return WS_BASE_PATH ? `${WS_BASE_PATH}${normalizedSuffix}` : normalizedSuffix;\n};\n\n// Active calls and sessions tracking\nconst activeCalls = new Map();\nconst activeRecordings = new Map();\nconst mediaStreams = new Map();\n\n// Latency tracking for metrics\nlet latencyMetrics: number[] = [];\n\n// Audio processing function for real-time voice conversion\nfunction processUserAudio(callSid: string, audioPayload: string, streamSid: string | null, ws: any) {\n  try {\n    // Check if voice conversion is enabled for this call\n    if (realtimeVoiceService.isConversionEnabled(callSid)) {\n      console.log(`[MEDIA] Processing audio with voice conversion for ${callSid}`);\n      // Send audio to real-time voice conversion (STT -> TTS pipeline)\n      realtimeVoiceService.processIncomingAudio(callSid, audioPayload);\n    } else {\n      console.log(`[MEDIA] Passing through original audio for ${callSid}`);\n      // Pass through original audio without conversion\n      if (streamSid && ws && ws.readyState === ws.OPEN) {\n        const message = {\n          event: 'media',\n          streamSid,\n          media: { payload: audioPayload }\n        };\n        ws.send(JSON.stringify(message));\n      }\n    }\n  } catch (error) {\n    console.error('[MEDIA] Error processing user audio:', error);\n  }\n}\n\nexport function setupTelephony(app: Express, httpServer: Server) {\n  // WebSocket servers - escutar nos paths que o nginx vai fazer proxy\n  const captionsPath = buildWsPath('/captions');\n  const mediaPath = buildWsPath('/media');\n\n  const captionsWss = new WebSocketServer({ \n    server: httpServer, \n    path: captionsPath,\n    verifyClient: (info: any) => {\n      console.log('[CAPTIONS_WS] Connection attempt from:', info.origin);\n      return true; // Aceitar todas as conex√µes\n    }\n  });\n  \n  const mediaWss = new WebSocketServer({ \n    server: httpServer, \n    path: mediaPath,\n    verifyClient: (info: any) => {\n      console.log('[MEDIA_WS] Connection attempt from:', info.origin);\n      console.log('[MEDIA_WS] Headers:', info.req.headers);\n      return true; // Accept all connections\n    }\n  });\n\n  console.log(`[TELEPHONY] WebSocket servers initialized on ${captionsPath} and ${mediaPath}`);\n\n  // === WEBSOCKET HANDLERS ===\n\n  // Handle captions WebSocket connections\n  captionsWss.on('connection', (ws, req) => {\n    console.log('[CAPTIONS] Client connected to captions WebSocket');\n    \n    // Send welcome message\n    ws.send(JSON.stringify({\n      text: 'Sistema de legendas conectado',\n      isFinal: false,\n      timestamp: Date.now()\n    }));\n\n    // Handle connection close\n    ws.on('close', () => {\n      console.log('[CAPTIONS] Captions WebSocket client disconnected');\n    });\n\n    // Handle errors\n    ws.on('error', (error) => {\n      console.error('[CAPTIONS] Captions WebSocket error:', error);\n    });\n  });\n\n  // Handle media WebSocket connections from Twilio\n  mediaWss.on('connection', (ws, req) => {\n    console.log('[MEDIA] Twilio media stream connected');\n    \n    let callSid: string | null = null;\n    let streamSid: string | null = null;\n\n    ws.on('message', (message) => {\n      try {\n        const data = JSON.parse(message.toString());\n        \n        if (data.event === 'connected') {\n          console.log('[MEDIA] Media stream connected');\n          \n        } else if (data.event === 'start') {\n          // Capture identifiers from Twilio\n          callSid = data.start?.callSid;\n          streamSid = data.start?.streamSid;\n          \n          console.log(`[MEDIA] Stream started for call: ${callSid}, stream: ${streamSid}`);\n          \n          if (callSid && streamSid) {\n            mediaStreams.set(callSid, { ws, streamSid });\n            \n            // Get call configuration\n            const callInfo = activeCalls.get(callSid);\n            const voiceType = (callInfo?.voiceType as 'masc' | 'fem') || 'masc';\n            \n            console.log(`[MEDIA] Starting voice processing for ${callSid} with voice type: ${voiceType}`);\n            \n            // Start real-time voice conversion session\n            realtimeVoiceService.startRealtimeVoice(callSid, voiceType).then((success) => {\n              if (success) {\n                console.log(`[REALTIME_VOICE] Session started successfully for ${callSid}`);\n              } else {\n                console.error(`[REALTIME_VOICE] Failed to start session for ${callSid}`);\n              }\n            }).catch((error) => {\n              console.error(`[REALTIME_VOICE] Error starting session for ${callSid}:`, error);\n            });\n          }\n          \n        } else if (data.event === 'media') {\n          // Process incoming audio from caller (user's voice)\n          if (data.media && data.media.payload && callSid && streamSid) {\n            console.log(`[MEDIA] Processing audio chunk for call: ${callSid}`);\n            processUserAudio(callSid, data.media.payload, streamSid, ws);\n          }\n          \n        } else if (data.event === 'stop') {\n          console.log(`[MEDIA] Stream stopped for call: ${callSid}`);\n        }\n        \n      } catch (error) {\n        console.error('[MEDIA] Error processing media message:', error);\n      }\n    });\n\n    ws.on('close', () => {\n      console.log(`[MEDIA] Media stream disconnected for call: ${callSid}`);\n      if (callSid) {\n        mediaStreams.delete(callSid);\n        realtimeVoiceService.stopRealtimeVoice(callSid);\n      }\n    });\n\n    ws.on('error', (error) => {\n      console.error('[MEDIA] Media stream error:', error);\n    });\n  });\n\n  // Forward STT results to captions WebSocket\n  elevenLabsService.on('stt-transcript', (transcript) => {\n    captionsWss.clients.forEach((client) => {\n      if (client.readyState === client.OPEN) {\n        client.send(JSON.stringify(transcript));\n      }\n    });\n  });\n\n  // Forward ElevenLabs TTS audio to the Twilio stream\n  elevenLabsService.on('tts-audio', (sessionId: string, audioBuffer: Buffer) => {\n    const entry = mediaStreams.get(sessionId) as any;\n    if (!entry) return;\n    const { ws, streamSid } = entry;\n    if (!ws || ws.readyState !== ws.OPEN) return;\n    try {\n      const payload = audioBuffer.toString('base64');\n      const message = {\n        event: 'media',\n        streamSid,\n        media: { payload }\n      };\n      ws.send(JSON.stringify(message));\n    } catch (e) {\n      console.error('[MEDIA] Failed to send TTS audio to Twilio:', e);\n    }\n  });\n\n  // Forward converted voice audio from real-time service to Twilio stream\n  realtimeVoiceService.on('converted-voice-audio', (callSid: string, audioBuffer: Buffer) => {\n    const entry = mediaStreams.get(callSid) as any;\n    if (!entry) {\n      console.log(`[MEDIA] No stream found for call: ${callSid}`);\n      return;\n    }\n    \n    const { ws, streamSid } = entry;\n    if (!ws || ws.readyState !== ws.OPEN) {\n      console.log(`[MEDIA] WebSocket not ready for call: ${callSid}`);\n      return;\n    }\n    \n    try {\n      const payload = audioBuffer.toString('base64');\n      const message = {\n        event: 'media',\n        streamSid,\n        media: { payload }\n      };\n      \n      console.log(`[MEDIA] Sending converted audio to Twilio for call: ${callSid}`);\n      ws.send(JSON.stringify(message));\n    } catch (e) {\n      console.error('[MEDIA] Failed to send converted audio to Twilio:', e);\n    }\n  });\n\n  // === AI/PROMPT ROUTES ===\n\n  // Send live prompt\n  app.post(\"/api/ai/prompt\", (req, res) => {\n    try {\n      const { text, style = 'neutro' } = req.body;\n      \n      if (!text) {\n        return res.status(400).json({ message: \"text is required\" });\n      }\n\n      console.log(`[AI] Sending live prompt: \"${text}\" with style: ${style}`);\n\n      // Find active TTS sessions and send prompt\n      let sentCount = 0;\n      activeCalls.forEach((callData, callSid) => {\n        if (elevenLabsService.sendTTSText(callSid, text, style)) {\n          sentCount++;\n        }\n      });\n\n      res.json({ \n        message: \"Prompt sent\", \n        text, \n        style, \n        activeSessions: sentCount \n      });\n    } catch (error) {\n      console.error('[AI] Error sending prompt:', error);\n      res.status(500).json({ message: \"Failed to send prompt\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === VOICE/SETTINGS ROUTES ===\n\n  // Get voices from ElevenLabs\n  app.get(\"/api/voices\", async (req, res) => {\n    try {\n      const voices = await elevenLabsService.getVoices();\n      res.json(voices);\n    } catch (error) {\n      console.error('[VOICES] Error fetching voices:', error);\n      res.status(500).json({ message: \"Failed to fetch voices\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === VOICE CONVERSION ROUTES ===\n\n  // Toggle voice conversion for a call\n  app.post(\"/api/voice/toggle\", (req, res) => {\n    try {\n      const { callSid, enabled } = req.body;\n      \n      if (!callSid) {\n        return res.status(400).json({ message: \"callSid is required\" });\n      }\n\n      const success = realtimeVoiceService.setConversionEnabled(callSid, enabled);\n      \n      if (success) {\n        console.log(`[REALTIME_VOICE] Conversion ${enabled ? 'enabled' : 'disabled'} for call ${callSid}`);\n        res.json({ \n          message: `Voice conversion ${enabled ? 'enabled' : 'disabled'}`, \n          callSid, \n          enabled \n        });\n      } else {\n        res.status(404).json({ message: \"Call session not found\" });\n      }\n    } catch (error) {\n      console.error('[REALTIME_VOICE] Error toggling conversion:', error);\n      res.status(500).json({ message: \"Failed to toggle voice conversion\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Get voice conversion status for a call\n  app.get(\"/api/voice/status/:callSid\", (req, res) => {\n    try {\n      const { callSid } = req.params;\n      \n      const enabled = realtimeVoiceService.isConversionEnabled(callSid);\n      const stats = realtimeVoiceService.getSessionStats();\n      \n      res.json({ \n        callSid, \n        enabled,\n        stats\n      });\n    } catch (error) {\n      console.error('[REALTIME_VOICE] Error getting status:', error);\n      res.status(500).json({ message: \"Failed to get voice conversion status\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Get available voices for conversion\n  app.get(\"/api/voice/conversion-voices\", async (req, res) => {\n    try {\n      const voices = await voiceConversionService.getAvailableVoices();\n      res.json(voices);\n    } catch (error) {\n      console.error('[VOICE_CONVERSION] Error fetching conversion voices:', error);\n      res.status(500).json({ message: \"Failed to fetch conversion voices\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Get settings\n  app.get(\"/api/settings\", (req, res) => {\n    try {\n      const settings = queries.getAllSettings.all();\n      const settingsObj = settings.reduce((acc: any, setting: any) => {\n        acc[setting.key] = setting.value;\n        return acc;\n      }, {});\n      \n      res.json(settingsObj);\n    } catch (error) {\n      console.error('[SETTINGS] Error getting settings:', error);\n      res.status(500).json({ message: \"Failed to get settings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Update settings\n  app.post(\"/api/settings\", (req, res) => {\n    try {\n      const settings = req.body;\n      \n      for (const [key, value] of Object.entries(settings)) {\n        queries.setSetting.run(key, value);\n      }\n      \n      console.log('[SETTINGS] Updated settings:', Object.keys(settings));\n      res.json({ message: \"Settings updated\", keys: Object.keys(settings) });\n    } catch (error) {\n      console.error('[SETTINGS] Error updating settings:', error);\n      res.status(500).json({ message: \"Failed to update settings\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // === METRICS ROUTE ===\n\n  // SSE endpoint for real-time metrics\n  app.get(\"/api/metrics\", (req, res) => {\n    res.writeHead(200, {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*'\n    });\n\n    const sendMetrics = () => {\n      const latency = elevenLabsService.getAverageLatency();\n      const data = {\n        latency,\n        activeCalls: activeCalls.size,\n        activeRecordings: activeRecordings.size,\n        timestamp: Date.now()\n      };\n      \n      res.write(`data: ${JSON.stringify(data)}\\n\\n`);\n    };\n\n    // Send initial metrics\n    sendMetrics();\n\n    // Send metrics every 2 seconds\n    const interval = setInterval(sendMetrics, 2000);\n\n    req.on('close', () => {\n      clearInterval(interval);\n    });\n  });\n\n  // === WEBSOCKET HEARTBEAT ===\n\n  // Heartbeat to keep WS alive in Replit\n  setInterval(() => {\n    captionsWss.clients.forEach((ws: any) => {\n      if (!ws.isAlive) return ws.terminate();\n      ws.isAlive = false;\n      try { \n        ws.ping(); \n      } catch (e) {\n        // Ignore ping errors\n      }\n    });\n  }, 25000);\n\n  // === FAVORITES ROUTES ===\n\n  // List favorites\n  app.get(\"/api/favorites\", (req, res) => {\n    try {\n      const favorites = queries.getAllFavorites.all();\n      res.json(favorites);\n    } catch (error) {\n      console.error('[FAVORITES] Error listing favorites:', error);\n      res.status(500).json({ message: \"Failed to list favorites\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Add favorite\n  app.post(\"/api/favorites/add\", (req, res) => {\n    try {\n      const { name, phone_e164, voice_type = 'masc' } = req.body;\n      \n      if (!name || !phone_e164) {\n        return res.status(400).json({ message: \"name and phone_e164 are required\" });\n      }\n\n      queries.addFavorite.run(name, phone_e164, voice_type);\n      \n      console.log(`[FAVORITES] Added favorite: ${name} - ${phone_e164} (${voice_type})`);\n      res.json({ message: \"Favorite added\", name, phone_e164, voice_type });\n    } catch (error) {\n      console.error('[FAVORITES] Error adding favorite:', error);\n      res.status(500).json({ message: \"Failed to add favorite\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  // Remove favorite\n  app.post(\"/api/favorites/remove\", (req, res) => {\n    try {\n      const { id } = req.body;\n      \n      if (!id) {\n        return res.status(400).json({ message: \"id is required\" });\n      }\n\n      queries.removeFavorite.run(id);\n      \n      console.log(`[FAVORITES] Removed favorite with ID: ${id}`);\n      res.json({ message: \"Favorite removed\", id });\n    } catch (error) {\n      console.error('[FAVORITES] Error removing favorite:', error);\n      res.status(500).json({ message: \"Failed to remove favorite\", error: error instanceof Error ? error.message : String(error) });\n    }\n  });\n\n  console.log(`[TELEPHONY] WebSocket servers initialized on ${captionsPath} and ${mediaPath}`);\n  return { captionsWss, mediaWss };\n}\n","size_bytes":17115},"client/src/services/captions.ts":{"content":"// Caption WebSocket service for real-time transcription\nlet ws: WebSocket | null = null;\nconst WS_URL = `${location.protocol === 'https:' ? 'wss' : 'ws'}://${location.host}/captions`;\n\nexport function connectCaptions() {\n  if (ws) return;\n  \n  console.log('captions: connecting to', WS_URL);\n  ws = new WebSocket(WS_URL);\n  \n  ws.onopen = () => {\n    console.log('captions: open');\n  };\n  \n  ws.onmessage = (ev) => {\n    try {\n      const data = JSON.parse(ev.data);\n      // Update captions card with JSON {text, isFinal}\n      const event = new CustomEvent('captionReceived', { detail: data });\n      window.dispatchEvent(event);\n    } catch (error) {\n      console.error('captions: parse error', error);\n    }\n  };\n  \n  ws.onerror = (error) => {\n    console.log('captions: error', error);\n    ws?.close();\n  };\n  \n  ws.onclose = () => {\n    ws = null;\n    console.log('captions: closed');\n    \n    // Reconnect only if call is active\n    setTimeout(() => {\n      if ((window as any).__CALL_ACTIVE__) {\n        connectCaptions();\n      }\n    }, 2000);\n  };\n}\n\nexport function disconnectCaptions() {\n  try {\n    ws?.close();\n  } finally {\n    ws = null;\n  }\n}\n\n// Legacy compatibility\nexport const captionService = {\n  onCaption: (callback: (caption: { text: string; isFinal: boolean }) => void) => {\n    const handler = (event: any) => callback(event.detail);\n    window.addEventListener('captionReceived', handler);\n    return () => window.removeEventListener('captionReceived', handler);\n  },\n  disconnect: disconnectCaptions,\n  isConnected: () => ws?.readyState === WebSocket.OPEN || false\n};","size_bytes":1598},"scripts/fix-port.sh":{"content":"#!/bin/bash\n\n# Script para corrigir a porta na VPS\nVPS_HOST=\"root@juliocamara.dev\"\nVPS_PATH=\"/var/www/juliocamara.dev/abmix-ligacao\"\n\necho \"üîß Corrigindo configura√ß√£o de porta na VPS...\"\necho \"üì° Conectando: $VPS_HOST\"\necho \"üìÅ Diret√≥rio: $VPS_PATH\"\necho \"\"\n\n# Comandos na VPS\nssh $VPS_HOST << EOF\ncd $VPS_PATH\n\necho \"üìù 1. Atualizando .env para porta 3000...\"\nsed -i 's/PORT=5000/PORT=3000/g' .env\necho \"   ‚úÖ .env atualizado\"\n\necho \"\"\necho \"üìã 2. Verificando configura√ß√£o atual:\"\necho \"   Porta no .env: \\$(grep PORT .env)\"\necho \"   Processo rodando: \\$(ss -ltnp | grep node | head -1)\"\n\necho \"\"\necho \"üîÑ 3. Reiniciando aplica√ß√£o...\"\npm2 restart abmix-ligacao || pm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\necho \"\"\necho \"üìä 4. Status ap√≥s reinicializa√ß√£o:\"\npm2 status abmix-ligacao\n\necho \"\"\necho \"üîç 5. Verificando se est√° na porta correta:\"\nsleep 3\nss -ltnp | grep :3000 || echo \"   ‚ö†Ô∏è  Processo n√£o encontrado na porta 3000\"\n\necho \"\"\necho \"üß™ 6. Testando endpoint local:\"\ncurl -s http://localhost:3000/api/health | head -1 || echo \"   ‚ùå Endpoint n√£o responde\"\n\necho \"\"\necho \"üìã 7. √öltimas linhas do log:\"\npm2 logs abmix-ligacao --lines 5 --nostream\nEOF\n\necho \"\"\necho \"üß™ Testando acesso externo...\"\nsleep 5\n\nHTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"https://juliocamara.dev/abmix-ligacao/api/health\" || echo \"000\")\n\nif [ \"$HTTP_STATUS\" = \"200\" ]; then\n    echo \"‚úÖ CORRE√á√ÉO BEM-SUCEDIDA!\"\n    echo \"\"\n    echo \"üéâ SISTEMA FUNCIONANDO!\"\n    echo \"üì± Acesse: https://juliocamara.dev/abmix-ligacao\"\n    echo \"üé§ Teste convers√£o de voz agora!\"\n    \nelif [ \"$HTTP_STATUS\" = \"000\" ]; then\n    echo \"‚ö†Ô∏è  N√£o foi poss√≠vel testar externamente\"\n    echo \"   Teste manualmente: https://juliocamara.dev/abmix-ligacao\"\n    \nelse\n    echo \"‚ùå Ainda com problemas (Status: $HTTP_STATUS)\"\n    echo \"   Verifique: ssh $VPS_HOST 'pm2 logs abmix-ligacao'\"\nfi\n\necho \"\"\necho \"üí° Se ainda n√£o funcionar:\"\necho \"   1. Verifique se Nginx foi recarregado: sudo systemctl reload nginx\"\necho \"   2. Veja logs: pm2 logs abmix-ligacao\"\necho \"   3. Teste local: curl http://localhost:3000/api/health\"\n\n\n\n\n\n","size_bytes":2176},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"scripts/deploy-fix-conflict.sh":{"content":"#!/bin/bash\n\n# Deploy corrigindo conflito de porta\nVPS_HOST=\"root@juliocamara.dev\"\nVPS_PATH=\"/var/www/juliocamara.dev/abmix-ligacao\"\n\necho \"üöÄ Deploy do Abmix Dialer - Resolvendo Conflito de Porta\"\necho \"\"\necho \"üìã CONFIGURA√á√ÉO:\"\necho \"   ‚Ä¢ Sistema existente (sistema-vendas): porta 3000 ‚úÖ\"\necho \"   ‚Ä¢ Novo sistema (abmix-ligacao): porta 5001 ‚úÖ\"\necho \"   ‚Ä¢ Nginx: /abmix-ligacao/ ‚Üí localhost:5001\"\necho \"\"\n\n# 1. Build local\necho \"üì¶ 1. Fazendo build...\"\nnpm run build\n\nif [ ! -f \"dist/index.js\" ]; then\n    echo \"‚ùå Build falhou\"\n    exit 1\nfi\n\n# 2. Preparar .env de produ√ß√£o\necho \"üìù 2. Preparando configura√ß√£o de produ√ß√£o...\"\ncp production.env .env.prod\n\n# 3. Enviar arquivos\necho \"üì§ 3. Enviando arquivos...\"\n\nssh $VPS_HOST \"mkdir -p $VPS_PATH\"\n\nrsync -avz --progress \\\n    --include='dist/' \\\n    --include='dist/**' \\\n    --include='package.json' \\\n    --include='package-lock.json' \\\n    --include='.env.prod' \\\n    --include='data/' \\\n    --include='data/**' \\\n    --include='shared/' \\\n    --include='shared/**' \\\n    --include='juliocamara.dev' \\\n    --exclude='*' \\\n    ./ $VPS_HOST:$VPS_PATH/\n\n# 4. Configurar na VPS\necho \"üîß 4. Configurando na VPS...\"\n\nssh $VPS_HOST << EOF\ncd $VPS_PATH\n\necho \"üìù Configurando .env...\"\nmv .env.prod .env\n\necho \"üìã Verificando portas em uso:\"\necho \"   Porta 3000: \\$(ss -ltn | grep :3000 | wc -l) processo(s)\"\necho \"   Porta 5001: \\$(ss -ltn | grep :5001 | wc -l) processo(s)\"\n\necho \"\"\necho \"üì¶ Instalando depend√™ncias...\"\nnpm install --production --silent\n\necho \"üõë Parando processo anterior na porta 5001 (se existir)...\"\npm2 stop abmix-ligacao 2>/dev/null || echo \"   (Nenhum processo anterior)\"\n\n# Matar qualquer processo na porta 5001\nfuser -k 5001/tcp 2>/dev/null || echo \"   (Porta 5001 livre)\"\n\necho \"\"\necho \"üöÄ Iniciando na porta 5001...\"\nPORT=5001 pm2 start dist/index.js --name \"abmix-ligacao\" --env production\n\necho \"üíæ Salvando configura√ß√£o...\"\npm2 save\n\necho \"\"\necho \"üìã Atualizando Nginx...\"\nsudo cp juliocamara.dev /etc/nginx/sites-available/\nsudo nginx -t\nif [ \\$? -eq 0 ]; then\n    sudo systemctl reload nginx\n    echo \"‚úÖ Nginx recarregado\"\nelse\n    echo \"‚ùå Erro no Nginx\"\n    exit 1\nfi\n\necho \"\"\necho \"üìä Status final:\"\npm2 status\necho \"\"\necho \"üîç Verificando portas:\"\nss -ltnp | grep -E \":(3000|5001)\" || echo \"   Nenhum processo encontrado\"\n\necho \"\"\necho \"üß™ Teste local:\"\nsleep 3\ncurl -s http://localhost:5001/api/health | head -1 || echo \"   ‚ùå N√£o responde na porta 5001\"\nEOF\n\n# 5. Teste externo\necho \"\"\necho \"üåê 5. Testando acesso externo...\"\nsleep 5\n\nHTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"https://juliocamara.dev/abmix-ligacao/api/health\" || echo \"000\")\n\nif [ \"$HTTP_STATUS\" = \"200\" ]; then\n    echo \"‚úÖ DEPLOY BEM-SUCEDIDO!\"\n    echo \"\"\n    echo \"üéâ SISTEMA FUNCIONANDO SEM CONFLITOS!\"\n    echo \"\"\n    echo \"üì± URLs do seu sistema:\"\n    echo \"   ‚Ä¢ Painel: https://juliocamara.dev/abmix-ligacao\"\n    echo \"   ‚Ä¢ Health: https://juliocamara.dev/abmix-ligacao/api/health\"\n    echo \"\"\n    echo \"üé§ TESTE DE CONVERS√ÉO DE VOZ:\"\n    echo \"   1. Acesse o painel\"\n    echo \"   2. Fa√ßa uma liga√ß√£o\"\n    echo \"   3. Ative o switch 'Convers√£o de Voz'\"\n    echo \"   4. Converse - sua voz ser√° modificada!\"\n    echo \"\"\n    echo \"üìä Monitoramento:\"\n    echo \"   ssh root@juliocamara.dev\"\n    echo \"   pm2 logs abmix-ligacao\"\n    \nelif [ \"$HTTP_STATUS\" = \"000\" ]; then\n    echo \"‚ö†Ô∏è  N√£o foi poss√≠vel testar (poss√≠vel problema de rede)\"\n    echo \"   Teste manualmente: https://juliocamara.dev/abmix-ligacao\"\n    \nelse\n    echo \"‚ùå Ainda com problemas (Status: $HTTP_STATUS)\"\n    echo \"\"\n    echo \"üîç Debug:\"\n    echo \"   ssh root@juliocamara.dev\"\n    echo \"   pm2 logs abmix-ligacao\"\n    echo \"   ss -ltnp | grep :5001\"\n    echo \"   curl http://localhost:5001/api/health\"\nfi\n\necho \"\"\necho \"üìã RESUMO DA CONFIGURA√á√ÉO:\"\necho \"   ‚Ä¢ Sistema existente: porta 3000 (mantido)\"\necho \"   ‚Ä¢ Abmix Liga√ß√£o: porta 5001 (novo)\"\necho \"   ‚Ä¢ Nginx: /abmix-ligacao/ ‚Üí localhost:5001\"\necho \"   ‚Ä¢ SSL: wss://juliocamara.dev/abmix-ligacao/media\"\n\n\n\n\n\n","size_bytes":4108},"client/src/components/SetupModal.tsx":{"content":"import { useState } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { CheckCircle, AlertCircle, Loader2 } from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface SetupModalProps {\n  isOpen: boolean;\n  onComplete: () => void;\n}\n\nexport function SetupModal({ isOpen, onComplete }: SetupModalProps) {\n  const [step, setStep] = useState(1);\n  const [isValidating, setIsValidating] = useState(false);\n  const [formData, setFormData] = useState({\n    ELEVENLABS_API_KEY: '',\n    TWILIO_ACCOUNT_SID: '',\n    TWILIO_AUTH_TOKEN: '',\n    TWILIO_NUMBER: ''\n  });\n\n  const { toast } = useToast();\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const validateKeys = async () => {\n    setIsValidating(true);\n\n    try {\n      const response = await apiRequest('POST', '/api/setup/keys', formData);\n      const result = await response.json();\n\n      if (result.success) {\n        localStorage.setItem('abmix_setup_complete', 'true');\n        toast({\n          title: \"Configura√ß√£o Conclu√≠da\",\n          description: \"Todas as chaves foram validadas com sucesso!\",\n        });\n        onComplete();\n      } else {\n        toast({\n          title: \"Erro na Valida√ß√£o\",\n          description: result.message || \"Falha na valida√ß√£o das chaves\",\n          variant: \"destructive\"\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Erro de Conex√£o\",\n        description: \"Erro ao validar as chaves da API\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsValidating(false);\n    }\n  };\n\n  const isFormValid = Object.values(formData).every(value => value.trim() !== '');\n\n  return (\n    <Dialog open={isOpen} onOpenChange={() => {}} modal>\n      <DialogContent className=\"max-w-2xl\" data-testid=\"setup-modal\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2 text-xl\">\n            <div className=\"w-8 h-8 bg-[#10B981] rounded-lg flex items-center justify-center\">\n              <span className=\"text-white font-bold text-sm\">A</span>\n            </div>\n            Configura√ß√£o Inicial - Abmix\n          </DialogTitle>\n          <DialogDescription>\n            Configure suas chaves de API para ativar todas as funcionalidades do sistema de discagem inteligente.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Progress indicator */}\n          <div className=\"flex items-center justify-center gap-4\">\n            <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n              step >= 1 ? 'bg-[#10B981] text-white' : 'bg-gray-200 text-gray-500'\n            }`}>\n              {step > 1 ? <CheckCircle className=\"w-4 h-4\" /> : '1'}\n            </div>\n            <div className={`h-px w-12 ${step > 1 ? 'bg-[#10B981]' : 'bg-gray-200'}`} />\n            <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n              step >= 2 ? 'bg-[#10B981] text-white' : 'bg-gray-200 text-gray-500'\n            }`}>\n              {step > 2 ? <CheckCircle className=\"w-4 h-4\" /> : '2'}\n            </div>\n          </div>\n\n          {step === 1 && (\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <AlertCircle className=\"w-5 h-5 text-[#10B981]\" />\n                  Chaves de API Necess√°rias\n                </CardTitle>\n                <CardDescription>\n                  Para utilizar o Abmix, voc√™ precisa das seguintes chaves de API:\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"elevenlabs\" className=\"text-sm font-medium\">\n                      ElevenLabs API Key\n                    </Label>\n                    <Input\n                      id=\"elevenlabs\"\n                      type=\"text\"\n                      placeholder=\"Cole sua chave ElevenLabs aqui...\"\n                      value={formData.ELEVENLABS_API_KEY}\n                      onChange={(e) => handleInputChange('ELEVENLABS_API_KEY', e.target.value)}\n                      data-testid=\"input-elevenlabs-key\"\n                      className=\"font-mono text-sm\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Necess√°ria para s√≠ntese de voz e transcri√ß√£o em tempo real\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"twilio-sid\" className=\"text-sm font-medium\">\n                      Twilio Account SID\n                    </Label>\n                    <Input\n                      id=\"twilio-sid\"\n                      type=\"text\"\n                      placeholder=\"AC...\"\n                      value={formData.TWILIO_ACCOUNT_SID}\n                      onChange={(e) => handleInputChange('TWILIO_ACCOUNT_SID', e.target.value)}\n                      data-testid=\"input-twilio-sid\"\n                      className=\"font-mono text-sm\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Account SID do Twilio para servi√ßos de telefonia\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"twilio-token\" className=\"text-sm font-medium\">\n                      Twilio Auth Token\n                    </Label>\n                    <Input\n                      id=\"twilio-token\"\n                      type=\"password\"\n                      placeholder=\"Token de autentica√ß√£o...\"\n                      value={formData.TWILIO_AUTH_TOKEN}\n                      onChange={(e) => handleInputChange('TWILIO_AUTH_TOKEN', e.target.value)}\n                      data-testid=\"input-twilio-token\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Token de autentica√ß√£o do Twilio\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"twilio-number\" className=\"text-sm font-medium\">\n                      N√∫mero Twilio\n                    </Label>\n                    <Input\n                      id=\"twilio-number\"\n                      type=\"text\"\n                      placeholder=\"+55...\"\n                      value={formData.TWILIO_NUMBER}\n                      onChange={(e) => handleInputChange('TWILIO_NUMBER', e.target.value)}\n                      data-testid=\"input-twilio-number\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      N√∫mero de telefone Twilio no formato E.164 (+5511...)\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"flex justify-between pt-4\">\n                  <Button\n                    onClick={() => {\n                      localStorage.setItem('abmix_setup_skipped', 'true');\n                      toast({\n                        title: \"Configura√ß√£o Pulada\",\n                        description: \"Voc√™ pode configurar as chaves depois em Configura√ß√µes\",\n                      });\n                      onComplete();\n                    }}\n                    variant=\"outline\"\n                    data-testid=\"button-skip-setup\"\n                  >\n                    Pular por Enquanto\n                  </Button>\n                  <Button\n                    onClick={validateKeys}\n                    disabled={!isFormValid || isValidating}\n                    className=\"bg-[#10B981] hover:bg-[#059669] text-white\"\n                    data-testid=\"button-validate-keys\"\n                  >\n                    {isValidating && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                    {isValidating ? 'Validando...' : 'Validar e Continuar'}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":8573},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"server/providers/sttProvider.ts":{"content":"import WebSocket from 'ws';\nimport { EventEmitter } from 'events';\n\nexport class STTProvider extends EventEmitter {\n  private apiKey: string;\n  private connections = new Map<string, WebSocket>();\n\n  constructor() {\n    super();\n    this.apiKey = process.env.DEEPGRAM_API_KEY || process.env.DEEPGRAM_KEY || \"\";\n  }\n\n  async startStreaming(callId: string): Promise<void> {\n    try {\n      if (!this.apiKey) {\n        throw new Error('Deepgram API key not configured');\n      }\n\n      const deepgramWs = new WebSocket('wss://api.deepgram.com/v1/listen', {\n        headers: {\n          'Authorization': `Token ${this.apiKey}`\n        }\n      });\n\n      const config = {\n        model: 'nova-2',\n        language: 'pt-BR',\n        smart_format: true,\n        punctuate: true,\n        interim_results: true,\n        endpointing: 300,\n        utterance_end_ms: 1000\n      };\n\n      deepgramWs.on('open', () => {\n        console.log(`[STT_PROVIDER] Connected to Deepgram for call ${callId}`);\n        deepgramWs.send(JSON.stringify(config));\n        this.emit('stt-connected', callId);\n      });\n\n      deepgramWs.on('message', (data) => {\n        try {\n          const response = JSON.parse(data.toString());\n          \n          if (response.channel?.alternatives?.[0]?.transcript) {\n            const transcript = response.channel.alternatives[0].transcript;\n            const isFinal = response.is_final;\n            \n            console.log(`[STT_PROVIDER] Transcript (${isFinal ? 'final' : 'interim'}): ${transcript}`);\n            \n            this.emit('transcript', {\n              callId,\n              transcript,\n              isFinal,\n              timestamp: new Date()\n            });\n          }\n        } catch (error) {\n          console.error('[STT_PROVIDER] Error parsing Deepgram response:', error);\n        }\n      });\n\n      deepgramWs.on('error', (error) => {\n        console.error(`[STT_PROVIDER] Deepgram error for call ${callId}:`, error);\n        this.emit('stt-error', callId, error);\n      });\n\n      deepgramWs.on('close', () => {\n        console.log(`[STT_PROVIDER] Deepgram connection closed for call ${callId}`);\n        this.connections.delete(callId);\n        this.emit('stt-closed', callId);\n      });\n\n      this.connections.set(callId, deepgramWs);\n      \n    } catch (error) {\n      console.error('[STT_PROVIDER] Failed to start streaming:', error);\n      throw error;\n    }\n  }\n\n  async stopStreaming(callId: string): Promise<void> {\n    const connection = this.connections.get(callId);\n    if (connection) {\n      connection.close();\n      this.connections.delete(callId);\n      console.log(`[STT_PROVIDER] Stopped streaming for call ${callId}`);\n    }\n  }\n\n  // Send audio data to Deepgram\n  sendAudio(callId: string, audioData: Buffer): void {\n    const connection = this.connections.get(callId);\n    if (connection && connection.readyState === WebSocket.OPEN) {\n      connection.send(audioData);\n    }\n  }\n\n  // Send keepalive\n  sendKeepAlive(callId: string): void {\n    const connection = this.connections.get(callId);\n    if (connection && connection.readyState === WebSocket.OPEN) {\n      connection.send(JSON.stringify({ type: 'KeepAlive' }));\n    }\n  }\n}\n","size_bytes":3197},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/AgentControls.tsx":{"content":"import { useMutation } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Switch } from '@/components/ui/switch';\nimport { useToast } from '@/hooks/use-toast';\nimport { useCallStore } from '@/stores/useCallStore';\nimport { api } from '@/services/api';\n\nexport function AgentControls() {\n  const { toast } = useToast();\n  const { aiActive, setAiActive, currentCallId } = useCallStore();\n\n  const pauseAIMutation = useMutation({\n    mutationFn: () => fetch('/api/agent/disable', { \n      method: 'POST', \n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ callSid: currentCallId })\n    }).then(res => res.json()),\n    onSuccess: () => {\n      setAiActive(false);\n      toast({\n        title: \"IA pausada\",\n        description: \"Controle assumido pelo humano\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao pausar IA\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const resumeAIMutation = useMutation({\n    mutationFn: () => fetch('/api/agent/enable', { \n      method: 'POST', \n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ callSid: currentCallId })\n    }).then(res => res.json()),\n    onSuccess: () => {\n      setAiActive(true);\n      toast({\n        title: \"IA retomada\",\n        description: \"IA assumiu o controle da chamada\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao retomar IA\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleAIToggle = (checked: boolean) => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        description: \"Inicie uma chamada para controlar a IA\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (checked) {\n      resumeAIMutation.mutate();\n    } else {\n      pauseAIMutation.mutate();\n    }\n  };\n\n  const handleTakeControl = () => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    pauseAIMutation.mutate();\n  };\n\n  const handleResumeAI = () => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    resumeAIMutation.mutate();\n  };\n\n  const pauseSpeechMutation = useMutation({\n    mutationFn: () => fetch('/api/agent/pause-speech', { \n      method: 'POST', \n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ callSid: currentCallId })\n    }).then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Fala pausada\",\n        description: \"TTS pausado temporariamente\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao pausar fala\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const resumeSpeechMutation = useMutation({\n    mutationFn: () => fetch('/api/agent/resume-speech', { \n      method: 'POST', \n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ callSid: currentCallId })\n    }).then(res => res.json()),\n    onSuccess: () => {\n      toast({\n        title: \"Fala retomada\",\n        description: \"TTS retomado\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao retomar fala\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handlePauseSpeech = () => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    pauseSpeechMutation.mutate();\n  };\n\n  const handleResumeSpeech = () => {\n    if (!currentCallId) {\n      toast({\n        title: \"Nenhuma chamada ativa\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    resumeSpeechMutation.mutate();\n  };\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border h-fit\">\n      <h3 className=\"text-lg font-semibold mb-4\">Controle de IA</h3>\n      \n      <div className=\"space-y-4\">\n        {/* AI Toggle */}\n        <div className=\"flex items-center justify-between\">\n          <span className=\"font-medium\">IA Ativa</span>\n          <div className=\"flex items-center space-x-2\">\n            <Switch\n              checked={aiActive}\n              onCheckedChange={handleAIToggle}\n              disabled={!currentCallId}\n              data-testid=\"ai-toggle\"\n            />\n          </div>\n        </div>\n\n        {/* Control Buttons */}\n        <div className=\"grid grid-cols-2 gap-2\">\n          <Button\n            onClick={handleTakeControl}\n            disabled={!currentCallId || pauseAIMutation.isPending}\n            className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n            data-testid=\"take-control-button\"\n          >\n            <i className=\"fas fa-user text-sm\"></i>\n            Assumir\n          </Button>\n          \n          <Button\n            onClick={handleResumeAI}\n            disabled={!currentCallId || resumeAIMutation.isPending}\n            className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n            data-testid=\"resume-ai-button\"\n          >\n            <i className=\"fas fa-robot text-sm\"></i>\n            Retomar IA\n          </Button>\n          \n          <Button\n            onClick={handlePauseSpeech}\n            disabled={!currentCallId || pauseSpeechMutation.isPending}\n            className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n            data-testid=\"pause-speech-button\"\n          >\n            <i className=\"fas fa-pause text-sm\"></i>\n            {pauseSpeechMutation.isPending ? 'Pausando...' : 'Pausar'}\n          </Button>\n          \n          <Button\n            onClick={handleResumeSpeech}\n            disabled={!currentCallId || resumeSpeechMutation.isPending}\n            className=\"bg-abmix-green text-black py-2 px-2 rounded-lg hover:bg-abmix-green/90 transition-colors text-xs font-medium disabled:opacity-50 flex flex-col items-center justify-center gap-1\"\n            data-testid=\"resume-speech-button\"\n          >\n            <i className=\"fas fa-play text-sm\"></i>\n            {resumeSpeechMutation.isPending ? 'Retomando...' : 'Retomar'}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6973},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"scripts/deploy.sh":{"content":"#!/bin/bash\n\n# Script de deploy automatizado para VPS\n# Uso: ./scripts/deploy.sh usuario@seu-dominio.com\n\nif [ \"$#\" -ne 1 ]; then\n    echo \"‚ùå Uso: $0 usuario@seu-dominio.com\"\n    exit 1\nfi\n\nVPS_HOST=$1\nVPS_PATH=\"/var/www/abmix\"\n\necho \"üöÄ Deploy do Abmix para VPS...\"\necho \"üì° Destino: $VPS_HOST:$VPS_PATH\"\necho \"\"\n\n# 1. Build local\necho \"üì¶ 1. Fazendo build do projeto...\"\nnpm run build\n\nif [ ! -f \"dist/index.js\" ]; then\n    echo \"‚ùå Erro: Build falhou. Arquivo dist/index.js n√£o encontrado.\"\n    exit 1\nfi\n\necho \"‚úÖ Build conclu√≠do\"\n\n# 2. Verificar conex√£o SSH\necho \"\"\necho \"üîó 2. Testando conex√£o SSH...\"\nssh -o BatchMode=yes -o ConnectTimeout=5 $VPS_HOST exit\nif [ $? -ne 0 ]; then\n    echo \"‚ùå Erro: N√£o foi poss√≠vel conectar via SSH\"\n    echo \"   Verifique se a chave SSH est√° configurada\"\n    exit 1\nfi\necho \"‚úÖ Conex√£o SSH funcionando\"\n\n# 3. Criar diret√≥rio na VPS se n√£o existir\necho \"\"\necho \"üìÅ 3. Preparando diret√≥rio na VPS...\"\nssh $VPS_HOST \"mkdir -p $VPS_PATH\"\n\n# 4. Sync arquivos\necho \"\"\necho \"üì§ 4. Enviando arquivos...\"\necho \"   Arquivos inclu√≠dos: dist/, package.json, package-lock.json, .env, data/, recordings/, shared/\"\necho \"   Arquivos exclu√≠dos: node_modules/, server/, client/src/, scripts/, attached_assets/\"\n\nrsync -avz --progress \\\n    --include='dist/' \\\n    --include='dist/**' \\\n    --include='package.json' \\\n    --include='package-lock.json' \\\n    --include='.env' \\\n    --include='data/' \\\n    --include='data/**' \\\n    --include='recordings/' \\\n    --include='recordings/**' \\\n    --include='shared/' \\\n    --include='shared/**' \\\n    --exclude='*' \\\n    ./ $VPS_HOST:$VPS_PATH/\n\nif [ $? -ne 0 ]; then\n    echo \"‚ùå Erro no envio de arquivos\"\n    exit 1\nfi\n\necho \"‚úÖ Arquivos enviados com sucesso\"\n\n# 5. Instalar depend√™ncias e iniciar na VPS\necho \"\"\necho \"üîß 5. Configurando na VPS...\"\n\nssh $VPS_HOST << EOF\ncd $VPS_PATH\n\necho \"üì¶ Instalando depend√™ncias...\"\nnpm install --production --silent\n\necho \"üõë Parando processo anterior (se existir)...\"\npm2 stop abmix 2>/dev/null || echo \"   (Nenhum processo anterior encontrado)\"\n\necho \"üöÄ Iniciando novo processo...\"\npm2 start dist/index.js --name \"abmix\" --env production\n\necho \"üíæ Salvando configura√ß√£o PM2...\"\npm2 save\n\necho \"\"\necho \"üìä Status do processo:\"\npm2 status abmix\n\necho \"\"\necho \"üîç √öltimas linhas do log:\"\npm2 logs abmix --lines 10 --nostream\nEOF\n\n# 6. Verificar se est√° funcionando\necho \"\"\necho \"üß™ 6. Testando deploy...\"\n\n# Extrair dom√≠nio do host SSH\nDOMAIN=$(echo $VPS_HOST | cut -d'@' -f2)\n\necho \"   Testando: https://$DOMAIN/api/health\"\n\n# Aguardar um pouco para o servidor inicializar\nsleep 5\n\n# Testar endpoint de health\nHTTP_STATUS=$(curl -s -o /dev/null -w \"%{http_code}\" \"https://$DOMAIN/api/health\" || echo \"000\")\n\nif [ \"$HTTP_STATUS\" = \"200\" ]; then\n    echo \"‚úÖ Deploy bem-sucedido!\"\n    echo \"\"\n    echo \"üéâ SEU SISTEMA EST√Å FUNCIONANDO!\"\n    echo \"üì± Acesse: https://$DOMAIN\"\n    echo \"üé§ Teste convers√£o de voz: Fa√ßa uma liga√ß√£o e ative o switch\"\n    echo \"\"\n    echo \"üìä Monitoramento:\"\n    echo \"   pm2 logs abmix     # Ver logs\"\n    echo \"   pm2 status         # Status do processo\"\n    echo \"   pm2 restart abmix  # Reiniciar se necess√°rio\"\n    \nelif [ \"$HTTP_STATUS\" = \"000\" ]; then\n    echo \"‚ö†Ô∏è  N√£o foi poss√≠vel testar (poss√≠vel problema de rede/SSL)\"\n    echo \"   Teste manualmente: https://$DOMAIN\"\n    \nelse\n    echo \"‚ùå Erro: Servidor respondeu com status $HTTP_STATUS\"\n    echo \"   Verifique os logs: ssh $VPS_HOST 'pm2 logs abmix'\"\nfi\n\necho \"\"\necho \"üìã CONFIGURA√á√ïES IMPORTANTES PARA CONVERS√ÉO DE VOZ:\"\necho \"   ‚úÖ Certifique-se que .env cont√©m:\"\necho \"      PUBLIC_BASE_URL=https://$DOMAIN\"\necho \"   ‚úÖ SSL configurado (HTTPS obrigat√≥rio para WebSocket)\"\necho \"   ‚úÖ Nginx configurado para proxy WebSocket\"\necho \"\"\necho \"üìñ Guia detalhado: DEPLOY_VPS.md\"\n\n\n\n\n\n\n","size_bytes":3877},"server/providers/providerFactory.ts":{"content":"import { queries } from '../database';\nimport { FaleVonoProviderImpl } from './faleVonoProvider';\n\nexport interface VoIPNumberRecord {\n  id: number;\n  name: string;\n  number: string;\n  provider: string;\n  sip_username: string | null;\n  sip_password: string | null;\n  sip_server: string | null;\n  is_default: boolean;\n  status: string;\n}\n\nexport class ProviderFactory {\n  static createProvider(voipNumber: VoIPNumberRecord) {\n    console.log(`[PROVIDER_FACTORY] Creating provider for ${voipNumber.name} (${voipNumber.provider})`);\n    \n    // Only FaleVono provider is supported\n    if (voipNumber.provider.toLowerCase() !== 'falevono') {\n      throw new Error(`Provedor n√£o suportado: ${voipNumber.provider}. Apenas FaleVono √© suportado.`);\n    }\n    \n    if (!voipNumber.sip_username || !voipNumber.sip_server) {\n      throw new Error('Configura√ß√£o SIP incompleta: faltam username ou servidor');\n    }\n    \n    // SECURITY: Password must come from environment variable\n    if (!process.env.FALEVONO_PASSWORD) {\n      throw new Error('FALEVONO_PASSWORD environment variable not configured');\n    }\n    \n    // Return FaleVono provider instance\n    return new FaleVonoProviderImpl(\n      voipNumber.sip_username,\n      voipNumber.number,\n      voipNumber.sip_server,\n      5060\n    );\n  }\n\n  static getDefaultNumber(): VoIPNumberRecord | null {\n    try {\n      const defaultNumber = queries.getDefaultVoipNumber.get() as VoIPNumberRecord | undefined;\n      return defaultNumber || null;\n    } catch (error) {\n      console.error('[PROVIDER_FACTORY] Error getting default number:', error);\n      return null;\n    }\n  }\n\n  static getNumberById(id: number): VoIPNumberRecord | null {\n    try {\n      const number = queries.getVoipNumberById.get(id) as VoIPNumberRecord | undefined;\n      return number || null;\n    } catch (error) {\n      console.error('[PROVIDER_FACTORY] Error getting number by id:', error);\n      return null;\n    }\n  }\n\n  static getNumberByNumber(phoneNumber: string): VoIPNumberRecord | null {\n    try {\n      const number = queries.getVoipNumberByNumber.get(phoneNumber) as VoIPNumberRecord | undefined;\n      return number || null;\n    } catch (error) {\n      console.error('[PROVIDER_FACTORY] Error getting number by phone:', error);\n      return null;\n    }\n  }\n\n  static getProviderForCall(numberId?: number): { provider: any; voipNumber: VoIPNumberRecord } {\n    let voipNumber: VoIPNumberRecord | null = null;\n\n    if (numberId) {\n      voipNumber = this.getNumberById(numberId);\n    }\n\n    if (!voipNumber) {\n      voipNumber = this.getDefaultNumber();\n    }\n\n    if (!voipNumber) {\n      throw new Error('Nenhum n√∫mero VoIP configurado. Por favor, cadastre um n√∫mero primeiro.');\n    }\n\n    if (voipNumber.status !== 'active') {\n      throw new Error(`O n√∫mero ${voipNumber.name} est√° inativo`);\n    }\n\n    const provider = this.createProvider(voipNumber);\n    \n    return { provider, voipNumber };\n  }\n}\n","size_bytes":2940},"server/providers/faleVonoProvider.ts":{"content":"import { SIPService } from '../sipService.js';\n\nexport interface FaleVonoProvider {\n  startCall(to: string): Promise<string>;\n  hangup(callId: string): Promise<boolean>;\n}\n\nexport class FaleVonoProviderImpl implements FaleVonoProvider {\n  private sipService: SIPService;\n\n  constructor(\n    sipUsername: string,\n    fromNumber: string,\n    sipServer: string = 'vono2.me',\n    sipPort: number = 5060\n  ) {\n    // Get password from environment\n    const sipPassword = process.env.FALEVONO_PASSWORD;\n    \n    if (!sipPassword) {\n      throw new Error('FALEVONO_PASSWORD environment variable is required');\n    }\n\n    // Initialize SIP service with FaleVono credentials\n    this.sipService = new SIPService(\n      sipUsername,\n      sipPassword,\n      sipServer,\n      fromNumber,\n      sipPort\n    );\n\n    console.log('[FALEVONO_PROVIDER] Initialized with:');\n    console.log(`[FALEVONO_PROVIDER]   Username: ${sipUsername}`);\n    console.log(`[FALEVONO_PROVIDER]   Server: ${sipServer}:${sipPort}`);\n    console.log(`[FALEVONO_PROVIDER]   From Number: ${fromNumber}`);\n  }\n\n  async startCall(to: string): Promise<string> {\n    console.log(`[FALEVONO_PROVIDER] Starting call to: ${to}`);\n    try {\n      const callId = await this.sipService.makeCall(to);\n      console.log(`[FALEVONO_PROVIDER] Call initiated with ID: ${callId}`);\n      return callId;\n    } catch (error) {\n      console.error('[FALEVONO_PROVIDER] Failed to start call:', error);\n      throw error;\n    }\n  }\n\n  async hangup(callId: string): Promise<boolean> {\n    console.log(`[FALEVONO_PROVIDER] Hanging up call: ${callId}`);\n    try {\n      const success = await this.sipService.hangup(callId);\n      console.log(`[FALEVONO_PROVIDER] Hangup ${success ? 'successful' : 'failed'}`);\n      return success;\n    } catch (error) {\n      console.error('[FALEVONO_PROVIDER] Failed to hangup:', error);\n      throw error;\n    }\n  }\n}\n","size_bytes":1892},"client/src/components/VoIPNumbers.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { api } from '@/services/api';\nimport { Phone, Plus, Trash2, Star, CheckCircle } from 'lucide-react';\n\ninterface VoIPNumber {\n  id: number;\n  name: string;\n  number: string;\n  provider: string;\n  sip_username: string | null;\n  sip_server: string | null;\n  is_default: boolean;\n  status: string;\n  created_at: string;\n  // sip_password is NOT included - handled securely on server via environment variables\n}\n\nexport function VoIPNumbers() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    number: '',\n    provider: 'falevono',\n    sipUsername: '',\n    sipServer: 'vono2.me',\n    isDefault: false\n    // sipPassword removed - must be configured as environment variable on server\n  });\n\n  const { data: numbers = [], isLoading } = useQuery({\n    queryKey: ['/api/voip-numbers'],\n    queryFn: () => api.getVoipNumbers(),\n  });\n\n  const addMutation = useMutation({\n    mutationFn: (data: typeof formData) => api.addVoipNumber(data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/voip-numbers'] });\n      toast({\n        title: \"N√∫mero adicionado\",\n        description: \"N√∫mero VoIP cadastrado com sucesso!\",\n      });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao adicionar n√∫mero\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: (id: number) => api.deleteVoipNumber(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/voip-numbers'] });\n      toast({\n        title: \"N√∫mero removido\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao remover n√∫mero\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const setDefaultMutation = useMutation({\n    mutationFn: (id: number) => api.setDefaultVoipNumber(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/voip-numbers'] });\n      toast({\n        title: \"N√∫mero padr√£o definido\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Erro ao definir padr√£o\",\n        description: error instanceof Error ? error.message : \"Falha na opera√ß√£o\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      number: '',\n      provider: 'falevono',\n      sipUsername: '',\n      sipServer: 'vono2.me',\n      isDefault: false\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    addMutation.mutate(formData);\n  };\n\n  const handleDelete = (number: VoIPNumber) => {\n    if (window.confirm(`Deseja realmente remover o n√∫mero ${number.name}?`)) {\n      deleteMutation.mutate(number.id);\n    }\n  };\n\n  const handleSetDefault = (number: VoIPNumber) => {\n    setDefaultMutation.mutate(number.id);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Phone className=\"w-5 h-5\" />\n            Meus N√∫meros VoIP\n          </h3>\n        </div>\n        <div className=\"text-center text-gray-400\">Carregando...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-dark-surface rounded-xl p-6 border border-dark-border\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n          <Phone className=\"w-5 h-5 text-abmix-green\" />\n          Meus N√∫meros VoIP\n        </h3>\n        <Button\n          onClick={() => setIsDialogOpen(true)}\n          className=\"bg-abmix-green text-black hover:bg-abmix-green/90\"\n          size=\"sm\"\n          data-testid=\"button-add-voip-number\"\n        >\n          <Plus className=\"w-4 h-4 mr-1\" />\n          Adicionar N√∫mero\n        </Button>\n      </div>\n\n      <div className=\"space-y-3\">\n        {numbers.length === 0 ? (\n          <div className=\"text-center text-gray-400 py-8\">\n            <Phone className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n            <p>Nenhum n√∫mero VoIP cadastrado</p>\n            <p className=\"text-sm mt-1\">Adicione seu primeiro n√∫mero para come√ßar</p>\n          </div>\n        ) : (\n          numbers.map((number: VoIPNumber) => (\n            <div\n              key={number.id}\n              className={`bg-dark-bg rounded-lg p-4 border ${\n                number.is_default ? 'border-abmix-green' : 'border-dark-border'\n              }`}\n              data-testid={`voip-number-${number.id}`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <h4 className=\"font-semibold\">{number.name}</h4>\n                    {number.is_default && (\n                      <span className=\"bg-abmix-green/20 text-abmix-green text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\n                        <CheckCircle className=\"w-3 h-3\" />\n                        Padr√£o\n                      </span>\n                    )}\n                    <span className=\"text-xs px-2 py-0.5 rounded-full bg-abmix-green/20 text-abmix-green\">\n                      FaleVono\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-gray-400 font-mono\">{number.number}</p>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    Servidor: {number.sip_server}\n                  </p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {!number.is_default && (\n                    <Button\n                      onClick={() => handleSetDefault(number)}\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"text-gray-400 hover:text-abmix-green\"\n                      data-testid={`button-set-default-${number.id}`}\n                    >\n                      <Star className=\"w-4 h-4\" />\n                    </Button>\n                  )}\n                  <Button\n                    onClick={() => handleDelete(number)}\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"text-gray-400 hover:text-red-400\"\n                    data-testid={`button-delete-${number.id}`}\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"sm:max-w-[500px]\" data-testid=\"dialog-add-voip-number\">\n          <DialogHeader>\n            <DialogTitle>Adicionar N√∫mero VoIP</DialogTitle>\n            <DialogDescription>\n              Cadastre um novo n√∫mero VoIP para usar no sistema\n            </DialogDescription>\n          </DialogHeader>\n          <form onSubmit={handleSubmit}>\n            <div className=\"grid gap-4 py-4\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"name\">Nome do N√∫mero</Label>\n                <Input\n                  id=\"name\"\n                  placeholder=\"Ex: SP Principal\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  required\n                  data-testid=\"input-name\"\n                />\n              </div>\n              \n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"number\">N√∫mero (formato E.164)</Label>\n                <Input\n                  id=\"number\"\n                  placeholder=\"+5511951944022\"\n                  value={formData.number}\n                  onChange={(e) => setFormData({ ...formData, number: e.target.value })}\n                  required\n                  data-testid=\"input-number\"\n                />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"provider\">Provedor</Label>\n                <Select\n                  value={formData.provider}\n                  onValueChange={(value) => setFormData({ ...formData, provider: value })}\n                >\n                  <SelectTrigger data-testid=\"select-provider\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"falevono\">FaleVono (VoIP Brasil)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"bg-card border border-border rounded-lg p-3 mb-4\">\n                <p className=\"text-sm text-muted-foreground\">\n                  <strong>üîí Seguran√ßa:</strong> A senha FaleVono deve ser configurada como vari√°vel de ambiente <code className=\"bg-muted px-1 rounded\">FALEVONO_PASSWORD</code> nos secrets do Replit.\n                </p>\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"sipUsername\">Login SIP</Label>\n                <Input\n                  id=\"sipUsername\"\n                  placeholder=\"Ex: Felipe_Manieri\"\n                  value={formData.sipUsername}\n                  onChange={(e) => setFormData({ ...formData, sipUsername: e.target.value })}\n                  data-testid=\"input-sip-username\"\n                />\n              </div>\n\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"sipServer\">Servidor SIP</Label>\n                <Input\n                  id=\"sipServer\"\n                  placeholder=\"vono2.me\"\n                  value={formData.sipServer}\n                  onChange={(e) => setFormData({ ...formData, sipServer: e.target.value })}\n                  data-testid=\"input-sip-server\"\n                />\n              </div>\n\n              <div className=\"flex items-center space-x-2\">\n                <input\n                  type=\"checkbox\"\n                  id=\"isDefault\"\n                  checked={formData.isDefault}\n                  onChange={(e) => setFormData({ ...formData, isDefault: e.target.checked })}\n                  className=\"rounded border-gray-300\"\n                  data-testid=\"checkbox-is-default\"\n                />\n                <Label htmlFor=\"isDefault\" className=\"cursor-pointer\">\n                  Definir como n√∫mero padr√£o\n                </Label>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setIsDialogOpen(false)}\n                data-testid=\"button-cancel\"\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                className=\"bg-abmix-green text-black hover:bg-abmix-green/90\"\n                disabled={addMutation.isPending}\n                data-testid=\"button-submit\"\n              >\n                {addMutation.isPending ? 'Salvando...' : 'Salvar N√∫mero'}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":12069},"server/sipService.ts":{"content":"// @ts-ignore - Module 'sip' has no type definitions\nimport * as sip from 'sip';\n// @ts-ignore\nimport * as digest from 'sip/digest.js';\nimport { randomUUID } from 'crypto';\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\ninterface SIPDialog {\n  local: any;\n  remote: any;\n  routeSet: any[];\n  cseq: number;\n  inviteRequest: any;\n  lastResponse: any;\n}\n\ninterface SIPCall {\n  callId: string;\n  toNumber: string;\n  fromNumber: string;\n  dialog?: SIPDialog;\n  status: 'initiating' | 'ringing' | 'answered' | 'ended' | 'failed';\n  startTime: Date;\n  endTime?: Date;\n  error?: string;\n}\n\n// Global flag to track if SIP stack was started (singleton pattern)\nlet globalSipStarted = false;\n\nexport class SIPService {\n  private initialized: boolean = false;\n  private activeCalls: Map<string, SIPCall> = new Map();\n  private sipUsername: string;\n  private sipPassword: string;\n  private sipServer: string;\n  private sipPort: number;\n  private localIP: string;\n  private fromNumber: string;\n  private authSession: any = {};\n  private registered: boolean = false;\n\n  constructor(\n    sipUsername: string,\n    sipPassword: string,\n    sipServer: string,\n    fromNumber: string,\n    sipPort: number = 5060\n  ) {\n    this.sipUsername = sipUsername;\n    this.sipPassword = sipPassword;\n    this.sipServer = sipServer;\n    this.sipPort = sipPort;\n    this.fromNumber = fromNumber;\n    this.localIP = '172.31.70.162'; // Replit server IP\n  }\n\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      console.log('[SIP_SERVICE] Already initialized');\n      return;\n    }\n\n    try {\n      // Detect local IP if needed\n      try {\n        const { stdout } = await execAsync(\"hostname -I | awk '{print $1}'\");\n        const detectedIP = stdout.trim();\n        if (detectedIP && detectedIP !== '127.0.0.1') {\n          this.localIP = detectedIP;\n        }\n      } catch (err) {\n        console.warn('[SIP_SERVICE] Could not detect IP, using default:', this.localIP);\n      }\n\n      console.log('[SIP_SERVICE] Initializing SIP stack...');\n      console.log(`[SIP_SERVICE] Local IP: ${this.localIP}`);\n      console.log(`[SIP_SERVICE] Server: ${this.sipServer}:${this.sipPort}`);\n      console.log(`[SIP_SERVICE] Username: ${this.sipUsername}`);\n      \n      // Start SIP stack only once (singleton pattern)\n      if (!globalSipStarted) {\n        console.log('[SIP_SERVICE] Starting SIP stack for the first time...');\n        sip.start({\n          publicAddress: this.localIP,\n          port: 6060, // Use port 6060 for client\n          tcp: false,\n          logger: {\n            send: (message: any) => {\n              console.log('[SIP_SERVICE] >>> SENT:', JSON.stringify(message, null, 2).substring(0, 500));\n            },\n            recv: (message: any) => {\n              console.log('[SIP_SERVICE] <<< RECEIVED:', JSON.stringify(message, null, 2).substring(0, 500));\n              this.handleIncomingMessage(message);\n          }\n          }\n        }, (request: any) => {\n          this.handleIncomingRequest(request);\n        });\n\n        // Wait for SIP stack to fully initialize (sip.send becomes available)\n        await new Promise(resolve => setTimeout(resolve, 500));\n        globalSipStarted = true;\n        console.log('[SIP_SERVICE] Global SIP stack started successfully');\n      } else {\n        console.log('[SIP_SERVICE] Reusing existing SIP stack');\n        // Small delay to ensure previous messages are processed\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n\n      this.initialized = true;\n      console.log('[SIP_SERVICE] ‚úÖ SIP stack initialized successfully');\n      \n      // Register with server\n      await this.register();\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Failed to initialize:', error);\n      throw error;\n    }\n  }\n\n  private async register(authChallenge?: any): Promise<void> {\n    const isReregister = !!authChallenge;\n    console.log(`[SIP_SERVICE] ${isReregister ? 'Re-registering with auth' : 'Registering'}...`);\n    \n    const callId = this.authSession.callId || randomUUID();\n    const tag = this.authSession.tag || randomUUID();\n    const cseq = (this.authSession.cseq || 0) + 1;\n    \n    this.authSession.callId = callId;\n    this.authSession.tag = tag;\n    this.authSession.cseq = cseq;\n    \n    try {\n      const registerRequest: any = {\n        method: 'REGISTER',\n        uri: `sip:${this.sipServer}:${this.sipPort}`,\n        headers: {\n          to: { uri: `sip:${this.sipUsername}@${this.sipServer}` },\n          from: { \n            uri: `sip:${this.sipUsername}@${this.sipServer}`,\n            params: { tag }\n          },\n          'call-id': callId,\n          cseq: { method: 'REGISTER', seq: cseq },\n          contact: [{ uri: `sip:${this.sipUsername}@${this.localIP}:6060` }],\n          expires: 3600,\n          via: []\n        }\n      };\n\n      // Add digest authentication if we have a challenge\n      if (authChallenge) {\n        const credentials = {\n          user: this.sipUsername,\n          password: this.sipPassword\n        };\n        \n        digest.signRequest(this.authSession, registerRequest, credentials);\n        console.log('[SIP_SERVICE] Added Authorization header for REGISTER');\n      }\n      \n      sip.send(registerRequest, (error: any) => {\n        if (error) {\n          console.error('[SIP_SERVICE] ‚ùå Error sending REGISTER:', error);\n        } else {\n          console.log('[SIP_SERVICE] ‚úÖ REGISTER sent');\n        }\n      });\n      console.log('[SIP_SERVICE] REGISTER request queued');\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Registration failed:', error);\n    }\n  }\n\n  async makeCall(toNumber: string): Promise<string> {\n    if (!this.initialized) {\n      await this.initialize();\n    }\n\n    if (!this.registered) {\n      throw new Error('SIP not registered - wait for registration to complete');\n    }\n\n    const callId = randomUUID();\n    const tag = randomUUID();\n    const branch = `z9hG4bK${randomUUID()}`;\n    \n    // Clean phone number (remove non-digits)\n    const cleanNumber = toNumber.replace(/[^\\d]/g, '');\n    \n    const call: SIPCall = {\n      callId,\n      toNumber: cleanNumber,\n      fromNumber: this.fromNumber,\n      status: 'initiating',\n      startTime: new Date()\n    };\n    \n    this.activeCalls.set(callId, call);\n    \n    console.log('[SIP_SERVICE] üìû Making call...');\n    console.log(`[SIP_SERVICE]   From: ${this.fromNumber} (${this.sipUsername})`);\n    console.log(`[SIP_SERVICE]   To: ${cleanNumber}`);\n    console.log(`[SIP_SERVICE]   Call-ID: ${callId}`);\n    \n    // Create minimal SDP for audio-only call\n    const sdp = this.createSDP();\n    \n    try {\n      const inviteRequest: any = {\n        method: 'INVITE',\n        uri: `sip:${cleanNumber}@${this.sipServer}:${this.sipPort}`,\n        headers: {\n          to: { uri: `sip:${cleanNumber}@${this.sipServer}` },\n          from: { \n            uri: `sip:${this.sipUsername}@${this.sipServer}`,\n            params: { tag }\n          },\n          'call-id': callId,\n          cseq: { method: 'INVITE', seq: 1 },\n          contact: [{ uri: `sip:${this.sipUsername}@${this.localIP}:6060` }],\n          'content-type': 'application/sdp',\n          via: [{\n            version: '2.0',\n            protocol: 'UDP',\n            host: this.localIP,\n            port: 6060,\n            params: { branch }\n          }]\n        },\n        content: sdp\n      };\n\n      // Store invite request for later use in ACK/CANCEL\n      if (!call.dialog) {\n        call.dialog = {\n          local: inviteRequest.headers.from,\n          remote: inviteRequest.headers.to,\n          routeSet: [],\n          cseq: 1,\n          inviteRequest: inviteRequest,\n          lastResponse: null\n        };\n      }\n      \n      sip.send(inviteRequest, (error: any) => {\n        if (error) {\n          console.error('[SIP_SERVICE] ‚ùå Error sending INVITE:', error);\n          call.status = 'failed';\n          call.error = String(error);\n          call.endTime = new Date();\n        } else {\n          call.status = 'ringing';\n          console.log('[SIP_SERVICE] ‚úÖ INVITE sent');\n        }\n      });\n      return callId;\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Failed to send INVITE:', error);\n      call.status = 'failed';\n      call.error = String(error);\n      call.endTime = new Date();\n      throw error;\n    }\n  }\n\n  private async reInviteWithAuth(call: SIPCall, authResponse: any): Promise<void> {\n    if (!call.dialog || !call.dialog.inviteRequest) {\n      console.error(`[SIP_SERVICE] ‚ùå No stored INVITE for re-authentication`);\n      call.status = 'failed';\n      call.error = 'Cannot re-authenticate without original INVITE';\n      call.endTime = new Date();\n      return;\n    }\n\n    console.log(`[SIP_SERVICE] üîê Re-sending INVITE with digest authentication...`);\n\n    try {\n      // Create auth session for this call\n      const callAuthSession: any = {};\n      \n      // Process the auth challenge\n      digest.challenge(callAuthSession, authResponse);\n      \n      // Clone the original INVITE request\n      const reInviteRequest: any = JSON.parse(JSON.stringify(call.dialog.inviteRequest));\n      \n      // Increment CSeq for the re-attempt\n      call.dialog.cseq++;\n      reInviteRequest.headers.cseq.seq = call.dialog.cseq;\n      \n      // Add digest authentication\n      const credentials = {\n        user: this.sipUsername,\n        password: this.sipPassword\n      };\n      \n      digest.signRequest(callAuthSession, reInviteRequest, credentials);\n      \n      // Update dialog state\n      call.dialog.inviteRequest = reInviteRequest;\n      \n      // Send authenticated INVITE\n      sip.send(reInviteRequest, (error: any) => {\n        if (error) {\n          console.error('[SIP_SERVICE] ‚ùå Error sending authenticated INVITE:', error);\n          call.status = 'failed';\n          call.error = String(error);\n          call.endTime = new Date();\n        } else {\n          console.log('[SIP_SERVICE] ‚úÖ Authenticated INVITE sent');\n          call.status = 'ringing';\n        }\n      });\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Failed to re-send INVITE with auth:', error);\n      call.status = 'failed';\n      call.error = `Authentication failed: ${error}`;\n      call.endTime = new Date();\n    }\n  }\n\n  async hangup(callId: string): Promise<boolean> {\n    const call = this.activeCalls.get(callId);\n    if (!call) {\n      console.warn(`[SIP_SERVICE] Call ${callId} not found`);\n      return false;\n    }\n\n    console.log(`[SIP_SERVICE] üì¥ Hanging up call ${callId} (status: ${call.status})`);\n    \n    try {\n      if (call.status === 'answered' && call.dialog && call.dialog.lastResponse) {\n        // Send BYE for established calls\n        const contactUri = call.dialog.lastResponse.headers.contact?.[0]?.uri \n          || call.dialog.remote.uri;\n\n        const byeRequest: any = {\n          method: 'BYE',\n          uri: contactUri,\n          headers: {\n            to: call.dialog.remote,\n            from: call.dialog.local,\n            'call-id': callId,\n            cseq: { method: 'BYE', seq: call.dialog.cseq + 1 },\n            via: call.dialog.inviteRequest.headers.via\n          }\n        };\n\n        sip.send(byeRequest, (error: any) => {\n          if (error) {\n            console.error('[SIP_SERVICE] ‚ùå Error sending BYE:', error);\n          } else {\n            console.log('[SIP_SERVICE] ‚úÖ BYE sent');\n          }\n        });\n      } else if (call.status === 'ringing' || call.status === 'initiating') {\n        // Send CANCEL for ringing calls\n        if (call.dialog && call.dialog.inviteRequest) {\n          const cancelRequest: any = {\n            method: 'CANCEL',\n            uri: call.dialog.inviteRequest.uri,\n            headers: {\n              to: call.dialog.inviteRequest.headers.to,\n              from: call.dialog.inviteRequest.headers.from,\n              'call-id': callId,\n              cseq: { method: 'CANCEL', seq: call.dialog.inviteRequest.headers.cseq.seq },\n              via: call.dialog.inviteRequest.headers.via\n            }\n          };\n\n          sip.send(cancelRequest, (error: any) => {\n            if (error) {\n              console.error('[SIP_SERVICE] ‚ùå Error sending CANCEL:', error);\n            } else {\n              console.log('[SIP_SERVICE] ‚úÖ CANCEL sent');\n            }\n          });\n        }\n      }\n      \n      call.status = 'ended';\n      call.endTime = new Date();\n      return true;\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Failed to hangup:', error);\n      return false;\n    }\n  }\n\n  async sendDTMF(callId: string, digits: string): Promise<boolean> {\n    const call = this.activeCalls.get(callId);\n    if (!call || !call.dialog || call.status !== 'answered') {\n      console.warn(`[SIP_SERVICE] Call ${callId} not active for DTMF`);\n      return false;\n    }\n\n    console.log(`[SIP_SERVICE] üî¢ Sending DTMF: ${digits}`);\n    \n    try {\n      const contactUri = call.dialog.lastResponse.headers.contact?.[0]?.uri \n        || call.dialog.remote.uri;\n\n      const infoRequest: any = {\n        method: 'INFO',\n        uri: contactUri,\n        headers: {\n          to: call.dialog.remote,\n          from: call.dialog.local,\n          'call-id': callId,\n          cseq: { method: 'INFO', seq: call.dialog.cseq + 1 },\n          'content-type': 'application/dtmf-relay',\n          via: call.dialog.inviteRequest.headers.via\n        },\n        content: `Signal=${digits}\\r\\nDuration=100`\n      };\n\n      call.dialog.cseq++;\n      sip.send(infoRequest, (error: any) => {\n        if (error) {\n          console.error('[SIP_SERVICE] ‚ùå Error sending DTMF:', error);\n        } else {\n          console.log('[SIP_SERVICE] ‚úÖ DTMF sent');\n        }\n      });\n      \n      return true;\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Failed to send DTMF:', error);\n      return false;\n    }\n  }\n\n  getCallStatus(callId: string): SIPCall | undefined {\n    return this.activeCalls.get(callId);\n  }\n\n  getAllCalls(): SIPCall[] {\n    return Array.from(this.activeCalls.values());\n  }\n\n  private handleIncomingMessage(message: any): void {\n    // Handle responses (200 OK, 180 Ringing, 401/407 Auth, etc)\n    if (message.status) {\n      const callId = message.headers['call-id'];\n      \n      // Handle REGISTER responses\n      if (message.headers.cseq?.method === 'REGISTER') {\n        if (message.status === 401 || message.status === 407) {\n          console.log(`[SIP_SERVICE] üîê Received ${message.status} auth challenge for REGISTER`);\n          digest.challenge(this.authSession, message);\n          this.register(message);\n        } else if (message.status === 200) {\n          console.log('[SIP_SERVICE] ‚úÖ Registration successful!');\n          this.registered = true;\n        } else {\n          console.error(`[SIP_SERVICE] ‚ùå Registration failed with status ${message.status}`);\n        }\n        return;\n      }\n\n      // Handle INVITE responses\n      const call = this.activeCalls.get(callId);\n      if (!call) return;\n\n      switch (message.status) {\n        case 100:\n          console.log(`[SIP_SERVICE] üìû Call ${callId}: Trying...`);\n          break;\n        case 180:\n        case 183:\n          console.log(`[SIP_SERVICE] üìû Call ${callId}: Ringing...`);\n          call.status = 'ringing';\n          break;\n        case 200:\n          if (message.headers.cseq.method === 'INVITE') {\n            console.log(`[SIP_SERVICE] ‚úÖ Call ${callId}: Answered!`);\n            call.status = 'answered';\n            // Store the 200 OK response for later use\n            if (call.dialog) {\n              call.dialog.lastResponse = message;\n              // CRITICAL: remote is 'To' header (callee with their tag), not 'From' (us)\n              call.dialog.remote = message.headers.to;\n              call.dialog.local = message.headers.from;\n            }\n            // Send ACK\n            this.sendAck(call, message);\n          }\n          break;\n        case 401:\n        case 407:\n          if (message.headers.cseq.method === 'INVITE') {\n            console.log(`[SIP_SERVICE] üîê Call ${callId}: Auth challenge for INVITE (${message.status})`);\n            // Re-send INVITE with digest authentication\n            this.reInviteWithAuth(call, message);\n          }\n          break;\n        case 486:\n          console.log(`[SIP_SERVICE] üìµ Call ${callId}: Busy`);\n          call.status = 'ended';\n          call.error = 'Busy';\n          call.endTime = new Date();\n          break;\n        case 487:\n          console.log(`[SIP_SERVICE] üì¥ Call ${callId}: Cancelled`);\n          call.status = 'ended';\n          call.endTime = new Date();\n          break;\n        default:\n          if (message.status >= 400) {\n            console.log(`[SIP_SERVICE] ‚ùå Call ${callId}: Error ${message.status} - ${message.reason}`);\n            call.status = 'failed';\n            call.error = `${message.status} ${message.reason}`;\n            call.endTime = new Date();\n          }\n      }\n    }\n  }\n\n  private handleIncomingRequest(request: any): void {\n    console.log(`[SIP_SERVICE] Incoming request: ${request.method}`);\n    \n    // Handle incoming calls, BYE, etc\n    if (request.method === 'BYE') {\n      const callId = request.headers['call-id'];\n      const call = this.activeCalls.get(callId);\n      \n      if (call) {\n        console.log(`[SIP_SERVICE] üì¥ Remote party hung up call ${callId}`);\n        call.status = 'ended';\n        call.endTime = new Date();\n      }\n      \n      // Send 200 OK\n      sip.send({\n        method: 'OK',\n        status: 200,\n        reason: 'OK',\n        headers: request.headers\n      }, (error: any) => {\n        if (error) {\n          console.error('[SIP_SERVICE] ‚ùå Error sending 200 OK:', error);\n        }\n      });\n    }\n  }\n\n  private sendAck(call: SIPCall, inviteResponse: any): void {\n    try {\n      // ACK must be sent to the Contact URI from the 200 OK, not the original Request-URI\n      const contactUri = inviteResponse.headers.contact?.[0]?.uri \n        || inviteResponse.headers.from.uri;\n\n      const ackRequest: any = {\n        method: 'ACK',\n        uri: contactUri,\n        headers: {\n          to: inviteResponse.headers.to,\n          from: inviteResponse.headers.from,\n          'call-id': call.callId,\n          cseq: { method: 'ACK', seq: inviteResponse.headers.cseq.seq },\n          via: call.dialog?.inviteRequest.headers.via || inviteResponse.headers.via\n        }\n      };\n      \n      sip.send(ackRequest, (error: any) => {\n        if (error) {\n          console.error('[SIP_SERVICE] ‚ùå Error sending ACK:', error);\n        } else {\n          console.log('[SIP_SERVICE] ‚úÖ ACK sent to', contactUri);\n        }\n      });\n    } catch (error) {\n      console.error('[SIP_SERVICE] ‚ùå Failed to send ACK:', error);\n    }\n  }\n\n  private createSDP(): string {\n    const sessionId = Date.now();\n    const version = 1;\n    \n    return [\n      `v=0`,\n      `o=- ${sessionId} ${version} IN IP4 ${this.localIP}`,\n      `s=Abmix Call`,\n      `c=IN IP4 ${this.localIP}`,\n      `t=0 0`,\n      `m=audio 8000 RTP/AVP 0 8 101`,\n      `a=rtpmap:0 PCMU/8000`,\n      `a=rtpmap:8 PCMA/8000`,\n      `a=rtpmap:101 telephone-event/8000`,\n      `a=sendrecv`\n    ].join('\\r\\n') + '\\r\\n';\n  }\n\n  async shutdown(): Promise<void> {\n    console.log('[SIP_SERVICE] Shutting down...');\n    \n    // Hangup all active calls\n    const callIds = Array.from(this.activeCalls.keys());\n    for (const callId of callIds) {\n      await this.hangup(callId);\n    }\n    \n    sip.stop();\n    this.initialized = false;\n    this.registered = false;\n    console.log('[SIP_SERVICE] ‚úÖ Shutdown complete');\n  }\n}\n","size_bytes":19689},"DEPLOY.md":{"content":"# üöÄ Tutorial Completo: Deploy do Abmix no EasyPanel\n\n> **Guia passo-a-passo para fazer deploy do sistema Abmix de telefonia com IA no seu VPS usando EasyPanel**\n\n---\n\n## üìë √çndice\n\n1. [Vis√£o Geral](#-vis√£o-geral)\n2. [Pr√©-requisitos](#-pr√©-requisitos)\n3. [Etapa 1: Garantir C√≥digo no GitHub](#-etapa-1-garantir-c√≥digo-no-github)\n4. [Etapa 2: Acessar e Conectar EasyPanel](#-etapa-2-acessar-e-conectar-easypanel)\n5. [Etapa 3: Criar Aplica√ß√£o](#-etapa-3-criar-aplica√ß√£o)\n6. [Etapa 4: Configurar Vari√°veis de Ambiente](#-etapa-4-configurar-vari√°veis-de-ambiente)\n7. [Etapa 5: Configura√ß√µes Avan√ßadas (CR√çTICO)](#-etapa-5-configura√ß√µes-avan√ßadas-cr√≠tico)\n8. [Etapa 6: Fazer o Deploy Inicial](#-etapa-6-fazer-o-deploy-inicial)\n9. [Etapa 7: Verificar Funcionamento](#-etapa-7-verificar-funcionamento)\n10. [Como Atualizar o Sistema (Redeploy)](#-como-atualizar-o-sistema-redeploy)\n11. [Troubleshooting](#-troubleshooting)\n12. [Checklist Final](#-checklist-final)\n\n---\n\n## üéØ Vis√£o Geral\n\n### O Que Voc√™ Vai Fazer\n\n```\n1. GitHub       ‚Üí Garantir que o c√≥digo est√° no reposit√≥rio\n2. EasyPanel    ‚Üí Conectar ao GitHub\n3. Configurar   ‚Üí Definir vari√°veis e portas (IMPORTANTE!)\n4. Deploy       ‚Üí Apertar o bot√£o \"Deploy\"\n5. Testar       ‚Üí Confirmar que est√° funcionando\n```\n\n### Tempo Estimado\n- **Primeira vez:** 15-20 minutos\n- **Pr√≥ximas atualiza√ß√µes (Redeploy):** 2-3 minutos\n\n---\n\n## üìã Pr√©-requisitos\n\nAntes de come√ßar, tenha em m√£os:\n\n| Item | Onde Obter | Obrigat√≥rio? |\n|------|------------|--------------|\n| **VPS com EasyPanel instalado** | Seu provedor (DigitalOcean, Hetzner, etc) | ‚úÖ SIM |\n| **Conta GitHub** | https://github.com | ‚úÖ SIM |\n| **Senha FaleVono** | Sua conta vono2.me | ‚úÖ SIM |\n| **API Key ElevenLabs** | https://elevenlabs.io/app/settings/api-keys | ‚úÖ SIM |\n| **API Key Deepgram** | https://console.deepgram.com/ | ‚úÖ SIM |\n| **Dom√≠nio pr√≥prio** | Registrar.br, GoDaddy, etc | ‚ö™ OPCIONAL |\n\n---\n\n## üìÇ Etapa 1: Garantir C√≥digo no GitHub\n\n### 1.1 - Verificar Reposit√≥rio Atual\n\nO c√≥digo j√° deve estar neste reposit√≥rio GitHub:\n\n```\nPropriet√°rio: Abmix-tech-Programacao\nReposit√≥rio:  abmix-telefone\nBranch:       main\nURL:          https://github.com/Abmix-tech-Programacao/abmix-telefone\n```\n\n### 1.2 - Atualizar C√≥digo (Se Necess√°rio)\n\nSe voc√™ fez mudan√ßas no Replit e ainda n√£o enviou para o GitHub:\n\n**No painel Git do Replit:**\n1. Clique no √≠cone de **Source Control** (barra lateral esquerda)\n2. Se houver mudan√ßas pendentes, clique em **\"Commit all\"**\n3. Escreva uma mensagem: `Update Abmix system`\n4. Clique em **\"Push\"** para enviar ao GitHub\n\n**OU via terminal:**\n```bash\ngit add .\ngit commit -m \"Update Abmix system\"\ngit push origin main\n```\n\n### 1.3 - Confirmar GitHub Atualizado\n\nAcesse: https://github.com/Abmix-tech-Programacao/abmix-telefone\n\nVoc√™ deve ver os arquivos:\n- ‚úÖ `Dockerfile`\n- ‚úÖ `docker-compose.yml`\n- ‚úÖ `package.json`\n- ‚úÖ Pastas: `client`, `server`, `shared`\n\n---\n\n## üñ•Ô∏è Etapa 2: Acessar e Conectar EasyPanel\n\n### 2.1 - Fazer Login no EasyPanel\n\nAcesse o painel do seu VPS:\n\n```\nhttps://seu-dominio.com:3000\nOU\nhttp://IP-DO-SEU-VPS:3000\n```\n\n**Exemplo:**\n```\nhttps://vps.abmix.com.br:3000\nhttp://123.45.67.89:3000\n```\n\nFa√ßa login com seu **usu√°rio e senha** do EasyPanel.\n\n### 2.2 - Conectar ao GitHub (Primeira Vez)\n\nSe √© sua primeira vez usando EasyPanel com GitHub:\n\n1. No menu lateral, clique em **\"Settings\"** (Configura√ß√µes)\n2. V√° em **\"Git Providers\"** ou **\"Integrations\"**\n3. Clique em **\"Connect GitHub\"**\n4. Voc√™ ser√° redirecionado para o GitHub\n5. **Autorize** o EasyPanel a acessar seus reposit√≥rios\n6. Selecione:\n   - ‚úÖ **Acesso a reposit√≥rios espec√≠ficos** (mais seguro)\n   - Escolha: `Abmix-tech-Programacao/abmix-telefone`\n7. Clique em **\"Authorize EasyPanel\"**\n8. Voc√™ voltar√° ao EasyPanel\n\n---\n\n## üèóÔ∏è Etapa 3: Criar Aplica√ß√£o\n\n### 3.1 - Iniciar Cria√ß√£o do App\n\n1. No dashboard principal do EasyPanel, clique no bot√£o:\n   - **\"+ Create\"** OU\n   - **\"New Application\"** OU\n   - **\"Add App\"**\n\n2. Selecione a op√ß√£o: **\"From GitHub Repository\"** ou **\"Git\"**\n\n### 3.2 - Selecionar Reposit√≥rio\n\n**Preencha EXATAMENTE assim:**\n\n| Campo | Valor |\n|-------|-------|\n| **Repository** | `Abmix-tech-Programacao/abmix-telefone` |\n| **Branch** | `main` |\n| **Build Context** | `/` (raiz do projeto) |\n| **Dockerfile Path** | `Dockerfile` |\n\n### 3.3 - Definir Nome e Porta\n\n| Campo | Valor |\n|-------|-------|\n| **Application Name** | `abmix` |\n| **Port** | `5000` |\n\n> üí° **Dica:** O nome `abmix` ser√° usado na URL e nos logs.\n\n---\n\n## üîê Etapa 4: Configurar Vari√°veis de Ambiente\n\nEsta √© a se√ß√£o mais importante! Sem as vari√°veis corretas, o sistema n√£o funcionar√°.\n\n### 4.1 - Acessar Se√ß√£o de Vari√°veis\n\nNa tela de configura√ß√£o do app (ou ap√≥s criar), procure pela aba:\n- **\"Environment\"** OU\n- **\"Environment Variables\"** OU\n- **\"Variables\"**\n\n### 4.2 - Adicionar Cada Vari√°vel\n\nPara cada vari√°vel abaixo, fa√ßa:\n\n1. Clique em **\"+ Add Variable\"** ou **\"+ New\"**\n2. **Name (Nome):** Digite exatamente como mostrado abaixo\n3. **Value (Valor):** Cole sua chave/senha real\n4. Clique em **\"Save\"** ou **\"Add\"**\n\n### 4.3 - Lista Completa de Vari√°veis\n\n#### ‚úÖ Vari√°veis Obrigat√≥rias\n\n| Nome | Valor | Onde Obter |\n|------|-------|------------|\n| `NODE_ENV` | `production` | Digite exatamente assim |\n| `PORT` | `8080` | Digite exatamente assim |\n| `FALEVONO_PASSWORD` | Sua senha FaleVono | Sua conta vono2.me |\n| `ELEVENLABS_API_KEY` | Sua chave ElevenLabs | Ver se√ß√£o 4.4 |\n| `DEEPGRAM_API_KEY` | Sua chave Deepgram | Ver se√ß√£o 4.5 |\n\n### 4.4 - Como Obter API Key do ElevenLabs\n\n1. Acesse: https://elevenlabs.io/app/settings/api-keys\n2. Fa√ßa login na sua conta ElevenLabs\n3. Clique em **\"Create API Key\"** (se n√£o tiver)\n4. **Copie** a chave (come√ßa com `sk_...`)\n5. **Cole** no campo `ELEVENLABS_API_KEY` no EasyPanel\n\n**Formato esperado:**\n```\nsk_abc123xyz456...\n```\n\n### 4.5 - Como Obter API Key do Deepgram\n\n1. Acesse: https://console.deepgram.com/\n2. Fa√ßa login na sua conta Deepgram\n3. No menu lateral, clique em **\"API Keys\"**\n4. Clique em **\"Create New Key\"**\n5. D√™ um nome: `Abmix Production`\n6. **Copie** a chave gerada\n7. **Cole** no campo `DEEPGRAM_API_KEY` no EasyPanel\n\n**Formato esperado:**\n```\nabc123def456ghi789...\n```\n\n---\n\n## ‚öôÔ∏è Etapa 5: Configura√ß√µes Avan√ßadas (CR√çTICO)\n\n> ‚ö†Ô∏è **ATEN√á√ÉO:** Esta etapa √© **OBRIGAT√ìRIA** para o SIP/telefonia funcionar!\n\n### 5.1 - Acessar Configura√ß√µes Avan√ßadas\n\nProcure pela aba ou se√ß√£o:\n- **\"Advanced\"** OU\n- **\"Advanced Settings\"** OU\n- **\"Network\"** OU\n- **\"Networking\"**\n\n### 5.2 - Configurar Network Mode = host\n\n**üî¥ CR√çTICO - SEM ISSO O SIP N√ÉO FUNCIONA!**\n\nProcure a op√ß√£o **\"Network Mode\"** e configure:\n\n| Campo | Valor | Por Que? |\n|-------|-------|----------|\n| **Network Mode** | `host` | Permite comunica√ß√£o UDP para SIP |\n\n**Como fazer:**\n1. Encontre o campo **\"Network Mode\"** (pode estar em dropdown)\n2. Selecione a op√ß√£o: **`host`**\n3. Salve a configura√ß√£o\n\n> üí° **Explica√ß√£o Simples:** O protocolo SIP usa portas UDP din√¢micas. O modo `host` permite que o container acesse diretamente a rede do servidor, evitando bloqueios.\n\n### 5.3 - Alternativa: Mapeamento de Portas Manual\n\n**Use SOMENTE se a op√ß√£o \"Network Mode: host\" n√£o existir no seu EasyPanel:**\n\nAdicione as seguintes portas:\n\n| Container Port | Protocol | Published Port | Descri√ß√£o |\n|----------------|----------|----------------|-----------|\n| `5000` | TCP | `5000` | Interface web |\n| `6060` | UDP | `6060` | Cliente SIP |\n\n**Como adicionar:**\n1. Procure por **\"Port Mappings\"** ou **\"Ports\"**\n2. Clique em **\"+ Add Port\"**\n3. Preencha cada linha da tabela acima\n4. Salve\n\n### 5.4 - Configurar Restart Policy\n\n| Campo | Valor |\n|-------|-------|\n| **Restart Policy** | `unless-stopped` ou `always` |\n\nIsso garante que o app reinicia automaticamente se cair.\n\n---\n\n## üöÄ Etapa 6: Fazer o Deploy Inicial\n\n### 6.1 - Revisar Configura√ß√µes\n\nAntes de fazer deploy, confirme:\n\n- ‚úÖ Reposit√≥rio GitHub conectado\n- ‚úÖ Branch: `main`\n- ‚úÖ Dockerfile Path: `Dockerfile`\n- ‚úÖ Porta: `5000`\n- ‚úÖ Vari√°veis de ambiente configuradas (5 obrigat√≥rias)\n- ‚úÖ Network Mode: `host` (OU portas mapeadas)\n\n### 6.2 - Iniciar Deploy\n\n1. Procure o bot√£o:\n   - **\"Deploy\"** OU\n   - **\"Build & Deploy\"** OU\n   - **\"Create & Deploy\"**\n\n2. **Clique** no bot√£o\n\n3. Voc√™ ver√° a tela de build em tempo real\n\n### 6.3 - Acompanhar o Build\n\nO processo de build leva **2-5 minutos** e passa por estas etapas:\n\n```\n1. ‚è≥ Cloning repository...        (30s)\n2. ‚è≥ Building Docker image...     (2-4 min)\n3. ‚è≥ Starting container...        (30s)\n4. ‚úÖ Running                      (pronto!)\n```\n\n**Mensagens esperadas nos logs:**\n```\nBuilding image...\nStep 1/15 : FROM node:20-alpine AS build\nStep 2/15 : WORKDIR /app\n...\nSuccessfully built abc123def456\nSuccessfully tagged abmix:latest\nStarting container...\nContainer started successfully\n```\n\n### 6.4 - Confirmar Status\n\nQuando terminar, o status deve mostrar:\n\n- ‚úÖ **Status:** `Running` (verde)\n- ‚úÖ **Health:** `Healthy` (verde)\n- ‚úÖ **URL:** `http://seu-ip:5000` ou `https://seu-dominio.com`\n\n---\n\n## ‚úÖ Etapa 7: Verificar Funcionamento\n\n### 7.1 - Abrir a Interface Web\n\nAcesse a URL do seu app:\n\n```\nhttps://seu-dominio.com\nOU\nhttp://IP-DO-VPS:5000\n```\n\n**O que voc√™ deve ver:**\n- ‚úÖ Interface do Abmix carregada\n- ‚úÖ Dashboard com op√ß√µes de chamada\n- ‚úÖ N√∫meros VoIP dispon√≠veis (FaleVono - SP)\n\n### 7.2 - Testar Health Endpoint\n\nAcesse:\n```\nhttps://seu-dominio.com/api/health\n```\n\n**Resposta esperada:**\n```json\n{\n  \"status\": \"ok\",\n  \"timestamp\": \"2025-11-04T12:00:00.000Z\",\n  \"services\": {\n    \"database\": \"ok\",\n    \"sip\": \"ok\"\n  }\n}\n```\n\n### 7.3 - Verificar Logs do Sistema\n\nNo EasyPanel:\n\n1. V√° para seu app **\"abmix\"**\n2. Clique na aba **\"Logs\"**\n3. Voc√™ ver√° logs em tempo real\n\n**Logs esperados (SIP funcionando):**\n```\n[DB] Database initialized successfully\n[SIP_SERVICE] Starting SIP stack for the first time...\n[SIP_SERVICE] Global SIP stack started successfully\n[SIP_SERVICE] Registering with server vono2.me:5060...\n[SIP_SERVICE] >>> SENT: REGISTER sip:vono2.me:5060\n[SIP_SERVICE] <<< RECEIVED: 401 Unauthorized (challenge)\n[SIP_SERVICE] >>> SENT: REGISTER with auth credentials\n[SIP_SERVICE] <<< RECEIVED: 200 OK\n[SIP_SERVICE] ‚úÖ Registration successful! Expires: 3600s\n[ROUTES] API routes configured\nHTTP/WS server listening on port 5000\n```\n\n> üí° **Aten√ß√£o:** Se voc√™ ver `‚ùå Registration failed`, v√° para a se√ß√£o [Troubleshooting](#-troubleshooting).\n\n### 7.4 - Fazer uma Chamada Teste\n\n1. Na interface web do Abmix:\n   - Digite um n√∫mero: `11999999999` (apenas DDD + n√∫mero, sem +55)\n   - Selecione: **FaleVono - SP**\n   - Escolha voz: **Portuguese (Brazilian)**\n   - Clique em **\"Discar\"** ou **\"Call\"**\n\n2. Verifique os logs:\n   ```\n   [CALL] Initiating call to 11999999999\n   [SIP_SERVICE] >>> SENT: INVITE sip:11999999999@vono2.me:5060\n   [SIP_SERVICE] <<< RECEIVED: 100 Trying\n   [SIP_SERVICE] <<< RECEIVED: 183 Session Progress\n   [SIP_SERVICE] <<< RECEIVED: 200 OK\n   [SIP_SERVICE] >>> SENT: ACK\n   [CALL] ‚úÖ Call established successfully!\n   ```\n\n3. O telefone deve tocar no n√∫mero discado\n\n### 7.5 - Testar Dom√≠nio e SSL (Se Configurou)\n\nSe voc√™ adicionou um dom√≠nio:\n\n1. Acesse: `https://seu-dominio.com`\n2. Verifique o **cadeado verde** no navegador\n3. Clique no cadeado ‚Üí deve mostrar **\"Conex√£o segura\"**\n\nSe o SSL ainda n√£o funcionar:\n- Aguarde **5-10 minutos** para propaga√ß√£o DNS\n- O EasyPanel configura SSL autom√°tico via Let's Encrypt\n\n---\n\n## üîÑ Como Atualizar o Sistema (Redeploy)\n\n### Quando Usar Redeploy\n\nUse quando voc√™ fizer mudan√ßas no c√≥digo:\n- ‚úèÔ∏è Corrigiu um bug\n- ‚ú® Adicionou nova funcionalidade\n- üé® Mudou a interface\n\n### Passo 1: Atualizar C√≥digo no GitHub\n\n**No Replit:**\n```bash\n# Ap√≥s fazer suas mudan√ßas\ngit add .\ngit commit -m \"Descri√ß√£o da mudan√ßa feita\"\ngit push origin main\n```\n\n**OU no painel Git do Replit:**\n1. Commit all\n2. Push\n\n### Passo 2: Fazer Redeploy no EasyPanel\n\n1. Acesse o EasyPanel\n2. V√° para seu app **\"abmix\"**\n3. Procure o bot√£o:\n   - **\"Redeploy\"** OU\n   - **\"Rebuild\"** OU\n   - **\"Deploy Latest\"**\n4. Clique no bot√£o\n5. Aguarde 2-3 minutos\n6. Status volta para **\"Running\"** (verde)\n\n### Diferen√ßa: Deploy vs Redeploy\n\n| A√ß√£o | Quando Usar | Tempo |\n|------|-------------|-------|\n| **Deploy** | Primeira vez, app novo | 5-10 min |\n| **Redeploy** | Atualizar c√≥digo existente | 2-3 min |\n\n### Auto-Deploy (Opcional)\n\nAlguns pain√©is EasyPanel t√™m **auto-deploy** autom√°tico:\n\n1. V√° em **\"Settings\"** do app\n2. Procure **\"Auto Deploy\"** ou **\"Continuous Deployment\"**\n3. Ative a op√ß√£o\n4. Agora toda vez que voc√™ fizer `git push`, o EasyPanel faz deploy automaticamente\n\n---\n\n## üêõ Troubleshooting\n\n### ‚ùå Problema: \"SIP Registration Failed\"\n\n**Sintoma:** Nos logs aparece:\n```\n[SIP_SERVICE] ‚ùå Registration failed: timeout\n```\n\n**Causas poss√≠veis:**\n\n1. **Network Mode n√£o est√° configurado como `host`**\n   - ‚úÖ Solu√ß√£o: V√° em Advanced ‚Üí Network Mode ‚Üí Selecione `host` ‚Üí Redeploy\n\n2. **Porta UDP 6060 bloqueada no firewall do VPS**\n   - ‚úÖ Solu√ß√£o: Acesse o VPS via SSH e execute:\n   ```bash\n   sudo ufw allow 6060/udp\n   sudo ufw allow 5000/tcp\n   sudo ufw reload\n   ```\n\n3. **Senha FaleVono incorreta**\n   - ‚úÖ Solu√ß√£o: Verifique a vari√°vel `FALEVONO_PASSWORD` no EasyPanel\n   - Confirme a senha em: https://vono2.me\n\n---\n\n### ‚ùå Problema: \"Build Failed\"\n\n**Sintoma:** Build para na metade com erro:\n```\nERROR: failed to solve: process \"/bin/sh -c npm install\" did not complete successfully\n```\n\n**Causas poss√≠veis:**\n\n1. **Mem√≥ria RAM insuficiente**\n   - ‚úÖ Solu√ß√£o: VPS precisa de **m√≠nimo 1GB RAM**\n   - Aumente recursos do VPS no provedor\n\n2. **Depend√™ncias n√£o instaladas**\n   - ‚úÖ Solu√ß√£o: Force rebuild limpo:\n     - Delete o app no EasyPanel\n     - Crie novamente do zero\n\n3. **Dockerfile com erro**\n   - ‚úÖ Solu√ß√£o: Verifique se o arquivo `Dockerfile` est√° correto no GitHub\n\n---\n\n### ‚ùå Problema: \"Cannot GET /\"\n\n**Sintoma:** Ao acessar `http://seu-ip:5000`, aparece:\n```\nCannot GET /\n```\n\n**Causas poss√≠veis:**\n\n1. **Build do frontend falhou**\n   - ‚úÖ Solu√ß√£o: Verifique os logs de build\n   - Procure por erros na etapa `vite build`\n\n2. **Porta incorreta**\n   - ‚úÖ Solu√ß√£o: Confirme que a vari√°vel `PORT=5000` est√° definida\n\n---\n\n### ‚ùå Problema: \"API Key Invalid\" (ElevenLabs ou Deepgram)\n\n**Sintoma:** Nos logs aparece:\n```\n[ELEVENLABS] Error: Invalid API key\n```\n\n**Solu√ß√£o:**\n1. Verifique se copiou a chave completa (sem espa√ßos extras)\n2. Gere uma nova chave no painel:\n   - ElevenLabs: https://elevenlabs.io/app/settings/api-keys\n   - Deepgram: https://console.deepgram.com/\n3. Atualize a vari√°vel no EasyPanel\n4. Redeploy\n\n---\n\n### ‚ùå Problema: \"Port 5000 Already in Use\"\n\n**Sintoma:**\n```\nError: listen EADDRINUSE: address already in use :::5000\n```\n\n**Solu√ß√£o:**\n1. Outro app est√° usando a porta 5000\n2. Mude a porta no EasyPanel para `5001` ou `8000`\n3. Atualize a vari√°vel `PORT=5001`\n4. Redeploy\n\n---\n\n### ‚ùå Problema: SSL/HTTPS N√£o Funciona\n\n**Sintoma:** Aparece \"Conex√£o n√£o segura\" no navegador\n\n**Solu√ß√£o:**\n\n1. **Aguarde 10-15 minutos** ap√≥s adicionar o dom√≠nio\n   - Let's Encrypt leva tempo para validar\n\n2. Verifique DNS do dom√≠nio:\n   ```bash\n   nslookup seu-dominio.com\n   ```\n   Deve apontar para o IP do seu VPS\n\n3. No EasyPanel, v√° em **Domains** ‚Üí **Force SSL Renewal**\n\n---\n\n## üìä Monitoramento e Manuten√ß√£o\n\n### Ver Logs em Tempo Real\n\nNo EasyPanel:\n1. App **\"abmix\"** ‚Üí **Logs**\n2. Logs aparecem automaticamente\n3. Use filtros para procurar:\n   - `ERROR` - Erros cr√≠ticos\n   - `SIP` - Status da telefonia\n   - `CALL` - Status de chamadas\n\n### Verificar Uso de Recursos\n\nNo EasyPanel:\n1. App **\"abmix\"** ‚Üí **Metrics** (ou **Statistics**)\n2. Veja gr√°ficos de:\n   - üíæ **RAM**: Deve ficar abaixo de 80%\n   - üîÑ **CPU**: Picos durante chamadas s√£o normais\n   - üì∂ **Network**: Tr√°fego aumenta com chamadas\n\n### Backup do Banco de Dados\n\nO banco SQLite fica em `/app/data/app.db`.\n\nPara fazer backup:\n```bash\n# Acessar o container\ndocker exec -it abmix sh\n\n# Copiar banco de dados\ncp /app/data/app.db /app/data/backup-$(date +%Y%m%d).db\n```\n\n---\n\n## ‚úÖ Checklist Final\n\nAntes de considerar o deploy **100% completo**, marque todos os itens:\n\n### Configura√ß√£o B√°sica\n- [ ] Reposit√≥rio GitHub atualizado\n- [ ] App criado no EasyPanel\n- [ ] Dockerfile Path: `Dockerfile`\n- [ ] Branch: `main`\n- [ ] Port: `5000`\n\n### Vari√°veis de Ambiente\n- [ ] `NODE_ENV=production`\n- [ ] `PORT=5000`\n- [ ] `FALEVONO_PASSWORD` (senha correta)\n- [ ] `ELEVENLABS_API_KEY` (chave v√°lida)\n- [ ] `DEEPGRAM_API_KEY` (chave v√°lida)\n\n### Configura√ß√µes Avan√ßadas\n- [ ] **Network Mode: `host`** (CR√çTICO!)\n- [ ] Restart Policy: `unless-stopped`\n- [ ] Firewall liberado (portas 5000/TCP e 6060/UDP)\n\n### Testes de Funcionamento\n- [ ] Interface web abre no navegador\n- [ ] Health endpoint retorna `{\"status\":\"ok\"}`\n- [ ] Logs mostram `‚úÖ Registration successful`\n- [ ] Consegue fazer uma chamada teste\n- [ ] Telefone toca no n√∫mero discado\n\n### Seguran√ßa e Extras\n- [ ] SSL configurado (se usar dom√≠nio)\n- [ ] Senhas/API keys n√£o est√£o no c√≥digo\n- [ ] Backup do banco de dados configurado\n- [ ] Monitoramento ativo\n\n---\n\n## üéâ Parab√©ns!\n\nSe voc√™ marcou **todos os itens** do checklist, seu sistema Abmix est√°:\n\n‚úÖ **Funcionando em produ√ß√£o**  \n‚úÖ **Fazendo chamadas VoIP reais**  \n‚úÖ **Integrado com IA (ElevenLabs + Deepgram)**  \n‚úÖ **Seguro e monitorado**  \n\n---\n\n## üìû Suporte e Documenta√ß√£o\n\n### Comandos √öteis (SSH no VPS)\n\n```bash\n# Ver containers rodando\ndocker ps\n\n# Ver logs do container\ndocker logs abmix -f --tail 100\n\n# Entrar no container\ndocker exec -it abmix sh\n\n# Reiniciar container\ndocker restart abmix\n\n# Verificar portas abertas\nsudo netstat -tulpn | grep 5000\nsudo netstat -tulpn | grep 6060\n```\n\n### Links √öteis\n\n- **FaleVono:** https://vono2.me\n- **ElevenLabs API Keys:** https://elevenlabs.io/app/settings/api-keys\n- **Deepgram Console:** https://console.deepgram.com/\n- **Documenta√ß√£o Docker:** https://docs.docker.com/\n- **Let's Encrypt Status:** https://letsencrypt.status.io/\n\n---\n\n## üîÑ Pr√≥ximos Passos\n\nAgora que o sistema est√° no ar, voc√™ pode:\n\n1. **Adicionar mais n√∫meros VoIP** no painel\n2. **Customizar vozes da IA** no ElevenLabs\n3. **Configurar webhooks** para integra√ß√µes\n4. **Escalar** adicionando mais recursos ao VPS\n5. **Monitorar** m√©tricas de chamadas e uso\n\n---\n\n**Desenvolvido com ‚ù§Ô∏è para Abmix**  \n*Sistema de Telefonia Inteligente com IA*\n","size_bytes":18709}},"version":2}